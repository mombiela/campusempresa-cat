<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projecte de Predicció de Sèries Temporals</title>

    <link rel="alternate" href="https://campusempresa.com/mod/pytorch/07-03-time-series-forecasting-project" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/pytorch/07-03-time-series-forecasting-project" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/pytorch/07-03-time-series-forecasting-project" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/pytorch/07-03-time-series-forecasting-project" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/pytorch/07-03-time-series-forecasting-project" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Projecte</a>
				<a href="/about">Sobre nosaltres</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donacions</a>
				<a href="/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='07-02-nlp-project' title="Projecte de Processament del Llenguatge Natural">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Projecte de Predicció de Sèries Temporals</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='07-04-custom-project' title="Projecte Personalitzat">Següent &#x25BA;</a>
			</div>
</div>
<div class='content'><p>En aquest projecte, aplicarem els coneixements adquirits sobre PyTorch per construir un model de predicció de sèries temporals. Les sèries temporals són dades que es recullen en intervals de temps regulars, com ara preus d'accions, temperatures diàries, etc. Utilitzarem una xarxa neuronal recurrent (RNN) per predir els valors futurs d'una sèrie temporal.</p>
</div><h1>Objectius del Projecte</h1>
<div class='content'><ol>
<li><strong>Càrrega i Preprocessament de Dades</strong>: Aprendre a carregar i preprocessar dades de sèries temporals.</li>
<li><strong>Construcció del Model</strong>: Construir una RNN per a la predicció de sèries temporals.</li>
<li><strong>Entrenament del Model</strong>: Entrenar la RNN amb les dades de sèries temporals.</li>
<li><strong>Avaluació del Model</strong>: Avaluar el rendiment del model i fer prediccions.</li>
</ol>
</div><h1>1. Càrrega i Preprocessament de Dades</h1>
<div class='content'></div><h2>1.1. Importació de Llibreries</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaC5ubiBhcyBubgppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgbWF0cGxvdGxpYi5weXBsb3QgYXMgcGx0CmZyb20gc2tsZWFybi5wcmVwcm9jZXNzaW5nIGltcG9ydCBNaW5NYXhTY2FsZXI="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
import torch.nn as nn
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.preprocessing import MinMaxScaler</pre></div><div class='content'></div><h2>1.2. Càrrega de les Dades</h2>
<div class='content'><p>Per a aquest projecte, utilitzarem un conjunt de dades de preus d'accions. Pots descarregar un conjunt de dades de Yahoo Finance o utilitzar qualsevol altre conjunt de dades de sèries temporals.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBDYXJyZWdhciBsZXMgZGFkZXMKZGF0YSA9IHBkLnJlYWRfY3N2KCdzdG9ja19wcmljZXMuY3N2JykKZGF0YS5oZWFkKCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Carregar les dades
data = pd.read_csv('stock_prices.csv')
data.head()</pre></div><div class='content'></div><h2>1.3. Preprocessament de les Dades</h2>
<div class='content'><p>Normalitzarem les dades per assegurar-nos que totes les característiques tinguin la mateixa escala.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBOb3JtYWxpdHphciBsZXMgZGFkZXMKc2NhbGVyID0gTWluTWF4U2NhbGVyKGZlYXR1cmVfcmFuZ2U9KC0xLCAxKSkKZGF0YV9ub3JtYWxpemVkID0gc2NhbGVyLmZpdF90cmFuc2Zvcm0oZGF0YVsnQ2xvc2UnXS52YWx1ZXMucmVzaGFwZSgtMSwgMSkpCgojIENvbnZlcnRpciBsZXMgZGFkZXMgYSB0ZW5zb3JzCmRhdGFfbm9ybWFsaXplZCA9IHRvcmNoLkZsb2F0VGVuc29yKGRhdGFfbm9ybWFsaXplZCkudmlldygtMSk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Normalitzar les dades
scaler = MinMaxScaler(feature_range=(-1, 1))
data_normalized = scaler.fit_transform(data['Close'].values.reshape(-1, 1))

# Convertir les dades a tensors
data_normalized = torch.FloatTensor(data_normalized).view(-1)</pre></div><div class='content'></div><h2>1.4. Creació de Seqüències de Dades</h2>
<div class='content'><p>Dividirem les dades en seqüències per entrenar la nostra RNN.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGVmIGNyZWF0ZV9pbm91dF9zZXF1ZW5jZXMoaW5wdXRfZGF0YSwgdHcpOgogICAgaW5vdXRfc2VxID0gW10KICAgIEwgPSBsZW4oaW5wdXRfZGF0YSkKICAgIGZvciBpIGluIHJhbmdlKEwtdHcpOgogICAgICAgIHRyYWluX3NlcSA9IGlucHV0X2RhdGFbaTppK3R3XQogICAgICAgIHRyYWluX2xhYmVsID0gaW5wdXRfZGF0YVtpK3R3OmkrdHcrMV0KICAgICAgICBpbm91dF9zZXEuYXBwZW5kKCh0cmFpbl9zZXEsIHRyYWluX2xhYmVsKSkKICAgIHJldHVybiBpbm91dF9zZXEKCnRyYWluX3dpbmRvdyA9IDEyCnRyYWluX2lub3V0X3NlcSA9IGNyZWF0ZV9pbm91dF9zZXF1ZW5jZXMoZGF0YV9ub3JtYWxpemVkLCB0cmFpbl93aW5kb3cp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>def create_inout_sequences(input_data, tw):
    inout_seq = []
    L = len(input_data)
    for i in range(L-tw):
        train_seq = input_data[i:i+tw]
        train_label = input_data[i+tw:i+tw+1]
        inout_seq.append((train_seq, train_label))
    return inout_seq

train_window = 12
train_inout_seq = create_inout_sequences(data_normalized, train_window)</pre></div><div class='content'></div><h1>2. Construcció del Model</h1>
<div class='content'></div><h2>2.1. Definició de la Xarxa Neuronal</h2>
<div class='content'><p>Crearem una RNN simple utilitzant PyTorch.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgTFNUTShubi5Nb2R1bGUpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGlucHV0X3NpemU9MSwgaGlkZGVuX2xheWVyX3NpemU9MTAwLCBvdXRwdXRfc2l6ZT0xKToKICAgICAgICBzdXBlcihMU1RNLCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5oaWRkZW5fbGF5ZXJfc2l6ZSA9IGhpZGRlbl9sYXllcl9zaXplCiAgICAgICAgc2VsZi5sc3RtID0gbm4uTFNUTShpbnB1dF9zaXplLCBoaWRkZW5fbGF5ZXJfc2l6ZSkKICAgICAgICBzZWxmLmxpbmVhciA9IG5uLkxpbmVhcihoaWRkZW5fbGF5ZXJfc2l6ZSwgb3V0cHV0X3NpemUpCiAgICAgICAgc2VsZi5oaWRkZW5fY2VsbCA9ICh0b3JjaC56ZXJvcygxLDEsc2VsZi5oaWRkZW5fbGF5ZXJfc2l6ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3JjaC56ZXJvcygxLDEsc2VsZi5oaWRkZW5fbGF5ZXJfc2l6ZSkpCgogICAgZGVmIGZvcndhcmQoc2VsZiwgaW5wdXRfc2VxKToKICAgICAgICBsc3RtX291dCwgc2VsZi5oaWRkZW5fY2VsbCA9IHNlbGYubHN0bShpbnB1dF9zZXEudmlldyhsZW4oaW5wdXRfc2VxKSAsMSwgLTEpLCBzZWxmLmhpZGRlbl9jZWxsKQogICAgICAgIHByZWRpY3Rpb25zID0gc2VsZi5saW5lYXIobHN0bV9vdXQudmlldyhsZW4oaW5wdXRfc2VxKSwgLTEpKQogICAgICAgIHJldHVybiBwcmVkaWN0aW9uc1stMV0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class LSTM(nn.Module):
    def __init__(self, input_size=1, hidden_layer_size=100, output_size=1):
        super(LSTM, self).__init__()
        self.hidden_layer_size = hidden_layer_size
        self.lstm = nn.LSTM(input_size, hidden_layer_size)
        self.linear = nn.Linear(hidden_layer_size, output_size)
        self.hidden_cell = (torch.zeros(1,1,self.hidden_layer_size),
                            torch.zeros(1,1,self.hidden_layer_size))

    def forward(self, input_seq):
        lstm_out, self.hidden_cell = self.lstm(input_seq.view(len(input_seq) ,1, -1), self.hidden_cell)
        predictions = self.linear(lstm_out.view(len(input_seq), -1))
        return predictions[-1]</pre></div><div class='content'></div><h1>3. Entrenament del Model</h1>
<div class='content'></div><h2>3.1. Definició de la Funció de Pèrdua i l'Optimitzador</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bW9kZWwgPSBMU1RNKCkKbG9zc19mdW5jdGlvbiA9IG5uLk1TRUxvc3MoKQpvcHRpbWl6ZXIgPSB0b3JjaC5vcHRpbS5BZGFtKG1vZGVsLnBhcmFtZXRlcnMoKSwgbHI9MC4wMDEp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>model = LSTM()
loss_function = nn.MSELoss()
optimizer = torch.optim.Adam(model.parameters(), lr=0.001)</pre></div><div class='content'></div><h2>3.2. Entrenament</h2>
<div class='content'><p>Entrenarem el model amb les seqüències de dades creades anteriorment.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZXBvY2hzID0gMTUwCgpmb3IgaSBpbiByYW5nZShlcG9jaHMpOgogICAgZm9yIHNlcSwgbGFiZWxzIGluIHRyYWluX2lub3V0X3NlcToKICAgICAgICBvcHRpbWl6ZXIuemVyb19ncmFkKCkKICAgICAgICBtb2RlbC5oaWRkZW5fY2VsbCA9ICh0b3JjaC56ZXJvcygxLCAxLCBtb2RlbC5oaWRkZW5fbGF5ZXJfc2l6ZSksCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcmNoLnplcm9zKDEsIDEsIG1vZGVsLmhpZGRlbl9sYXllcl9zaXplKSkKCiAgICAgICAgeV9wcmVkID0gbW9kZWwoc2VxKQoKICAgICAgICBzaW5nbGVfbG9zcyA9IGxvc3NfZnVuY3Rpb24oeV9wcmVkLCBsYWJlbHMpCiAgICAgICAgc2luZ2xlX2xvc3MuYmFja3dhcmQoKQogICAgICAgIG9wdGltaXplci5zdGVwKCkKCiAgICBpZiBpJTI1ID09IDE6CiAgICAgICAgcHJpbnQoZidlcG9jaDoge2k6M30gbG9zczoge3NpbmdsZV9sb3NzLml0ZW0oKToxMC44Zn0nKQoKcHJpbnQoZidlcG9jaDoge2k6M30gbG9zczoge3NpbmdsZV9sb3NzLml0ZW0oKToxMC4xMGZ9Jyk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>epochs = 150

for i in range(epochs):
    for seq, labels in train_inout_seq:
        optimizer.zero_grad()
        model.hidden_cell = (torch.zeros(1, 1, model.hidden_layer_size),
                        torch.zeros(1, 1, model.hidden_layer_size))

        y_pred = model(seq)

        single_loss = loss_function(y_pred, labels)
        single_loss.backward()
        optimizer.step()

    if i%25 == 1:
        print(f'epoch: {i:3} loss: {single_loss.item():10.8f}')

print(f'epoch: {i:3} loss: {single_loss.item():10.10f}')</pre></div><div class='content'></div><h1>4. Avaluació del Model</h1>
<div class='content'></div><h2>4.1. Predicció</h2>
<div class='content'><p>Utilitzarem el model entrenat per fer prediccions sobre les dades de test.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnV0X3ByZWQgPSAxMgoKdGVzdF9pbnB1dHMgPSBkYXRhX25vcm1hbGl6ZWRbLXRyYWluX3dpbmRvdzpdLnRvbGlzdCgpCgptb2RlbC5ldmFsKCkKCmZvciBpIGluIHJhbmdlKGZ1dF9wcmVkKToKICAgIHNlcSA9IHRvcmNoLkZsb2F0VGVuc29yKHRlc3RfaW5wdXRzWy10cmFpbl93aW5kb3c6XSkKICAgIHdpdGggdG9yY2gubm9fZ3JhZCgpOgogICAgICAgIHRlc3RfaW5wdXRzLmFwcGVuZChtb2RlbChzZXEpLml0ZW0oKSkKCmFjdHVhbF9wcmVkaWN0aW9ucyA9IHNjYWxlci5pbnZlcnNlX3RyYW5zZm9ybShucC5hcnJheSh0ZXN0X2lucHV0c1t0cmFpbl93aW5kb3c6XSApLnJlc2hhcGUoLTEsIDEpKQoKcGx0LnRpdGxlKCdQcmVkaWNjacOzIGRlIFPDqHJpZXMgVGVtcG9yYWxzJykKcGx0LnlsYWJlbCgnUHJldSBkZSBsZXMgQWNjaW9ucycpCnBsdC5ncmlkKFRydWUpCnBsdC5hdXRvc2NhbGUoYXhpcz0neCcsIHRpZ2h0PVRydWUpCnBsdC5wbG90KGRhdGFbJ0Nsb3NlJ10pCnBsdC5wbG90KHJhbmdlKGxlbihkYXRhWydDbG9zZSddKSwgbGVuKGRhdGFbJ0Nsb3NlJ10pICsgZnV0X3ByZWQpLCBhY3R1YWxfcHJlZGljdGlvbnMpCnBsdC5zaG93KCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>fut_pred = 12

test_inputs = data_normalized[-train_window:].tolist()

model.eval()

for i in range(fut_pred):
    seq = torch.FloatTensor(test_inputs[-train_window:])
    with torch.no_grad():
        test_inputs.append(model(seq).item())

actual_predictions = scaler.inverse_transform(np.array(test_inputs[train_window:] ).reshape(-1, 1))

plt.title('Predicci&oacute; de S&egrave;ries Temporals')
plt.ylabel('Preu de les Accions')
plt.grid(True)
plt.autoscale(axis='x', tight=True)
plt.plot(data['Close'])
plt.plot(range(len(data['Close']), len(data['Close']) + fut_pred), actual_predictions)
plt.show()</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>En aquest projecte, hem après a carregar i preprocessar dades de sèries temporals, construir una RNN utilitzant PyTorch, entrenar el model i fer prediccions. Aquest projecte proporciona una base sòlida per a la predicció de sèries temporals amb PyTorch, i es pot ampliar per abordar problemes més complexos i utilitzar conjunts de dades més grans.</p>
<p><strong>Errors Comuns i Consells:</strong></p>
<ul>
<li><strong>Normalització de Dades</strong>: Assegura't de normalitzar les dades correctament per evitar problemes durant l'entrenament.</li>
<li><strong>Seqüències de Dades</strong>: La longitud de les seqüències de dades (train_window) pot afectar el rendiment del model. Experimenta amb diferents valors.</li>
<li><strong>Overfitting</strong>: Si el model s'ajusta massa a les dades d'entrenament, considera utilitzar tècniques de regularització o augmentar la quantitat de dades d'entrenament.</li>
</ul>
<p>Amb aquests coneixements, estàs preparat per abordar projectes més avançats i personalitzats en el camp de la predicció de sèries temporals.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='07-02-nlp-project' title="Projecte de Processament del Llenguatge Natural">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='07-04-custom-project' title="Projecte Personalitzat">Següent &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
