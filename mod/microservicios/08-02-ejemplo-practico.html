<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exemple Pràctic: Implementació Completa</title>

    <link rel="alternate" href="https://campusempresa.com/mod/microservicios/08-02-ejemplo-practico" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/microservicios/08-02-ejemplo-practico" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/microservicios/08-02-practical-example" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
				<a href="https://enterprisecampus.net/mod/microservicios/08-02-practical-example" class="px-2">EN</a></b>
	|
	<a href="https://campusempresa.com/mod/microservicios/08-02-ejemplo-practico" class="px-2">ES</a></b>
	|
	<b class="px-2">CA</b>
<br>
			<cite>Construint la societat d'avui i del demà</cite>
		</div>
	</div>
</div>
<div id="subheader" class="container-xxl">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">El Projecte</a> | 
<a href="/about">Sobre nosaltres</a> | 
<a href="/contribute">Contribuir</a> | 
<a href="/donate">Donacions</a> | 
<a href="/licence">Llicència</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
									<a href="./">Contingut del curs</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Competències tècniques</a>
				<a href="/all/conocimientos">Coneixements</a>
				<a href="/all/soft_skills">Competències socials</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='08-01-caso-estudio-migracion' title="Cas d'Estudi: Migració de Monòlit a Microserveis">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Exemple Pràctic: Implementació Completa</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='08-03-lecciones-aprendidas' title="Lliçons Apreses i Millors Pràctiques">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>En aquest tema, implementarem un sistema de microserveis complet des de zero. Aquest exemple pràctic ens permetrà aplicar els conceptes apresos en els mòduls anteriors i veure com es poden integrar en una aplicació real.</p>
</div><h1><p>Objectius</p>
</h1>
<div class='content'><ol>
<li><strong>Desenvolupar diversos microserveis</strong> que interactuïn entre ells.</li>
<li><strong>Utilitzar tecnologies i eines</strong> adequades per a la implementació.</li>
<li><strong>Desplegar els microserveis</strong> en un entorn de contenidors.</li>
<li><strong>Configurar la comunicació</strong> entre els microserveis.</li>
<li><strong>Implementar monitoratge i seguretat</strong> bàsica.</li>
</ol>
</div><h1><p>Descripció del Sistema</p>
</h1>
<div class='content'><p>Crearem un sistema de comerç electrònic senzill amb els següents microserveis:</p>
<ol>
<li><strong>Servei d'Usuari</strong>: Gestió d'usuaris (registre, autenticació).</li>
<li><strong>Servei de Productes</strong>: Gestió de productes (creació, actualització, eliminació).</li>
<li><strong>Servei de Comandes</strong>: Gestió de comandes (creació, actualització, estat).</li>
</ol>
</div><h1><p>Tecnologies Utilitzades</p>
</h1>
<div class='content'><ul>
<li><strong>Llenguatge de Programació</strong>: Python</li>
<li><strong>Framework</strong>: Flask per a APIs RESTful</li>
<li><strong>Base de Dades</strong>: PostgreSQL</li>
<li><strong>Contenidors</strong>: Docker</li>
<li><strong>Orquestració</strong>: Kubernetes</li>
<li><strong>Monitoratge</strong>: Prometheus i Grafana</li>
<li><strong>Autenticació</strong>: JWT (JSON Web Tokens)</li>
</ul>
</div><h1><p>Estructura del Projecte</p>
</h1>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZWNvbW1lcmNlLXN5c3RlbS8K4pSc4pSA4pSAIHVzZXItc2VydmljZS8K4pSCICAg4pSc4pSA4pSAIGFwcC8K4pSCICAg4pSc4pSA4pSAIERvY2tlcmZpbGUK4pSCICAg4pSc4pSA4pSAIHJlcXVpcmVtZW50cy50eHQK4pSCICAg4pSU4pSA4pSAIC4uLgrilJzilIDilIAgcHJvZHVjdC1zZXJ2aWNlLwrilIIgICDilJzilIDilIAgYXBwLwrilIIgICDilJzilIDilIAgRG9ja2VyZmlsZQrilIIgICDilJzilIDilIAgcmVxdWlyZW1lbnRzLnR4dArilIIgICDilJTilIDilIAgLi4uCuKUnOKUgOKUgCBvcmRlci1zZXJ2aWNlLwrilIIgICDilJzilIDilIAgYXBwLwrilIIgICDilJzilIDilIAgRG9ja2VyZmlsZQrilIIgICDilJzilIDilIAgcmVxdWlyZW1lbnRzLnR4dArilIIgICDilJTilIDilIAgLi4uCuKUnOKUgOKUgCBkb2NrZXItY29tcG9zZS55bWwK4pSU4pSA4pSAIGs4cy8KICAgIOKUnOKUgOKUgCB1c2VyLXNlcnZpY2UtZGVwbG95bWVudC55bWwKICAgIOKUnOKUgOKUgCBwcm9kdWN0LXNlcnZpY2UtZGVwbG95bWVudC55bWwKICAgIOKUnOKUgOKUgCBvcmRlci1zZXJ2aWNlLWRlcGxveW1lbnQueW1sCiAgICDilJTilIDilIAgLi4u"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ecommerce-system/
├── user-service/
│   ├── app/
│   ├── Dockerfile
│   ├── requirements.txt
│   └── ...
├── product-service/
│   ├── app/
│   ├── Dockerfile
│   ├── requirements.txt
│   └── ...
├── order-service/
│   ├── app/
│   ├── Dockerfile
│   ├── requirements.txt
│   └── ...
├── docker-compose.yml
└── k8s/
    ├── user-service-deployment.yml
    ├── product-service-deployment.yml
    ├── order-service-deployment.yml
    └── ...</pre></div><div class='content'></div><h1><p>Desenvolupament dels Microserveis</p>
</h1>
<div class='content'></div><h2><p>Servei d'Usuari</p>
</h2>
<div class='content'><h4>Estructura del Servei d'Usuari</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNlci1zZXJ2aWNlLwrilJzilIDilIAgYXBwLwrilIIgICDilJzilIDilIAgX19pbml0X18ucHkK4pSCICAg4pSc4pSA4pSAIG1vZGVscy5weQrilIIgICDilJzilIDilIAgcm91dGVzLnB5CuKUgiAgIOKUlOKUgOKUgCB1dGlscy5weQrilJzilIDilIAgRG9ja2VyZmlsZQrilJzilIDilIAgcmVxdWlyZW1lbnRzLnR4dArilJTilIDilIAgLi4u"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>user-service/
├── app/
│   ├── __init__.py
│   ├── models.py
│   ├── routes.py
│   └── utils.py
├── Dockerfile
├── requirements.txt
└── ...</pre></div><div class='content'><h4>Codi del Servei d'Usuari</h4>
<p><strong><code>app/__init__.py</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBmbGFzayBpbXBvcnQgRmxhc2sKZnJvbSBmbGFza19zcWxhbGNoZW15IGltcG9ydCBTUUxBbGNoZW15CgphcHAgPSBGbGFzayhfX25hbWVfXykKYXBwLmNvbmZpZ1snU1FMQUxDSEVNWV9EQVRBQkFTRV9VUkknXSA9ICdwb3N0Z3Jlc3FsOi8vdXNlcjpwYXNzd29yZEBkYjo1NDMyL3VzZXJfZGInCmRiID0gU1FMQWxjaGVteShhcHApCgpmcm9tIGFwcCBpbXBvcnQgcm91dGVz"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from flask import Flask
from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://user:password@db:5432/user_db'
db = SQLAlchemy(app)

from app import routes</pre></div><div class='content'><p><strong><code>app/models.py</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBhcHAgaW1wb3J0IGRiCgpjbGFzcyBVc2VyKGRiLk1vZGVsKToKICAgIGlkID0gZGIuQ29sdW1uKGRiLkludGVnZXIsIHByaW1hcnlfa2V5PVRydWUpCiAgICB1c2VybmFtZSA9IGRiLkNvbHVtbihkYi5TdHJpbmcoODApLCB1bmlxdWU9VHJ1ZSwgbnVsbGFibGU9RmFsc2UpCiAgICBwYXNzd29yZCA9IGRiLkNvbHVtbihkYi5TdHJpbmcoMTIwKSwgbnVsbGFibGU9RmFsc2Up"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from app import db

class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80), unique=True, nullable=False)
    password = db.Column(db.String(120), nullable=False)</pre></div><div class='content'><p><strong><code>app/routes.py</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBmbGFzayBpbXBvcnQgcmVxdWVzdCwganNvbmlmeQpmcm9tIGFwcCBpbXBvcnQgYXBwLCBkYgpmcm9tIGFwcC5tb2RlbHMgaW1wb3J0IFVzZXIKZnJvbSBhcHAudXRpbHMgaW1wb3J0IGdlbmVyYXRlX3Rva2VuLCB2ZXJpZnlfcGFzc3dvcmQKCkBhcHAucm91dGUoJy9yZWdpc3RlcicsIG1ldGhvZHM9WydQT1NUJ10pCmRlZiByZWdpc3RlcigpOgogICAgZGF0YSA9IHJlcXVlc3QuZ2V0X2pzb24oKQogICAgbmV3X3VzZXIgPSBVc2VyKHVzZXJuYW1lPWRhdGFbJ3VzZXJuYW1lJ10sIHBhc3N3b3JkPWdlbmVyYXRlX3Bhc3N3b3JkX2hhc2goZGF0YVsncGFzc3dvcmQnXSkpCiAgICBkYi5zZXNzaW9uLmFkZChuZXdfdXNlcikKICAgIGRiLnNlc3Npb24uY29tbWl0KCkKICAgIHJldHVybiBqc29uaWZ5KHsnbWVzc2FnZSc6ICdVc2VyIHJlZ2lzdGVyZWQgc3VjY2Vzc2Z1bGx5J30pLCAyMDEKCkBhcHAucm91dGUoJy9sb2dpbicsIG1ldGhvZHM9WydQT1NUJ10pCmRlZiBsb2dpbigpOgogICAgZGF0YSA9IHJlcXVlc3QuZ2V0X2pzb24oKQogICAgdXNlciA9IFVzZXIucXVlcnkuZmlsdGVyX2J5KHVzZXJuYW1lPWRhdGFbJ3VzZXJuYW1lJ10pLmZpcnN0KCkKICAgIGlmIHVzZXIgYW5kIHZlcmlmeV9wYXNzd29yZCh1c2VyLnBhc3N3b3JkLCBkYXRhWydwYXNzd29yZCddKToKICAgICAgICB0b2tlbiA9IGdlbmVyYXRlX3Rva2VuKHVzZXIuaWQpCiAgICAgICAgcmV0dXJuIGpzb25pZnkoeyd0b2tlbic6IHRva2VufSksIDIwMAogICAgcmV0dXJuIGpzb25pZnkoeydtZXNzYWdlJzogJ0ludmFsaWQgY3JlZGVudGlhbHMnfSksIDQwMQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from flask import request, jsonify
from app import app, db
from app.models import User
from app.utils import generate_token, verify_password

@app.route('/register', methods=['POST'])
def register():
    data = request.get_json()
    new_user = User(username=data['username'], password=generate_password_hash(data['password']))
    db.session.add(new_user)
    db.session.commit()
    return jsonify({'message': 'User registered successfully'}), 201

@app.route('/login', methods=['POST'])
def login():
    data = request.get_json()
    user = User.query.filter_by(username=data['username']).first()
    if user and verify_password(user.password, data['password']):
        token = generate_token(user.id)
        return jsonify({'token': token}), 200
    return jsonify({'message': 'Invalid credentials'}), 401</pre></div><div class='content'><p><strong><code>app/utils.py</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGp3dApmcm9tIHdlcmt6ZXVnLnNlY3VyaXR5IGltcG9ydCBnZW5lcmF0ZV9wYXNzd29yZF9oYXNoLCBjaGVja19wYXNzd29yZF9oYXNoCgpTRUNSRVRfS0VZID0gJ3lvdXJfc2VjcmV0X2tleScKCmRlZiBnZW5lcmF0ZV90b2tlbih1c2VyX2lkKToKICAgIHJldHVybiBqd3QuZW5jb2RlKHsndXNlcl9pZCc6IHVzZXJfaWR9LCBTRUNSRVRfS0VZLCBhbGdvcml0aG09J0hTMjU2JykKCmRlZiB2ZXJpZnlfcGFzc3dvcmQoc3RvcmVkX3Bhc3N3b3JkLCBwcm92aWRlZF9wYXNzd29yZCk6CiAgICByZXR1cm4gY2hlY2tfcGFzc3dvcmRfaGFzaChzdG9yZWRfcGFzc3dvcmQsIHByb3ZpZGVkX3Bhc3N3b3JkKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import jwt
from werkzeug.security import generate_password_hash, check_password_hash

SECRET_KEY = 'your_secret_key'

def generate_token(user_id):
    return jwt.encode({'user_id': user_id}, SECRET_KEY, algorithm='HS256')

def verify_password(stored_password, provided_password):
    return check_password_hash(stored_password, provided_password)</pre></div><div class='content'><p><strong><code>Dockerfile</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("RlJPTSBweXRob246My44LXNsaW0KCldPUktESVIgL2FwcAoKQ09QWSByZXF1aXJlbWVudHMudHh0IHJlcXVpcmVtZW50cy50eHQKUlVOIHBpcCBpbnN0YWxsIC1yIHJlcXVpcmVtZW50cy50eHQKCkNPUFkgLiAuCgpDTUQgWyJweXRob24iLCAiYXBwL19faW5pdF9fLnB5Il0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>FROM python:3.8-slim

WORKDIR /app

COPY requirements.txt requirements.txt
RUN pip install -r requirements.txt

COPY . .

CMD [&quot;python&quot;, &quot;app/__init__.py&quot;]</pre></div><div class='content'><p><strong><code>requirements.txt</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Rmxhc2s9PTIuMC4xCkZsYXNrLVNRTEFsY2hlbXk9PTIuNS4xCnBzeWNvcGcyLWJpbmFyeT09Mi45LjEKV2Vya3pldWc9PTIuMC4xClB5SldUPT0yLjEuMA=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Flask==2.0.1
Flask-SQLAlchemy==2.5.1
psycopg2-binary==2.9.1
Werkzeug==2.0.1
PyJWT==2.1.0</pre></div><div class='content'></div><h2><p>Servei de Productes</p>
</h2>
<div class='content'><h4>Estructura del Servei de Productes</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHJvZHVjdC1zZXJ2aWNlLwrilJzilIDilIAgYXBwLwrilIIgICDilJzilIDilIAgX19pbml0X18ucHkK4pSCICAg4pSc4pSA4pSAIG1vZGVscy5weQrilIIgICDilJzilIDilIAgcm91dGVzLnB5CuKUgiAgIOKUlOKUgOKUgCB1dGlscy5weQrilJzilIDilIAgRG9ja2VyZmlsZQrilJzilIDilIAgcmVxdWlyZW1lbnRzLnR4dArilJTilIDilIAgLi4u"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>product-service/
├── app/
│   ├── __init__.py
│   ├── models.py
│   ├── routes.py
│   └── utils.py
├── Dockerfile
├── requirements.txt
└── ...</pre></div><div class='content'><h4>Codi del Servei de Productes</h4>
<p><strong><code>app/__init__.py</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBmbGFzayBpbXBvcnQgRmxhc2sKZnJvbSBmbGFza19zcWxhbGNoZW15IGltcG9ydCBTUUxBbGNoZW15CgphcHAgPSBGbGFzayhfX25hbWVfXykKYXBwLmNvbmZpZ1snU1FMQUxDSEVNWV9EQVRBQkFTRV9VUkknXSA9ICdwb3N0Z3Jlc3FsOi8vdXNlcjpwYXNzd29yZEBkYjo1NDMyL3Byb2R1Y3RfZGInCmRiID0gU1FMQWxjaGVteShhcHApCgpmcm9tIGFwcCBpbXBvcnQgcm91dGVz"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from flask import Flask
from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://user:password@db:5432/product_db'
db = SQLAlchemy(app)

from app import routes</pre></div><div class='content'><p><strong><code>app/models.py</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBhcHAgaW1wb3J0IGRiCgpjbGFzcyBQcm9kdWN0KGRiLk1vZGVsKToKICAgIGlkID0gZGIuQ29sdW1uKGRiLkludGVnZXIsIHByaW1hcnlfa2V5PVRydWUpCiAgICBuYW1lID0gZGIuQ29sdW1uKGRiLlN0cmluZyg4MCksIHVuaXF1ZT1UcnVlLCBudWxsYWJsZT1GYWxzZSkKICAgIHByaWNlID0gZGIuQ29sdW1uKGRiLkZsb2F0LCBudWxsYWJsZT1GYWxzZSk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from app import db

class Product(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(80), unique=True, nullable=False)
    price = db.Column(db.Float, nullable=False)</pre></div><div class='content'><p><strong><code>app/routes.py</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBmbGFzayBpbXBvcnQgcmVxdWVzdCwganNvbmlmeQpmcm9tIGFwcCBpbXBvcnQgYXBwLCBkYgpmcm9tIGFwcC5tb2RlbHMgaW1wb3J0IFByb2R1Y3QKCkBhcHAucm91dGUoJy9wcm9kdWN0cycsIG1ldGhvZHM9WydQT1NUJ10pCmRlZiBhZGRfcHJvZHVjdCgpOgogICAgZGF0YSA9IHJlcXVlc3QuZ2V0X2pzb24oKQogICAgbmV3X3Byb2R1Y3QgPSBQcm9kdWN0KG5hbWU9ZGF0YVsnbmFtZSddLCBwcmljZT1kYXRhWydwcmljZSddKQogICAgZGIuc2Vzc2lvbi5hZGQobmV3X3Byb2R1Y3QpCiAgICBkYi5zZXNzaW9uLmNvbW1pdCgpCiAgICByZXR1cm4ganNvbmlmeSh7J21lc3NhZ2UnOiAnUHJvZHVjdCBhZGRlZCBzdWNjZXNzZnVsbHknfSksIDIwMQoKQGFwcC5yb3V0ZSgnL3Byb2R1Y3RzJywgbWV0aG9kcz1bJ0dFVCddKQpkZWYgZ2V0X3Byb2R1Y3RzKCk6CiAgICBwcm9kdWN0cyA9IFByb2R1Y3QucXVlcnkuYWxsKCkKICAgIHJldHVybiBqc29uaWZ5KFt7J2lkJzogcC5pZCwgJ25hbWUnOiBwLm5hbWUsICdwcmljZSc6IHAucHJpY2V9IGZvciBwIGluIHByb2R1Y3RzXSksIDIwMA=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from flask import request, jsonify
from app import app, db
from app.models import Product

@app.route('/products', methods=['POST'])
def add_product():
    data = request.get_json()
    new_product = Product(name=data['name'], price=data['price'])
    db.session.add(new_product)
    db.session.commit()
    return jsonify({'message': 'Product added successfully'}), 201

@app.route('/products', methods=['GET'])
def get_products():
    products = Product.query.all()
    return jsonify([{'id': p.id, 'name': p.name, 'price': p.price} for p in products]), 200</pre></div><div class='content'><p><strong><code>Dockerfile</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("RlJPTSBweXRob246My44LXNsaW0KCldPUktESVIgL2FwcAoKQ09QWSByZXF1aXJlbWVudHMudHh0IHJlcXVpcmVtZW50cy50eHQKUlVOIHBpcCBpbnN0YWxsIC1yIHJlcXVpcmVtZW50cy50eHQKCkNPUFkgLiAuCgpDTUQgWyJweXRob24iLCAiYXBwL19faW5pdF9fLnB5Il0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>FROM python:3.8-slim

WORKDIR /app

COPY requirements.txt requirements.txt
RUN pip install -r requirements.txt

COPY . .

CMD [&quot;python&quot;, &quot;app/__init__.py&quot;]</pre></div><div class='content'><p><strong><code>requirements.txt</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Rmxhc2s9PTIuMC4xCkZsYXNrLVNRTEFsY2hlbXk9PTIuNS4xCnBzeWNvcGcyLWJpbmFyeT09Mi45LjE="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Flask==2.0.1
Flask-SQLAlchemy==2.5.1
psycopg2-binary==2.9.1</pre></div><div class='content'></div><h2><p>Servei de Comandes</p>
</h2>
<div class='content'><h4>Estructura del Servei de Comandes</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("b3JkZXItc2VydmljZS8K4pSc4pSA4pSAIGFwcC8K4pSCICAg4pSc4pSA4pSAIF9faW5pdF9fLnB5CuKUgiAgIOKUnOKUgOKUgCBtb2RlbHMucHkK4pSCICAg4pSc4pSA4pSAIHJvdXRlcy5weQrilIIgICDilJTilIDilIAgdXRpbHMucHkK4pSc4pSA4pSAIERvY2tlcmZpbGUK4pSc4pSA4pSAIHJlcXVpcmVtZW50cy50eHQK4pSU4pSA4pSAIC4uLg=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>order-service/
├── app/
│   ├── __init__.py
│   ├── models.py
│   ├── routes.py
│   └── utils.py
├── Dockerfile
├── requirements.txt
└── ...</pre></div><div class='content'><h4>Codi del Servei de Comandes</h4>
<p><strong><code>app/__init__.py</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBmbGFzayBpbXBvcnQgRmxhc2sKZnJvbSBmbGFza19zcWxhbGNoZW15IGltcG9ydCBTUUxBbGNoZW15CgphcHAgPSBGbGFzayhfX25hbWVfXykKYXBwLmNvbmZpZ1snU1FMQUxDSEVNWV9EQVRBQkFTRV9VUkknXSA9ICdwb3N0Z3Jlc3FsOi8vdXNlcjpwYXNzd29yZEBkYjo1NDMyL29yZGVyX2RiJwpkYiA9IFNRTEFsY2hlbXkoYXBwKQoKZnJvbSBhcHAgaW1wb3J0IHJvdXRlcw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from flask import Flask
from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://user:password@db:5432/order_db'
db = SQLAlchemy(app)

from app import routes</pre></div><div class='content'><p><strong><code>app/models.py</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBhcHAgaW1wb3J0IGRiCgpjbGFzcyBPcmRlcihkYi5Nb2RlbCk6CiAgICBpZCA9IGRiLkNvbHVtbihkYi5JbnRlZ2VyLCBwcmltYXJ5X2tleT1UcnVlKQogICAgdXNlcl9pZCA9IGRiLkNvbHVtbihkYi5JbnRlZ2VyLCBudWxsYWJsZT1GYWxzZSkKICAgIHByb2R1Y3RfaWQgPSBkYi5Db2x1bW4oZGIuSW50ZWdlciwgbnVsbGFibGU9RmFsc2UpCiAgICBxdWFudGl0eSA9IGRiLkNvbHVtbihkYi5JbnRlZ2VyLCBudWxsYWJsZT1GYWxzZSkKICAgIHN0YXR1cyA9IGRiLkNvbHVtbihkYi5TdHJpbmcoNTApLCBudWxsYWJsZT1GYWxzZSwgZGVmYXVsdD0nUGVuZGluZycp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from app import db

class Order(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    user_id = db.Column(db.Integer, nullable=False)
    product_id = db.Column(db.Integer, nullable=False)
    quantity = db.Column(db.Integer, nullable=False)
    status = db.Column(db.String(50), nullable=False, default='Pending')</pre></div><div class='content'><p><strong><code>app/routes.py</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBmbGFzayBpbXBvcnQgcmVxdWVzdCwganNvbmlmeQpmcm9tIGFwcCBpbXBvcnQgYXBwLCBkYgpmcm9tIGFwcC5tb2RlbHMgaW1wb3J0IE9yZGVyCgpAYXBwLnJvdXRlKCcvb3JkZXJzJywgbWV0aG9kcz1bJ1BPU1QnXSkKZGVmIGNyZWF0ZV9vcmRlcigpOgogICAgZGF0YSA9IHJlcXVlc3QuZ2V0X2pzb24oKQogICAgbmV3X29yZGVyID0gT3JkZXIodXNlcl9pZD1kYXRhWyd1c2VyX2lkJ10sIHByb2R1Y3RfaWQ9ZGF0YVsncHJvZHVjdF9pZCddLCBxdWFudGl0eT1kYXRhWydxdWFudGl0eSddKQogICAgZGIuc2Vzc2lvbi5hZGQobmV3X29yZGVyKQogICAgZGIuc2Vzc2lvbi5jb21taXQoKQogICAgcmV0dXJuIGpzb25pZnkoeydtZXNzYWdlJzogJ09yZGVyIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5J30pLCAyMDEKCkBhcHAucm91dGUoJy9vcmRlcnMnLCBtZXRob2RzPVsnR0VUJ10pCmRlZiBnZXRfb3JkZXJzKCk6CiAgICBvcmRlcnMgPSBPcmRlci5xdWVyeS5hbGwoKQogICAgcmV0dXJuIGpzb25pZnkoW3snaWQnOiBvLmlkLCAndXNlcl9pZCc6IG8udXNlcl9pZCwgJ3Byb2R1Y3RfaWQnOiBvLnByb2R1Y3RfaWQsICdxdWFudGl0eSc6IG8ucXVhbnRpdHksICdzdGF0dXMnOiBvLnN0YXR1c30gZm9yIG8gaW4gb3JkZXJzXSksIDIwMA=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from flask import request, jsonify
from app import app, db
from app.models import Order

@app.route('/orders', methods=['POST'])
def create_order():
    data = request.get_json()
    new_order = Order(user_id=data['user_id'], product_id=data['product_id'], quantity=data['quantity'])
    db.session.add(new_order)
    db.session.commit()
    return jsonify({'message': 'Order created successfully'}), 201

@app.route('/orders', methods=['GET'])
def get_orders():
    orders = Order.query.all()
    return jsonify([{'id': o.id, 'user_id': o.user_id, 'product_id': o.product_id, 'quantity': o.quantity, 'status': o.status} for o in orders]), 200</pre></div><div class='content'><p><strong><code>Dockerfile</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("RlJPTSBweXRob246My44LXNsaW0KCldPUktESVIgL2FwcAoKQ09QWSByZXF1aXJlbWVudHMudHh0IHJlcXVpcmVtZW50cy50eHQKUlVOIHBpcCBpbnN0YWxsIC1yIHJlcXVpcmVtZW50cy50eHQKCkNPUFkgLiAuCgpDTUQgWyJweXRob24iLCAiYXBwL19faW5pdF9fLnB5Il0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>FROM python:3.8-slim

WORKDIR /app

COPY requirements.txt requirements.txt
RUN pip install -r requirements.txt

COPY . .

CMD [&quot;python&quot;, &quot;app/__init__.py&quot;]</pre></div><div class='content'><p><strong><code>requirements.txt</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Rmxhc2s9PTIuMC4xCkZsYXNrLVNRTEFsY2hlbXk9PTIuNS4xCnBzeWNvcGcyLWJpbmFyeT09Mi45LjE="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Flask==2.0.1
Flask-SQLAlchemy==2.5.1
psycopg2-binary==2.9.1</pre></div><div class='content'></div><h1><p>Desplegament amb Docker i Kubernetes</p>
</h1>
<div class='content'></div><h2><p>Docker Compose</p>
</h2>
<div class='content'><p><strong><code>docker-compose.yml</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dmVyc2lvbjogJzMuOCcKCnNlcnZpY2VzOgogIHVzZXItc2VydmljZToKICAgIGJ1aWxkOiAuL3VzZXItc2VydmljZQogICAgcG9ydHM6CiAgICAgIC0gIjUwMDE6NTAwMCIKICAgIGVudmlyb25tZW50OgogICAgICAtIFNRTEFMQ0hFTVlfREFUQUJBU0VfVVJJPXBvc3RncmVzcWw6Ly91c2VyOnBhc3N3b3JkQGRiOjU0MzIvdXNlcl9kYgoKICBwcm9kdWN0LXNlcnZpY2U6CiAgICBidWlsZDogLi9wcm9kdWN0LXNlcnZpY2UKICAgIHBvcnRzOgogICAgICAtICI1MDAyOjUwMDAiCiAgICBlbnZpcm9ubWVudDoKICAgICAgLSBTUUxBTENIRU1ZX0RBVEFCQVNFX1VSST1wb3N0Z3Jlc3FsOi8vdXNlcjpwYXNzd29yZEBkYjo1NDMyL3Byb2R1Y3RfZGIKCiAgb3JkZXItc2VydmljZToKICAgIGJ1aWxkOiAuL29yZGVyLXNlcnZpY2UKICAgIHBvcnRzOgogICAgICAtICI1MDAzOjUwMDAiCiAgICBlbnZpcm9ubWVudDoKICAgICAgLSBTUUxBTENIRU1ZX0RBVEFCQVNFX1VSST1wb3N0Z3Jlc3FsOi8vdXNlcjpwYXNzd29yZEBkYjo1NDMyL29yZGVyX2RiCgogIGRiOgogICAgaW1hZ2U6IHBvc3RncmVzOjEzCiAgICBlbnZpcm9ubWVudDoKICAgICAgUE9TVEdSRVNfVVNFUjogdXNlcgogICAgICBQT1NUR1JFU19QQVNTV09SRDogcGFzc3dvcmQKICAgICAgUE9TVEdSRVNfREI6IHVzZXJfZGI="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>version: '3.8'

services:
  user-service:
    build: ./user-service
    ports:
      - &quot;5001:5000&quot;
    environment:
      - SQLALCHEMY_DATABASE_URI=postgresql://user:password@db:5432/user_db

  product-service:
    build: ./product-service
    ports:
      - &quot;5002:5000&quot;
    environment:
      - SQLALCHEMY_DATABASE_URI=postgresql://user:password@db:5432/product_db

  order-service:
    build: ./order-service
    ports:
      - &quot;5003:5000&quot;
    environment:
      - SQLALCHEMY_DATABASE_URI=postgresql://user:password@db:5432/order_db

  db:
    image: postgres:13
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: user_db</pre></div><div class='content'></div><h2><p>Kubernetes</p>
</h2>
<div class='content'><p><strong><code>k8s/user-service-deployment.yml</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YXBpVmVyc2lvbjogYXBwcy92MQpraW5kOiBEZXBsb3ltZW50Cm1ldGFkYXRhOgogIG5hbWU6IHVzZXItc2VydmljZQpzcGVjOgogIHJlcGxpY2FzOiAyCiAgc2VsZWN0b3I6CiAgICBtYXRjaExhYmVsczoKICAgICAgYXBwOiB1c2VyLXNlcnZpY2UKICB0ZW1wbGF0ZToKICAgIG1ldGFkYXRhOgogICAgICBsYWJlbHM6CiAgICAgICAgYXBwOiB1c2VyLXNlcnZpY2UKICAgIHNwZWM6CiAgICAgIGNvbnRhaW5lcnM6CiAgICAgIC0gbmFtZTogdXNlci1zZXJ2aWNlCiAgICAgICAgaW1hZ2U6IHVzZXItc2VydmljZTpsYXRlc3QKICAgICAgICBwb3J0czoKICAgICAgICAtIGNvbnRhaW5lclBvcnQ6IDUwMDAKICAgICAgICBlbnY6CiAgICAgICAgLSBuYW1lOiBTUUxBTENIRU1ZX0RBVEFCQVNFX1VSSQogICAgICAgICAgdmFsdWU6ICJwb3N0Z3Jlc3FsOi8vdXNlcjpwYXNzd29yZEBkYjo1NDMyL3VzZXJfZGIi"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
spec:
  replicas: 2
  selector:
    matchLabels:
      app: user-service
  template:
    metadata:
      labels:
        app: user-service
    spec:
      containers:
      - name: user-service
        image: user-service:latest
        ports:
        - containerPort: 5000
        env:
        - name: SQLALCHEMY_DATABASE_URI
          value: &quot;postgresql://user:password@db:5432/user_db&quot;</pre></div><div class='content'><p><strong><code>k8s/product-service-deployment.yml</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YXBpVmVyc2lvbjogYXBwcy92MQpraW5kOiBEZXBsb3ltZW50Cm1ldGFkYXRhOgogIG5hbWU6IHByb2R1Y3Qtc2VydmljZQpzcGVjOgogIHJlcGxpY2FzOiAyCiAgc2VsZWN0b3I6CiAgICBtYXRjaExhYmVsczoKICAgICAgYXBwOiBwcm9kdWN0LXNlcnZpY2UKICB0ZW1wbGF0ZToKICAgIG1ldGFkYXRhOgogICAgICBsYWJlbHM6CiAgICAgICAgYXBwOiBwcm9kdWN0LXNlcnZpY2UKICAgIHNwZWM6CiAgICAgIGNvbnRhaW5lcnM6CiAgICAgIC0gbmFtZTogcHJvZHVjdC1zZXJ2aWNlCiAgICAgICAgaW1hZ2U6IHByb2R1Y3Qtc2VydmljZTpsYXRlc3QKICAgICAgICBwb3J0czoKICAgICAgICAtIGNvbnRhaW5lclBvcnQ6IDUwMDAKICAgICAgICBlbnY6CiAgICAgICAgLSBuYW1lOiBTUUxBTENIRU1ZX0RBVEFCQVNFX1VSSQogICAgICAgICAgdmFsdWU6ICJwb3N0Z3Jlc3FsOi8vdXNlcjpwYXNzd29yZEBkYjo1NDMyL3Byb2R1Y3RfZGIi"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>apiVersion: apps/v1
kind: Deployment
metadata:
  name: product-service
spec:
  replicas: 2
  selector:
    matchLabels:
      app: product-service
  template:
    metadata:
      labels:
        app: product-service
    spec:
      containers:
      - name: product-service
        image: product-service:latest
        ports:
        - containerPort: 5000
        env:
        - name: SQLALCHEMY_DATABASE_URI
          value: &quot;postgresql://user:password@db:5432/product_db&quot;</pre></div><div class='content'><p><strong><code>k8s/order-service-deployment.yml</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YXBpVmVyc2lvbjogYXBwcy92MQpraW5kOiBEZXBsb3ltZW50Cm1ldGFkYXRhOgogIG5hbWU6IG9yZGVyLXNlcnZpY2UKc3BlYzoKICByZXBsaWNhczogMgogIHNlbGVjdG9yOgogICAgbWF0Y2hMYWJlbHM6CiAgICAgIGFwcDogb3JkZXItc2VydmljZQogIHRlbXBsYXRlOgogICAgbWV0YWRhdGE6CiAgICAgIGxhYmVsczoKICAgICAgICBhcHA6IG9yZGVyLXNlcnZpY2UKICAgIHNwZWM6CiAgICAgIGNvbnRhaW5lcnM6CiAgICAgIC0gbmFtZTogb3JkZXItc2VydmljZQogICAgICAgIGltYWdlOiBvcmRlci1zZXJ2aWNlOmxhdGVzdAogICAgICAgIHBvcnRzOgogICAgICAgIC0gY29udGFpbmVyUG9ydDogNTAwMAogICAgICAgIGVudjoKICAgICAgICAtIG5hbWU6IFNRTEFMQ0hFTVlfREFUQUJBU0VfVVJJCiAgICAgICAgICB2YWx1ZTogInBvc3RncmVzcWw6Ly91c2VyOnBhc3N3b3JkQGRiOjU0MzIvb3JkZXJfZGIi"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>apiVersion: apps/v1
kind: Deployment
metadata:
  name: order-service
spec:
  replicas: 2
  selector:
    matchLabels:
      app: order-service
  template:
    metadata:
      labels:
        app: order-service
    spec:
      containers:
      - name: order-service
        image: order-service:latest
        ports:
        - containerPort: 5000
        env:
        - name: SQLALCHEMY_DATABASE_URI
          value: &quot;postgresql://user:password@db:5432/order_db&quot;</pre></div><div class='content'></div><h1><p>Monitoratge i Seguretat</p>
</h1>
<div class='content'></div><h2><p>Monitoratge amb Prometheus i Grafana</p>
</h2>
<div class='content'><p><strong><code>docker-compose.yml</code> (afegint serveis de monitoratge)</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VydmljZXM6CiAgLi4uCiAgcHJvbWV0aGV1czoKICAgIGltYWdlOiBwcm9tL3Byb21ldGhldXMKICAgIHBvcnRzOgogICAgICAtICI5MDkwOjkwOTAiCiAgICB2b2x1bWVzOgogICAgICAtIC4vcHJvbWV0aGV1cy55bWw6L2V0Yy9wcm9tZXRoZXVzL3Byb21ldGhldXMueW1sCgogIGdyYWZhbmE6CiAgICBpbWFnZTogZ3JhZmFuYS9ncmFmYW5hCiAgICBwb3J0czoKICAgICAgLSAiMzAwMDozMDAwIg=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>services:
  ...
  prometheus:
    image: prom/prometheus
    ports:
      - &quot;9090:9090&quot;
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml

  grafana:
    image: grafana/grafana
    ports:
      - &quot;3000:3000&quot;</pre></div><div class='content'><p><strong><code>prometheus.yml</code></strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Z2xvYmFsOgogIHNjcmFwZV9pbnRlcnZhbDogMTVzCgpzY3JhcGVfY29uZmlnczoKICAtIGpvYl9uYW1lOiAndXNlci1zZXJ2aWNlJwogICAgc3RhdGljX2NvbmZpZ3M6CiAgICAgIC0gdGFyZ2V0czogWyd1c2VyLXNlcnZpY2U6NTAwMCddCgogIC0gam9iX25hbWU6ICdwcm9kdWN0LXNlcnZpY2UnCiAgICBzdGF0aWNfY29uZmlnczoKICAgICAgLSB0YXJnZXRzOiBbJ3Byb2R1Y3Qtc2VydmljZTo1MDAwJ10KCiAgLSBqb2JfbmFtZTogJ29yZGVyLXNlcnZpY2UnCiAgICBzdGF0aWNfY29uZmlnczoKICAgICAgLSB0YXJnZXRzOiBbJ29yZGVyLXNlcnZpY2U6NTAwMCdd"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'user-service'
    static_configs:
      - targets: ['user-service:5000']

  - job_name: 'product-service'
    static_configs:
      - targets: ['product-service:5000']

  - job_name: 'order-service'
    static_configs:
      - targets: ['order-service:5000']</pre></div><div class='content'></div><h2><p>Seguretat amb JWT</p>
</h2>
<div class='content'><p>Ja hem implementat JWT en el servei d'usuari per a l'autenticació. Assegurem-nos que els altres serveis validin el token JWT en les seves peticions.</p>
<p><strong><code>app/utils.py</code> (Servei de Productes i Comandes)</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGp3dApmcm9tIGZsYXNrIGltcG9ydCByZXF1ZXN0LCBqc29uaWZ5CgpTRUNSRVRfS0VZID0gJ3lvdXJfc2VjcmV0X2tleScKCmRlZiB0b2tlbl9yZXF1aXJlZChmKToKICAgIGRlZiBkZWNvcmF0b3IoKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICB0b2tlbiA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ0F1dGhvcml6YXRpb24nKQogICAgICAgIGlmIG5vdCB0b2tlbjoKICAgICAgICAgICAgcmV0dXJuIGpzb25pZnkoeydtZXNzYWdlJzogJ1Rva2VuIGlzIG1pc3NpbmchJ30pLCA0MDMKICAgICAgICB0cnk6CiAgICAgICAgICAgIGp3dC5kZWNvZGUodG9rZW4sIFNFQ1JFVF9LRVksIGFsZ29yaXRobXM9WydIUzI1NiddKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcmV0dXJuIGpzb25pZnkoeydtZXNzYWdlJzogJ1Rva2VuIGlzIGludmFsaWQhJ30pLCA0MDMKICAgICAgICByZXR1cm4gZigqYXJncywgKiprd2FyZ3MpCiAgICByZXR1cm4gZGVjb3JhdG9y"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import jwt
from flask import request, jsonify

SECRET_KEY = 'your_secret_key'

def token_required(f):
    def decorator(*args, **kwargs):
        token = request.headers.get('Authorization')
        if not token:
            return jsonify({'message': 'Token is missing!'}), 403
        try:
            jwt.decode(token, SECRET_KEY, algorithms=['HS256'])
        except:
            return jsonify({'message': 'Token is invalid!'}), 403
        return f(*args, **kwargs)
    return decorator</pre></div><div class='content'><p><strong><code>app/routes.py</code> (Servei de Productes i Comandes)</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBhcHAudXRpbHMgaW1wb3J0IHRva2VuX3JlcXVpcmVkCgpAYXBwLnJvdXRlKCcvcHJvZHVjdHMnLCBtZXRob2RzPVsnUE9TVCddKQpAdG9rZW5fcmVxdWlyZWQKZGVmIGFkZF9wcm9kdWN0KCk6CiAgICAuLi4="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from app.utils import token_required

@app.route('/products', methods=['POST'])
@token_required
def add_product():
    ...</pre></div><div class='content'></div><h1><p>Conclusió</p>
</h1>
<div class='content'><p>En aquest exemple pràctic, hem creat un sistema de comerç electrònic senzill utilitzant microserveis. Hem desenvolupat serveis per a la gestió d'usuaris, productes i comandes, i hem desplegat aquests serveis utilitzant Docker i Kubernetes. També hem implementat monitoratge amb Prometheus i Grafana, i hem assegurat la comunicació entre serveis amb JWT.</p>
<p>Aquest exemple ens proporciona una base sòlida per a la implementació de sistemes de microserveis més complexos i ens permet aplicar els conceptes apresos en els mòduls anteriors del curs.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='08-01-caso-estudio-migracion' title="Cas d'Estudi: Migració de Monòlit a Microserveis">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='08-03-lecciones-aprendidas' title="Lliçons Apreses i Millors Pràctiques">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
