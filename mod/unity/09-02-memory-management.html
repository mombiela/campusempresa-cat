<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestió de Memòria</title>

    <link rel="alternate" href="https://campusempresa.com/mod/unity/09-02-memory-management" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/unity/09-02-memory-management" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/unity/09-02-memory-management" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/unity/09-02-memory-management" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/unity/09-02-memory-management" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Projecte</a>
				<a href="/about">Sobre nosaltres</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donacions</a>
				<a href="/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='09-01-profiling-optimization-techniques' title="Tècniques de Perfilat i Optimització">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Gestió de Memòria</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='09-03-reducing-draw-calls' title="Reduint Draw Calls">Següent &#x25BA;</a>
			</div>
</div>
<div class='content'><p>La gestió de memòria és un aspecte crucial en el desenvolupament de jocs amb Unity, especialment quan es tracta de jocs complexos o que han de funcionar en dispositius amb recursos limitats. Una gestió de memòria eficient pot millorar significativament el rendiment del joc i evitar problemes com ara les caigudes de rendiment o els bloquejos.</p>
</div><h1><p>Conceptes Clau</p>
</h1>
<div class='content'><ol>
<li>
<p><strong>Memòria Dinàmica vs. Memòria Estàtica</strong>:</p>
<ul>
<li><strong>Memòria Dinàmica</strong>: S'assigna i es desassigna durant l'execució del programa. Exemple: objectes creats amb <code>new</code> en C#.</li>
<li><strong>Memòria Estàtica</strong>: S'assigna en temps de compilació i es manté durant tota l'execució del programa. Exemple: variables estàtiques.</li>
</ul>
</li>
<li>
<p><strong>Garbage Collection (GC)</strong>:</p>
<ul>
<li>Unity utilitza un sistema de Garbage Collection per gestionar la memòria dinàmica. El GC allibera memòria que ja no és accessible per l'aplicació, però pot causar pauses en l'execució del joc.</li>
</ul>
</li>
<li>
<p><strong>Fragmentació de Memòria</strong>:</p>
<ul>
<li>La fragmentació de memòria es produeix quan hi ha espais lliures no contigus en la memòria, cosa que pot dificultar l'assignació de grans blocs de memòria.</li>
</ul>
</li>
</ol>
</div><h1><p>Bones Pràctiques per a la Gestió de Memòria</p>
</h1>
<div class='content'></div><h2><ol>
<li>Evitar l'Assignació Dinàmica Excessiva</li>
</ol>
</h2>
<div class='content'><ul>
<li>
<p><strong>Reutilitzar Objectes</strong>: En lloc de crear i destruir objectes constantment, reutilitza'ls. Per exemple, utilitza un object pool per gestionar objectes que es creen i destrueixen freqüentment.</p>
<pre><code class="language-csharp">public class ObjectPool : MonoBehaviour
{
    public GameObject objectPrefab;
    private Queue&lt;GameObject&gt; pool = new Queue&lt;GameObject&gt;();

    public GameObject GetObject()
    {
        if (pool.Count &gt; 0)
        {
            GameObject obj = pool.Dequeue();
            obj.SetActive(true);
            return obj;
        }
        else
        {
            return Instantiate(objectPrefab);
        }
    }

    public void ReturnObject(GameObject obj)
    {
        obj.SetActive(false);
        pool.Enqueue(obj);
    }
}
</code></pre>
</li>
</ul>
</div><h2><ol start="2">
<li>Minimitzar l'Ús de Strings</li>
</ol>
</h2>
<div class='content'><ul>
<li>
<p><strong>Evitar la Concatenació de Strings</strong>: La concatenació de strings pot generar molta memòria dinàmica. Utilitza <code>StringBuilder</code> en lloc de concatenar strings directament.</p>
<pre><code class="language-csharp">using System.Text;

StringBuilder sb = new StringBuilder();
sb.Append(&quot;Hello&quot;);
sb.Append(&quot; &quot;);
sb.Append(&quot;World&quot;);
string result = sb.ToString();
</code></pre>
</li>
</ul>
</div><h2><ol start="3">
<li>Optimitzar l'Ús de Col·leccions</li>
</ol>
</h2>
<div class='content'><ul>
<li>
<p><strong>Utilitzar Col·leccions Adequades</strong>: Tria la col·lecció adequada per a cada situació. Per exemple, utilitza <code>List&lt;T&gt;</code> en lloc de <code>ArrayList</code> per evitar conversions de tipus.</p>
<pre><code class="language-csharp">List&lt;int&gt; numbers = new List&lt;int&gt;();
numbers.Add(1);
numbers.Add(2);
</code></pre>
</li>
</ul>
</div><h2><ol start="4">
<li>Gestionar Correctament els Recursos</li>
</ol>
</h2>
<div class='content'><ul>
<li>
<p><strong>Alliberar Recursos No Utilitzats</strong>: Assegura't d'alliberar recursos com ara textures, àudio i altres actius quan ja no es necessiten.</p>
<pre><code class="language-csharp">void OnDestroy()
{
    if (texture != null)
    {
        Destroy(texture);
    }
}
</code></pre>
</li>
</ul>
</div><h2><ol start="5">
<li>Utilitzar el Profiler de Unity</li>
</ol>
</h2>
<div class='content'><ul>
<li>
<p><strong>Profiler</strong>: Utilitza el Profiler de Unity per identificar problemes de memòria i optimitzar el teu joc. El Profiler et permet veure quanta memòria s'està utilitzant i quins objectes estan ocupant més memòria.</p>
<p><img src="https://docs.unity3d.com/uploads/Main/ProfilerWindow.png" alt="Unity Profiler" /></p>
</li>
</ul>
</div><h1><p>Exercicis Pràctics</p>
</h1>
<div class='content'></div><h2><p>Exercici 1: Implementar un Object Pool</p>
</h2>
<div class='content'><p><strong>Descripció</strong>: Implementa un sistema d'object pool per gestionar projectils en un joc de disparar.</p>
<p><strong>Passos</strong>:</p>
<ol>
<li>Crea un prefab de projectil.</li>
<li>Implementa una classe <code>ProjectilePool</code> que gestioni la creació i reutilització de projectils.</li>
<li>Modifica el codi del joc per utilitzar el <code>ProjectilePool</code> en lloc de crear i destruir projectils constantment.</li>
</ol>
<p><strong>Solució</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHVibGljIGNsYXNzIFByb2plY3RpbGVQb29sIDogTW9ub0JlaGF2aW91cgp7CiAgICBwdWJsaWMgR2FtZU9iamVjdCBwcm9qZWN0aWxlUHJlZmFiOwogICAgcHJpdmF0ZSBRdWV1ZTxHYW1lT2JqZWN0PiBwb29sID0gbmV3IFF1ZXVlPEdhbWVPYmplY3Q+KCk7CgogICAgcHVibGljIEdhbWVPYmplY3QgR2V0UHJvamVjdGlsZSgpCiAgICB7CiAgICAgICAgaWYgKHBvb2wuQ291bnQgPiAwKQogICAgICAgIHsKICAgICAgICAgICAgR2FtZU9iamVjdCBwcm9qZWN0aWxlID0gcG9vbC5EZXF1ZXVlKCk7CiAgICAgICAgICAgIHByb2plY3RpbGUuU2V0QWN0aXZlKHRydWUpOwogICAgICAgICAgICByZXR1cm4gcHJvamVjdGlsZTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIEluc3RhbnRpYXRlKHByb2plY3RpbGVQcmVmYWIpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBSZXR1cm5Qcm9qZWN0aWxlKEdhbWVPYmplY3QgcHJvamVjdGlsZSkKICAgIHsKICAgICAgICBwcm9qZWN0aWxlLlNldEFjdGl2ZShmYWxzZSk7CiAgICAgICAgcG9vbC5FbnF1ZXVlKHByb2plY3RpbGUpOwogICAgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>public class ProjectilePool : MonoBehaviour
{
    public GameObject projectilePrefab;
    private Queue&lt;GameObject&gt; pool = new Queue&lt;GameObject&gt;();

    public GameObject GetProjectile()
    {
        if (pool.Count &gt; 0)
        {
            GameObject projectile = pool.Dequeue();
            projectile.SetActive(true);
            return projectile;
        }
        else
        {
            return Instantiate(projectilePrefab);
        }
    }

    public void ReturnProjectile(GameObject projectile)
    {
        projectile.SetActive(false);
        pool.Enqueue(projectile);
    }
}</pre></div><div class='content'></div><h2><p>Exercici 2: Optimitzar l'Ús de Strings</p>
</h2>
<div class='content'><p><strong>Descripció</strong>: Optimitza un codi que concatena strings en un bucle.</p>
<p><strong>Codi Original</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c3RyaW5nIHJlc3VsdCA9ICIiOwpmb3IgKGludCBpID0gMDsgaSA8IDEwMDsgaSsrKQp7CiAgICByZXN1bHQgKz0gaS5Ub1N0cmluZygpICsgIiwgIjsKfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>string result = &quot;&quot;;
for (int i = 0; i &lt; 100; i++)
{
    result += i.ToString() + &quot;, &quot;;
}</pre></div><div class='content'><p><strong>Solució</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNpbmcgU3lzdGVtLlRleHQ7CgpTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKZm9yIChpbnQgaSA9IDA7IGkgPCAxMDA7IGkrKykKewogICAgc2IuQXBwZW5kKGkuVG9TdHJpbmcoKSk7CiAgICBzYi5BcHBlbmQoIiwgIik7Cn0Kc3RyaW5nIHJlc3VsdCA9IHNiLlRvU3RyaW5nKCk7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>using System.Text;

StringBuilder sb = new StringBuilder();
for (int i = 0; i &lt; 100; i++)
{
    sb.Append(i.ToString());
    sb.Append(&quot;, &quot;);
}
string result = sb.ToString();</pre></div><div class='content'></div><h1><p>Conclusió</p>
</h1>
<div class='content'><p>La gestió de memòria és essencial per garantir que el teu joc funcioni de manera eficient i sense problemes. Mitjançant la implementació de bones pràctiques com la reutilització d'objectes, l'optimització de l'ús de strings i col·leccions, i l'alliberament de recursos no utilitzats, pots millorar significativament el rendiment del teu joc. Utilitza el Profiler de Unity per identificar i solucionar problemes de memòria, i assegura't de provar i optimitzar constantment el teu codi.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='09-01-profiling-optimization-techniques' title="Tècniques de Perfilat i Optimització">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='09-03-reducing-draw-calls' title="Reduint Draw Calls">Següent &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
