<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS WAF</title>

    <link rel="alternate" href="https://campusempresa.com/mod/aws/04-04-aws-waf" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/aws/04-04-aws-waf" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/aws/04-04-aws-waf" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/aws/04-04-aws-waf" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/aws/04-04-aws-waf" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<!-- <a href="/">Home</a>  -->
									<a href="./">Contingut del curs</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Competències tècniques</a>
				<a href="/all/conocimientos">Coneixements</a>
				<a href="/all/soft_skills">Competències socials</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='04-03-aws-shield' title="AWS Shield">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">AWS WAF</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='05-01-cloudwatch' title="Amazon CloudWatch">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'></div><h1><p>Introducció a AWS WAF</p>
</h1>
<div class='content'><p>AWS WAF (Web Application Firewall) és un servei que ajuda a protegir les aplicacions web contra atacs comuns que poden afectar la disponibilitat, comprometre la seguretat o consumir recursos excessius. AWS WAF permet definir regles personalitzades per filtrar el trànsit web entrant i bloquejar peticions malicioses.</p>
</div><h2><p>Característiques clau d'AWS WAF</p>
</h2>
<div class='content'><ul>
<li><strong>Protecció contra atacs comuns</strong>: Protegeix contra atacs com SQL injection, cross-site scripting (XSS) i altres vulnerabilitats de les aplicacions web.</li>
<li><strong>Regles personalitzades</strong>: Permet crear regles personalitzades per filtrar el trànsit web segons les necessitats específiques de l'aplicació.</li>
<li><strong>Integració amb altres serveis d'AWS</strong>: Es pot integrar amb Amazon CloudFront, Application Load Balancer (ALB) i API Gateway per proporcionar protecció a les aplicacions web.</li>
<li><strong>Monitoratge i mètriques</strong>: Proporciona mètriques detallades i registres d'activitat per ajudar a monitoritzar i analitzar el trànsit web.</li>
</ul>
</div><h1><p>Configuració d'AWS WAF</p>
</h1>
<div class='content'></div><h2><p>Pas 1: Crear un Web ACL</p>
</h2>
<div class='content'><p>Un Web ACL (Access Control List) és un conjunt de regles que defineixen com AWS WAF ha de filtrar el trànsit web. Per crear un Web ACL:</p>
<ol>
<li>Accedeix a la consola de gestió d'AWS.</li>
<li>Navega a <strong>AWS WAF &amp; Shield</strong>.</li>
<li>Selecciona <strong>Create web ACL</strong>.</li>
<li>Proporciona un nom per al Web ACL i selecciona la regió.</li>
<li>Selecciona el tipus de recurs que vols protegir (CloudFront, ALB, API Gateway).</li>
<li>Defineix les regles que vols aplicar.</li>
</ol>
</div><h2><p>Pas 2: Definir regles</p>
</h2>
<div class='content'><p>Les regles d'AWS WAF es poden crear utilitzant condicions predefinides o personalitzades. Algunes de les condicions predefinides inclouen:</p>
<ul>
<li><strong>IP match conditions</strong>: Permet bloquejar o permetre trànsit des de determinades adreces IP.</li>
<li><strong>String match conditions</strong>: Permet filtrar peticions que continguin cadenes de text específiques.</li>
<li><strong>Size constraint conditions</strong>: Permet filtrar peticions basades en la mida de certs elements (com el cos de la petició).</li>
</ul>
</div><h2><p>Exemple de creació d'una regla</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGJvdG8zCgojIENyZWFyIHVuIGNsaWVudCBkJ0FXUyBXQUYKd2FmX2NsaWVudCA9IGJvdG8zLmNsaWVudCgnd2FmJykKCiMgQ3JlYXIgdW5hIGNvbmRpY2nDsyBkZSBjb2luY2lkw6huY2lhIGQnSVAKaXBfc2V0ID0gd2FmX2NsaWVudC5jcmVhdGVfaXBfc2V0KAogICAgTmFtZT0nTXlJUFNldCcsCiAgICBDaGFuZ2VUb2tlbj13YWZfY2xpZW50LmdldF9jaGFuZ2VfdG9rZW4oKVsnQ2hhbmdlVG9rZW4nXSwKICAgIElQU2V0RGVzY3JpcHRvcnM9WwogICAgICAgIHsKICAgICAgICAgICAgJ1R5cGUnOiAnSVBWNCcsCiAgICAgICAgICAgICdWYWx1ZSc6ICcxOTIuMC4yLjAvMjQnCiAgICAgICAgfSwKICAgIF0KKQoKIyBDcmVhciB1bmEgcmVnbGEgcXVlIHV0aWxpdHppIGxhIGNvbmRpY2nDsyBkZSBjb2luY2lkw6huY2lhIGQnSVAKcnVsZSA9IHdhZl9jbGllbnQuY3JlYXRlX3J1bGUoCiAgICBOYW1lPSdNeUlQTWF0Y2hSdWxlJywKICAgIE1ldHJpY05hbWU9J015SVBNYXRjaFJ1bGVNZXRyaWMnLAogICAgQ2hhbmdlVG9rZW49d2FmX2NsaWVudC5nZXRfY2hhbmdlX3Rva2VuKClbJ0NoYW5nZVRva2VuJ10sCiAgICBQcmVkaWNhdGVzPVsKICAgICAgICB7CiAgICAgICAgICAgICdOZWdhdGVkJzogRmFsc2UsCiAgICAgICAgICAgICdUeXBlJzogJ0lQTWF0Y2gnLAogICAgICAgICAgICAnRGF0YUlkJzogaXBfc2V0WydJUFNldCddWydJUFNldElkJ10KICAgICAgICB9LAogICAgXQopCgojIEFmZWdpciBsYSByZWdsYSBhbCBXZWIgQUNMCndlYl9hY2wgPSB3YWZfY2xpZW50LmNyZWF0ZV93ZWJfYWNsKAogICAgTmFtZT0nTXlXZWJBQ0wnLAogICAgTWV0cmljTmFtZT0nTXlXZWJBQ0xNZXRyaWMnLAogICAgRGVmYXVsdEFjdGlvbj17J1R5cGUnOiAnQUxMT1cnfSwKICAgIENoYW5nZVRva2VuPXdhZl9jbGllbnQuZ2V0X2NoYW5nZV90b2tlbigpWydDaGFuZ2VUb2tlbiddLAogICAgUnVsZXM9WwogICAgICAgIHsKICAgICAgICAgICAgJ0FjdGlvbic6IHsnVHlwZSc6ICdCTE9DSyd9LAogICAgICAgICAgICAnUHJpb3JpdHknOiAxLAogICAgICAgICAgICAnUnVsZUlkJzogcnVsZVsnUnVsZSddWydSdWxlSWQnXQogICAgICAgIH0sCiAgICBdCik="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import boto3

# Crear un client d'AWS WAF
waf_client = boto3.client('waf')

# Crear una condici&oacute; de coincid&egrave;ncia d'IP
ip_set = waf_client.create_ip_set(
    Name='MyIPSet',
    ChangeToken=waf_client.get_change_token()['ChangeToken'],
    IPSetDescriptors=[
        {
            'Type': 'IPV4',
            'Value': '192.0.2.0/24'
        },
    ]
)

# Crear una regla que utilitzi la condici&oacute; de coincid&egrave;ncia d'IP
rule = waf_client.create_rule(
    Name='MyIPMatchRule',
    MetricName='MyIPMatchRuleMetric',
    ChangeToken=waf_client.get_change_token()['ChangeToken'],
    Predicates=[
        {
            'Negated': False,
            'Type': 'IPMatch',
            'DataId': ip_set['IPSet']['IPSetId']
        },
    ]
)

# Afegir la regla al Web ACL
web_acl = waf_client.create_web_acl(
    Name='MyWebACL',
    MetricName='MyWebACLMetric',
    DefaultAction={'Type': 'ALLOW'},
    ChangeToken=waf_client.get_change_token()['ChangeToken'],
    Rules=[
        {
            'Action': {'Type': 'BLOCK'},
            'Priority': 1,
            'RuleId': rule['Rule']['RuleId']
        },
    ]
)</pre></div><div class='content'></div><h2><p>Pas 3: Associar el Web ACL amb un recurs</p>
</h2>
<div class='content'><p>Després de crear el Web ACL i definir les regles, has d'associar-lo amb el recurs que vols protegir (per exemple, un CloudFront distribution o un Application Load Balancer).</p>
<ol>
<li>Navega a la consola del recurs (per exemple, CloudFront).</li>
<li>Selecciona el recurs que vols protegir.</li>
<li>A la configuració del recurs, selecciona el Web ACL que has creat.</li>
</ol>
</div><h1><p>Exercici pràctic</p>
</h1>
<div class='content'></div><h2><p>Objectiu</p>
</h2>
<div class='content'><p>Configurar AWS WAF per protegir una aplicació web contra atacs de SQL injection.</p>
</div><h2><p>Passos</p>
</h2>
<div class='content'><ol>
<li>
<p><strong>Crear una condició de coincidència de SQL injection</strong>:</p>
<ul>
<li>A la consola d'AWS WAF, crea una nova condició de coincidència de SQL injection.</li>
<li>Defineix els camps de la petició que vols inspeccionar (per exemple, el cos de la petició).</li>
</ul>
</li>
<li>
<p><strong>Crear una regla que utilitzi la condició de coincidència de SQL injection</strong>:</p>
<ul>
<li>Crea una nova regla a AWS WAF.</li>
<li>Afegeix la condició de coincidència de SQL injection a la regla.</li>
</ul>
</li>
<li>
<p><strong>Crear un Web ACL i afegir la regla</strong>:</p>
<ul>
<li>Crea un nou Web ACL.</li>
<li>Afegeix la regla de SQL injection al Web ACL amb una acció de bloqueig.</li>
</ul>
</li>
<li>
<p><strong>Associar el Web ACL amb un recurs</strong>:</p>
<ul>
<li>Associa el Web ACL amb el recurs que vols protegir (per exemple, un CloudFront distribution).</li>
</ul>
</li>
</ol>
</div><h2><p>Solució</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGJvdG8zCgojIENyZWFyIHVuIGNsaWVudCBkJ0FXUyBXQUYKd2FmX2NsaWVudCA9IGJvdG8zLmNsaWVudCgnd2FmJykKCiMgQ3JlYXIgdW5hIGNvbmRpY2nDsyBkZSBjb2luY2lkw6huY2lhIGRlIFNRTCBpbmplY3Rpb24Kc3FsX2luamVjdGlvbl9zZXQgPSB3YWZfY2xpZW50LmNyZWF0ZV9zcWxfaW5qZWN0aW9uX21hdGNoX3NldCgKICAgIE5hbWU9J015U1FMSW5qZWN0aW9uU2V0JywKICAgIENoYW5nZVRva2VuPXdhZl9jbGllbnQuZ2V0X2NoYW5nZV90b2tlbigpWydDaGFuZ2VUb2tlbiddLAogICAgU3FsSW5qZWN0aW9uTWF0Y2hUdXBsZXM9WwogICAgICAgIHsKICAgICAgICAgICAgJ0ZpZWxkVG9NYXRjaCc6IHsKICAgICAgICAgICAgICAgICdUeXBlJzogJ0JPRFknCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICdUZXh0VHJhbnNmb3JtYXRpb24nOiAnVVJMX0RFQ09ERScKICAgICAgICB9LAogICAgXQopCgojIENyZWFyIHVuYSByZWdsYSBxdWUgdXRpbGl0emkgbGEgY29uZGljacOzIGRlIGNvaW5jaWTDqG5jaWEgZGUgU1FMIGluamVjdGlvbgpydWxlID0gd2FmX2NsaWVudC5jcmVhdGVfcnVsZSgKICAgIE5hbWU9J015U1FMSW5qZWN0aW9uUnVsZScsCiAgICBNZXRyaWNOYW1lPSdNeVNRTEluamVjdGlvblJ1bGVNZXRyaWMnLAogICAgQ2hhbmdlVG9rZW49d2FmX2NsaWVudC5nZXRfY2hhbmdlX3Rva2VuKClbJ0NoYW5nZVRva2VuJ10sCiAgICBQcmVkaWNhdGVzPVsKICAgICAgICB7CiAgICAgICAgICAgICdOZWdhdGVkJzogRmFsc2UsCiAgICAgICAgICAgICdUeXBlJzogJ1NxbEluamVjdGlvbk1hdGNoJywKICAgICAgICAgICAgJ0RhdGFJZCc6IHNxbF9pbmplY3Rpb25fc2V0WydTcWxJbmplY3Rpb25NYXRjaFNldCddWydTcWxJbmplY3Rpb25NYXRjaFNldElkJ10KICAgICAgICB9LAogICAgXQopCgojIENyZWFyIHVuIFdlYiBBQ0wgaSBhZmVnaXIgbGEgcmVnbGEKd2ViX2FjbCA9IHdhZl9jbGllbnQuY3JlYXRlX3dlYl9hY2woCiAgICBOYW1lPSdNeVdlYkFDTCcsCiAgICBNZXRyaWNOYW1lPSdNeVdlYkFDTE1ldHJpYycsCiAgICBEZWZhdWx0QWN0aW9uPXsnVHlwZSc6ICdBTExPVyd9LAogICAgQ2hhbmdlVG9rZW49d2FmX2NsaWVudC5nZXRfY2hhbmdlX3Rva2VuKClbJ0NoYW5nZVRva2VuJ10sCiAgICBSdWxlcz1bCiAgICAgICAgewogICAgICAgICAgICAnQWN0aW9uJzogeydUeXBlJzogJ0JMT0NLJ30sCiAgICAgICAgICAgICdQcmlvcml0eSc6IDEsCiAgICAgICAgICAgICdSdWxlSWQnOiBydWxlWydSdWxlJ11bJ1J1bGVJZCddCiAgICAgICAgfSwKICAgIF0KKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import boto3

# Crear un client d'AWS WAF
waf_client = boto3.client('waf')

# Crear una condici&oacute; de coincid&egrave;ncia de SQL injection
sql_injection_set = waf_client.create_sql_injection_match_set(
    Name='MySQLInjectionSet',
    ChangeToken=waf_client.get_change_token()['ChangeToken'],
    SqlInjectionMatchTuples=[
        {
            'FieldToMatch': {
                'Type': 'BODY'
            },
            'TextTransformation': 'URL_DECODE'
        },
    ]
)

# Crear una regla que utilitzi la condici&oacute; de coincid&egrave;ncia de SQL injection
rule = waf_client.create_rule(
    Name='MySQLInjectionRule',
    MetricName='MySQLInjectionRuleMetric',
    ChangeToken=waf_client.get_change_token()['ChangeToken'],
    Predicates=[
        {
            'Negated': False,
            'Type': 'SqlInjectionMatch',
            'DataId': sql_injection_set['SqlInjectionMatchSet']['SqlInjectionMatchSetId']
        },
    ]
)

# Crear un Web ACL i afegir la regla
web_acl = waf_client.create_web_acl(
    Name='MyWebACL',
    MetricName='MyWebACLMetric',
    DefaultAction={'Type': 'ALLOW'},
    ChangeToken=waf_client.get_change_token()['ChangeToken'],
    Rules=[
        {
            'Action': {'Type': 'BLOCK'},
            'Priority': 1,
            'RuleId': rule['Rule']['RuleId']
        },
    ]
)</pre></div><div class='content'></div><h1><p>Resum</p>
</h1>
<div class='content'><p>En aquesta secció, hem après què és AWS WAF i com pot ajudar a protegir les aplicacions web contra atacs comuns. Hem vist com configurar un Web ACL, definir regles personalitzades i associar el Web ACL amb un recurs. També hem realitzat un exercici pràctic per configurar AWS WAF per protegir una aplicació web contra atacs de SQL injection. Amb aquests coneixements, estàs preparat per començar a utilitzar AWS WAF per millorar la seguretat de les teves aplicacions web.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='04-03-aws-shield' title="AWS Shield">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='05-01-cloudwatch' title="Amazon CloudWatch">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
