<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estructura de dades i regles de seguretat</title>

    <link rel="alternate" href="https://campusempresa.com/mod/firebase/03-03-data-structure-and-security-rules" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/firebase/03-03-data-structure-and-security-rules" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/firebase/03-03-data-structure-and-security-rules" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/firebase/03-03-data-structure-and-security-rules" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/firebase/03-03-data-structure-and-security-rules" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Projecte</a>
				<a href="/about">Sobre nosaltres</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donacions</a>
				<a href="/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='03-02-reading-and-writing-data' title="Lectura i escriptura de dades">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Estructura de dades i regles de seguretat</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='03-04-offline-capabilities' title="Capacitats fora de línia">Següent &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introducció</h1>
<div class='content'><p>En aquest tema, explorarem com estructurar les dades a la base de dades en temps real de Firebase i com definir regles de seguretat per protegir aquestes dades. Una bona estructura de dades i regles de seguretat ben definides són essencials per garantir que la teva aplicació sigui eficient i segura.</p>
</div><h1>Estructura de dades</h1>
<div class='content'></div><h2>1. Nodes i claus</h2>
<div class='content'><p>La base de dades en temps real de Firebase emmagatzema les dades en un format JSON, on cada node és una clau que conté un valor. Els nodes poden contenir altres nodes, creant una estructura jeràrquica.</p>
<p><strong>Exemple:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ewogICJ1c3VhcmlzIjogewogICAgInVzdWFyaTEiOiB7CiAgICAgICJub20iOiAiSm9hbiIsCiAgICAgICJlZGF0IjogMzAKICAgIH0sCiAgICAidXN1YXJpMiI6IHsKICAgICAgIm5vbSI6ICJNYXJpYSIsCiAgICAgICJlZGF0IjogMjUKICAgIH0KICB9LAogICJtaXNzYXRnZXMiOiB7CiAgICAibWlzc2F0Z2UxIjogewogICAgICAidGV4dCI6ICJIb2xhISIsCiAgICAgICJ1c3VhcmkiOiAidXN1YXJpMSIKICAgIH0sCiAgICAibWlzc2F0Z2UyIjogewogICAgICAidGV4dCI6ICJCb24gZGlhISIsCiAgICAgICJ1c3VhcmkiOiAidXN1YXJpMiIKICAgIH0KICB9Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>{
  &quot;usuaris&quot;: {
    &quot;usuari1&quot;: {
      &quot;nom&quot;: &quot;Joan&quot;,
      &quot;edat&quot;: 30
    },
    &quot;usuari2&quot;: {
      &quot;nom&quot;: &quot;Maria&quot;,
      &quot;edat&quot;: 25
    }
  },
  &quot;missatges&quot;: {
    &quot;missatge1&quot;: {
      &quot;text&quot;: &quot;Hola!&quot;,
      &quot;usuari&quot;: &quot;usuari1&quot;
    },
    &quot;missatge2&quot;: {
      &quot;text&quot;: &quot;Bon dia!&quot;,
      &quot;usuari&quot;: &quot;usuari2&quot;
    }
  }
}</pre></div><div class='content'></div><h2>2. Normalització de dades</h2>
<div class='content'><p>Per evitar la duplicació de dades i mantenir una estructura escalable, és recomanable normalitzar les dades. Això implica dividir les dades en diferents nodes i utilitzar referències per connectar-les.</p>
<p><strong>Exemple:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ewogICJ1c3VhcmlzIjogewogICAgInVzdWFyaTEiOiB7CiAgICAgICJub20iOiAiSm9hbiIsCiAgICAgICJlZGF0IjogMzAKICAgIH0sCiAgICAidXN1YXJpMiI6IHsKICAgICAgIm5vbSI6ICJNYXJpYSIsCiAgICAgICJlZGF0IjogMjUKICAgIH0KICB9LAogICJtaXNzYXRnZXMiOiB7CiAgICAibWlzc2F0Z2UxIjogewogICAgICAidGV4dCI6ICJIb2xhISIsCiAgICAgICJ1c3VhcmlJZCI6ICJ1c3VhcmkxIgogICAgfSwKICAgICJtaXNzYXRnZTIiOiB7CiAgICAgICJ0ZXh0IjogIkJvbiBkaWEhIiwKICAgICAgInVzdWFyaUlkIjogInVzdWFyaTIiCiAgICB9CiAgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>{
  &quot;usuaris&quot;: {
    &quot;usuari1&quot;: {
      &quot;nom&quot;: &quot;Joan&quot;,
      &quot;edat&quot;: 30
    },
    &quot;usuari2&quot;: {
      &quot;nom&quot;: &quot;Maria&quot;,
      &quot;edat&quot;: 25
    }
  },
  &quot;missatges&quot;: {
    &quot;missatge1&quot;: {
      &quot;text&quot;: &quot;Hola!&quot;,
      &quot;usuariId&quot;: &quot;usuari1&quot;
    },
    &quot;missatge2&quot;: {
      &quot;text&quot;: &quot;Bon dia!&quot;,
      &quot;usuariId&quot;: &quot;usuari2&quot;
    }
  }
}</pre></div><div class='content'></div><h2>3. Indexació de dades</h2>
<div class='content'><p>Per millorar el rendiment de les consultes, és important indexar les dades. Firebase permet definir índexs a les regles de seguretat.</p>
<p><strong>Exemple de regles d'indexació:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ewogICJydWxlcyI6IHsKICAgICJ1c3VhcmlzIjogewogICAgICAiLmluZGV4T24iOiBbIm5vbSJdCiAgICB9LAogICAgIm1pc3NhdGdlcyI6IHsKICAgICAgIi5pbmRleE9uIjogWyJ1c3VhcmlJZCJdCiAgICB9CiAgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>{
  &quot;rules&quot;: {
    &quot;usuaris&quot;: {
      &quot;.indexOn&quot;: [&quot;nom&quot;]
    },
    &quot;missatges&quot;: {
      &quot;.indexOn&quot;: [&quot;usuariId&quot;]
    }
  }
}</pre></div><div class='content'></div><h1>Regles de seguretat</h1>
<div class='content'></div><h2>1. Introducció a les regles de seguretat</h2>
<div class='content'><p>Les regles de seguretat de Firebase determinen qui pot llegir i escriure dades a la base de dades. Aquestes regles es defineixen en un fitxer JSON i s'apliquen a cada node de la base de dades.</p>
</div><h2>2. Regles bàsiques</h2>
<div class='content'><p>Les regles de seguretat es defineixen utilitzant les propietats <code>.read</code> i <code>.write</code>.</p>
<p><strong>Exemple:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ewogICJydWxlcyI6IHsKICAgICIucmVhZCI6ICJhdXRoICE9IG51bGwiLAogICAgIi53cml0ZSI6ICJhdXRoICE9IG51bGwiCiAgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>{
  &quot;rules&quot;: {
    &quot;.read&quot;: &quot;auth != null&quot;,
    &quot;.write&quot;: &quot;auth != null&quot;
  }
}</pre></div><div class='content'><p>Aquestes regles permeten l'accés només als usuaris autenticats.</p>
</div><h2>3. Regles basades en nodes</h2>
<div class='content'><p>Es poden definir regles específiques per a diferents nodes de la base de dades.</p>
<p><strong>Exemple:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ewogICJydWxlcyI6IHsKICAgICJ1c3VhcmlzIjogewogICAgICAiJHVzdWFyaUlkIjogewogICAgICAgICIucmVhZCI6ICIkdXN1YXJpSWQgPT09IGF1dGgudWlkIiwKICAgICAgICAiLndyaXRlIjogIiR1c3VhcmlJZCA9PT0gYXV0aC51aWQiCiAgICAgIH0KICAgIH0sCiAgICAibWlzc2F0Z2VzIjogewogICAgICAiLnJlYWQiOiAiYXV0aCAhPSBudWxsIiwKICAgICAgIi53cml0ZSI6ICJhdXRoICE9IG51bGwiCiAgICB9CiAgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>{
  &quot;rules&quot;: {
    &quot;usuaris&quot;: {
      &quot;$usuariId&quot;: {
        &quot;.read&quot;: &quot;$usuariId === auth.uid&quot;,
        &quot;.write&quot;: &quot;$usuariId === auth.uid&quot;
      }
    },
    &quot;missatges&quot;: {
      &quot;.read&quot;: &quot;auth != null&quot;,
      &quot;.write&quot;: &quot;auth != null&quot;
    }
  }
}</pre></div><div class='content'><p>En aquest exemple, només l'usuari propietari de les dades pot llegir i escriure en el seu node d'usuari, mentre que tots els usuaris autenticats poden llegir i escriure missatges.</p>
</div><h2>4. Validació de dades</h2>
<div class='content'><p>Les regles de seguretat també poden validar les dades abans de permetre l'escriptura.</p>
<p><strong>Exemple:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ewogICJydWxlcyI6IHsKICAgICJ1c3VhcmlzIjogewogICAgICAiJHVzdWFyaUlkIjogewogICAgICAgICIud3JpdGUiOiAiJHVzdWFyaUlkID09PSBhdXRoLnVpZCIsCiAgICAgICAgIi52YWxpZGF0ZSI6ICJuZXdEYXRhLmhhc0NoaWxkcmVuKFsnbm9tJywgJ2VkYXQnXSkgJiYgbmV3RGF0YS5jaGlsZCgnZWRhdCcpLmlzTnVtYmVyKCkiCiAgICAgIH0KICAgIH0KICB9Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>{
  &quot;rules&quot;: {
    &quot;usuaris&quot;: {
      &quot;$usuariId&quot;: {
        &quot;.write&quot;: &quot;$usuariId === auth.uid&quot;,
        &quot;.validate&quot;: &quot;newData.hasChildren(['nom', 'edat']) &amp;&amp; newData.child('edat').isNumber()&quot;
      }
    }
  }
}</pre></div><div class='content'><p>Aquestes regles asseguren que cada node d'usuari conté els camps <code>nom</code> i <code>edat</code>, i que <code>edat</code> és un número.</p>
</div><h1>Exercicis pràctics</h1>
<div class='content'></div><h2>Exercici 1: Crear una estructura de dades</h2>
<div class='content'><ol>
<li>Crea una estructura de dades per a una aplicació de xat que inclogui usuaris i missatges.</li>
<li>Normalitza les dades per evitar duplicacions.</li>
</ol>
<p><strong>Solució:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ewogICJ1c3VhcmlzIjogewogICAgInVzdWFyaTEiOiB7CiAgICAgICJub20iOiAiSm9hbiIsCiAgICAgICJlZGF0IjogMzAKICAgIH0sCiAgICAidXN1YXJpMiI6IHsKICAgICAgIm5vbSI6ICJNYXJpYSIsCiAgICAgICJlZGF0IjogMjUKICAgIH0KICB9LAogICJtaXNzYXRnZXMiOiB7CiAgICAibWlzc2F0Z2UxIjogewogICAgICAidGV4dCI6ICJIb2xhISIsCiAgICAgICJ1c3VhcmlJZCI6ICJ1c3VhcmkxIgogICAgfSwKICAgICJtaXNzYXRnZTIiOiB7CiAgICAgICJ0ZXh0IjogIkJvbiBkaWEhIiwKICAgICAgInVzdWFyaUlkIjogInVzdWFyaTIiCiAgICB9CiAgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>{
  &quot;usuaris&quot;: {
    &quot;usuari1&quot;: {
      &quot;nom&quot;: &quot;Joan&quot;,
      &quot;edat&quot;: 30
    },
    &quot;usuari2&quot;: {
      &quot;nom&quot;: &quot;Maria&quot;,
      &quot;edat&quot;: 25
    }
  },
  &quot;missatges&quot;: {
    &quot;missatge1&quot;: {
      &quot;text&quot;: &quot;Hola!&quot;,
      &quot;usuariId&quot;: &quot;usuari1&quot;
    },
    &quot;missatge2&quot;: {
      &quot;text&quot;: &quot;Bon dia!&quot;,
      &quot;usuariId&quot;: &quot;usuari2&quot;
    }
  }
}</pre></div><div class='content'></div><h2>Exercici 2: Definir regles de seguretat</h2>
<div class='content'><ol>
<li>Defineix regles de seguretat que permetin només als usuaris autenticats llegir i escriure missatges.</li>
<li>Assegura't que només l'usuari propietari pugui llegir i escriure en el seu node d'usuari.</li>
</ol>
<p><strong>Solució:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ewogICJydWxlcyI6IHsKICAgICJ1c3VhcmlzIjogewogICAgICAiJHVzdWFyaUlkIjogewogICAgICAgICIucmVhZCI6ICIkdXN1YXJpSWQgPT09IGF1dGgudWlkIiwKICAgICAgICAiLndyaXRlIjogIiR1c3VhcmlJZCA9PT0gYXV0aC51aWQiCiAgICAgIH0KICAgIH0sCiAgICAibWlzc2F0Z2VzIjogewogICAgICAiLnJlYWQiOiAiYXV0aCAhPSBudWxsIiwKICAgICAgIi53cml0ZSI6ICJhdXRoICE9IG51bGwiCiAgICB9CiAgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>{
  &quot;rules&quot;: {
    &quot;usuaris&quot;: {
      &quot;$usuariId&quot;: {
        &quot;.read&quot;: &quot;$usuariId === auth.uid&quot;,
        &quot;.write&quot;: &quot;$usuariId === auth.uid&quot;
      }
    },
    &quot;missatges&quot;: {
      &quot;.read&quot;: &quot;auth != null&quot;,
      &quot;.write&quot;: &quot;auth != null&quot;
    }
  }
}</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>En aquesta secció, hem après com estructurar les dades a la base de dades en temps real de Firebase i com definir regles de seguretat per protegir aquestes dades. Hem vist la importància de normalitzar les dades, indexar-les per millorar el rendiment i definir regles de seguretat per controlar l'accés i validar les dades. Amb aquests coneixements, estàs preparat per crear una base de dades segura i eficient per a la teva aplicació.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='03-02-reading-and-writing-data' title="Lectura i escriptura de dades">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='03-04-offline-capabilities' title="Capacitats fora de línia">Següent &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
