<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utilitzar serveis per a la gestió d'estat</title>

    <link rel="alternate" href="https://campusempresa.com/mod/angular/08-02-using-services-state-management" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/angular/08-02-using-services-state-management" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/angular/08-02-using-services-state-management" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 px-0 py-2 py-md-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 px-0 py-2 py-md-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/angular/08-02-using-services-state-management" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/angular/08-02-using-services-state-management" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Projecte</a>
				<a href="/about">Sobre nosaltres</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donacions</a>
				<a href="/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='08-01-introduction-state-management' title="Introducció a la gestió d'estat">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Utilitzar serveis per a la gestió d'estat</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='08-03-ngrx-store' title="NgRx Store">Següent &#x25BA;</a>
			</div>
</div>
<div class='content'><p>En aquest tema, explorarem com utilitzar serveis per gestionar l'estat de les aplicacions Angular. La gestió d'estat és crucial per mantenir la coherència de les dades i la interacció de l'usuari en aplicacions complexes. Els serveis d'Angular proporcionen una manera eficient de compartir dades i funcionalitats entre components.</p>
</div><h1>Objectius</h1>
<div class='content'><ul>
<li>Comprendre la importància de la gestió d'estat.</li>
<li>Aprendre a crear i utilitzar serveis per gestionar l'estat.</li>
<li>Implementar patrons comuns de gestió d'estat amb serveis.</li>
</ul>
</div><h1>Conceptes Clau</h1>
<div class='content'></div><h2>Què és la gestió d'estat?</h2>
<div class='content'><p>La gestió d'estat es refereix a com es maneja i es manté l'estat de l'aplicació, incloent dades de l'usuari, configuracions, i altres informacions que poden canviar durant l'ús de l'aplicació.</p>
</div><h2>Per què utilitzar serveis per a la gestió d'estat?</h2>
<div class='content'><ul>
<li><strong>Compartició de dades</strong>: Els serveis permeten compartir dades entre components sense necessitat de passar-les a través de la jerarquia de components.</li>
<li><strong>Encapsulació de la lògica</strong>: La lògica de negoci es pot encapsular en serveis, mantenint els components més nets i enfocats en la presentació.</li>
<li><strong>Reutilització</strong>: Els serveis poden ser reutilitzats en diferents parts de l'aplicació.</li>
</ul>
</div><h1>Creació d'un servei per a la gestió d'estat</h1>
<div class='content'></div><h2>Pas 1: Crear el servei</h2>
<div class='content'><p>Utilitzarem Angular CLI per crear un servei. Suposem que estem gestionant l'estat d'una llista de tasques.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bmcgZ2VuZXJhdGUgc2VydmljZSB0YXNr"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ng generate service task</pre></div><div class='content'></div><h2>Pas 2: Definir el servei</h2>
<div class='content'><p>Definim el servei <code>TaskService</code> per gestionar l'estat de les tasques.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnOwppbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJzsKCmV4cG9ydCBpbnRlcmZhY2UgVGFzayB7CiAgaWQ6IG51bWJlcjsKICB0aXRsZTogc3RyaW5nOwogIGNvbXBsZXRlZDogYm9vbGVhbjsKfQoKQEluamVjdGFibGUoewogIHByb3ZpZGVkSW46ICdyb290Jwp9KQpleHBvcnQgY2xhc3MgVGFza1NlcnZpY2UgewogIHByaXZhdGUgdGFza3NTdWJqZWN0ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxUYXNrW10+KFtdKTsKICB0YXNrcyQgPSB0aGlzLnRhc2tzU3ViamVjdC5hc09ic2VydmFibGUoKTsKCiAgY29uc3RydWN0b3IoKSB7IH0KCiAgYWRkVGFzayh0YXNrOiBUYXNrKSB7CiAgICBjb25zdCBjdXJyZW50VGFza3MgPSB0aGlzLnRhc2tzU3ViamVjdC52YWx1ZTsKICAgIHRoaXMudGFza3NTdWJqZWN0Lm5leHQoWy4uLmN1cnJlbnRUYXNrcywgdGFza10pOwogIH0KCiAgdXBkYXRlVGFzayh1cGRhdGVkVGFzazogVGFzaykgewogICAgY29uc3QgY3VycmVudFRhc2tzID0gdGhpcy50YXNrc1N1YmplY3QudmFsdWUubWFwKHRhc2sgPT4KICAgICAgdGFzay5pZCA9PT0gdXBkYXRlZFRhc2suaWQgPyB1cGRhdGVkVGFzayA6IHRhc2sKICAgICk7CiAgICB0aGlzLnRhc2tzU3ViamVjdC5uZXh0KGN1cnJlbnRUYXNrcyk7CiAgfQoKICBkZWxldGVUYXNrKHRhc2tJZDogbnVtYmVyKSB7CiAgICBjb25zdCBjdXJyZW50VGFza3MgPSB0aGlzLnRhc2tzU3ViamVjdC52YWx1ZS5maWx0ZXIodGFzayA9PiB0YXNrLmlkICE9PSB0YXNrSWQpOwogICAgdGhpcy50YXNrc1N1YmplY3QubmV4dChjdXJyZW50VGFza3MpOwogIH0KfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';

export interface Task {
  id: number;
  title: string;
  completed: boolean;
}

@Injectable({
  providedIn: 'root'
})
export class TaskService {
  private tasksSubject = new BehaviorSubject&lt;Task[]&gt;([]);
  tasks$ = this.tasksSubject.asObservable();

  constructor() { }

  addTask(task: Task) {
    const currentTasks = this.tasksSubject.value;
    this.tasksSubject.next([...currentTasks, task]);
  }

  updateTask(updatedTask: Task) {
    const currentTasks = this.tasksSubject.value.map(task =&gt;
      task.id === updatedTask.id ? updatedTask : task
    );
    this.tasksSubject.next(currentTasks);
  }

  deleteTask(taskId: number) {
    const currentTasks = this.tasksSubject.value.filter(task =&gt; task.id !== taskId);
    this.tasksSubject.next(currentTasks);
  }
}</pre></div><div class='content'></div><h2>Explicació del codi</h2>
<div class='content'><ul>
<li><strong>BehaviorSubject</strong>: Utilitzem <code>BehaviorSubject</code> per mantenir l'estat de les tasques i permetre que els components es subscriguin a les actualitzacions.</li>
<li><strong>tasks$</strong>: És un observable que els components poden subscriure's per rebre actualitzacions de l'estat de les tasques.</li>
<li><strong>addTask, updateTask, deleteTask</strong>: Mètodes per modificar l'estat de les tasques.</li>
</ul>
</div><h1>Utilització del servei en components</h1>
<div class='content'></div><h2>Pas 3: Injectar el servei en un component</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJzsKaW1wb3J0IHsgVGFza1NlcnZpY2UsIFRhc2sgfSBmcm9tICcuL3Rhc2suc2VydmljZSc7CgpAQ29tcG9uZW50KHsKICBzZWxlY3RvcjogJ2FwcC10YXNrLWxpc3QnLAogIHRlbXBsYXRlVXJsOiAnLi90YXNrLWxpc3QuY29tcG9uZW50Lmh0bWwnLAogIHN0eWxlVXJsczogWycuL3Rhc2stbGlzdC5jb21wb25lbnQuY3NzJ10KfSkKZXhwb3J0IGNsYXNzIFRhc2tMaXN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHsKICB0YXNrczogVGFza1tdID0gW107CgogIGNvbnN0cnVjdG9yKHByaXZhdGUgdGFza1NlcnZpY2U6IFRhc2tTZXJ2aWNlKSB7IH0KCiAgbmdPbkluaXQoKTogdm9pZCB7CiAgICB0aGlzLnRhc2tTZXJ2aWNlLnRhc2tzJC5zdWJzY3JpYmUodGFza3MgPT4gewogICAgICB0aGlzLnRhc2tzID0gdGFza3M7CiAgICB9KTsKICB9CgogIGFkZFRhc2sodGl0bGU6IHN0cmluZykgewogICAgY29uc3QgbmV3VGFzazogVGFzayA9IHsgaWQ6IERhdGUubm93KCksIHRpdGxlLCBjb21wbGV0ZWQ6IGZhbHNlIH07CiAgICB0aGlzLnRhc2tTZXJ2aWNlLmFkZFRhc2sobmV3VGFzayk7CiAgfQoKICB1cGRhdGVUYXNrKHRhc2s6IFRhc2spIHsKICAgIHRoaXMudGFza1NlcnZpY2UudXBkYXRlVGFzayh0YXNrKTsKICB9CgogIGRlbGV0ZVRhc2sodGFza0lkOiBudW1iZXIpIHsKICAgIHRoaXMudGFza1NlcnZpY2UuZGVsZXRlVGFzayh0YXNrSWQpOwogIH0KfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import { Component, OnInit } from '@angular/core';
import { TaskService, Task } from './task.service';

@Component({
  selector: 'app-task-list',
  templateUrl: './task-list.component.html',
  styleUrls: ['./task-list.component.css']
})
export class TaskListComponent implements OnInit {
  tasks: Task[] = [];

  constructor(private taskService: TaskService) { }

  ngOnInit(): void {
    this.taskService.tasks$.subscribe(tasks =&gt; {
      this.tasks = tasks;
    });
  }

  addTask(title: string) {
    const newTask: Task = { id: Date.now(), title, completed: false };
    this.taskService.addTask(newTask);
  }

  updateTask(task: Task) {
    this.taskService.updateTask(task);
  }

  deleteTask(taskId: number) {
    this.taskService.deleteTask(taskId);
  }
}</pre></div><div class='content'></div><h2>Explicació del codi</h2>
<div class='content'><ul>
<li><strong>ngOnInit</strong>: Ens subscrivim a <code>tasks$</code> per rebre actualitzacions de l'estat de les tasques.</li>
<li><strong>addTask, updateTask, deleteTask</strong>: Mètodes per interactuar amb el servei i modificar l'estat de les tasques.</li>
</ul>
</div><h1>Exercici Pràctic</h1>
<div class='content'></div><h2>Exercici</h2>
<div class='content'><ol>
<li>Crea un nou servei <code>UserService</code> per gestionar l'estat dels usuaris.</li>
<li>Defineix una interfície <code>User</code> amb els camps <code>id</code>, <code>name</code>, i <code>email</code>.</li>
<li>Implementa mètodes per afegir, actualitzar i eliminar usuaris.</li>
<li>Utilitza el servei en un component <code>UserListComponent</code> per mostrar la llista d'usuaris i permetre afegir, actualitzar i eliminar usuaris.</li>
</ol>
</div><h2>Solució</h2>
<div class='content'><h4>user.service.ts</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnOwppbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJzsKCmV4cG9ydCBpbnRlcmZhY2UgVXNlciB7CiAgaWQ6IG51bWJlcjsKICBuYW1lOiBzdHJpbmc7CiAgZW1haWw6IHN0cmluZzsKfQoKQEluamVjdGFibGUoewogIHByb3ZpZGVkSW46ICdyb290Jwp9KQpleHBvcnQgY2xhc3MgVXNlclNlcnZpY2UgewogIHByaXZhdGUgdXNlcnNTdWJqZWN0ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxVc2VyW10+KFtdKTsKICB1c2VycyQgPSB0aGlzLnVzZXJzU3ViamVjdC5hc09ic2VydmFibGUoKTsKCiAgY29uc3RydWN0b3IoKSB7IH0KCiAgYWRkVXNlcih1c2VyOiBVc2VyKSB7CiAgICBjb25zdCBjdXJyZW50VXNlcnMgPSB0aGlzLnVzZXJzU3ViamVjdC52YWx1ZTsKICAgIHRoaXMudXNlcnNTdWJqZWN0Lm5leHQoWy4uLmN1cnJlbnRVc2VycywgdXNlcl0pOwogIH0KCiAgdXBkYXRlVXNlcih1cGRhdGVkVXNlcjogVXNlcikgewogICAgY29uc3QgY3VycmVudFVzZXJzID0gdGhpcy51c2Vyc1N1YmplY3QudmFsdWUubWFwKHVzZXIgPT4KICAgICAgdXNlci5pZCA9PT0gdXBkYXRlZFVzZXIuaWQgPyB1cGRhdGVkVXNlciA6IHVzZXIKICAgICk7CiAgICB0aGlzLnVzZXJzU3ViamVjdC5uZXh0KGN1cnJlbnRVc2Vycyk7CiAgfQoKICBkZWxldGVVc2VyKHVzZXJJZDogbnVtYmVyKSB7CiAgICBjb25zdCBjdXJyZW50VXNlcnMgPSB0aGlzLnVzZXJzU3ViamVjdC52YWx1ZS5maWx0ZXIodXNlciA9PiB1c2VyLmlkICE9PSB1c2VySWQpOwogICAgdGhpcy51c2Vyc1N1YmplY3QubmV4dChjdXJyZW50VXNlcnMpOwogIH0KfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';

export interface User {
  id: number;
  name: string;
  email: string;
}

@Injectable({
  providedIn: 'root'
})
export class UserService {
  private usersSubject = new BehaviorSubject&lt;User[]&gt;([]);
  users$ = this.usersSubject.asObservable();

  constructor() { }

  addUser(user: User) {
    const currentUsers = this.usersSubject.value;
    this.usersSubject.next([...currentUsers, user]);
  }

  updateUser(updatedUser: User) {
    const currentUsers = this.usersSubject.value.map(user =&gt;
      user.id === updatedUser.id ? updatedUser : user
    );
    this.usersSubject.next(currentUsers);
  }

  deleteUser(userId: number) {
    const currentUsers = this.usersSubject.value.filter(user =&gt; user.id !== userId);
    this.usersSubject.next(currentUsers);
  }
}</pre></div><div class='content'><h4>user-list.component.ts</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJzsKaW1wb3J0IHsgVXNlclNlcnZpY2UsIFVzZXIgfSBmcm9tICcuL3VzZXIuc2VydmljZSc7CgpAQ29tcG9uZW50KHsKICBzZWxlY3RvcjogJ2FwcC11c2VyLWxpc3QnLAogIHRlbXBsYXRlVXJsOiAnLi91c2VyLWxpc3QuY29tcG9uZW50Lmh0bWwnLAogIHN0eWxlVXJsczogWycuL3VzZXItbGlzdC5jb21wb25lbnQuY3NzJ10KfSkKZXhwb3J0IGNsYXNzIFVzZXJMaXN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHsKICB1c2VyczogVXNlcltdID0gW107CgogIGNvbnN0cnVjdG9yKHByaXZhdGUgdXNlclNlcnZpY2U6IFVzZXJTZXJ2aWNlKSB7IH0KCiAgbmdPbkluaXQoKTogdm9pZCB7CiAgICB0aGlzLnVzZXJTZXJ2aWNlLnVzZXJzJC5zdWJzY3JpYmUodXNlcnMgPT4gewogICAgICB0aGlzLnVzZXJzID0gdXNlcnM7CiAgICB9KTsKICB9CgogIGFkZFVzZXIobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nKSB7CiAgICBjb25zdCBuZXdVc2VyOiBVc2VyID0geyBpZDogRGF0ZS5ub3coKSwgbmFtZSwgZW1haWwgfTsKICAgIHRoaXMudXNlclNlcnZpY2UuYWRkVXNlcihuZXdVc2VyKTsKICB9CgogIHVwZGF0ZVVzZXIodXNlcjogVXNlcikgewogICAgdGhpcy51c2VyU2VydmljZS51cGRhdGVVc2VyKHVzZXIpOwogIH0KCiAgZGVsZXRlVXNlcih1c2VySWQ6IG51bWJlcikgewogICAgdGhpcy51c2VyU2VydmljZS5kZWxldGVVc2VyKHVzZXJJZCk7CiAgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import { Component, OnInit } from '@angular/core';
import { UserService, User } from './user.service';

@Component({
  selector: 'app-user-list',
  templateUrl: './user-list.component.html',
  styleUrls: ['./user-list.component.css']
})
export class UserListComponent implements OnInit {
  users: User[] = [];

  constructor(private userService: UserService) { }

  ngOnInit(): void {
    this.userService.users$.subscribe(users =&gt; {
      this.users = users;
    });
  }

  addUser(name: string, email: string) {
    const newUser: User = { id: Date.now(), name, email };
    this.userService.addUser(newUser);
  }

  updateUser(user: User) {
    this.userService.updateUser(user);
  }

  deleteUser(userId: number) {
    this.userService.deleteUser(userId);
  }
}</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>En aquest tema, hem après com utilitzar serveis per gestionar l'estat en aplicacions Angular. Els serveis proporcionen una manera eficient de compartir dades i encapsular la lògica de negoci, facilitant la gestió de l'estat de l'aplicació. Hem creat un servei per gestionar tasques i hem vist com utilitzar-lo en un component. A més, hem practicat creant un servei per gestionar usuaris. En el proper tema, explorarem com utilitzar NgRx per a la gestió d'estat avançada.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='08-01-introduction-state-management' title="Introducció a la gestió d'estat">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='08-03-ngrx-store' title="NgRx Store">Següent &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
