<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mòdul 7: Temes Avançats</title>

    <link rel="alternate" href="https://campusempresa.com/mod/python/7-3-context-managers" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/python/7-3-context-managers" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/python/7-3-context-managers" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/python/7-3-context-managers" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/python/7-3-context-managers" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Projecte</a>
				<a href="/about">Sobre nosaltres</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donacions</a>
				<a href="/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-4'>
					<a href='7-2-generators'>&#x25C4;Generadors</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Mòdul 7: Temes Avançats</a>
	</div>
	<div class='col-4 text-end'>
					<a href='7-4-regular-expressions'>Expressions Regulars &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>7-3: Gestors de Context</h1>
<div class='content'></div><h2>Introducció</h2>
<div class='content'><p>Els gestors de context en Python són una característica poderosa que permet gestionar recursos de manera eficient i segura. S'utilitzen principalment per assegurar-se que els recursos es tanquin correctament després d'usar-los, com ara fitxers, connexions de xarxa, etc. El mètode més comú per utilitzar gestors de context és amb la instrucció <code>with</code>.</p>
</div><h2>Conceptes Clau</h2>
<div class='content'><ul>
<li><strong>Gestor de Context</strong>: Una estructura que defineix mètodes per inicialitzar i finalitzar un context.</li>
<li><strong>Instrucció <code>with</code></strong>: Simplifica la gestió de recursos, garantint que es tanquin correctament.</li>
<li><strong>Mètodes <code>__enter__</code> i <code>__exit__</code></strong>: Mètodes especials que defineixen el comportament d'un gestor de context.</li>
</ul>
</div><h2>Sintaxi Bàsica</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("d2l0aCBvcGVuKCdmaXR4ZXIudHh0JywgJ3InKSBhcyBmaXR4ZXI6CiAgICBjb250aW5ndXQgPSBmaXR4ZXIucmVhZCgpCiAgICBwcmludChjb250aW5ndXQp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>with open('fitxer.txt', 'r') as fitxer:
    contingut = fitxer.read()
    print(contingut)</pre></div><div class='content'><p>En aquest exemple, el fitxer s'obre i es llegeix dins del bloc <code>with</code>. Quan el bloc <code>with</code> es completa, el fitxer es tanca automàticament, fins i tot si es produeix una excepció.</p>
</div><h2>Creació d'un Gestor de Context Personalitzat</h2>
<div class='content'><p>Per crear un gestor de context personalitzat, cal definir una classe amb els mètodes <code>__enter__</code> i <code>__exit__</code>.</p>
<h4>Exemple:</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgR2VzdG9yRGVGaXR4ZXI6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbm9tX2ZpdHhlciwgbW9kZSk6CiAgICAgICAgc2VsZi5ub21fZml0eGVyID0gbm9tX2ZpdHhlcgogICAgICAgIHNlbGYubW9kZSA9IG1vZGUKCiAgICBkZWYgX19lbnRlcl9fKHNlbGYpOgogICAgICAgIHNlbGYuZml0eGVyID0gb3BlbihzZWxmLm5vbV9maXR4ZXIsIHNlbGYubW9kZSkKICAgICAgICByZXR1cm4gc2VsZi5maXR4ZXIKCiAgICBkZWYgX19leGl0X18oc2VsZiwgdGlwdXNfZXhjZXBjaW8sIHZhbG9yX2V4Y2VwY2lvLCB0cmFjZWJhY2spOgogICAgICAgIHNlbGYuZml0eGVyLmNsb3NlKCkKCiMgw5pzIGRlbCBnZXN0b3IgZGUgY29udGV4dCBwZXJzb25hbGl0emF0CndpdGggR2VzdG9yRGVGaXR4ZXIoJ2ZpdHhlci50eHQnLCAncicpIGFzIGZpdHhlcjoKICAgIGNvbnRpbmd1dCA9IGZpdHhlci5yZWFkKCkKICAgIHByaW50KGNvbnRpbmd1dCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class GestorDeFitxer:
    def __init__(self, nom_fitxer, mode):
        self.nom_fitxer = nom_fitxer
        self.mode = mode

    def __enter__(self):
        self.fitxer = open(self.nom_fitxer, self.mode)
        return self.fitxer

    def __exit__(self, tipus_excepcio, valor_excepcio, traceback):
        self.fitxer.close()

# &Uacute;s del gestor de context personalitzat
with GestorDeFitxer('fitxer.txt', 'r') as fitxer:
    contingut = fitxer.read()
    print(contingut)</pre></div><div class='content'></div><h2>Explicació del Codi</h2>
<div class='content'><ol>
<li>
<p><strong>Definició de la Classe</strong>:</p>
<ul>
<li><code>__init__</code>: Inicialitza els paràmetres del fitxer.</li>
<li><code>__enter__</code>: Obre el fitxer i retorna l'objecte fitxer.</li>
<li><code>__exit__</code>: Tanca el fitxer, independentment de si es produeix una excepció.</li>
</ul>
</li>
<li>
<p><strong>Ús del Gestor de Context</strong>:</p>
<ul>
<li>La instrucció <code>with</code> utilitza la classe <code>GestorDeFitxer</code> per obrir i tancar el fitxer automàticament.</li>
</ul>
</li>
</ol>
</div><h2>Exemples Pràctics</h2>
<div class='content'><h4>Exemple 1: Gestió de Connexions de Xarxa</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHNvY2tldAoKY2xhc3MgR2VzdG9yRGVDb25uZXhpbzoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBob3N0LCBwb3J0KToKICAgICAgICBzZWxmLmhvc3QgPSBob3N0CiAgICAgICAgc2VsZi5wb3J0ID0gcG9ydAoKICAgIGRlZiBfX2VudGVyX18oc2VsZik6CiAgICAgICAgc2VsZi5jb25uZXhpbyA9IHNvY2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQsIHNvY2tldC5TT0NLX1NUUkVBTSkKICAgICAgICBzZWxmLmNvbm5leGlvLmNvbm5lY3QoKHNlbGYuaG9zdCwgc2VsZi5wb3J0KSkKICAgICAgICByZXR1cm4gc2VsZi5jb25uZXhpbwoKICAgIGRlZiBfX2V4aXRfXyhzZWxmLCB0aXB1c19leGNlcGNpbywgdmFsb3JfZXhjZXBjaW8sIHRyYWNlYmFjayk6CiAgICAgICAgc2VsZi5jb25uZXhpby5jbG9zZSgpCgojIMOacyBkZWwgZ2VzdG9yIGRlIGNvbnRleHQgcGVyIGEgY29ubmV4aW9ucyBkZSB4YXJ4YQp3aXRoIEdlc3RvckRlQ29ubmV4aW8oJ2V4YW1wbGUuY29tJywgODApIGFzIGNvbm5leGlvOgogICAgY29ubmV4aW8uc2VuZGFsbChiJ0dFVCAvIEhUVFAvMS4xXHJcbkhvc3Q6IGV4YW1wbGUuY29tXHJcblxyXG4nKQogICAgcmVzcG9zdGEgPSBjb25uZXhpby5yZWN2KDQwOTYpCiAgICBwcmludChyZXNwb3N0YS5kZWNvZGUoJ3V0Zi04Jykp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import socket

class GestorDeConnexio:
    def __init__(self, host, port):
        self.host = host
        self.port = port

    def __enter__(self):
        self.connexio = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.connexio.connect((self.host, self.port))
        return self.connexio

    def __exit__(self, tipus_excepcio, valor_excepcio, traceback):
        self.connexio.close()

# &Uacute;s del gestor de context per a connexions de xarxa
with GestorDeConnexio('example.com', 80) as connexio:
    connexio.sendall(b'GET / HTTP/1.1\r\nHost: example.com\r\n\r\n')
    resposta = connexio.recv(4096)
    print(resposta.decode('utf-8'))</pre></div><div class='content'><h4>Exemple 2: Temporització d'Execució</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRpbWUKCmNsYXNzIFRlbXBvcml0emFkb3I6CiAgICBkZWYgX19lbnRlcl9fKHNlbGYpOgogICAgICAgIHNlbGYuaW5pY2kgPSB0aW1lLnRpbWUoKQogICAgICAgIHJldHVybiBzZWxmCgogICAgZGVmIF9fZXhpdF9fKHNlbGYsIHRpcHVzX2V4Y2VwY2lvLCB2YWxvcl9leGNlcGNpbywgdHJhY2ViYWNrKToKICAgICAgICBzZWxmLmZpbmFsID0gdGltZS50aW1lKCkKICAgICAgICBzZWxmLnRlbXBzX3RvdGFsID0gc2VsZi5maW5hbCAtIHNlbGYuaW5pY2kKICAgICAgICBwcmludChmJ1RlbXBzIGRcJ2V4ZWN1Y2nDszoge3NlbGYudGVtcHNfdG90YWx9IHNlZ29ucycpCgojIMOacyBkZWwgZ2VzdG9yIGRlIGNvbnRleHQgcGVyIHRlbXBvcml0emFyIGwnZXhlY3VjacOzCndpdGggVGVtcG9yaXR6YWRvcigpIGFzIHQ6CiAgICBzdW1hID0gc3VtKHJhbmdlKDEwMDAwMDApKQogICAgcHJpbnQoZidTdW1hOiB7c3VtYX0nKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import time

class Temporitzador:
    def __enter__(self):
        self.inici = time.time()
        return self

    def __exit__(self, tipus_excepcio, valor_excepcio, traceback):
        self.final = time.time()
        self.temps_total = self.final - self.inici
        print(f'Temps d\'execuci&oacute;: {self.temps_total} segons')

# &Uacute;s del gestor de context per temporitzar l'execuci&oacute;
with Temporitzador() as t:
    suma = sum(range(1000000))
    print(f'Suma: {suma}')</pre></div><div class='content'></div><h2>Exercicis Pràctics</h2>
<div class='content'><h4>Exercici 1: Gestor de Fitxers</h4>
<p>Crea un gestor de context que llegeixi un fitxer línia per línia i imprimeixi cada línia en majúscules.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgR2VzdG9yRGVGaXR4ZXJNYWp1c2N1bGVzOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5vbV9maXR4ZXIpOgogICAgICAgIHNlbGYubm9tX2ZpdHhlciA9IG5vbV9maXR4ZXIKCiAgICBkZWYgX19lbnRlcl9fKHNlbGYpOgogICAgICAgIHNlbGYuZml0eGVyID0gb3BlbihzZWxmLm5vbV9maXR4ZXIsICdyJykKICAgICAgICByZXR1cm4gc2VsZi5maXR4ZXIKCiAgICBkZWYgX19leGl0X18oc2VsZiwgdGlwdXNfZXhjZXBjaW8sIHZhbG9yX2V4Y2VwY2lvLCB0cmFjZWJhY2spOgogICAgICAgIHNlbGYuZml0eGVyLmNsb3NlKCkKCiMgU29sdWNpw7MKd2l0aCBHZXN0b3JEZUZpdHhlck1hanVzY3VsZXMoJ2ZpdHhlci50eHQnKSBhcyBmaXR4ZXI6CiAgICBmb3IgbGluaWEgaW4gZml0eGVyOgogICAgICAgIHByaW50KGxpbmlhLnVwcGVyKCkp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class GestorDeFitxerMajuscules:
    def __init__(self, nom_fitxer):
        self.nom_fitxer = nom_fitxer

    def __enter__(self):
        self.fitxer = open(self.nom_fitxer, 'r')
        return self.fitxer

    def __exit__(self, tipus_excepcio, valor_excepcio, traceback):
        self.fitxer.close()

# Soluci&oacute;
with GestorDeFitxerMajuscules('fitxer.txt') as fitxer:
    for linia in fitxer:
        print(linia.upper())</pre></div><div class='content'><h4>Exercici 2: Gestor de Base de Dades</h4>
<p>Crea un gestor de context per gestionar connexions a una base de dades SQLite.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHNxbGl0ZTMKCmNsYXNzIEdlc3RvckRlQmFzZURlRGFkZXM6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbm9tX2Jhc2VfZGVfZGFkZXMpOgogICAgICAgIHNlbGYubm9tX2Jhc2VfZGVfZGFkZXMgPSBub21fYmFzZV9kZV9kYWRlcwoKICAgIGRlZiBfX2VudGVyX18oc2VsZik6CiAgICAgICAgc2VsZi5jb25uZXhpbyA9IHNxbGl0ZTMuY29ubmVjdChzZWxmLm5vbV9iYXNlX2RlX2RhZGVzKQogICAgICAgIHJldHVybiBzZWxmLmNvbm5leGlvCgogICAgZGVmIF9fZXhpdF9fKHNlbGYsIHRpcHVzX2V4Y2VwY2lvLCB2YWxvcl9leGNlcGNpbywgdHJhY2ViYWNrKToKICAgICAgICBzZWxmLmNvbm5leGlvLmNsb3NlKCkKCiMgU29sdWNpw7MKd2l0aCBHZXN0b3JEZUJhc2VEZURhZGVzKCdiYXNlX2RlX2RhZGVzLmRiJykgYXMgY29ubmV4aW86CiAgICBjdXJzb3IgPSBjb25uZXhpby5jdXJzb3IoKQogICAgY3Vyc29yLmV4ZWN1dGUoJ1NFTEVDVCAqIEZST00gdGF1bGEnKQogICAgcmVzdWx0YXRzID0gY3Vyc29yLmZldGNoYWxsKCkKICAgIGZvciBmaWxhIGluIHJlc3VsdGF0czoKICAgICAgICBwcmludChmaWxhKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import sqlite3

class GestorDeBaseDeDades:
    def __init__(self, nom_base_de_dades):
        self.nom_base_de_dades = nom_base_de_dades

    def __enter__(self):
        self.connexio = sqlite3.connect(self.nom_base_de_dades)
        return self.connexio

    def __exit__(self, tipus_excepcio, valor_excepcio, traceback):
        self.connexio.close()

# Soluci&oacute;
with GestorDeBaseDeDades('base_de_dades.db') as connexio:
    cursor = connexio.cursor()
    cursor.execute('SELECT * FROM taula')
    resultats = cursor.fetchall()
    for fila in resultats:
        print(fila)</pre></div><div class='content'></div><h2>Errors Comuns i Consells</h2>
<div class='content'><ul>
<li><strong>Oblidar tancar recursos</strong>: Utilitzar gestors de context per evitar oblidar tancar fitxers o connexions.</li>
<li><strong>No gestionar excepcions</strong>: Assegura't que el mètode <code>__exit__</code> gestioni correctament les excepcions per evitar fuites de recursos.</li>
<li><strong>No retornar l'objecte correcte en <code>__enter__</code></strong>: Retorna l'objecte que es vol gestionar dins del bloc <code>with</code>.</li>
</ul>
</div><h2>Conclusió</h2>
<div class='content'><p>Els gestors de context són una eina essencial per gestionar recursos de manera eficient i segura en Python. Amb la instrucció <code>with</code> i els mètodes <code>__enter__</code> i <code>__exit__</code>, pots assegurar-te que els recursos es tanquin correctament, fins i tot en cas d'excepcions. Practica creant els teus propis gestors de context per familiaritzar-te amb aquesta potent característica.</p>
<p>En el següent tema, explorarem les <strong>Expressions Regulars</strong>, una eina poderosa per treballar amb cadenes de text.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='7-2-generators'>&#x25C4;Generadors</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Mòdul 7: Temes Avançats</a>
	</div>
	<div class='col-4 text-end'>
					<a href='7-4-regular-expressions'>Expressions Regulars &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
