<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow, noarchive">
    <title>Agrupació i emmagatzematge en memòria cau</title>

    <link rel="alternate" href="https://campusempresa.com/mod/graphql/04-03-batching-and-caching" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/graphql/04-03-batching-and-caching" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/graphql/04-03-batching-and-caching" hreflang="en" />
    
	<!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"> -->
	<link href="/css/bootstrap/bootstrap.css?v=1" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css?v=4" rel="stylesheet">
	 
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<!-- 
  	<style type="text/css">
  		img {
  			visibility:hidden;
  		}
  	</style>
  	 -->
  	<script>
  		var LANG = "ca";
  		var CATEGORY = "frameworks";
  		var MOD_NAME = "graphql";
  		var TEMA_NAME = "04-03";
  		var TYPE = "mod";
  		var PATH = "mod/graphql/04-03-batching-and-caching";
  		var IS_INDEX = false;
  		var DEVELOP = sessionStorage.getItem("DEVELOP") == "true";
  		  		var ALL_PAGES_MOD = ["01-01-what-is-graphql","01-02-graphql-vs-rest","01-03-setting-up-graphql-server","01-04-graphql-schema-basics","02-01-queries","02-02-mutations","02-03-resolvers","02-04-graphql-types","02-05-graphql-scalars","03-01-interfaces","03-02-unions","03-03-enums","03-04-input-types","03-05-custom-scalars","04-01-connecting-to-database","04-02-data-fetching-strategies","04-03-batching-and-caching","04-04-error-handling","05-01-query-optimization","05-02-rate-limiting","05-03-authentication-authorization","05-04-persisted-queries","06-01-graphiql-playground","06-02-apollo-client","06-03-relay","06-04-graphql-subscriptions","07-01-unit-testing-resolvers","07-02-integration-testing","07-03-continuous-integration","07-04-deploying-graphql-servers","08-01-building-fullstack-application","08-02-graphql-in-microservices","08-03-graphql-federation","08-04-case-studies"];
  		  	</script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
  	<script type="module" src="/js/app.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>  	
</head>

<body class="">
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-0 text-end">
			<p class="mb-0 p-0">	<a href="https://enterprisecampus.net/mod/graphql/04-03-batching-and-caching" class="px-2">EN</a></b>
	|
	<a href="https://campusempresa.com/mod/graphql/04-03-batching-and-caching" class="px-2">ES</a></b>
	|
	<b class="px-2">CA</b>
</p>
			<p class="mb-4 mt-0 mx-2  d-none d-md-block"><cite>Tot el coneixement al teu abast</cite></p>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">El Projecte</a> | 
<a href="/about">Sobre nosaltres</a> | 
<a href="/contribute">Contribuir</a> | 
<a href="/donate">Donacions</a> | 
<a href="/licence">Llicència</a>
		</div>
	</div>
</div>
		<div class="top-bar container-fluid p-0">
	<div class="container-xxl p-0">
		<div class="row">
			<div class="col">
				<div class="d-flex justify-content-between">
					<div class="left">
						<a href="/" class="nav-link px-3" id="btnHome">
	<i class="bi bi-house-fill"></i>
	HOME
</a>

<a href="/my_modules" class="nav-link px-3 d-none" id="btnMyCourses">
	<i class="bi bi-rocket-takeoff-fill"></i>
	<i><b>Els meus cursos</b></i>
</a>
<a href="/end_modules" class="nav-link px-3 d-none" id="trophy_button">
	<i class="bi bi-trophy-fill"></i>
	Finalitzats             
</a>

					</div>
                    <div class="ms-auto right">
                        <a id="user_button" href="#" class="nav-link px-3" style="display:none;" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i id="user_icon" class="bi"></i>                            
                        </a>
                    </div>					
				</div>
			</div>
		</div>
	</div>
</div>

		<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
										<div class="row py-1 m-0">
	<div class="col-6 p-0" data-mod="graphql">
		<a  href="#" class="text-secondary d-none" data-read-mod="graphql" data-read-unit="04-03" style="text-decoration:none;">
			<i class="bi bi-check-circle-fill"></i> 
			Marcar com a llegit
		</a>
		<a href="#" class="text-secondary d-none" data-unread-mod="graphql" data-unread-unit="04-03" style="text-decoration:none;">
			<i class="bi bi-x-circle-fill"></i>
			Marcar com a no llegit
		</a>
	</div>
	<div class="col-6 text-end p-0">
					<a href="./"  class="nav-link">
				<i class="bi bi-journal-text"></i>
				Contingut del curs
			</a>
			</div>
</div>						<div id="inner_content">
				<div class='row navigation'>
	<div class='col-2'>
					<a href='04-02-data-fetching-strategies' title="Estratègies de recuperació de dades" class="py-2 px-3 btn btn-primary d-none d-md-inline">
				&#x25C4; Anterior 
			</a>
			<a href='04-02-data-fetching-strategies' title="Estratègies de recuperació de dades" class="py-2 px-3 btn btn-primary d-md-none">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
					<h2 style="text-decoration:underline">Agrupació i emmagatzematge en memòria cau</h2>
			</div>
	<div class='col-2 text-end'>
					<a href='04-04-error-handling' title="Gestió d'errors" class="py-2 px-3 d-none d-md-inline btn btn-primary"
				data-read-mod="graphql" data-read-unit="04-03">
				Següent &#x25BA;
			</a>
			<a href='04-04-error-handling' title="Gestió d'errors" class="py-2 px-3 d-md-none btn btn-primary" 
				data-read-mod="graphql" data-read-unit="04-03">
				 &#x25BA;
			</a>
			</div>
</div>
<div class='content'><p>En aquest tema, explorarem dues tècniques essencials per millorar el rendiment de les aplicacions GraphQL: l'agrupació (batching) i l'emmagatzematge en memòria cau (caching). Aquestes tècniques ajuden a reduir la latència i a optimitzar l'ús dels recursos del servidor.</p>
</div><h1>Agrupació (Batching)</h1>
<div class='content'></div><h2>Què és l'agrupació?</h2>
<div class='content'><p>L'agrupació és una tècnica que permet combinar múltiples sol·licituds en una sola operació per reduir el nombre de crides a la base de dades o a altres serveis externs. Això és especialment útil en GraphQL, on una sola consulta pot desencadenar múltiples resolucions de dades.</p>
</div><h2>Exemple pràctic d'agrupació</h2>
<div class='content'><p>Suposem que tenim una consulta que necessita obtenir informació de diversos usuaris:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cXVlcnkgewogIHVzZXJzIHsKICAgIGlkCiAgICBuYW1lCiAgICBwb3N0cyB7CiAgICAgIGlkCiAgICAgIHRpdGxlCiAgICB9CiAgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>query {
  users {
    id
    name
    posts {
      id
      title
    }
  }
}</pre></div><div class='content'><p>Sense agrupació, cada resolució de <code>posts</code> per a cada usuari podria resultar en una crida separada a la base de dades. Amb l'agrupació, podem combinar aquestes crides en una sola operació.</p>
</div><h2>Implementació amb DataLoader</h2>
<div class='content'><p>Una eina popular per implementar l'agrupació en GraphQL és <a href="https://github.com/graphql/dataloader">DataLoader</a>. A continuació, es mostra com utilitzar DataLoader per agrupar crides a la base de dades:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgRGF0YUxvYWRlciA9IHJlcXVpcmUoJ2RhdGFsb2FkZXInKTsKCi8vIEZ1bmNpw7MgcGVyIGNhcnJlZ2FyIG3Dumx0aXBsZXMgdXN1YXJpcyBwZXIgSUQKY29uc3QgYmF0Y2hVc2VycyA9IGFzeW5jICh1c2VySWRzKSA9PiB7CiAgY29uc3QgdXNlcnMgPSBhd2FpdCBVc2VyLmZpbmQoeyBfaWQ6IHsgJGluOiB1c2VySWRzIH0gfSk7CiAgcmV0dXJuIHVzZXJJZHMubWFwKGlkID0+IHVzZXJzLmZpbmQodXNlciA9PiB1c2VyLmlkID09PSBpZCkpOwp9OwoKLy8gQ3JlYXIgdW5hIGluc3TDoG5jaWEgZGUgRGF0YUxvYWRlcgpjb25zdCB1c2VyTG9hZGVyID0gbmV3IERhdGFMb2FkZXIoYmF0Y2hVc2Vycyk7CgovLyBSZXNvbHZlciBwZXIgYSBsYSBjb25zdWx0YSBkJ3VzdWFyaXMKY29uc3QgcmVzb2x2ZXJzID0gewogIFF1ZXJ5OiB7CiAgICB1c2VyczogKCkgPT4gdXNlckxvYWRlci5sb2FkTWFueShbMSwgMiwgM10pLCAvLyBFeGVtcGxlIGQnSURzIGQndXN1YXJpcwogIH0sCiAgVXNlcjogewogICAgcG9zdHM6ICh1c2VyKSA9PiBQb3N0LmZpbmQoeyB1c2VySWQ6IHVzZXIuaWQgfSksCiAgfSwKfTs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const DataLoader = require('dataloader');

// Funci&oacute; per carregar m&uacute;ltiples usuaris per ID
const batchUsers = async (userIds) =&gt; {
  const users = await User.find({ _id: { $in: userIds } });
  return userIds.map(id =&gt; users.find(user =&gt; user.id === id));
};

// Crear una inst&agrave;ncia de DataLoader
const userLoader = new DataLoader(batchUsers);

// Resolver per a la consulta d'usuaris
const resolvers = {
  Query: {
    users: () =&gt; userLoader.loadMany([1, 2, 3]), // Exemple d'IDs d'usuaris
  },
  User: {
    posts: (user) =&gt; Post.find({ userId: user.id }),
  },
};</pre></div><div class='content'></div><h2>Beneficis de l'agrupació</h2>
<div class='content'><ul>
<li><strong>Reducció de crides a la base de dades</strong>: Menys crides significa menys latència i menys càrrega al servidor.</li>
<li><strong>Millora del rendiment</strong>: Les operacions agrupades són més eficients i poden processar-se més ràpidament.</li>
</ul>
</div><h1>Emmagatzematge en memòria cau (Caching)</h1>
<div class='content'></div><h2>Què és l'emmagatzematge en memòria cau?</h2>
<div class='content'><p>L'emmagatzematge en memòria cau és una tècnica per guardar dades recentment sol·licitades en una ubicació temporal (memòria cau) per accelerar futures sol·licituds de les mateixes dades. Això redueix la necessitat de recalcular o tornar a obtenir dades des de la font original.</p>
</div><h2>Tipus de memòria cau</h2>
<div class='content'><ul>
<li><strong>Memòria cau del client</strong>: Emmagatzematge de dades al costat del client per evitar sol·licituds repetides al servidor.</li>
<li><strong>Memòria cau del servidor</strong>: Emmagatzematge de dades al costat del servidor per evitar recalculs o crides repetides a la base de dades.</li>
</ul>
</div><h2>Implementació de la memòria cau</h2>
<div class='content'><h4>Memòria cau del client amb Apollo Client</h4>
<p>Apollo Client ofereix una solució integrada per a la memòria cau del client:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHsgQXBvbGxvQ2xpZW50LCBJbk1lbW9yeUNhY2hlIH0gZnJvbSAnQGFwb2xsby9jbGllbnQnOwoKY29uc3QgY2xpZW50ID0gbmV3IEFwb2xsb0NsaWVudCh7CiAgdXJpOiAnaHR0cDovL2xvY2FsaG9zdDo0MDAwL2dyYXBocWwnLAogIGNhY2hlOiBuZXcgSW5NZW1vcnlDYWNoZSgpLAp9KTs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import { ApolloClient, InMemoryCache } from '@apollo/client';

const client = new ApolloClient({
  uri: 'http://localhost:4000/graphql',
  cache: new InMemoryCache(),
});</pre></div><div class='content'><h4>Memòria cau del servidor amb Redis</h4>
<p>Redis és una eina popular per a la memòria cau del servidor. A continuació, es mostra com utilitzar Redis per emmagatzemar dades en memòria cau:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgcmVkaXMgPSByZXF1aXJlKCdyZWRpcycpOwpjb25zdCBjbGllbnQgPSByZWRpcy5jcmVhdGVDbGllbnQoKTsKCi8vIEZ1bmNpw7MgcGVyIG9idGVuaXIgZGFkZXMgYW1iIG1lbcOycmlhIGNhdQpjb25zdCBnZXRVc2VyID0gYXN5bmMgKGlkKSA9PiB7CiAgY29uc3QgY2FjaGVLZXkgPSBgdXNlcjoke2lkfWA7CiAgY29uc3QgY2FjaGVkVXNlciA9IGF3YWl0IGNsaWVudC5nZXQoY2FjaGVLZXkpOwoKICBpZiAoY2FjaGVkVXNlcikgewogICAgcmV0dXJuIEpTT04ucGFyc2UoY2FjaGVkVXNlcik7CiAgfQoKICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChpZCk7CiAgYXdhaXQgY2xpZW50LnNldChjYWNoZUtleSwgSlNPTi5zdHJpbmdpZnkodXNlciksICdFWCcsIDM2MDApOyAvLyBFbW1hZ2F0emVtYSBkdXJhbnQgMSBob3JhCiAgcmV0dXJuIHVzZXI7Cn07CgovLyBSZXNvbHZlciBwZXIgYSBsYSBjb25zdWx0YSBkJ3VzdWFyaQpjb25zdCByZXNvbHZlcnMgPSB7CiAgUXVlcnk6IHsKICAgIHVzZXI6IChfLCB7IGlkIH0pID0+IGdldFVzZXIoaWQpLAogIH0sCn07"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const redis = require('redis');
const client = redis.createClient();

// Funci&oacute; per obtenir dades amb mem&ograve;ria cau
const getUser = async (id) =&gt; {
  const cacheKey = `user:${id}`;
  const cachedUser = await client.get(cacheKey);

  if (cachedUser) {
    return JSON.parse(cachedUser);
  }

  const user = await User.findById(id);
  await client.set(cacheKey, JSON.stringify(user), 'EX', 3600); // Emmagatzema durant 1 hora
  return user;
};

// Resolver per a la consulta d'usuari
const resolvers = {
  Query: {
    user: (_, { id }) =&gt; getUser(id),
  },
};</pre></div><div class='content'></div><h2>Beneficis de la memòria cau</h2>
<div class='content'><ul>
<li><strong>Reducció de la latència</strong>: Les dades emmagatzemades en memòria cau es poden recuperar més ràpidament que les dades obtingudes des de la font original.</li>
<li><strong>Reducció de la càrrega del servidor</strong>: Menys crides a la base de dades o a altres serveis externs.</li>
</ul>
</div><h1>Exercici pràctic</h1>
<div class='content'></div><h2>Exercici</h2>
<div class='content'><p>Implementa una solució d'agrupació i memòria cau per a una consulta que obtingui informació de productes i les seves categories.</p>
<h4>Pas 1: Crear un DataLoader per agrupar les crides a la base de dades de categories.</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgYmF0Y2hDYXRlZ29yaWVzID0gYXN5bmMgKGNhdGVnb3J5SWRzKSA9PiB7CiAgY29uc3QgY2F0ZWdvcmllcyA9IGF3YWl0IENhdGVnb3J5LmZpbmQoeyBfaWQ6IHsgJGluOiBjYXRlZ29yeUlkcyB9IH0pOwogIHJldHVybiBjYXRlZ29yeUlkcy5tYXAoaWQgPT4gY2F0ZWdvcmllcy5maW5kKGNhdGVnb3J5ID0+IGNhdGVnb3J5LmlkID09PSBpZCkpOwp9OwoKY29uc3QgY2F0ZWdvcnlMb2FkZXIgPSBuZXcgRGF0YUxvYWRlcihiYXRjaENhdGVnb3JpZXMpOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const batchCategories = async (categoryIds) =&gt; {
  const categories = await Category.find({ _id: { $in: categoryIds } });
  return categoryIds.map(id =&gt; categories.find(category =&gt; category.id === id));
};

const categoryLoader = new DataLoader(batchCategories);</pre></div><div class='content'><h4>Pas 2: Implementar la memòria cau del servidor amb Redis per a les dades de productes.</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZ2V0UHJvZHVjdCA9IGFzeW5jIChpZCkgPT4gewogIGNvbnN0IGNhY2hlS2V5ID0gYHByb2R1Y3Q6JHtpZH1gOwogIGNvbnN0IGNhY2hlZFByb2R1Y3QgPSBhd2FpdCBjbGllbnQuZ2V0KGNhY2hlS2V5KTsKCiAgaWYgKGNhY2hlZFByb2R1Y3QpIHsKICAgIHJldHVybiBKU09OLnBhcnNlKGNhY2hlZFByb2R1Y3QpOwogIH0KCiAgY29uc3QgcHJvZHVjdCA9IGF3YWl0IFByb2R1Y3QuZmluZEJ5SWQoaWQpOwogIGF3YWl0IGNsaWVudC5zZXQoY2FjaGVLZXksIEpTT04uc3RyaW5naWZ5KHByb2R1Y3QpLCAnRVgnLCAzNjAwKTsgLy8gRW1tYWdhdHplbWEgZHVyYW50IDEgaG9yYQogIHJldHVybiBwcm9kdWN0Owp9Ow=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const getProduct = async (id) =&gt; {
  const cacheKey = `product:${id}`;
  const cachedProduct = await client.get(cacheKey);

  if (cachedProduct) {
    return JSON.parse(cachedProduct);
  }

  const product = await Product.findById(id);
  await client.set(cacheKey, JSON.stringify(product), 'EX', 3600); // Emmagatzema durant 1 hora
  return product;
};</pre></div><div class='content'><h4>Pas 3: Integrar les solucions d'agrupació i memòria cau en els resolvers.</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgcmVzb2x2ZXJzID0gewogIFF1ZXJ5OiB7CiAgICBwcm9kdWN0OiAoXywgeyBpZCB9KSA9PiBnZXRQcm9kdWN0KGlkKSwKICAgIHByb2R1Y3RzOiAoKSA9PiBQcm9kdWN0LmZpbmQoKSwKICB9LAogIFByb2R1Y3Q6IHsKICAgIGNhdGVnb3J5OiAocHJvZHVjdCkgPT4gY2F0ZWdvcnlMb2FkZXIubG9hZChwcm9kdWN0LmNhdGVnb3J5SWQpLAogIH0sCn07"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const resolvers = {
  Query: {
    product: (_, { id }) =&gt; getProduct(id),
    products: () =&gt; Product.find(),
  },
  Product: {
    category: (product) =&gt; categoryLoader.load(product.categoryId),
  },
};</pre></div><div class='content'></div><h2>Solució</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgRGF0YUxvYWRlciA9IHJlcXVpcmUoJ2RhdGFsb2FkZXInKTsKY29uc3QgcmVkaXMgPSByZXF1aXJlKCdyZWRpcycpOwpjb25zdCBjbGllbnQgPSByZWRpcy5jcmVhdGVDbGllbnQoKTsKCi8vIEZ1bmNpw7MgcGVyIGFncnVwYXIgY2F0ZWdvcmllcwpjb25zdCBiYXRjaENhdGVnb3JpZXMgPSBhc3luYyAoY2F0ZWdvcnlJZHMpID0+IHsKICBjb25zdCBjYXRlZ29yaWVzID0gYXdhaXQgQ2F0ZWdvcnkuZmluZCh7IF9pZDogeyAkaW46IGNhdGVnb3J5SWRzIH0gfSk7CiAgcmV0dXJuIGNhdGVnb3J5SWRzLm1hcChpZCA9PiBjYXRlZ29yaWVzLmZpbmQoY2F0ZWdvcnkgPT4gY2F0ZWdvcnkuaWQgPT09IGlkKSk7Cn07Cgpjb25zdCBjYXRlZ29yeUxvYWRlciA9IG5ldyBEYXRhTG9hZGVyKGJhdGNoQ2F0ZWdvcmllcyk7CgovLyBGdW5jacOzIHBlciBvYnRlbmlyIHByb2R1Y3RlcyBhbWIgbWVtw7JyaWEgY2F1CmNvbnN0IGdldFByb2R1Y3QgPSBhc3luYyAoaWQpID0+IHsKICBjb25zdCBjYWNoZUtleSA9IGBwcm9kdWN0OiR7aWR9YDsKICBjb25zdCBjYWNoZWRQcm9kdWN0ID0gYXdhaXQgY2xpZW50LmdldChjYWNoZUtleSk7CgogIGlmIChjYWNoZWRQcm9kdWN0KSB7CiAgICByZXR1cm4gSlNPTi5wYXJzZShjYWNoZWRQcm9kdWN0KTsKICB9CgogIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkKGlkKTsKICBhd2FpdCBjbGllbnQuc2V0KGNhY2hlS2V5LCBKU09OLnN0cmluZ2lmeShwcm9kdWN0KSwgJ0VYJywgMzYwMCk7IC8vIEVtbWFnYXR6ZW1hIGR1cmFudCAxIGhvcmEKICByZXR1cm4gcHJvZHVjdDsKfTsKCi8vIFJlc29sdmVycwpjb25zdCByZXNvbHZlcnMgPSB7CiAgUXVlcnk6IHsKICAgIHByb2R1Y3Q6IChfLCB7IGlkIH0pID0+IGdldFByb2R1Y3QoaWQpLAogICAgcHJvZHVjdHM6ICgpID0+IFByb2R1Y3QuZmluZCgpLAogIH0sCiAgUHJvZHVjdDogewogICAgY2F0ZWdvcnk6IChwcm9kdWN0KSA9PiBjYXRlZ29yeUxvYWRlci5sb2FkKHByb2R1Y3QuY2F0ZWdvcnlJZCksCiAgfSwKfTs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const DataLoader = require('dataloader');
const redis = require('redis');
const client = redis.createClient();

// Funci&oacute; per agrupar categories
const batchCategories = async (categoryIds) =&gt; {
  const categories = await Category.find({ _id: { $in: categoryIds } });
  return categoryIds.map(id =&gt; categories.find(category =&gt; category.id === id));
};

const categoryLoader = new DataLoader(batchCategories);

// Funci&oacute; per obtenir productes amb mem&ograve;ria cau
const getProduct = async (id) =&gt; {
  const cacheKey = `product:${id}`;
  const cachedProduct = await client.get(cacheKey);

  if (cachedProduct) {
    return JSON.parse(cachedProduct);
  }

  const product = await Product.findById(id);
  await client.set(cacheKey, JSON.stringify(product), 'EX', 3600); // Emmagatzema durant 1 hora
  return product;
};

// Resolvers
const resolvers = {
  Query: {
    product: (_, { id }) =&gt; getProduct(id),
    products: () =&gt; Product.find(),
  },
  Product: {
    category: (product) =&gt; categoryLoader.load(product.categoryId),
  },
};</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>L'agrupació i l'emmagatzematge en memòria cau són tècniques poderoses per millorar el rendiment de les aplicacions GraphQL. L'agrupació redueix el nombre de crides a la base de dades, mentre que l'emmagatzematge en memòria cau accelera la recuperació de dades. Implementar aquestes tècniques pot significar una gran diferència en l'eficiència i la velocitat de la teva aplicació.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='04-02-data-fetching-strategies' title="Estratègies de recuperació de dades" class="py-2 px-3 btn btn-primary d-none d-md-inline">
				&#x25C4; Anterior 
			</a>
			<a href='04-02-data-fetching-strategies' title="Estratègies de recuperació de dades" class="py-2 px-3 btn btn-primary d-md-none">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='04-04-error-handling' title="Gestió d'errors" class="py-2 px-3 d-none d-md-inline btn btn-primary"
				data-read-mod="graphql" data-read-unit="04-03">
				Següent &#x25BA;
			</a>
			<a href='04-04-error-handling' title="Gestió d'errors" class="py-2 px-3 d-md-none btn btn-primary" 
				data-read-mod="graphql" data-read-unit="04-03">
				 &#x25BA;
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725"
     crossorigin="anonymous"></script>
<!-- enterprise_campus -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-0611338592562725"
     data-ad-slot="6914733106"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

			
	<div class="container mt-2 d-none d-md-block index">
		<h1>Curs de GraphQL</h1>
<h2>Mòdul 1: Introducció a GraphQL</h2>
<ul>
<li><a href="01-01-what-is-graphql">Què és GraphQL?</a></li>
<li><a href="01-02-graphql-vs-rest">GraphQL vs REST</a></li>
<li><a href="01-03-setting-up-graphql-server">Configuració d'un servidor GraphQL</a></li>
<li><a href="01-04-graphql-schema-basics">Conceptes bàsics de l'esquema de GraphQL</a></li>
</ul>
<h2>Mòdul 2: Conceptes bàsics</h2>
<ul>
<li><a href="02-01-queries">Consultes</a></li>
<li><a href="02-02-mutations">Mutacions</a></li>
<li><a href="02-03-resolvers">Resolvers</a></li>
<li><a href="02-04-graphql-types">Tipus de GraphQL</a></li>
<li><a href="02-05-graphql-scalars">Escalars de GraphQL</a></li>
</ul>
<h2>Mòdul 3: Disseny avançat d'esquemes</h2>
<ul>
<li><a href="03-01-interfaces">Interfícies</a></li>
<li><a href="03-02-unions">Unions</a></li>
<li><a href="03-03-enums">Enums</a></li>
<li><a href="03-04-input-types">Tipus d'entrada</a></li>
<li><a href="03-05-custom-scalars">Escalars personalitzats</a></li>
</ul>
<h2>Mòdul 4: Treballant amb dades</h2>
<ul>
<li><a href="04-01-connecting-to-database">Connexió a una base de dades</a></li>
<li><a href="04-02-data-fetching-strategies">Estratègies de recuperació de dades</a></li>
<li><a href="04-03-batching-and-caching">Agrupació i emmagatzematge en memòria cau</a></li>
<li><a href="04-04-error-handling">Gestió d'errors</a></li>
</ul>
<h2>Mòdul 5: Rendiment i seguretat</h2>
<ul>
<li><a href="05-01-query-optimization">Optimització de consultes</a></li>
<li><a href="05-02-rate-limiting">Limitació de velocitat</a></li>
<li><a href="05-03-authentication-authorization">Autenticació i autorització</a></li>
<li><a href="05-04-persisted-queries">Consultes persistents</a></li>
</ul>
<h2>Mòdul 6: Eines i ecosistema</h2>
<ul>
<li><a href="06-01-graphiql-playground">GraphiQL i Playground</a></li>
<li><a href="06-02-apollo-client">Client Apollo</a></li>
<li><a href="06-03-relay">Relay</a></li>
<li><a href="06-04-graphql-subscriptions">Subscripcions de GraphQL</a></li>
</ul>
<h2>Mòdul 7: Proves i desplegament</h2>
<ul>
<li><a href="07-01-unit-testing-resolvers">Proves unitàries de resolvers</a></li>
<li><a href="07-02-integration-testing">Proves d'integració</a></li>
<li><a href="07-03-continuous-integration">Integració contínua</a></li>
<li><a href="07-04-deploying-graphql-servers">Desplegament de servidors GraphQL</a></li>
</ul>
<h2>Mòdul 8: Aplicacions del món real</h2>
<ul>
<li><a href="08-01-building-fullstack-application">Construcció d'una aplicació full-stack</a></li>
<li><a href="08-02-graphql-in-microservices">GraphQL en microserveis</a></li>
<li><a href="08-03-graphql-federation">Federació de GraphQL</a></li>
<li><a href="08-04-case-studies">Estudis de casos</a></li>
</ul>

	</div>










		</div>
	</div>
</div>		
<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">El Projecte</a> | 
<a href="/about">Sobre nosaltres</a> | 
<a href="/contribute">Contribuir</a> | 
<a href="/donate">Donacions</a> | 
<a href="/licence">Llicència</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

		<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">Usuari no autentificat</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            	<p id="loginModalEmail"></p>
            	<div id="mensaje" class="error"></div>
            	<div id="mensaje_info" class="text-success"></div>
            	
				<div class="mt-4 d-none" id="forgotPasswordSection">
					<div class="mb-3">
    <label for="recovery-email" class="form-label">Correu electrònic</label>
    <input type="email" required class="form-control" id="recovery-email" placeholder="Introdueix el teu correu electrònic">
</div>
<button class="btn btn-primary" id="btnRecover">Enviar enllaç de recuperació</button>

				</div>
								
				<div class="mt-4 d-none" id="deleteUserSection">	
					<div class="mb-3 alert alert-danger">
	Atenció! Estàs a punt d'eliminar totes les dades de registre i progrés.<br><b>Aquesta acció no es pot desfer.</b>
</div>
<div class="mb-3">
    <input type="password" required class="form-control" id="delete-user-pwd" placeholder="Introdueix la teva contrasenya">
</div>
<button class="btn btn-primary" id="btnDeleteUser">Eliminar usuari</button>

				</div>
				
				<div class="mt-4 d-none" id="changePassordSection">
					<div class="mb-3 row">
	<div class="col col-12 my-2">
	    <input type="password" required class="form-control" id="change-pwd-actual" placeholder="Introdueix la contrasenya actual">
	</div>
	<div class="col col-12 my-2">
    	<input type="password" required class="form-control" id="change-pwd-new-1" placeholder="Introdueix la nova contrasenya">
	</div>
	<div class="col col-12 my-2">
    	<input type="password" required class="form-control" id="change-pwd-new-2" placeholder="Repeteix la nova contrasenya">
	</div>
</div>
<button class="btn btn-primary" id="btnChangePassword">Canviar la contrasenya</button>

				</div>
				
				<div class="mt-4 d-none alert alert-warning" id="verifyPasswordSection">
					<p><b>Falta verificar correu</b></p>
					<a id="btnVerifyEmail" href="#">Enviar enllaç de verificació</a>

				</div>
				
				<div class="mt-4 d-none" id="disconnectUserSection">
					<div class="mb-3">
    <button id="btnDisconnect" class="btn btn-primary">Desconnectar</button>
</div>

<hr>

<div class="mt-3">
    <button class="btn btn-outline-secondary" id="change-password-link">Canviar la contrasenya</button>
</div>

<div class="mt-3">
    <a href="#" id="delete-user-link">Eliminar usuari</a>
</div>

				</div>
            
            	<div class="mt-4 d-none" id="modalTabsSection">
            		<ul class="nav nav-tabs" id="authTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button" role="tab" aria-controls="login" aria-selected="true">
        	Iniciar sessió
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button" role="tab" aria-controls="register" aria-selected="false">
        	Registrar-se
        </button>
    </li>
</ul>

<div class="tab-content mt-3" id="authTabsContent">
    <div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
    	<div class="mb-3">
    <label for="login-username" class="form-label">Correu electrònic</label>
    <input type="email" required class="form-control" id="login-username" placeholder="Introdueix el teu correu electrònic">
</div>
<div class="mb-3">
    <label for="login-password" class="form-label">Contrasenya</label>
    <input type="password"  required class="form-control" id="login-password" placeholder="Introdueix la teva contrasenya">
</div>
<button class="btn btn-primary" id="btnLogin">Iniciar sessió</button>
<div class="mt-3">
    <a href="#" id="forgot-password-link">Has oblidat la teva contrasenya?</a>
</div>
    </div>

    <div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
    	<div class="mb-3">
    <label for="register-email" class="form-label">Correu electrònic</label>
    <input type="email" class="form-control" id="register-email" required placeholder="Introdueix el teu correu electrònic">
</div>

<div class="mb-3">
    <label for="register-password" class="form-label">Contrasenya</label>
    <input type="password" class="form-control"  required id="register-password" placeholder="Introdueix la teva contrasenya">
</div>

<div class="mb-3">
    <label for="register-name" class="form-label">Nom</label>
    <input type="text" class="form-control"  required id="register-name" placeholder="Introdueix el teu nom">
</div>

<div class="form-check mb-3">
    <input type="checkbox" class="form-check-input" id="accept-conditions-reg">
    <label for="accept-conditions-reg" class="form-check-label">
        He llegit i accepto la <a href="/privacity" target="blank">Política de Privacitat</a> i els <a href="/licence" target="blank">Termes i Condicions d'Ús</a>.
    </label>
</div>

<div class="form-check mb-3">
    <input type="checkbox" class="form-check-input" id="accept-allow_comunications">
    <label for="accept-allow_comunications" class="form-check-label">
        Vull rebre notícies i actualitzacions sobre els cursos (opcional).
    </label>
</div>

<button id="btnRegister" class="btn btn-primary">Registrar-se</button>
    </div>
</div>
            	</div>
            </div>
        </div>
    </div>
</div>

	</div>    
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
