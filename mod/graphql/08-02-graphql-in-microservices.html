<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphQL en microserveis</title>

    <link rel="alternate" href="https://campusempresa.com/mod/graphql/08-02-graphql-in-microservices" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/graphql/08-02-graphql-in-microservices" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/graphql/08-02-graphql-in-microservices" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/graphql/08-02-graphql-in-microservices" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/graphql/08-02-graphql-in-microservices" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Projecte</a>
				<a href="/about">Sobre nosaltres</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donacions</a>
				<a href="/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='08-01-building-fullstack-application' title="Construcció d'una aplicació full-stack">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">GraphQL en microserveis</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='08-03-graphql-federation' title="Federació de GraphQL">Següent &#x25BA;</a>
			</div>
</div>
<div class='content'><p>En aquest tema, explorarem com integrar GraphQL en una arquitectura de microserveis. Els microserveis són una manera de dissenyar aplicacions com una col·lecció de serveis petits i independents que es comuniquen entre ells. GraphQL pot ser una eina poderosa per unificar aquestes comunicacions i proporcionar una interfície coherent per als clients.</p>
</div><h1><p>Objectius d'aprenentatge</p>
</h1>
<div class='content'><ul>
<li>Comprendre els avantatges d'utilitzar GraphQL en una arquitectura de microserveis.</li>
<li>Aprendre a dissenyar esquemes de GraphQL per a microserveis.</li>
<li>Implementar un servidor GraphQL que agregui dades de diversos microserveis.</li>
<li>Gestionar la comunicació i la seguretat entre microserveis amb GraphQL.</li>
</ul>
</div><h1><p>Avantatges de GraphQL en microserveis</p>
</h1>
<div class='content'><ul>
<li><strong>Unificació de dades</strong>: GraphQL permet als clients obtenir dades de múltiples microserveis amb una sola consulta.</li>
<li><strong>Flexibilitat</strong>: Els clients poden sol·licitar exactament les dades que necessiten, reduint la sobrecàrrega de dades.</li>
<li><strong>Evolució de l'API</strong>: Les APIs de GraphQL poden evolucionar sense trencar les aplicacions clients, ja que les noves funcionalitats es poden afegir sense afectar les existents.</li>
</ul>
</div><h1><p>Disseny d'esquemes de GraphQL per a microserveis</p>
</h1>
<div class='content'><p>Quan dissenyem esquemes de GraphQL per a microserveis, és important tenir en compte com es distribuiran les dades i com es gestionaran les dependències entre serveis.</p>
</div><h2><p>Exemples de disseny d'esquemes</p>
</h2>
<div class='content'><p>Suposem que tenim una aplicació de comerç electrònic amb els següents microserveis:</p>
<ul>
<li><strong>Servei d'Usuaris</strong>: Gestiona la informació dels usuaris.</li>
<li><strong>Servei de Productes</strong>: Gestiona la informació dels productes.</li>
<li><strong>Servei de Comandes</strong>: Gestiona les comandes dels usuaris.</li>
</ul>
<p>Podem dissenyar un esquema de GraphQL que agregui dades d'aquests serveis:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dHlwZSBVc2VyIHsKICBpZDogSUQhCiAgbmFtZTogU3RyaW5nIQogIGVtYWlsOiBTdHJpbmchCiAgb3JkZXJzOiBbT3JkZXJdCn0KCnR5cGUgUHJvZHVjdCB7CiAgaWQ6IElEIQogIG5hbWU6IFN0cmluZyEKICBwcmljZTogRmxvYXQhCn0KCnR5cGUgT3JkZXIgewogIGlkOiBJRCEKICB1c2VyOiBVc2VyIQogIHByb2R1Y3RzOiBbUHJvZHVjdF0hCiAgdG90YWw6IEZsb2F0IQp9Cgp0eXBlIFF1ZXJ5IHsKICB1c2VyKGlkOiBJRCEpOiBVc2VyCiAgcHJvZHVjdChpZDogSUQhKTogUHJvZHVjdAogIG9yZGVyKGlkOiBJRCEpOiBPcmRlcgp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>type User {
  id: ID!
  name: String!
  email: String!
  orders: [Order]
}

type Product {
  id: ID!
  name: String!
  price: Float!
}

type Order {
  id: ID!
  user: User!
  products: [Product]!
  total: Float!
}

type Query {
  user(id: ID!): User
  product(id: ID!): Product
  order(id: ID!): Order
}</pre></div><div class='content'></div><h2><p>Implementació de resolvers</p>
</h2>
<div class='content'><p>Els resolvers són responsables de recuperar les dades dels microserveis corresponents. A continuació, es mostra un exemple de resolvers per a l'esquema anterior:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgcmVzb2x2ZXJzID0gewogIFF1ZXJ5OiB7CiAgICB1c2VyOiBhc3luYyAoXywgeyBpZCB9KSA9PiB7CiAgICAgIC8vIENyaWRhIGFsIFNlcnZlaSBkJ1VzdWFyaXMKICAgICAgcmV0dXJuIGZldGNoVXNlckJ5SWQoaWQpOwogICAgfSwKICAgIHByb2R1Y3Q6IGFzeW5jIChfLCB7IGlkIH0pID0+IHsKICAgICAgLy8gQ3JpZGEgYWwgU2VydmVpIGRlIFByb2R1Y3RlcwogICAgICByZXR1cm4gZmV0Y2hQcm9kdWN0QnlJZChpZCk7CiAgICB9LAogICAgb3JkZXI6IGFzeW5jIChfLCB7IGlkIH0pID0+IHsKICAgICAgLy8gQ3JpZGEgYWwgU2VydmVpIGRlIENvbWFuZGVzCiAgICAgIHJldHVybiBmZXRjaE9yZGVyQnlJZChpZCk7CiAgICB9LAogIH0sCiAgVXNlcjogewogICAgb3JkZXJzOiBhc3luYyAodXNlcikgPT4gewogICAgICAvLyBDcmlkYSBhbCBTZXJ2ZWkgZGUgQ29tYW5kZXMgcGVyIG9idGVuaXIgbGVzIGNvbWFuZGVzIGRlIGwndXN1YXJpCiAgICAgIHJldHVybiBmZXRjaE9yZGVyc0J5VXNlcklkKHVzZXIuaWQpOwogICAgfSwKICB9LAogIE9yZGVyOiB7CiAgICB1c2VyOiBhc3luYyAob3JkZXIpID0+IHsKICAgICAgLy8gQ3JpZGEgYWwgU2VydmVpIGQnVXN1YXJpcyBwZXIgb2J0ZW5pciBsYSBpbmZvcm1hY2nDsyBkZSBsJ3VzdWFyaQogICAgICByZXR1cm4gZmV0Y2hVc2VyQnlJZChvcmRlci51c2VySWQpOwogICAgfSwKICAgIHByb2R1Y3RzOiBhc3luYyAob3JkZXIpID0+IHsKICAgICAgLy8gQ3JpZGEgYWwgU2VydmVpIGRlIFByb2R1Y3RlcyBwZXIgb2J0ZW5pciBsYSBpbmZvcm1hY2nDsyBkZWxzIHByb2R1Y3RlcwogICAgICByZXR1cm4gZmV0Y2hQcm9kdWN0c0J5SWRzKG9yZGVyLnByb2R1Y3RJZHMpOwogICAgfSwKICB9LAp9Ow=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const resolvers = {
  Query: {
    user: async (_, { id }) =&gt; {
      // Crida al Servei d'Usuaris
      return fetchUserById(id);
    },
    product: async (_, { id }) =&gt; {
      // Crida al Servei de Productes
      return fetchProductById(id);
    },
    order: async (_, { id }) =&gt; {
      // Crida al Servei de Comandes
      return fetchOrderById(id);
    },
  },
  User: {
    orders: async (user) =&gt; {
      // Crida al Servei de Comandes per obtenir les comandes de l'usuari
      return fetchOrdersByUserId(user.id);
    },
  },
  Order: {
    user: async (order) =&gt; {
      // Crida al Servei d'Usuaris per obtenir la informaci&oacute; de l'usuari
      return fetchUserById(order.userId);
    },
    products: async (order) =&gt; {
      // Crida al Servei de Productes per obtenir la informaci&oacute; dels productes
      return fetchProductsByIds(order.productIds);
    },
  },
};</pre></div><div class='content'></div><h1><p>Comunicació entre microserveis</p>
</h1>
<div class='content'><p>La comunicació entre microserveis pot ser gestionada mitjançant crides HTTP, RPC (Remote Procedure Call) o altres protocols de comunicació. És important assegurar-se que aquestes comunicacions siguin segures i eficients.</p>
</div><h2><p>Exemple de crida HTTP</p>
</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZmV0Y2hVc2VyQnlJZCA9IGFzeW5jIChpZCkgPT4gewogIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHA6Ly91c2VyLXNlcnZpY2UvdXNlcnMvJHtpZH1gKTsKICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwp9OwoKY29uc3QgZmV0Y2hQcm9kdWN0QnlJZCA9IGFzeW5jIChpZCkgPT4gewogIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHA6Ly9wcm9kdWN0LXNlcnZpY2UvcHJvZHVjdHMvJHtpZH1gKTsKICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwp9OwoKY29uc3QgZmV0Y2hPcmRlckJ5SWQgPSBhc3luYyAoaWQpID0+IHsKICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGBodHRwOi8vb3JkZXItc2VydmljZS9vcmRlcnMvJHtpZH1gKTsKICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwp9Ow=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const fetchUserById = async (id) =&gt; {
  const response = await fetch(`http://user-service/users/${id}`);
  return response.json();
};

const fetchProductById = async (id) =&gt; {
  const response = await fetch(`http://product-service/products/${id}`);
  return response.json();
};

const fetchOrderById = async (id) =&gt; {
  const response = await fetch(`http://order-service/orders/${id}`);
  return response.json();
};</pre></div><div class='content'></div><h1><p>Seguretat en GraphQL per a microserveis</p>
</h1>
<div class='content'><p>La seguretat és un aspecte crític en qualsevol arquitectura de microserveis. Algunes pràctiques recomanades inclouen:</p>
<ul>
<li><strong>Autenticació i autorització</strong>: Assegurar-se que només els usuaris autoritzats puguin accedir a les dades.</li>
<li><strong>Limitació de velocitat</strong>: Prevenir abusos limitant el nombre de consultes que un client pot fer en un període de temps determinat.</li>
<li><strong>Validació de dades</strong>: Assegurar-se que les dades enviades i rebudes compleixin amb els requisits esperats.</li>
</ul>
</div><h2><p>Exemple d'autenticació</p>
</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBBcG9sbG9TZXJ2ZXIgfSA9IHJlcXVpcmUoJ2Fwb2xsby1zZXJ2ZXInKTsKCmNvbnN0IHNlcnZlciA9IG5ldyBBcG9sbG9TZXJ2ZXIoewogIHR5cGVEZWZzLAogIHJlc29sdmVycywKICBjb250ZXh0OiAoeyByZXEgfSkgPT4gewogICAgLy8gT2J0ZW5pciBlbCB0b2tlbiBkJ2F1dGVudGljYWNpw7MgZGUgbGVzIGNhcMOnYWxlcmVzIGRlIGxhIHNvbMK3bGljaXR1ZAogICAgY29uc3QgdG9rZW4gPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uIHx8ICcnOwoKICAgIC8vIFZhbGlkYXIgZWwgdG9rZW4gaSBvYnRlbmlyIGxhIGluZm9ybWFjacOzIGRlIGwndXN1YXJpCiAgICBjb25zdCB1c2VyID0gdmFsaWRhdGVUb2tlbih0b2tlbik7CgogICAgLy8gQWZlZ2lyIGwndXN1YXJpIGFsIGNvbnRleHQKICAgIHJldHVybiB7IHVzZXIgfTsKICB9LAp9KTs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { ApolloServer } = require('apollo-server');

const server = new ApolloServer({
  typeDefs,
  resolvers,
  context: ({ req }) =&gt; {
    // Obtenir el token d'autenticaci&oacute; de les cap&ccedil;aleres de la sol&middot;licitud
    const token = req.headers.authorization || '';

    // Validar el token i obtenir la informaci&oacute; de l'usuari
    const user = validateToken(token);

    // Afegir l'usuari al context
    return { user };
  },
});</pre></div><div class='content'></div><h1><p>Exercici pràctic</p>
</h1>
<h2><p>Exercici</p>
</h2>
<div class='content'><p>Implementa un servidor GraphQL que agregui dades de dos microserveis: un servei d'usuaris i un servei de productes. El servidor ha de permetre obtenir la informació d'un usuari i els productes que ha comprat.</p>
</div><h2><p>Solució</p>
</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBBcG9sbG9TZXJ2ZXIsIGdxbCB9ID0gcmVxdWlyZSgnYXBvbGxvLXNlcnZlcicpOwpjb25zdCBmZXRjaCA9IHJlcXVpcmUoJ25vZGUtZmV0Y2gnKTsKCmNvbnN0IHR5cGVEZWZzID0gZ3FsYAogIHR5cGUgVXNlciB7CiAgICBpZDogSUQhCiAgICBuYW1lOiBTdHJpbmchCiAgICBlbWFpbDogU3RyaW5nIQogICAgcHJvZHVjdHM6IFtQcm9kdWN0XQogIH0KCiAgdHlwZSBQcm9kdWN0IHsKICAgIGlkOiBJRCEKICAgIG5hbWU6IFN0cmluZyEKICAgIHByaWNlOiBGbG9hdCEKICB9CgogIHR5cGUgUXVlcnkgewogICAgdXNlcihpZDogSUQhKTogVXNlcgogIH0KYDsKCmNvbnN0IHJlc29sdmVycyA9IHsKICBRdWVyeTogewogICAgdXNlcjogYXN5bmMgKF8sIHsgaWQgfSkgPT4gewogICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGBodHRwOi8vdXNlci1zZXJ2aWNlL3VzZXJzLyR7aWR9YCk7CiAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7CiAgICB9LAogIH0sCiAgVXNlcjogewogICAgcHJvZHVjdHM6IGFzeW5jICh1c2VyKSA9PiB7CiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHA6Ly9wcm9kdWN0LXNlcnZpY2UvcHJvZHVjdHM/dXNlcklkPSR7dXNlci5pZH1gKTsKICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTsKICAgIH0sCiAgfSwKfTsKCmNvbnN0IHNlcnZlciA9IG5ldyBBcG9sbG9TZXJ2ZXIoeyB0eXBlRGVmcywgcmVzb2x2ZXJzIH0pOwoKc2VydmVyLmxpc3RlbigpLnRoZW4oKHsgdXJsIH0pID0+IHsKICBjb25zb2xlLmxvZyhg8J+agCBTZXJ2ZXIgcmVhZHkgYXQgJHt1cmx9YCk7Cn0pOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { ApolloServer, gql } = require('apollo-server');
const fetch = require('node-fetch');

const typeDefs = gql`
  type User {
    id: ID!
    name: String!
    email: String!
    products: [Product]
  }

  type Product {
    id: ID!
    name: String!
    price: Float!
  }

  type Query {
    user(id: ID!): User
  }
`;

const resolvers = {
  Query: {
    user: async (_, { id }) =&gt; {
      const response = await fetch(`http://user-service/users/${id}`);
      return response.json();
    },
  },
  User: {
    products: async (user) =&gt; {
      const response = await fetch(`http://product-service/products?userId=${user.id}`);
      return response.json();
    },
  },
};

const server = new ApolloServer({ typeDefs, resolvers });

server.listen().then(({ url }) =&gt; {
  console.log(`🚀 Server ready at ${url}`);
});</pre></div><div class='content'></div><h1><p>Conclusió</p>
</h1>
<div class='content'><p>Integrar GraphQL en una arquitectura de microserveis pot proporcionar una interfície unificada i flexible per als clients, permetent una millor gestió de les dades i una evolució més fàcil de l'API. En aquest tema, hem après a dissenyar esquemes de GraphQL per a microserveis, implementar resolvers per agregar dades de diversos serveis i gestionar la comunicació i la seguretat entre microserveis. Amb aquests coneixements, estàs preparat per aplicar GraphQL en una arquitectura de microserveis en projectes del món real.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='08-01-building-fullstack-application' title="Construcció d'una aplicació full-stack">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='08-03-graphql-federation' title="Federació de GraphQL">Següent &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
