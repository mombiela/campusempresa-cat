<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subconsultes</title>

    <link rel="alternate" href="https://campusempresa.com/mod/postgresql/03-02-subqueries" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/postgresql/03-02-subqueries" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/postgresql/03-02-subqueries" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/postgresql/03-02-subqueries" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/postgresql/03-02-subqueries" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<!-- <a href="/">Home</a>  -->
									<a href="./">Contingut del curs</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Competències tècniques</a>
				<a href="/all/conocimientos">Coneixements</a>
				<a href="/all/soft_skills">Competències socials</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='03-01-joins' title="Unions">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Subconsultes</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='03-03-aggregate-functions' title="Funcions agregades">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>Les subconsultes són una eina poderosa en SQL que permeten realitzar consultes dins d'altres consultes. Aquestes poden ser utilitzades en diverses parts d'una instrucció SQL, com en les claus <code>SELECT</code>, <code>FROM</code>, <code>WHERE</code>, i altres. En aquest tema, explorarem què són les subconsultes, com utilitzar-les i veurem exemples pràctics per entendre millor el seu funcionament.</p>
</div><h1><p>Què és una Subconsulta?</p>
</h1>
<div class='content'><p>Una subconsulta és una consulta SQL que es troba dins d'una altra consulta SQL. La subconsulta es pot utilitzar per retornar dades que seran utilitzades per la consulta principal. Les subconsultes poden ser utilitzades en diverses parts d'una instrucció SQL, com ara:</p>
<ul>
<li>En la clàusula <code>SELECT</code> per retornar valors calculats.</li>
<li>En la clàusula <code>FROM</code> per crear una taula temporal.</li>
<li>En la clàusula <code>WHERE</code> per filtrar resultats basats en una condició.</li>
</ul>
</div><h1><p>Tipus de Subconsultes</p>
</h1>
<div class='content'><p>Hi ha dos tipus principals de subconsultes:</p>
<ol>
<li><strong>Subconsultes Escalares</strong>: Retornen un sol valor.</li>
<li><strong>Subconsultes de Taula</strong>: Retornen un conjunt de files.</li>
</ol>
</div><h1><p>Exemples de Subconsultes</p>
</h1>
<div class='content'></div><h2><p>Subconsulta en la Clàusula <code>SELECT</code></p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgcHJvZHVjdF9pZCwgCiAgICBwcm9kdWN0X25hbWUsIAogICAgKFNFTEVDVCBBVkcocHJpY2UpIEZST00gcHJvZHVjdHMpIEFTIGF2ZXJhZ2VfcHJpY2UKRlJPTSAKICAgIHByb2R1Y3RzOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    product_id, 
    product_name, 
    (SELECT AVG(price) FROM products) AS average_price
FROM 
    products;</pre></div><div class='content'><p>En aquest exemple, la subconsulta <code>(SELECT AVG(price) FROM products)</code> calcula el preu mitjà de tots els productes i el retorna com a <code>average_price</code> per a cada fila de la consulta principal.</p>
</div><h2><p>Subconsulta en la Clàusula <code>FROM</code></p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgc3ViLnByb2R1Y3RfaWQsIAogICAgc3ViLnRvdGFsX3NhbGVzCkZST00gCiAgICAoU0VMRUNUIAogICAgICAgIHByb2R1Y3RfaWQsIAogICAgICAgIFNVTShxdWFudGl0eSkgQVMgdG90YWxfc2FsZXMgCiAgICAgRlJPTSAKICAgICAgICBzYWxlcyAKICAgICBHUk9VUCBCWSAKICAgICAgICBwcm9kdWN0X2lkKSBBUyBzdWI7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    sub.product_id, 
    sub.total_sales
FROM 
    (SELECT 
        product_id, 
        SUM(quantity) AS total_sales 
     FROM 
        sales 
     GROUP BY 
        product_id) AS sub;</pre></div><div class='content'><p>En aquest exemple, la subconsulta dins de la clàusula <code>FROM</code> crea una taula temporal <code>sub</code> que conté el total de vendes per a cada producte. La consulta principal després selecciona dades d'aquesta taula temporal.</p>
</div><h2><p>Subconsulta en la Clàusula <code>WHERE</code></p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgcHJvZHVjdF9pZCwgCiAgICBwcm9kdWN0X25hbWUKRlJPTSAKICAgIHByb2R1Y3RzCldIRVJFIAogICAgcHJpY2UgPiAoU0VMRUNUIEFWRyhwcmljZSkgRlJPTSBwcm9kdWN0cyk7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    product_id, 
    product_name
FROM 
    products
WHERE 
    price &gt; (SELECT AVG(price) FROM products);</pre></div><div class='content'><p>En aquest exemple, la subconsulta <code>(SELECT AVG(price) FROM products)</code> calcula el preu mitjà de tots els productes. La consulta principal després selecciona tots els productes que tenen un preu superior al preu mitjà.</p>
</div><h1><p>Exercicis Pràctics</p>
</h1>
<div class='content'></div><h2><p>Exercici 1: Subconsulta en la Clàusula <code>SELECT</code></p>
</h2>
<div class='content'><p><strong>Enunciat</strong>: Escriu una consulta que mostri el <code>product_id</code>, <code>product_name</code> i el preu mitjà de tots els productes com a <code>average_price</code>.</p>
<p><strong>Solució</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgcHJvZHVjdF9pZCwgCiAgICBwcm9kdWN0X25hbWUsIAogICAgKFNFTEVDVCBBVkcocHJpY2UpIEZST00gcHJvZHVjdHMpIEFTIGF2ZXJhZ2VfcHJpY2UKRlJPTSAKICAgIHByb2R1Y3RzOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    product_id, 
    product_name, 
    (SELECT AVG(price) FROM products) AS average_price
FROM 
    products;</pre></div><div class='content'></div><h2><p>Exercici 2: Subconsulta en la Clàusula <code>FROM</code></p>
</h2>
<div class='content'><p><strong>Enunciat</strong>: Escriu una consulta que mostri el <code>product_id</code> i el total de vendes (<code>total_sales</code>) per a cada producte.</p>
<p><strong>Solució</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgc3ViLnByb2R1Y3RfaWQsIAogICAgc3ViLnRvdGFsX3NhbGVzCkZST00gCiAgICAoU0VMRUNUIAogICAgICAgIHByb2R1Y3RfaWQsIAogICAgICAgIFNVTShxdWFudGl0eSkgQVMgdG90YWxfc2FsZXMgCiAgICAgRlJPTSAKICAgICAgICBzYWxlcyAKICAgICBHUk9VUCBCWSAKICAgICAgICBwcm9kdWN0X2lkKSBBUyBzdWI7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    sub.product_id, 
    sub.total_sales
FROM 
    (SELECT 
        product_id, 
        SUM(quantity) AS total_sales 
     FROM 
        sales 
     GROUP BY 
        product_id) AS sub;</pre></div><div class='content'></div><h2><p>Exercici 3: Subconsulta en la Clàusula <code>WHERE</code></p>
</h2>
<div class='content'><p><strong>Enunciat</strong>: Escriu una consulta que mostri el <code>product_id</code> i <code>product_name</code> de tots els productes que tenen un preu superior al preu mitjà de tots els productes.</p>
<p><strong>Solució</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgcHJvZHVjdF9pZCwgCiAgICBwcm9kdWN0X25hbWUKRlJPTSAKICAgIHByb2R1Y3RzCldIRVJFIAogICAgcHJpY2UgPiAoU0VMRUNUIEFWRyhwcmljZSkgRlJPTSBwcm9kdWN0cyk7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    product_id, 
    product_name
FROM 
    products
WHERE 
    price &gt; (SELECT AVG(price) FROM products);</pre></div><div class='content'></div><h1><p>Errors Comuns i Consells</p>
</h1>
<div class='content'><ul>
<li>
<p><strong>Error Comú</strong>: Utilitzar una subconsulta que retorna múltiples files en una clàusula que espera un sol valor.</p>
<ul>
<li><strong>Solució</strong>: Assegura't que la subconsulta retorni un sol valor quan s'utilitza en contextos escalares.</li>
</ul>
</li>
<li>
<p><strong>Error Comú</strong>: No aliasar la subconsulta en la clàusula <code>FROM</code>.</p>
<ul>
<li><strong>Solució</strong>: Sempre proporciona un àlies a la subconsulta per poder referenciar-la correctament en la consulta principal.</li>
</ul>
</li>
</ul>
</div><h1><p>Conclusió</p>
</h1>
<div class='content'><p>Les subconsultes són una eina essencial en SQL que permeten realitzar consultes complexes de manera eficient. Hem vist com utilitzar subconsultes en diverses parts d'una instrucció SQL i hem practicat amb exemples concrets. Amb aquesta base, estàs preparat per aplicar subconsultes en les teves pròpies consultes SQL i resoldre problemes més avançats.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='03-01-joins' title="Unions">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='03-03-aggregate-functions' title="Funcions agregades">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
