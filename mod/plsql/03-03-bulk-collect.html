<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive">
    <title>Recollida massiva</title>

    <link rel="alternate" href="https://campusempresa.com/mod/plsql/03-03-bulk-collect" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/plsql/03-03-bulk-collect" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/plsql/03-03-bulk-collect" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css?v=4" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>  	
	</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
			<span>	<a href="https://enterprisecampus.net/mod/plsql/03-03-bulk-collect" class="px-2">EN</a></b>
	|
	<a href="https://campusempresa.com/mod/plsql/03-03-bulk-collect" class="px-2">ES</a></b>
	|
	<b class="px-2">CA</b>
</span>
			<span class="d-none d-md-inline"><br><cite>Tot el coneixement al teu abast</cite></span>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">El Projecte</a> | 
<a href="/about">Sobre nosaltres</a> | 
<a href="/contribute">Contribuir</a> | 
<a href="/donate">Donacions</a> | 
<a href="/licence">Llicència</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
					 				<a href="/"><i class="bi bi-house-fill"></i> HOME</a>
											</div>
		</div>
	</div>
</div>
		
<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
				<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='03-02-implicit-explicit-cursors' title="Cursors implícits i explícits">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Recollida massiva</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='03-04-forall-statement' title="Sentència FORALL">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>La recollida massiva (Bulk Collect) és una característica poderosa de PL/SQL que permet processar múltiples files de dades en una sola operació, millorant significativament el rendiment en comparació amb el processament fila per fila. Aquesta tècnica és especialment útil quan es treballa amb grans volums de dades.</p>
</div><h1>Conceptes Clau</h1>
<div class='content'></div><h2>Què és la recollida massiva?</h2>
<div class='content'><p>La recollida massiva permet carregar múltiples files de dades en col·leccions PL/SQL (com ara taules indexades, matrius o VARRAYs) en una sola operació SQL. Això redueix el nombre de commutacions de context entre PL/SQL i SQL, millorant així el rendiment.</p>
</div><h2>Beneficis de la recollida massiva</h2>
<div class='content'><ul>
<li><strong>Rendiment millorat</strong>: Redueix el nombre de commutacions de context entre PL/SQL i SQL.</li>
<li><strong>Codi més net</strong>: Simplifica el codi en comparació amb els bucles que processen fila per fila.</li>
<li><strong>Menys càrrega de xarxa</strong>: Menys operacions de xarxa en entorns distribuïts.</li>
</ul>
</div><h1>Sintaxi de la recollida massiva</h1>
<div class='content'><p>La sintaxi bàsica per utilitzar <code>BULK COLLECT</code> és la següent:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIGNvbHVtbjEsIGNvbHVtbjIsIC4uLgpCVUxLIENPTExFQ1QgSU5UTyBjb2xsZWN0aW9uMSwgY29sbGVjdGlvbjIsIC4uLgpGUk9NIHRhYmxlX25hbWUKV0hFUkUgY29uZGl0aW9uOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT column1, column2, ...
BULK COLLECT INTO collection1, collection2, ...
FROM table_name
WHERE condition;</pre></div><div class='content'></div><h2>Exemple pràctic</h2>
<div class='content'><p>Suposem que tenim una taula <code>employees</code> i volem carregar tots els noms i salaris en col·leccions PL/SQL.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("REVDTEFSRQogICAgVFlQRSB0X25hbWUgSVMgVEFCTEUgT0YgZW1wbG95ZWVzLm5hbWUlVFlQRTsKICAgIFRZUEUgdF9zYWxhcnkgSVMgVEFCTEUgT0YgZW1wbG95ZWVzLnNhbGFyeSVUWVBFOwogICAgCiAgICBsX25hbWVzIHRfbmFtZTsKICAgIGxfc2FsYXJpZXMgdF9zYWxhcnk7CkJFR0lOCiAgICBTRUxFQ1QgbmFtZSwgc2FsYXJ5CiAgICBCVUxLIENPTExFQ1QgSU5UTyBsX25hbWVzLCBsX3NhbGFyaWVzCiAgICBGUk9NIGVtcGxveWVlczsKICAgIAogICAgLS0gUHJvY2Vzc2FyIGxlcyBkYWRlcyByZWNvbGxpZGVzCiAgICBGT1IgaSBJTiAxLi5sX25hbWVzLkNPVU5UIExPT1AKICAgICAgICBEQk1TX09VVFBVVC5QVVRfTElORSgnTm9tOiAnIHx8IGxfbmFtZXMoaSkgfHwgJywgU2FsYXJpOiAnIHx8IGxfc2FsYXJpZXMoaSkpOwogICAgRU5EIExPT1A7CkVORDsKLw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>DECLARE
    TYPE t_name IS TABLE OF employees.name%TYPE;
    TYPE t_salary IS TABLE OF employees.salary%TYPE;
    
    l_names t_name;
    l_salaries t_salary;
BEGIN
    SELECT name, salary
    BULK COLLECT INTO l_names, l_salaries
    FROM employees;
    
    -- Processar les dades recollides
    FOR i IN 1..l_names.COUNT LOOP
        DBMS_OUTPUT.PUT_LINE('Nom: ' || l_names(i) || ', Salari: ' || l_salaries(i));
    END LOOP;
END;
/</pre></div><div class='content'></div><h2>Explicació del codi</h2>
<div class='content'><ol>
<li><strong>Declaració de tipus de col·lecció</strong>: Es declaren dos tipus de col·lecció, <code>t_name</code> i <code>t_salary</code>, basats en els tipus de dades de les columnes <code>name</code> i <code>salary</code> de la taula <code>employees</code>.</li>
<li><strong>Declaració de variables de col·lecció</strong>: Es declaren dues variables de col·lecció, <code>l_names</code> i <code>l_salaries</code>, de tipus <code>t_name</code> i <code>t_salary</code> respectivament.</li>
<li><strong>Recollida massiva</strong>: La sentència <code>SELECT</code> utilitza <code>BULK COLLECT</code> per carregar totes les files de les columnes <code>name</code> i <code>salary</code> en les col·leccions <code>l_names</code> i <code>l_salaries</code>.</li>
<li><strong>Processament de les dades</strong>: Un bucle <code>FOR</code> recorre les col·leccions i imprimeix els noms i salaris.</li>
</ol>
</div><h1>Exercicis Pràctics</h1>
<div class='content'></div><h2>Exercici 1: Recollida massiva bàsica</h2>
<div class='content'><p><strong>Descripció</strong>: Escriu un bloc PL/SQL que utilitzi <code>BULK COLLECT</code> per carregar les dades de les columnes <code>department_id</code> i <code>department_name</code> de la taula <code>departments</code> en col·leccions PL/SQL i imprimeixi els resultats.</p>
<p><strong>Solució</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("REVDTEFSRQogICAgVFlQRSB0X2RlcHRfaWQgSVMgVEFCTEUgT0YgZGVwYXJ0bWVudHMuZGVwYXJ0bWVudF9pZCVUWVBFOwogICAgVFlQRSB0X2RlcHRfbmFtZSBJUyBUQUJMRSBPRiBkZXBhcnRtZW50cy5kZXBhcnRtZW50X25hbWUlVFlQRTsKICAgIAogICAgbF9kZXB0X2lkcyB0X2RlcHRfaWQ7CiAgICBsX2RlcHRfbmFtZXMgdF9kZXB0X25hbWU7CkJFR0lOCiAgICBTRUxFQ1QgZGVwYXJ0bWVudF9pZCwgZGVwYXJ0bWVudF9uYW1lCiAgICBCVUxLIENPTExFQ1QgSU5UTyBsX2RlcHRfaWRzLCBsX2RlcHRfbmFtZXMKICAgIEZST00gZGVwYXJ0bWVudHM7CiAgICAKICAgIEZPUiBpIElOIDEuLmxfZGVwdF9pZHMuQ09VTlQgTE9PUAogICAgICAgIERCTVNfT1VUUFVULlBVVF9MSU5FKCdEZXBhcnRtZW50IElEOiAnIHx8IGxfZGVwdF9pZHMoaSkgfHwgJywgRGVwYXJ0bWVudCBOYW1lOiAnIHx8IGxfZGVwdF9uYW1lcyhpKSk7CiAgICBFTkQgTE9PUDsKRU5EOwov"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>DECLARE
    TYPE t_dept_id IS TABLE OF departments.department_id%TYPE;
    TYPE t_dept_name IS TABLE OF departments.department_name%TYPE;
    
    l_dept_ids t_dept_id;
    l_dept_names t_dept_name;
BEGIN
    SELECT department_id, department_name
    BULK COLLECT INTO l_dept_ids, l_dept_names
    FROM departments;
    
    FOR i IN 1..l_dept_ids.COUNT LOOP
        DBMS_OUTPUT.PUT_LINE('Department ID: ' || l_dept_ids(i) || ', Department Name: ' || l_dept_names(i));
    END LOOP;
END;
/</pre></div><div class='content'></div><h2>Exercici 2: Recollida massiva amb condicions</h2>
<div class='content'><p><strong>Descripció</strong>: Escriu un bloc PL/SQL que utilitzi <code>BULK COLLECT</code> per carregar les dades de les columnes <code>employee_id</code> i <code>last_name</code> de la taula <code>employees</code> on el salari sigui superior a 5000 en col·leccions PL/SQL i imprimeixi els resultats.</p>
<p><strong>Solució</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("REVDTEFSRQogICAgVFlQRSB0X2VtcF9pZCBJUyBUQUJMRSBPRiBlbXBsb3llZXMuZW1wbG95ZWVfaWQlVFlQRTsKICAgIFRZUEUgdF9sYXN0X25hbWUgSVMgVEFCTEUgT0YgZW1wbG95ZWVzLmxhc3RfbmFtZSVUWVBFOwogICAgCiAgICBsX2VtcF9pZHMgdF9lbXBfaWQ7CiAgICBsX2xhc3RfbmFtZXMgdF9sYXN0X25hbWU7CkJFR0lOCiAgICBTRUxFQ1QgZW1wbG95ZWVfaWQsIGxhc3RfbmFtZQogICAgQlVMSyBDT0xMRUNUIElOVE8gbF9lbXBfaWRzLCBsX2xhc3RfbmFtZXMKICAgIEZST00gZW1wbG95ZWVzCiAgICBXSEVSRSBzYWxhcnkgPiA1MDAwOwogICAgCiAgICBGT1IgaSBJTiAxLi5sX2VtcF9pZHMuQ09VTlQgTE9PUAogICAgICAgIERCTVNfT1VUUFVULlBVVF9MSU5FKCdFbXBsb3llZSBJRDogJyB8fCBsX2VtcF9pZHMoaSkgfHwgJywgTGFzdCBOYW1lOiAnIHx8IGxfbGFzdF9uYW1lcyhpKSk7CiAgICBFTkQgTE9PUDsKRU5EOwov"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>DECLARE
    TYPE t_emp_id IS TABLE OF employees.employee_id%TYPE;
    TYPE t_last_name IS TABLE OF employees.last_name%TYPE;
    
    l_emp_ids t_emp_id;
    l_last_names t_last_name;
BEGIN
    SELECT employee_id, last_name
    BULK COLLECT INTO l_emp_ids, l_last_names
    FROM employees
    WHERE salary &gt; 5000;
    
    FOR i IN 1..l_emp_ids.COUNT LOOP
        DBMS_OUTPUT.PUT_LINE('Employee ID: ' || l_emp_ids(i) || ', Last Name: ' || l_last_names(i));
    END LOOP;
END;
/</pre></div><div class='content'></div><h1>Errors Comuns i Consells</h1>
<div class='content'></div><h2>Errors Comuns</h2>
<div class='content'><ul>
<li><strong>Desbordament de memòria</strong>: La recollida massiva pot consumir molta memòria si es carreguen grans volums de dades. Utilitza límits (<code>LIMIT</code>) per controlar la quantitat de dades carregades en cada operació.</li>
<li><strong>Manca de gestió d'excepcions</strong>: Assegura't de gestionar les excepcions per evitar que el programa falli en cas d'errors inesperats.</li>
</ul>
</div><h2>Consells</h2>
<div class='content'><ul>
<li><strong>Utilitza límits</strong>: Per evitar desbordaments de memòria, utilitza la clàusula <code>LIMIT</code> amb <code>BULK COLLECT</code>.</li>
<li><strong>Processament en lots</strong>: Divideix les operacions de recollida massiva en lots més petits per millorar l'eficiència i la gestió de memòria.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("REVDTEFSRQogICAgVFlQRSB0X25hbWUgSVMgVEFCTEUgT0YgZW1wbG95ZWVzLm5hbWUlVFlQRTsKICAgIFRZUEUgdF9zYWxhcnkgSVMgVEFCTEUgT0YgZW1wbG95ZWVzLnNhbGFyeSVUWVBFOwogICAgCiAgICBsX25hbWVzIHRfbmFtZTsKICAgIGxfc2FsYXJpZXMgdF9zYWxhcnk7CiAgICBDVVJTT1IgY19lbXBsb3llZXMgSVMgU0VMRUNUIG5hbWUsIHNhbGFyeSBGUk9NIGVtcGxveWVlczsKQkVHSU4KICAgIE9QRU4gY19lbXBsb3llZXM7CiAgICBMT09QCiAgICAgICAgRkVUQ0ggY19lbXBsb3llZXMgQlVMSyBDT0xMRUNUIElOVE8gbF9uYW1lcywgbF9zYWxhcmllcyBMSU1JVCAxMDA7CiAgICAgICAgRVhJVCBXSEVOIGxfbmFtZXMuQ09VTlQgPSAwOwogICAgICAgIAogICAgICAgIEZPUiBpIElOIDEuLmxfbmFtZXMuQ09VTlQgTE9PUAogICAgICAgICAgICBEQk1TX09VVFBVVC5QVVRfTElORSgnTm9tOiAnIHx8IGxfbmFtZXMoaSkgfHwgJywgU2FsYXJpOiAnIHx8IGxfc2FsYXJpZXMoaSkpOwogICAgICAgIEVORCBMT09QOwogICAgRU5EIExPT1A7CiAgICBDTE9TRSBjX2VtcGxveWVlczsKRU5EOwov"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>DECLARE
    TYPE t_name IS TABLE OF employees.name%TYPE;
    TYPE t_salary IS TABLE OF employees.salary%TYPE;
    
    l_names t_name;
    l_salaries t_salary;
    CURSOR c_employees IS SELECT name, salary FROM employees;
BEGIN
    OPEN c_employees;
    LOOP
        FETCH c_employees BULK COLLECT INTO l_names, l_salaries LIMIT 100;
        EXIT WHEN l_names.COUNT = 0;
        
        FOR i IN 1..l_names.COUNT LOOP
            DBMS_OUTPUT.PUT_LINE('Nom: ' || l_names(i) || ', Salari: ' || l_salaries(i));
        END LOOP;
    END LOOP;
    CLOSE c_employees;
END;
/</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>La recollida massiva és una tècnica essencial per optimitzar el rendiment de les aplicacions PL/SQL que treballen amb grans volums de dades. Mitjançant l'ús de <code>BULK COLLECT</code>, pots reduir significativament el temps d'execució i la càrrega de xarxa, alhora que mantens el codi net i fàcil de mantenir. Practica amb els exercicis proporcionats per dominar aquesta tècnica i aplicar-la de manera efectiva en els teus projectes.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='03-02-implicit-explicit-cursors' title="Cursors implícits i explícits">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='03-04-forall-statement' title="Sentència FORALL">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<!-- 
<h1>Publicitat</h1>
<p>Aquest espai està destinat a publicitat.</p>
<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
<p>Gràcies per col·laborar!</p>
-->

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725"
     crossorigin="anonymous"></script>
<!-- enterprise_campus -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-0611338592562725"
     data-ad-slot="6914733106"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			









		</div>
	</div>
</div>

<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">El Projecte</a> | 
<a href="/about">Sobre nosaltres</a> | 
<a href="/contribute">Contribuir</a> | 
<a href="/donate">Donacions</a> | 
<a href="/licence">Llicència</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
