<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triggers</title>

    <link rel="alternate" href="https://campusempresa.com/mod/plsql/04-04-triggers" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/plsql/04-04-triggers" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/plsql/04-04-triggers" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
				<a href="https://enterprisecampus.net/mod/plsql/04-04-triggers" class="px-2">EN</a></b>
	|
	<a href="https://campusempresa.com/mod/plsql/04-04-triggers" class="px-2">ES</a></b>
	|
	<b class="px-2">CA</b>
<br>
			<cite>Construint la societat d'avui i del demà</cite>
		</div>
	</div>
</div>
<div id="subheader" class="container-xxl">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">El Projecte</a> | 
<a href="/about">Sobre nosaltres</a> | 
<a href="/contribute">Contribuir</a> | 
<a href="/donate">Donacions</a> | 
<a href="/licence">Llicència</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				 					<a href="/categ/languages">Llenguatges de Programació</a>
				 					<a href="/categ/frameworks">Frameworks i Llibreries</a>
				 					<a href="/categ/tech-tools">Eines Tècniques</a>
				 					<a href="/categ/foundations">Fonaments Teòrics</a>
				 					<a href="/categ/soft-skills">Habilitats Socials</a>
							</div>
		</div>
	</div>
</div>
		
<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
				<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='04-03-packages' title="Paquets">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Triggers</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='05-01-code-optimization' title="Tècniques d'optimització de codi">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>Els triggers (triggers en anglès) són una característica poderosa de PL/SQL que permet executar codi automàticament en resposta a certs esdeveniments en una base de dades. Els triggers poden ser utilitzats per mantenir la integritat de les dades, auditar canvis, i implementar regles de negoci complexes.</p>
</div><h1><p>Què és un Trigger?</p>
</h1>
<div class='content'><p>Un trigger és un bloc de codi PL/SQL que s'executa automàticament quan ocorre un esdeveniment específic en una taula o vista. Els esdeveniments que poden activar un trigger inclouen operacions DML (INSERT, UPDATE, DELETE) i esdeveniments DDL (CREATE, ALTER, DROP).</p>
</div><h2><p>Tipus de Triggers</p>
</h2>
<div class='content'><p>Hi ha diversos tipus de triggers en PL/SQL:</p>
<ol>
<li><strong>Triggers DML</strong>: S'activen en resposta a operacions DML (INSERT, UPDATE, DELETE).</li>
<li><strong>Triggers DDL</strong>: S'activen en resposta a operacions DDL (CREATE, ALTER, DROP).</li>
<li><strong>Triggers de Base de Dades</strong>: S'activen en resposta a esdeveniments de la base de dades com l'inici de sessió d'un usuari o el tancament de la base de dades.</li>
</ol>
</div><h2><p>Estructura d'un Trigger</p>
</h2>
<div class='content'><p>Un trigger DML típic té la següent estructura:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIE9SIFJFUExBQ0UgVFJJR0dFUiB0cmlnZ2VyX25hbWUKQkVGT1JFIHwgQUZURVIgSU5TRVJUIHwgVVBEQVRFIHwgREVMRVRFCk9OIHRhYmxlX25hbWUKW0ZPUiBFQUNIIFJPV10KREVDTEFSRQogICAgLS0gRGVjbGFyYWNpw7MgZGUgdmFyaWFibGVzIGxvY2FscwpCRUdJTgogICAgLS0gQ29kaSBQTC9TUUwgYSBleGVjdXRhcgpFTkQ7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE OR REPLACE TRIGGER trigger_name
BEFORE | AFTER INSERT | UPDATE | DELETE
ON table_name
[FOR EACH ROW]
DECLARE
    -- Declaraci&oacute; de variables locals
BEGIN
    -- Codi PL/SQL a executar
END;</pre></div><div class='content'><ul>
<li><code>BEFORE | AFTER</code>: Indica si el trigger s'executa abans o després de l'esdeveniment.</li>
<li><code>INSERT | UPDATE | DELETE</code>: Especifica l'operació DML que activa el trigger.</li>
<li><code>ON table_name</code>: Especifica la taula o vista sobre la qual s'aplica el trigger.</li>
<li><code>FOR EACH ROW</code>: Opcional, indica que el trigger s'executa per a cada fila afectada per l'operació DML.</li>
</ul>
</div><h1><p>Exemple Pràctic</p>
</h1>
<div class='content'></div><h2><p>Crear un Trigger</p>
</h2>
<div class='content'><p>Suposem que tenim una taula <code>employees</code> i volem crear un trigger que registri qualsevol canvi en el salari dels empleats en una taula d'auditoria <code>salary_audit</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gQ3JlYWNpw7MgZGUgbGEgdGF1bGEgZCdhdWRpdG9yaWEKQ1JFQVRFIFRBQkxFIHNhbGFyeV9hdWRpdCAoCiAgICBlbXBsb3llZV9pZCBOVU1CRVIsCiAgICBvbGRfc2FsYXJ5IE5VTUJFUiwKICAgIG5ld19zYWxhcnkgTlVNQkVSLAogICAgY2hhbmdlX2RhdGUgREFURQopOwoKLS0gQ3JlYWNpw7MgZGVsIHRyaWdnZXIKQ1JFQVRFIE9SIFJFUExBQ0UgVFJJR0dFUiB0cmdfc2FsYXJ5X3VwZGF0ZQpBRlRFUiBVUERBVEUgT0Ygc2FsYXJ5IE9OIGVtcGxveWVlcwpGT1IgRUFDSCBST1cKQkVHSU4KICAgIElOU0VSVCBJTlRPIHNhbGFyeV9hdWRpdCAoZW1wbG95ZWVfaWQsIG9sZF9zYWxhcnksIG5ld19zYWxhcnksIGNoYW5nZV9kYXRlKQogICAgVkFMVUVTICg6T0xELmVtcGxveWVlX2lkLCA6T0xELnNhbGFyeSwgOk5FVy5zYWxhcnksIFNZU0RBVEUpOwpFTkQ7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Creaci&oacute; de la taula d'auditoria
CREATE TABLE salary_audit (
    employee_id NUMBER,
    old_salary NUMBER,
    new_salary NUMBER,
    change_date DATE
);

-- Creaci&oacute; del trigger
CREATE OR REPLACE TRIGGER trg_salary_update
AFTER UPDATE OF salary ON employees
FOR EACH ROW
BEGIN
    INSERT INTO salary_audit (employee_id, old_salary, new_salary, change_date)
    VALUES (:OLD.employee_id, :OLD.salary, :NEW.salary, SYSDATE);
END;</pre></div><div class='content'></div><h2><p>Explicació del Codi</p>
</h2>
<div class='content'><ul>
<li><code>AFTER UPDATE OF salary ON employees</code>: El trigger s'activa després d'una operació UPDATE en la columna <code>salary</code> de la taula <code>employees</code>.</li>
<li><code>FOR EACH ROW</code>: El trigger s'executa per a cada fila afectada per l'operació UPDATE.</li>
<li><code>:OLD</code> i <code>:NEW</code>: Són pseudorecords que contenen els valors antics i nous de les columnes afectades.</li>
</ul>
</div><h2><p>Provar el Trigger</p>
</h2>
<div class='content'><p>Per provar el trigger, podem fer una actualització en la taula <code>employees</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("VVBEQVRFIGVtcGxveWVlcwpTRVQgc2FsYXJ5ID0gc2FsYXJ5ICogMS4xCldIRVJFIGVtcGxveWVlX2lkID0gMTAxOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>UPDATE employees
SET salary = salary * 1.1
WHERE employee_id = 101;</pre></div><div class='content'><p>Després d'executar aquesta sentència, podem verificar la taula <code>salary_audit</code> per veure el registre de l'actualització:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUICogRlJPTSBzYWxhcnlfYXVkaXQ7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT * FROM salary_audit;</pre></div><div class='content'></div><h1><p>Exercicis Pràctics</p>
</h1>
<div class='content'></div><h2><p>Exercici 1: Crear un Trigger d'Inserció</p>
</h2>
<div class='content'><p>Crea un trigger que registri qualsevol nova inserció en la taula <code>employees</code> en una taula d'auditoria <code>employee_audit</code>.</p>
<h4>Solució</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gQ3JlYWNpw7MgZGUgbGEgdGF1bGEgZCdhdWRpdG9yaWEKQ1JFQVRFIFRBQkxFIGVtcGxveWVlX2F1ZGl0ICgKICAgIGVtcGxveWVlX2lkIE5VTUJFUiwKICAgIGVtcGxveWVlX25hbWUgVkFSQ0hBUjIoMTAwKSwKICAgIGhpcmVfZGF0ZSBEQVRFCik7CgotLSBDcmVhY2nDsyBkZWwgdHJpZ2dlcgpDUkVBVEUgT1IgUkVQTEFDRSBUUklHR0VSIHRyZ19lbXBsb3llZV9pbnNlcnQKQUZURVIgSU5TRVJUIE9OIGVtcGxveWVlcwpGT1IgRUFDSCBST1cKQkVHSU4KICAgIElOU0VSVCBJTlRPIGVtcGxveWVlX2F1ZGl0IChlbXBsb3llZV9pZCwgZW1wbG95ZWVfbmFtZSwgaGlyZV9kYXRlKQogICAgVkFMVUVTICg6TkVXLmVtcGxveWVlX2lkLCA6TkVXLmVtcGxveWVlX25hbWUsIDpORVcuaGlyZV9kYXRlKTsKRU5EOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Creaci&oacute; de la taula d'auditoria
CREATE TABLE employee_audit (
    employee_id NUMBER,
    employee_name VARCHAR2(100),
    hire_date DATE
);

-- Creaci&oacute; del trigger
CREATE OR REPLACE TRIGGER trg_employee_insert
AFTER INSERT ON employees
FOR EACH ROW
BEGIN
    INSERT INTO employee_audit (employee_id, employee_name, hire_date)
    VALUES (:NEW.employee_id, :NEW.employee_name, :NEW.hire_date);
END;</pre></div><div class='content'></div><h2><p>Exercici 2: Crear un Trigger de Supressió</p>
</h2>
<div class='content'><p>Crea un trigger que registri qualsevol eliminació en la taula <code>employees</code> en una taula d'auditoria <code>deletion_audit</code>.</p>
<h4>Solució</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gQ3JlYWNpw7MgZGUgbGEgdGF1bGEgZCdhdWRpdG9yaWEKQ1JFQVRFIFRBQkxFIGRlbGV0aW9uX2F1ZGl0ICgKICAgIGVtcGxveWVlX2lkIE5VTUJFUiwKICAgIGVtcGxveWVlX25hbWUgVkFSQ0hBUjIoMTAwKSwKICAgIGRlbGV0aW9uX2RhdGUgREFURQopOwoKLS0gQ3JlYWNpw7MgZGVsIHRyaWdnZXIKQ1JFQVRFIE9SIFJFUExBQ0UgVFJJR0dFUiB0cmdfZW1wbG95ZWVfZGVsZXRlCkFGVEVSIERFTEVURSBPTiBlbXBsb3llZXMKRk9SIEVBQ0ggUk9XCkJFR0lOCiAgICBJTlNFUlQgSU5UTyBkZWxldGlvbl9hdWRpdCAoZW1wbG95ZWVfaWQsIGVtcGxveWVlX25hbWUsIGRlbGV0aW9uX2RhdGUpCiAgICBWQUxVRVMgKDpPTEQuZW1wbG95ZWVfaWQsIDpPTEQuZW1wbG95ZWVfbmFtZSwgU1lTREFURSk7CkVORDs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Creaci&oacute; de la taula d'auditoria
CREATE TABLE deletion_audit (
    employee_id NUMBER,
    employee_name VARCHAR2(100),
    deletion_date DATE
);

-- Creaci&oacute; del trigger
CREATE OR REPLACE TRIGGER trg_employee_delete
AFTER DELETE ON employees
FOR EACH ROW
BEGIN
    INSERT INTO deletion_audit (employee_id, employee_name, deletion_date)
    VALUES (:OLD.employee_id, :OLD.employee_name, SYSDATE);
END;</pre></div><div class='content'></div><h1><p>Errors Comuns i Consells</p>
</h1>
<div class='content'><ul>
<li><strong>Error: Mutació de la Taula</strong>: Un error comú és intentar modificar la mateixa taula que activa el trigger. Això pot causar un error de mutació de la taula. Evita modificar la taula objectiu del trigger dins del mateix trigger.</li>
<li><strong>Consell: Utilitza Triggers amb Moderació</strong>: Els triggers poden complicar el depurament i el manteniment del codi. Utilitza'ls només quan sigui necessari i documenta bé el seu comportament.</li>
</ul>
</div><h1><p>Conclusió</p>
</h1>
<div class='content'><p>Els triggers són una eina poderosa en PL/SQL per automatitzar tasques i mantenir la integritat de les dades. En aquest tema, hem après què són els triggers, com crear-los i com utilitzar-los en situacions pràctiques. Amb aquesta base, estàs preparat per implementar triggers en els teus projectes de PL/SQL i aprofitar al màxim les seves capacitats.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='04-03-packages' title="Paquets">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='05-01-code-optimization' title="Tècniques d'optimització de codi">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
