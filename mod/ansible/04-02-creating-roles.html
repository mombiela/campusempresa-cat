<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creant Rols</title>

    <link rel="alternate" href="https://campusempresa.com/mod/ansible/04-02-creating-roles" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/ansible/04-02-creating-roles" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/ansible/04-02-creating-roles" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/ansible/04-02-creating-roles" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/ansible/04-02-creating-roles" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Projecte</a>
				<a href="/about">Sobre nosaltres</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donacions</a>
				<a href="/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='04-01-introduction-to-roles' title="Introducció als Rols">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Creant Rols</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='04-03-role-directory-structure' title="Estructura del Directori de Rols">Següent &#x25BA;</a>
			</div>
</div>
<div class='content'><p>En aquest tema, aprendrem com crear rols en Ansible. Els rols són una manera d'organitzar i reutilitzar el codi d'Ansible, facilitant la gestió de configuracions complexes. Un rol és una col·lecció de tasques, fitxers, plantilles, variables i altres recursos que es poden aplicar a un sistema.</p>
</div><h1><p>Objectius</p>
</h1>
<div class='content'><ul>
<li>Entendre la importància dels rols en Ansible.</li>
<li>Aprendre a crear un rol des de zero.</li>
<li>Conèixer l'estructura d'un rol.</li>
<li>Implementar un rol en un playbook.</li>
</ul>
</div><h1><ol>
<li>Importància dels Rols</li>
</ol>
</h1>
<div class='content'><p>Els rols permeten:</p>
<ul>
<li><strong>Reutilització del codi</strong>: Pots reutilitzar el mateix rol en diferents playbooks.</li>
<li><strong>Organització</strong>: Faciliten l'organització del codi en projectes grans.</li>
<li><strong>Mantenibilitat</strong>: Fan que el codi sigui més fàcil de mantenir i actualitzar.</li>
</ul>
</div><h1><ol start="2">
<li>Creant un Rol des de Zero</li>
</ol>
</h1>
<div class='content'></div><h2><p>Pas 1: Crear l'Estructura del Rol</p>
</h2>
<div class='content'><p>Ansible proporciona una eina per crear l'estructura bàsica d'un rol. Utilitza la comanda següent:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1nYWxheHkgaW5pdCBub21fZGVsX3JvbA=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-galaxy init nom_del_rol</pre></div><div class='content'><p>Per exemple, per crear un rol anomenat <code>webserver</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1nYWxheHkgaW5pdCB3ZWJzZXJ2ZXI="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-galaxy init webserver</pre></div><div class='content'><p>Això crearà una estructura de directoris com la següent:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("d2Vic2VydmVyLwrilJzilIDilIAgUkVBRE1FLm1kCuKUnOKUgOKUgCBkZWZhdWx0cy8K4pSCICAg4pSU4pSA4pSAIG1haW4ueW1sCuKUnOKUgOKUgCBmaWxlcy8K4pSc4pSA4pSAIGhhbmRsZXJzLwrilIIgICDilJTilIDilIAgbWFpbi55bWwK4pSc4pSA4pSAIG1ldGEvCuKUgiAgIOKUlOKUgOKUgCBtYWluLnltbArilJzilIDilIAgdGFza3MvCuKUgiAgIOKUlOKUgOKUgCBtYWluLnltbArilJzilIDilIAgdGVtcGxhdGVzLwrilJzilIDilIAgdGVzdHMvCuKUgiAgIOKUnOKUgOKUgCBpbnZlbnRvcnkK4pSCICAg4pSU4pSA4pSAIHRlc3QueW1sCuKUlOKUgOKUgCB2YXJzLwogICAg4pSU4pSA4pSAIG1haW4ueW1s"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>webserver/
├── README.md
├── defaults/
│   └── main.yml
├── files/
├── handlers/
│   └── main.yml
├── meta/
│   └── main.yml
├── tasks/
│   └── main.yml
├── templates/
├── tests/
│   ├── inventory
│   └── test.yml
└── vars/
    └── main.yml</pre></div><div class='content'></div><h2><p>Pas 2: Entendre l'Estructura del Rol</p>
</h2>
<div class='content'><ul>
<li><strong>defaults/main.yml</strong>: Variables per defecte del rol.</li>
<li><strong>files/</strong>: Fitxers que es copien directament al sistema remot.</li>
<li><strong>handlers/main.yml</strong>: Handlers que es poden cridar des de les tasques.</li>
<li><strong>meta/main.yml</strong>: Metadades del rol, com dependències.</li>
<li><strong>tasks/main.yml</strong>: Tasques que defineixen el que fa el rol.</li>
<li><strong>templates/</strong>: Plantilles Jinja2 que es renderitzen i es copien al sistema remot.</li>
<li><strong>vars/main.yml</strong>: Variables del rol.</li>
</ul>
</div><h2><p>Pas 3: Definir les Tasques del Rol</p>
</h2>
<div class='content'><p>Edita el fitxer <code>tasks/main.yml</code> per definir les tasques que el rol ha de realitzar. Per exemple, per instal·lar un servidor web Nginx:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogSW5zdGFswrdsYXIgTmdpbngKICBhcHQ6CiAgICBuYW1lOiBuZ2lueAogICAgc3RhdGU6IHByZXNlbnQKCi0gbmFtZTogQXNzZWd1cmFyLXNlIHF1ZSBOZ2lueCBlc3TDoCBlbiBmdW5jaW9uYW1lbnQKICBzZXJ2aWNlOgogICAgbmFtZTogbmdpbngKICAgIHN0YXRlOiBzdGFydGVkCiAgICBlbmFibGVkOiB0cnVl"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Instal&middot;lar Nginx
  apt:
    name: nginx
    state: present

- name: Assegurar-se que Nginx est&agrave; en funcionament
  service:
    name: nginx
    state: started
    enabled: true</pre></div><div class='content'></div><h2><p>Pas 4: Definir Handlers</p>
</h2>
<div class='content'><p>Els handlers són tasques que es criden quan es notifiquen. Edita el fitxer <code>handlers/main.yml</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogUmVpbmljaWFyIE5naW54CiAgc2VydmljZToKICAgIG5hbWU6IG5naW54CiAgICBzdGF0ZTogcmVzdGFydGVk"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Reiniciar Nginx
  service:
    name: nginx
    state: restarted</pre></div><div class='content'></div><h2><p>Pas 5: Definir Variables</p>
</h2>
<div class='content'><p>Edita el fitxer <code>vars/main.yml</code> per definir variables específiques del rol:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCm5naW54X3BvcnQ6IDgw"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
nginx_port: 80</pre></div><div class='content'></div><h2><p>Pas 6: Utilitzar Plantilles</p>
</h2>
<div class='content'><p>Si necessites utilitzar plantilles, col·loca-les al directori <code>templates/</code> i utilitza el mòdul <code>template</code> en les tasques. Per exemple, crea una plantilla <code>nginx.conf.j2</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VydmVyIHsKICAgIGxpc3RlbiB7eyBuZ2lueF9wb3J0IH19OwogICAgc2VydmVyX25hbWUgbG9jYWxob3N0OwoKICAgIGxvY2F0aW9uIC8gewogICAgICAgIHJvb3QgL3Zhci93d3cvaHRtbDsKICAgICAgICBpbmRleCBpbmRleC5odG1sIGluZGV4Lmh0bTsKICAgIH0KfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>server {
    listen {{ nginx_port }};
    server_name localhost;

    location / {
        root /var/www/html;
        index index.html index.htm;
    }
}</pre></div><div class='content'><p>I afegeix una tasca per copiar aquesta plantilla:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogQ29waWFyIGxhIGNvbmZpZ3VyYWNpw7MgZGUgTmdpbngKICB0ZW1wbGF0ZToKICAgIHNyYzogbmdpbnguY29uZi5qMgogICAgZGVzdDogL2V0Yy9uZ2lueC9zaXRlcy1hdmFpbGFibGUvZGVmYXVsdAogIG5vdGlmeTogUmVpbmljaWFyIE5naW54"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Copiar la configuraci&oacute; de Nginx
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/sites-available/default
  notify: Reiniciar Nginx</pre></div><div class='content'></div><h1><ol start="3">
<li>Implementar un Rol en un Playbook</li>
</ol>
</h1>
<div class='content'><p>Per utilitzar el rol en un playbook, simplement afegeix-lo a la secció <code>roles</code> del playbook:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gaG9zdHM6IHdlYnNlcnZlcnMKICByb2xlczoKICAgIC0gd2Vic2VydmVy"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- hosts: webservers
  roles:
    - webserver</pre></div><div class='content'></div><h1><p>Exercici Pràctic</p>
</h1>
<div class='content'></div><h2><p>Objectiu</p>
</h2>
<div class='content'><p>Crear un rol que instal·li i configuri Apache.</p>
</div><h2><p>Passos</p>
</h2>
<div class='content'><ol>
<li>Crea un nou rol anomenat <code>apache</code> utilitzant <code>ansible-galaxy init apache</code>.</li>
<li>Defineix les tasques per instal·lar Apache en <code>tasks/main.yml</code>.</li>
<li>Defineix un handler per reiniciar Apache en <code>handlers/main.yml</code>.</li>
<li>Crea una plantilla per a la configuració d'Apache en <code>templates/</code>.</li>
<li>Utilitza el rol en un playbook.</li>
</ol>
</div><h2><p>Solució</p>
</h2>
<div class='content'><ol>
<li>Crear el rol:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1nYWxheHkgaW5pdCBhcGFjaGU="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-galaxy init apache</pre></div><div class='content'><ol start="2">
<li>Definir les tasques en <code>tasks/main.yml</code>:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogSW5zdGFswrdsYXIgQXBhY2hlCiAgYXB0OgogICAgbmFtZTogYXBhY2hlMgogICAgc3RhdGU6IHByZXNlbnQKCi0gbmFtZTogQXNzZWd1cmFyLXNlIHF1ZSBBcGFjaGUgZXN0w6AgZW4gZnVuY2lvbmFtZW50CiAgc2VydmljZToKICAgIG5hbWU6IGFwYWNoZTIKICAgIHN0YXRlOiBzdGFydGVkCiAgICBlbmFibGVkOiB0cnVl"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Instal&middot;lar Apache
  apt:
    name: apache2
    state: present

- name: Assegurar-se que Apache est&agrave; en funcionament
  service:
    name: apache2
    state: started
    enabled: true</pre></div><div class='content'><ol start="3">
<li>Definir el handler en <code>handlers/main.yml</code>:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogUmVpbmljaWFyIEFwYWNoZQogIHNlcnZpY2U6CiAgICBuYW1lOiBhcGFjaGUyCiAgICBzdGF0ZTogcmVzdGFydGVk"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Reiniciar Apache
  service:
    name: apache2
    state: restarted</pre></div><div class='content'><ol start="4">
<li>Crear una plantilla <code>apache.conf.j2</code> en <code>templates/</code>:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PFZpcnR1YWxIb3N0ICo6ODA+CiAgICBTZXJ2ZXJBZG1pbiB3ZWJtYXN0ZXJAbG9jYWxob3N0CiAgICBEb2N1bWVudFJvb3QgL3Zhci93d3cvaHRtbAogICAgRXJyb3JMb2cgJHtBUEFDSEVfTE9HX0RJUn0vZXJyb3IubG9nCiAgICBDdXN0b21Mb2cgJHtBUEFDSEVfTE9HX0RJUn0vYWNjZXNzLmxvZyBjb21iaW5lZAo8L1ZpcnR1YWxIb3N0Pg=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;</pre></div><div class='content'><ol start="5">
<li>Afegir una tasca per copiar la plantilla:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogQ29waWFyIGxhIGNvbmZpZ3VyYWNpw7MgZCdBcGFjaGUKICB0ZW1wbGF0ZToKICAgIHNyYzogYXBhY2hlLmNvbmYuajIKICAgIGRlc3Q6IC9ldGMvYXBhY2hlMi9zaXRlcy1hdmFpbGFibGUvMDAwLWRlZmF1bHQuY29uZgogIG5vdGlmeTogUmVpbmljaWFyIEFwYWNoZQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Copiar la configuraci&oacute; d'Apache
  template:
    src: apache.conf.j2
    dest: /etc/apache2/sites-available/000-default.conf
  notify: Reiniciar Apache</pre></div><div class='content'><ol start="6">
<li>Utilitzar el rol en un playbook:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gaG9zdHM6IHdlYnNlcnZlcnMKICByb2xlczoKICAgIC0gYXBhY2hl"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- hosts: webservers
  roles:
    - apache</pre></div><div class='content'></div><h1><p>Conclusió</p>
</h1>
<div class='content'><p>En aquest tema, hem après com crear un rol en Ansible, entendre la seva estructura i utilitzar-lo en un playbook. Els rols són una eina poderosa per organitzar i reutilitzar el codi, facilitant la gestió de configuracions complexes. Amb aquesta base, estàs preparat per crear i gestionar rols en els teus projectes d'Ansible.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='04-01-introduction-to-roles' title="Introducció als Rols">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='04-03-role-directory-structure' title="Estructura del Directori de Rols">Següent &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
