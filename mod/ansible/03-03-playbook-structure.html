<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estructura del Playbook</title>

    <link rel="alternate" href="https://campusempresa.com/mod/ansible/03-03-playbook-structure" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/ansible/03-03-playbook-structure" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/ansible/03-03-playbook-structure" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/ansible/03-03-playbook-structure" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/ansible/03-03-playbook-structure" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<!-- <a href="/">Home</a>  -->
									<a href="./">Contingut del curs</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Competències tècniques</a>
				<a href="/all/conocimientos">Coneixements</a>
				<a href="/all/soft_skills">Competències socials</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='03-02-writing-your-first-playbook' title="Escrivint el teu primer Playbook">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Estructura del Playbook</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='03-04-variables-and-facts' title="Variables i Fets">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>En aquest tema, explorarem l'estructura d'un playbook d'Ansible. Els playbooks són el cor d'Ansible, ja que defineixen les tasques que es volen executar en els nodes gestionats. Comprendre l'estructura d'un playbook és fonamental per escriure playbooks eficients i mantenibles.</p>
</div><h1><p>Components d'un Playbook</p>
</h1>
<div class='content'><p>Un playbook d'Ansible està format per una o més &quot;plays&quot;. Cada play aplica un conjunt de tasques a un grup de nodes. A continuació, desglossem els components principals d'un playbook:</p>
<ol>
<li><strong>Hosts</strong>: Defineix els nodes on s'executaran les tasques.</li>
<li><strong>Vars</strong>: Variables que es poden utilitzar dins del playbook.</li>
<li><strong>Tasks</strong>: Llista de tasques que es volen executar.</li>
<li><strong>Handlers</strong>: Tasques especials que s'executen en resposta a notificacions.</li>
<li><strong>Roles</strong>: Agrupacions de tasques, variables, fitxers, plantilles, etc.</li>
</ol>
</div><h2><p>Exemple d'un Playbook Bàsic</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogRXhlbXBsZSBkZSBQbGF5Ym9vawogIGhvc3RzOiB3ZWJzZXJ2ZXJzCiAgdmFyczoKICAgIGh0dHBfcG9ydDogODAKICB0YXNrczoKICAgIC0gbmFtZTogSW5zdGFswrdsYXIgQXBhY2hlCiAgICAgIGFwdDoKICAgICAgICBuYW1lOiBhcGFjaGUyCiAgICAgICAgc3RhdGU6IHByZXNlbnQKICAgICAgYmVjb21lOiB5ZXMKCiAgICAtIG5hbWU6IENvcGlhciBmaXR4ZXIgZGUgY29uZmlndXJhY2nDswogICAgICB0ZW1wbGF0ZToKICAgICAgICBzcmM6IC9wYXRoL3RvL2h0dHBkLmNvbmYuajIKICAgICAgICBkZXN0OiAvZXRjL2FwYWNoZTIvc2l0ZXMtYXZhaWxhYmxlLzAwMC1kZWZhdWx0LmNvbmYKICAgICAgbm90aWZ5OgogICAgICAgIC0gUmVzdGFydCBBcGFjaGUKCiAgaGFuZGxlcnM6CiAgICAtIG5hbWU6IFJlc3RhcnQgQXBhY2hlCiAgICAgIHNlcnZpY2U6CiAgICAgICAgbmFtZTogYXBhY2hlMgogICAgICAgIHN0YXRlOiByZXN0YXJ0ZWQ="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Exemple de Playbook
  hosts: webservers
  vars:
    http_port: 80
  tasks:
    - name: Instal&middot;lar Apache
      apt:
        name: apache2
        state: present
      become: yes

    - name: Copiar fitxer de configuraci&oacute;
      template:
        src: /path/to/httpd.conf.j2
        dest: /etc/apache2/sites-available/000-default.conf
      notify:
        - Restart Apache

  handlers:
    - name: Restart Apache
      service:
        name: apache2
        state: restarted</pre></div><div class='content'></div><h2><p>Descripció dels Components</p>
</h2>
<div class='content'><ol>
<li>
<p><strong>Hosts</strong>:</p>
<pre><code class="language-yaml">hosts: webservers
</code></pre>
<p>Aquest camp especifica els nodes on s'executaran les tasques. En aquest cas, el grup de nodes es diu <code>webservers</code>.</p>
</li>
<li>
<p><strong>Vars</strong>:</p>
<pre><code class="language-yaml">vars:
  http_port: 80
</code></pre>
<p>Aquí es defineixen variables que es poden utilitzar dins del playbook. En aquest exemple, <code>http_port</code> és una variable que conté el valor <code>80</code>.</p>
</li>
<li>
<p><strong>Tasks</strong>:</p>
<pre><code class="language-yaml">tasks:
  - name: Instal·lar Apache
    apt:
      name: apache2
      state: present
    become: yes
</code></pre>
<p>Les tasques són les accions que es volen executar en els nodes. Cada tasca té un nom descriptiu i utilitza un mòdul d'Ansible (en aquest cas, <code>apt</code>) per realitzar una acció. El paràmetre <code>become: yes</code> indica que la tasca s'executarà amb privilegis d'administrador.</p>
</li>
<li>
<p><strong>Handlers</strong>:</p>
<pre><code class="language-yaml">handlers:
  - name: Restart Apache
    service:
      name: apache2
      state: restarted
</code></pre>
<p>Els handlers són tasques especials que s'executen quan són notificades per altres tasques. En aquest exemple, el handler <code>Restart Apache</code> s'executa quan la tasca <code>Copiar fitxer de configuració</code> el notifica.</p>
</li>
</ol>
</div><h1><p>Estructura Detallada d'un Playbook</p>
</h1>
<div class='content'><p>A continuació, es presenta una estructura més detallada d'un playbook amb més components:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogRXhlbXBsZSBBdmFuw6dhdCBkZSBQbGF5Ym9vawogIGhvc3RzOiB3ZWJzZXJ2ZXJzCiAgdmFyczoKICAgIGh0dHBfcG9ydDogODAKICAgIG1heF9jbGllbnRzOiAyMDAKICBwcmVfdGFza3M6CiAgICAtIG5hbWU6IEFjdHVhbGl0emFyIGVsIGNhY2hlIGQnYXB0CiAgICAgIGFwdDoKICAgICAgICB1cGRhdGVfY2FjaGU6IHllcwogIHRhc2tzOgogICAgLSBuYW1lOiBJbnN0YWzCt2xhciBBcGFjaGUKICAgICAgYXB0OgogICAgICAgIG5hbWU6IGFwYWNoZTIKICAgICAgICBzdGF0ZTogcHJlc2VudAogICAgICBiZWNvbWU6IHllcwoKICAgIC0gbmFtZTogQ29waWFyIGZpdHhlciBkZSBjb25maWd1cmFjacOzCiAgICAgIHRlbXBsYXRlOgogICAgICAgIHNyYzogL3BhdGgvdG8vaHR0cGQuY29uZi5qMgogICAgICAgIGRlc3Q6IC9ldGMvYXBhY2hlMi9zaXRlcy1hdmFpbGFibGUvMDAwLWRlZmF1bHQuY29uZgogICAgICBub3RpZnk6CiAgICAgICAgLSBSZXN0YXJ0IEFwYWNoZQoKICAgIC0gbmFtZTogQXNzZWd1cmFyLXNlIHF1ZSBBcGFjaGUgZXN0w6AgZW4gZnVuY2lvbmFtZW50CiAgICAgIHNlcnZpY2U6CiAgICAgICAgbmFtZTogYXBhY2hlMgogICAgICAgIHN0YXRlOiBzdGFydGVkCgogIHBvc3RfdGFza3M6CiAgICAtIG5hbWU6IFZlcmlmaWNhciBxdWUgQXBhY2hlIGVzdMOgIGVzY29sdGFudCBhbCBwb3J0IDgwCiAgICAgIGNvbW1hbmQ6IG5ldHN0YXQgLXR1bG4gfCBncmVwIDo4MAoKICBoYW5kbGVyczoKICAgIC0gbmFtZTogUmVzdGFydCBBcGFjaGUKICAgICAgc2VydmljZToKICAgICAgICBuYW1lOiBhcGFjaGUyCiAgICAgICAgc3RhdGU6IHJlc3RhcnRlZA=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Exemple Avan&ccedil;at de Playbook
  hosts: webservers
  vars:
    http_port: 80
    max_clients: 200
  pre_tasks:
    - name: Actualitzar el cache d'apt
      apt:
        update_cache: yes
  tasks:
    - name: Instal&middot;lar Apache
      apt:
        name: apache2
        state: present
      become: yes

    - name: Copiar fitxer de configuraci&oacute;
      template:
        src: /path/to/httpd.conf.j2
        dest: /etc/apache2/sites-available/000-default.conf
      notify:
        - Restart Apache

    - name: Assegurar-se que Apache est&agrave; en funcionament
      service:
        name: apache2
        state: started

  post_tasks:
    - name: Verificar que Apache est&agrave; escoltant al port 80
      command: netstat -tuln | grep :80

  handlers:
    - name: Restart Apache
      service:
        name: apache2
        state: restarted</pre></div><div class='content'></div><h2><p>Components Addicionals</p>
</h2>
<div class='content'><ol>
<li>
<p><strong>pre_tasks</strong>:</p>
<pre><code class="language-yaml">pre_tasks:
  - name: Actualitzar el cache d'apt
    apt:
      update_cache: yes
</code></pre>
<p>Les pre-tasques són tasques que s'executen abans de les tasques principals. En aquest exemple, s'actualitza el cache d'apt abans d'instal·lar Apache.</p>
</li>
<li>
<p><strong>post_tasks</strong>:</p>
<pre><code class="language-yaml">post_tasks:
  - name: Verificar que Apache està escoltant al port 80
    command: netstat -tuln | grep :80
</code></pre>
<p>Les post-tasques són tasques que s'executen després de les tasques principals. En aquest exemple, es verifica que Apache està escoltant al port 80.</p>
</li>
</ol>
</div><h1><p>Exercici Pràctic</p>
</h1>
<div class='content'></div><h2><p>Objectiu</p>
</h2>
<div class='content'><p>Escriure un playbook que faci el següent:</p>
<ol>
<li>Instal·li Nginx en els nodes del grup <code>webservers</code>.</li>
<li>Copiï un fitxer de configuració personalitzat.</li>
<li>Reiniciï Nginx si el fitxer de configuració ha canviat.</li>
<li>Verifiqui que Nginx està en funcionament.</li>
</ol>
</div><h2><p>Solució</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogSW5zdGFswrdsYXIgaSBDb25maWd1cmFyIE5naW54CiAgaG9zdHM6IHdlYnNlcnZlcnMKICB0YXNrczoKICAgIC0gbmFtZTogSW5zdGFswrdsYXIgTmdpbngKICAgICAgYXB0OgogICAgICAgIG5hbWU6IG5naW54CiAgICAgICAgc3RhdGU6IHByZXNlbnQKICAgICAgYmVjb21lOiB5ZXMKCiAgICAtIG5hbWU6IENvcGlhciBmaXR4ZXIgZGUgY29uZmlndXJhY2nDsyBkZSBOZ2lueAogICAgICB0ZW1wbGF0ZToKICAgICAgICBzcmM6IC9wYXRoL3RvL25naW54LmNvbmYuajIKICAgICAgICBkZXN0OiAvZXRjL25naW54L25naW54LmNvbmYKICAgICAgbm90aWZ5OgogICAgICAgIC0gUmVzdGFydCBOZ2lueAoKICAgIC0gbmFtZTogQXNzZWd1cmFyLXNlIHF1ZSBOZ2lueCBlc3TDoCBlbiBmdW5jaW9uYW1lbnQKICAgICAgc2VydmljZToKICAgICAgICBuYW1lOiBuZ2lueAogICAgICAgIHN0YXRlOiBzdGFydGVkCgogIGhhbmRsZXJzOgogICAgLSBuYW1lOiBSZXN0YXJ0IE5naW54CiAgICAgIHNlcnZpY2U6CiAgICAgICAgbmFtZTogbmdpbngKICAgICAgICBzdGF0ZTogcmVzdGFydGVk"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Instal&middot;lar i Configurar Nginx
  hosts: webservers
  tasks:
    - name: Instal&middot;lar Nginx
      apt:
        name: nginx
        state: present
      become: yes

    - name: Copiar fitxer de configuraci&oacute; de Nginx
      template:
        src: /path/to/nginx.conf.j2
        dest: /etc/nginx/nginx.conf
      notify:
        - Restart Nginx

    - name: Assegurar-se que Nginx est&agrave; en funcionament
      service:
        name: nginx
        state: started

  handlers:
    - name: Restart Nginx
      service:
        name: nginx
        state: restarted</pre></div><div class='content'></div><h2><p>Explicació</p>
</h2>
<div class='content'><ol>
<li><strong>Instal·lar Nginx</strong>: Utilitza el mòdul <code>apt</code> per instal·lar Nginx.</li>
<li><strong>Copiar fitxer de configuració de Nginx</strong>: Utilitza el mòdul <code>template</code> per copiar un fitxer de configuració personalitzat.</li>
<li><strong>Assegurar-se que Nginx està en funcionament</strong>: Utilitza el mòdul <code>service</code> per assegurar-se que Nginx està en funcionament.</li>
<li><strong>Restart Nginx</strong>: Handler que reinicia Nginx si el fitxer de configuració ha canviat.</li>
</ol>
</div><h1><p>Conclusió</p>
</h1>
<div class='content'><p>En aquest tema, hem après sobre l'estructura d'un playbook d'Ansible i els seus components principals. Hem vist exemples pràctics i hem realitzat un exercici per reforçar els conceptes apresos. Amb aquesta base, estem preparats per aprofundir en altres aspectes dels playbooks en els següents temes.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='03-02-writing-your-first-playbook' title="Escrivint el teu primer Playbook">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='03-04-variables-and-facts' title="Variables i Fets">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
