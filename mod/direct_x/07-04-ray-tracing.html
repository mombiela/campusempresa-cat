<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traçat de Raigs</title>

    <link rel="alternate" href="https://campusempresa.com/mod/direct_x/07-04-ray-tracing" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/direct_x/07-04-ray-tracing" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/direct_x/07-04-ray-tracing" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 px-0 py-2 py-md-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 px-0 py-2 py-md-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/direct_x/07-04-ray-tracing" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/direct_x/07-04-ray-tracing" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Projecte</a>
				<a href="/about">Sobre nosaltres</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donacions</a>
				<a href="/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='07-03-tessellation' title="Tessel·lació">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Traçat de Raigs</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='08-01-building-game-engine' title="Construir un Motor de Joc">Següent &#x25BA;</a>
			</div>
</div>
<div class='content'><p>El traçat de raigs (Ray Tracing) és una tècnica avançada de renderització que simula el comportament de la llum per produir imatges amb un alt grau de realisme. Aquesta tècnica es basa en el seguiment dels raigs de llum mentre interactuen amb els objectes en una escena, permetent efectes com reflexions, refraccions i ombres suaus.</p>
</div><h1>Conceptes Clau del Traçat de Raigs</h1>
<div class='content'><ol>
<li><strong>Raigs Primaris</strong>: Són els raigs que es disparen des de la càmera cap a l'escena.</li>
<li><strong>Raigs Secundaris</strong>: Són els raigs que es generen a partir de les interaccions dels raigs primaris amb els objectes (reflexions, refraccions).</li>
<li><strong>Intersecció de Raigs</strong>: El càlcul de la intersecció dels raigs amb les superfícies dels objectes.</li>
<li><strong>Il·luminació Global</strong>: La simulació de la llum que rebota múltiples vegades en una escena, contribuint a un realisme més gran.</li>
</ol>
</div><h1>Configuració Inicial</h1>
<div class='content'></div><h2>Requisits</h2>
<div class='content'><ul>
<li>DirectX 12 SDK</li>
<li>Targeta gràfica compatible amb DirectX Raytracing (DXR)</li>
<li>Entorn de desenvolupament configurat (Visual Studio)</li>
</ul>
</div><h2>Inicialització de DXR</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gSW5jbG91cmUgbGVzIGxsaWJyZXJpZXMgbmVjZXNzw6ByaWVzCiNpbmNsdWRlIDxkM2QxMi5oPgojaW5jbHVkZSA8ZHhnaTFfNC5oPgojaW5jbHVkZSA8ZDNkMTJzaGFkZXIuaD4KI2luY2x1ZGUgPGR4Y2FwaS5oPgoKLy8gSW5pY2lhbGl0emFyIGVsIGRpc3Bvc2l0aXUgRFhSCkNvbVB0cjxJRDNEMTJEZXZpY2U1PiBkeHJEZXZpY2U7CkQzRDEyQ3JlYXRlRGV2aWNlKG51bGxwdHIsIEQzRF9GRUFUVVJFX0xFVkVMXzEyXzEsIElJRF9QUFZfQVJHUygmZHhyRGV2aWNlKSk7CgovLyBDcmVhciBsYSBkZXNjcmlwY2nDsyBkZWwgcGlwZWxpbmUgZGUgdHJhw6dhdCBkZSByYWlncwpEM0QxMl9TVEFURV9PQkpFQ1RfREVTQyByYXl0cmFjaW5nUGlwZWxpbmVEZXNjID0ge307CnJheXRyYWNpbmdQaXBlbGluZURlc2MuVHlwZSA9IEQzRDEyX1NUQVRFX09CSkVDVF9UWVBFX1JBWVRSQUNJTkdfUElQRUxJTkU7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Incloure les llibreries necess&agrave;ries
#include &lt;d3d12.h&gt;
#include &lt;dxgi1_4.h&gt;
#include &lt;d3d12shader.h&gt;
#include &lt;dxcapi.h&gt;

// Inicialitzar el dispositiu DXR
ComPtr&lt;ID3D12Device5&gt; dxrDevice;
D3D12CreateDevice(nullptr, D3D_FEATURE_LEVEL_12_1, IID_PPV_ARGS(&amp;dxrDevice));

// Crear la descripci&oacute; del pipeline de tra&ccedil;at de raigs
D3D12_STATE_OBJECT_DESC raytracingPipelineDesc = {};
raytracingPipelineDesc.Type = D3D12_STATE_OBJECT_TYPE_RAYTRACING_PIPELINE;</pre></div><div class='content'></div><h1>Escriure Shaders per al Traçat de Raigs</h1>
<div class='content'></div><h2>Shader de Raig de Generació</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gUmF5IEdlbmVyYXRpb24gU2hhZGVyCltzaGFkZXIoInJheWdlbmVyYXRpb24iKV0Kdm9pZCBSYXlHZW5TaGFkZXIoKQp7CiAgICAvLyBDb2RpIHBlciBnZW5lcmFyIHJhaWdzIHByaW1hcmlzCiAgICBSYXlEZXNjIHJheTsKICAgIHJheS5PcmlnaW4gPSBjYW1lcmFQb3NpdGlvbjsKICAgIHJheS5EaXJlY3Rpb24gPSBjYWxjdWxhdGVSYXlEaXJlY3Rpb24oKTsKICAgIFRyYWNlUmF5KHJheSk7Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Ray Generation Shader
[shader(&quot;raygeneration&quot;)]
void RayGenShader()
{
    // Codi per generar raigs primaris
    RayDesc ray;
    ray.Origin = cameraPosition;
    ray.Direction = calculateRayDirection();
    TraceRay(ray);
}</pre></div><div class='content'></div><h2>Shader de Raig de Col·lisió</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gQ2xvc2VzdCBIaXQgU2hhZGVyCltzaGFkZXIoImNsb3Nlc3RoaXQiKV0Kdm9pZCBDbG9zZXN0SGl0U2hhZGVyKCkKewogICAgLy8gQ29kaSBwZXIgZ2VzdGlvbmFyIGxhIGludGVyc2VjY2nDsyBkZWwgcmFpZyBhbWIgdW4gb2JqZWN0ZQogICAgZmxvYXQzIGhpdFBvc2l0aW9uID0gY2FsY3VsYXRlSGl0UG9zaXRpb24oKTsKICAgIGZsb2F0MyBub3JtYWwgPSBjYWxjdWxhdGVOb3JtYWwoKTsKICAgIGZsb2F0MyBjb2xvciA9IGNhbGN1bGF0ZUNvbG9yKGhpdFBvc2l0aW9uLCBub3JtYWwpOwogICAgb3V0cHV0Q29sb3IgPSBjb2xvcjsKfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Closest Hit Shader
[shader(&quot;closesthit&quot;)]
void ClosestHitShader()
{
    // Codi per gestionar la intersecci&oacute; del raig amb un objecte
    float3 hitPosition = calculateHitPosition();
    float3 normal = calculateNormal();
    float3 color = calculateColor(hitPosition, normal);
    outputColor = color;
}</pre></div><div class='content'></div><h1>Compilar i Utilitzar Shaders</h1>
<div class='content'></div><h2>Compilació de Shaders</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gVXRpbGl0emFyIGVsIGNvbXBpbGFkb3IgRFhDIHBlciBjb21waWxhciBlbHMgc2hhZGVycwpDb21QdHI8SUR4Y0NvbXBpbGVyPiBjb21waWxlcjsKRHhjQ3JlYXRlSW5zdGFuY2UoQ0xTSURfRHhjQ29tcGlsZXIsIElJRF9QUFZfQVJHUygmY29tcGlsZXIpKTsKCkNvbVB0cjxJRHhjQmxvYj4gcmF5R2VuU2hhZGVyQmxvYjsKY29tcGlsZXItPkNvbXBpbGUocmF5R2VuU2hhZGVyU291cmNlLCBMIlJheUdlblNoYWRlci5obHNsIiwgTCJSYXlHZW5TaGFkZXIiLCBMImxpYl82XzMiLCBudWxscHRyLCAwLCBudWxscHRyLCAwLCBudWxscHRyLCAmcmF5R2VuU2hhZGVyQmxvYik7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Utilitzar el compilador DXC per compilar els shaders
ComPtr&lt;IDxcCompiler&gt; compiler;
DxcCreateInstance(CLSID_DxcCompiler, IID_PPV_ARGS(&amp;compiler));

ComPtr&lt;IDxcBlob&gt; rayGenShaderBlob;
compiler-&gt;Compile(rayGenShaderSource, L&quot;RayGenShader.hlsl&quot;, L&quot;RayGenShader&quot;, L&quot;lib_6_3&quot;, nullptr, 0, nullptr, 0, nullptr, &amp;rayGenShaderBlob);</pre></div><div class='content'></div><h2>Configuració del Pipeline</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gQ29uZmlndXJhciBlbCBwaXBlbGluZSBkZSB0cmHDp2F0IGRlIHJhaWdzCkQzRDEyX1NUQVRFX1NVQk9CSkVDVCByYXlHZW5TaGFkZXJTdWJvYmplY3QgPSB7fTsKcmF5R2VuU2hhZGVyU3Vib2JqZWN0LlR5cGUgPSBEM0QxMl9TVEFURV9TVUJPQkpFQ1RfVFlQRV9EWElMX0xJQlJBUlk7CnJheUdlblNoYWRlclN1Ym9iamVjdC5wRGVzYyA9ICZyYXlHZW5TaGFkZXJEZXNjOwoKcmF5dHJhY2luZ1BpcGVsaW5lRGVzYy5OdW1TdWJvYmplY3RzID0gMTsKcmF5dHJhY2luZ1BpcGVsaW5lRGVzYy5wU3Vib2JqZWN0cyA9ICZyYXlHZW5TaGFkZXJTdWJvYmplY3Q7CgpDb21QdHI8SUQzRDEyU3RhdGVPYmplY3Q+IHJheXRyYWNpbmdQaXBlbGluZTsKZHhyRGV2aWNlLT5DcmVhdGVTdGF0ZU9iamVjdCgmcmF5dHJhY2luZ1BpcGVsaW5lRGVzYywgSUlEX1BQVl9BUkdTKCZyYXl0cmFjaW5nUGlwZWxpbmUpKTs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Configurar el pipeline de tra&ccedil;at de raigs
D3D12_STATE_SUBOBJECT rayGenShaderSubobject = {};
rayGenShaderSubobject.Type = D3D12_STATE_SUBOBJECT_TYPE_DXIL_LIBRARY;
rayGenShaderSubobject.pDesc = &amp;rayGenShaderDesc;

raytracingPipelineDesc.NumSubobjects = 1;
raytracingPipelineDesc.pSubobjects = &amp;rayGenShaderSubobject;

ComPtr&lt;ID3D12StateObject&gt; raytracingPipeline;
dxrDevice-&gt;CreateStateObject(&amp;raytracingPipelineDesc, IID_PPV_ARGS(&amp;raytracingPipeline));</pre></div><div class='content'></div><h1>Exercici Pràctic</h1>
<div class='content'></div><h2>Objectiu</h2>
<div class='content'><p>Implementar un shader de traçat de raigs que generi reflexions en una escena simple.</p>
</div><h2>Passos</h2>
<div class='content'><ol>
<li><strong>Crear una escena amb objectes reflectants</strong>.</li>
<li><strong>Escriure un shader de raig de generació que dispari raigs primaris</strong>.</li>
<li><strong>Escriure un shader de col·lisió que calculi les reflexions</strong>.</li>
<li><strong>Compilar i configurar el pipeline de traçat de raigs</strong>.</li>
<li><strong>Renderitzar l'escena i observar les reflexions</strong>.</li>
</ol>
</div><h2>Solució</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gUmF5IEdlbmVyYXRpb24gU2hhZGVyCltzaGFkZXIoInJheWdlbmVyYXRpb24iKV0Kdm9pZCBSYXlHZW5TaGFkZXIoKQp7CiAgICBSYXlEZXNjIHJheTsKICAgIHJheS5PcmlnaW4gPSBjYW1lcmFQb3NpdGlvbjsKICAgIHJheS5EaXJlY3Rpb24gPSBjYWxjdWxhdGVSYXlEaXJlY3Rpb24oKTsKICAgIFRyYWNlUmF5KHJheSk7Cn0KCi8vIENsb3Nlc3QgSGl0IFNoYWRlcgpbc2hhZGVyKCJjbG9zZXN0aGl0IildCnZvaWQgQ2xvc2VzdEhpdFNoYWRlcigpCnsKICAgIGZsb2F0MyBoaXRQb3NpdGlvbiA9IGNhbGN1bGF0ZUhpdFBvc2l0aW9uKCk7CiAgICBmbG9hdDMgbm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKCk7CiAgICBmbG9hdDMgcmVmbGVjdGlvbkRpcmVjdGlvbiA9IHJlZmxlY3QocmF5LkRpcmVjdGlvbiwgbm9ybWFsKTsKICAgIAogICAgUmF5RGVzYyByZWZsZWN0aW9uUmF5OwogICAgcmVmbGVjdGlvblJheS5PcmlnaW4gPSBoaXRQb3NpdGlvbjsKICAgIHJlZmxlY3Rpb25SYXkuRGlyZWN0aW9uID0gcmVmbGVjdGlvbkRpcmVjdGlvbjsKICAgIAogICAgZmxvYXQzIHJlZmxlY3Rpb25Db2xvciA9IFRyYWNlUmF5KHJlZmxlY3Rpb25SYXkpOwogICAgb3V0cHV0Q29sb3IgPSByZWZsZWN0aW9uQ29sb3I7Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Ray Generation Shader
[shader(&quot;raygeneration&quot;)]
void RayGenShader()
{
    RayDesc ray;
    ray.Origin = cameraPosition;
    ray.Direction = calculateRayDirection();
    TraceRay(ray);
}

// Closest Hit Shader
[shader(&quot;closesthit&quot;)]
void ClosestHitShader()
{
    float3 hitPosition = calculateHitPosition();
    float3 normal = calculateNormal();
    float3 reflectionDirection = reflect(ray.Direction, normal);
    
    RayDesc reflectionRay;
    reflectionRay.Origin = hitPosition;
    reflectionRay.Direction = reflectionDirection;
    
    float3 reflectionColor = TraceRay(reflectionRay);
    outputColor = reflectionColor;
}</pre></div><div class='content'></div><h1>Resum</h1>
<div class='content'><p>En aquesta secció, hem explorat els conceptes bàsics del traçat de raigs i hem implementat shaders per generar raigs i calcular reflexions. Hem après a configurar el pipeline de traçat de raigs i a compilar els shaders necessaris. Aquesta tècnica permet crear imatges amb un alt grau de realisme, simulant efectes complexos de llum com reflexions i refraccions. En el següent mòdul, explorarem altres tècniques avançades de renderització per millorar encara més la qualitat visual de les nostres aplicacions DirectX.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='07-03-tessellation' title="Tessel·lació">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='08-01-building-game-engine' title="Construir un Motor de Joc">Següent &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
