<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestió d'errors en VBA</title>

    <link rel="alternate" href="https://campusempresa.com/mod/vba/04-02-error-handling-vba" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/vba/04-02-error-handling-vba" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/vba/04-02-error-handling-vba" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/vba/04-02-error-handling-vba" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/vba/04-02-error-handling-vba" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Projecte</a>
				<a href="/about">Sobre nosaltres</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donacions</a>
				<a href="/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='04-01-creating-using-functions' title="Crear i utilitzar funcions">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Gestió d'errors en VBA</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='04-03-debugging-techniques' title="Tècniques de depuració">Següent &#x25BA;</a>
			</div>
</div>
<div class='content'><p>La gestió d'errors és una part fonamental de la programació en VBA. Permet que el teu codi pugui manejar situacions inesperades de manera controlada, evitant que l'execució del programa es detingui abruptament. En aquesta secció, aprendrem com gestionar errors en VBA utilitzant diverses tècniques i estructures.</p>
</div><h1><p>Conceptes Clau</p>
</h1>
<div class='content'><ol>
<li><strong>Errors en temps d'execució</strong>: Són errors que es produeixen mentre el codi s'està executant. Aquests errors poden ser deguts a diverses raons, com ara la divisió per zero, l'accés a un índex fora de límits en un array, o la referència a un objecte que no existeix.</li>
<li><strong>Gestió d'errors</strong>: Consisteix en detectar i manejar errors de manera que el programa pugui continuar executant-se o finalitzar de manera controlada.</li>
</ol>
</div><h1><p>Estructures de Gestió d'Errors</p>
</h1>
<div class='content'></div><h2><p>On Error Statement</p>
</h2>
<div class='content'><p>La instrucció <code>On Error</code> s'utilitza per gestionar errors en VBA. Hi ha diverses formes d'utilitzar aquesta instrucció:</p>
<ol>
<li><strong>On Error GoTo [label]</strong>: Redirigeix l'execució del codi a una etiqueta específica quan es produeix un error.</li>
<li><strong>On Error Resume Next</strong>: Continua l'execució del codi a la següent línia després de la línia que ha produït l'error.</li>
<li><strong>On Error GoTo 0</strong>: Desactiva la gestió d'errors en el codi.</li>
</ol>
</div><h2><p>Exemple Pràctic</p>
</h2>
<div class='content'><p>A continuació, es mostra un exemple pràctic de com utilitzar aquestes instruccions per gestionar errors en VBA.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U3ViIEV4ZW1wbGVHZXN0aW9FcnJvcnMoKQogICAgRGltIGRpdmlzb3IgQXMgSW50ZWdlcgogICAgRGltIHJlc3VsdGF0IEFzIERvdWJsZQogICAgCiAgICAnIENvbmZpZ3VyYSBsYSBnZXN0acOzIGQnZXJyb3JzIHBlciByZWRpcmlnaXIgYSBsYSBzZWNjacOzIGQnZXJyb3JzCiAgICBPbiBFcnJvciBHb1RvIEVycm9ySGFuZGxlcgogICAgCiAgICAnIFNvbMK3bGljaXRhIGEgbCd1c3VhcmkgcXVlIGludHJvZHVlaXhpIHVuIG7Dum1lcm8KICAgIGRpdmlzb3IgPSBJbnB1dEJveCgiSW50cm9kdWVpeCB1biBuw7ptZXJvIHBlciBkaXZpZGlyIDEwMDoiKQogICAgCiAgICAnIFJlYWxpdHphIGxhIGRpdmlzacOzCiAgICByZXN1bHRhdCA9IDEwMCAvIGRpdmlzb3IKICAgIE1zZ0JveCAiRWwgcmVzdWx0YXQgw6lzICIgJiByZXN1bHRhdAogICAgCiAgICAnIEZpbmFsaXR6YSBsYSBzdWJydXRpbmEKICAgIEV4aXQgU3ViCiAgICAKRXJyb3JIYW5kbGVyOgogICAgJyBNb3N0cmEgdW4gbWlzc2F0Z2UgZCdlcnJvcgogICAgTXNnQm94ICJTJ2hhIHByb2R1w690IHVuIGVycm9yOiAiICYgRXJyLkRlc2NyaXB0aW9uCiAgICAnIENvbnRpbnVhIGwnZXhlY3VjacOzIGRlbCBjb2RpCiAgICBSZXN1bWUgTmV4dApFbmQgU3Vi"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Sub ExempleGestioErrors()
    Dim divisor As Integer
    Dim resultat As Double
    
    ' Configura la gesti&oacute; d'errors per redirigir a la secci&oacute; d'errors
    On Error GoTo ErrorHandler
    
    ' Sol&middot;licita a l'usuari que introdueixi un n&uacute;mero
    divisor = InputBox(&quot;Introdueix un n&uacute;mero per dividir 100:&quot;)
    
    ' Realitza la divisi&oacute;
    resultat = 100 / divisor
    MsgBox &quot;El resultat &eacute;s &quot; &amp; resultat
    
    ' Finalitza la subrutina
    Exit Sub
    
ErrorHandler:
    ' Mostra un missatge d'error
    MsgBox &quot;S'ha produ&iuml;t un error: &quot; &amp; Err.Description
    ' Continua l'execuci&oacute; del codi
    Resume Next
End Sub</pre></div><div class='content'></div><h2><p>Explicació del Codi</p>
</h2>
<div class='content'><ol>
<li><strong>On Error GoTo ErrorHandler</strong>: Configura la gestió d'errors per redirigir l'execució a l'etiqueta <code>ErrorHandler</code> si es produeix un error.</li>
<li><strong>InputBox</strong>: Sol·licita a l'usuari que introdueixi un número.</li>
<li><strong>Divisió</strong>: Realitza la divisió de 100 pel número introduït per l'usuari.</li>
<li><strong>ErrorHandler</strong>: Si es produeix un error (per exemple, si l'usuari introdueix zero), l'execució es redirigeix aquí. Es mostra un missatge d'error amb la descripció de l'error i es continua l'execució del codi amb <code>Resume Next</code>.</li>
</ol>
</div><h1><p>Exercicis Pràctics</p>
</h1>
<div class='content'></div><h2><p>Exercici 1: Gestió d'Errors Bàsica</p>
</h2>
<div class='content'><p>Escriu una subrutina que sol·liciti a l'usuari que introdueixi dos números i mostri el resultat de la seva divisió. Implementa la gestió d'errors per manejar la divisió per zero.</p>
<h4>Solució</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U3ViIERpdmlzaW9BbWJHZXN0aW9FcnJvcnMoKQogICAgRGltIG51bTEgQXMgRG91YmxlCiAgICBEaW0gbnVtMiBBcyBEb3VibGUKICAgIERpbSByZXN1bHRhdCBBcyBEb3VibGUKICAgIAogICAgT24gRXJyb3IgR29UbyBFcnJvckhhbmRsZXIKICAgIAogICAgbnVtMSA9IElucHV0Qm94KCJJbnRyb2R1ZWl4IGVsIHByaW1lciBuw7ptZXJvOiIpCiAgICBudW0yID0gSW5wdXRCb3goIkludHJvZHVlaXggZWwgc2Vnb24gbsO6bWVybzoiKQogICAgCiAgICByZXN1bHRhdCA9IG51bTEgLyBudW0yCiAgICBNc2dCb3ggIkVsIHJlc3VsdGF0IMOpcyAiICYgcmVzdWx0YXQKICAgIAogICAgRXhpdCBTdWIKICAgIApFcnJvckhhbmRsZXI6CiAgICBNc2dCb3ggIkVycm9yOiBObyBlcyBwb3QgZGl2aWRpciBwZXIgemVyby4iCiAgICBSZXN1bWUgTmV4dApFbmQgU3Vi"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Sub DivisioAmbGestioErrors()
    Dim num1 As Double
    Dim num2 As Double
    Dim resultat As Double
    
    On Error GoTo ErrorHandler
    
    num1 = InputBox(&quot;Introdueix el primer n&uacute;mero:&quot;)
    num2 = InputBox(&quot;Introdueix el segon n&uacute;mero:&quot;)
    
    resultat = num1 / num2
    MsgBox &quot;El resultat &eacute;s &quot; &amp; resultat
    
    Exit Sub
    
ErrorHandler:
    MsgBox &quot;Error: No es pot dividir per zero.&quot;
    Resume Next
End Sub</pre></div><div class='content'></div><h2><p>Exercici 2: Gestió d'Errors Avançada</p>
</h2>
<div class='content'><p>Escriu una subrutina que llegeixi valors d'un rang de cel·les en un full de càlcul i calculi la mitjana. Implementa la gestió d'errors per manejar cel·les buides o valors no numèrics.</p>
<h4>Solució</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U3ViIENhbGN1bGFNaXRqYW5hQW1iR2VzdGlvRXJyb3JzKCkKICAgIERpbSBybmcgQXMgUmFuZ2UKICAgIERpbSBjZWzCt2xhIEFzIFJhbmdlCiAgICBEaW0gc3VtYSBBcyBEb3VibGUKICAgIERpbSBjb21wdGFkb3IgQXMgSW50ZWdlcgogICAgRGltIG1pdGphbmEgQXMgRG91YmxlCiAgICAKICAgIE9uIEVycm9yIFJlc3VtZSBOZXh0CiAgICAKICAgIFNldCBybmcgPSBSYW5nZSgiQTE6QTEwIikKICAgIAogICAgRm9yIEVhY2ggY2VswrdsYSBJbiBybmcKICAgICAgICBJZiBJc051bWVyaWMoY2VswrdsYS5WYWx1ZSkgVGhlbgogICAgICAgICAgICBzdW1hID0gc3VtYSArIGNlbMK3bGEuVmFsdWUKICAgICAgICAgICAgY29tcHRhZG9yID0gY29tcHRhZG9yICsgMQogICAgICAgIEVuZCBJZgogICAgTmV4dCBjZWzCt2xhCiAgICAKICAgIElmIGNvbXB0YWRvciA+IDAgVGhlbgogICAgICAgIG1pdGphbmEgPSBzdW1hIC8gY29tcHRhZG9yCiAgICAgICAgTXNnQm94ICJMYSBtaXRqYW5hIMOpcyAiICYgbWl0amFuYQogICAgRWxzZQogICAgICAgIE1zZ0JveCAiTm8gaGkgaGEgdmFsb3JzIG51bcOocmljcyBlbiBlbCByYW5nIHNlbGVjY2lvbmF0LiIKICAgIEVuZCBJZgpFbmQgU3Vi"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Sub CalculaMitjanaAmbGestioErrors()
    Dim rng As Range
    Dim cel&middot;la As Range
    Dim suma As Double
    Dim comptador As Integer
    Dim mitjana As Double
    
    On Error Resume Next
    
    Set rng = Range(&quot;A1:A10&quot;)
    
    For Each cel&middot;la In rng
        If IsNumeric(cel&middot;la.Value) Then
            suma = suma + cel&middot;la.Value
            comptador = comptador + 1
        End If
    Next cel&middot;la
    
    If comptador &gt; 0 Then
        mitjana = suma / comptador
        MsgBox &quot;La mitjana &eacute;s &quot; &amp; mitjana
    Else
        MsgBox &quot;No hi ha valors num&egrave;rics en el rang seleccionat.&quot;
    End If
End Sub</pre></div><div class='content'></div><h1><p>Errors Comuns i Consells</p>
</h1>
<div class='content'><ol>
<li><strong>Oblidar desactivar la gestió d'errors</strong>: Després de gestionar un error, assegura't de desactivar la gestió d'errors amb <code>On Error GoTo 0</code> per evitar comportaments inesperats.</li>
<li><strong>No proporcionar informació suficient a l'usuari</strong>: Quan es produeix un error, proporciona informació clara i útil a l'usuari sobre què ha anat malament i com pot solucionar-ho.</li>
<li><strong>No utilitzar <code>Resume</code> adequadament</strong>: Utilitza <code>Resume</code> per continuar l'execució del codi després de gestionar un error. <code>Resume Next</code> és útil per saltar a la següent línia de codi, però assegura't que és el comportament desitjat.</li>
</ol>
</div><h1><p>Conclusió</p>
</h1>
<div class='content'><p>La gestió d'errors en VBA és essencial per crear aplicacions robustes i fiables. Mitjançant l'ús de les instruccions <code>On Error</code>, pots detectar i manejar errors de manera controlada, millorant l'experiència de l'usuari i evitant que el teu codi es detingui inesperadament. Practica amb els exercicis proporcionats per consolidar els teus coneixements i estar preparat per gestionar errors en els teus projectes VBA.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='04-01-creating-using-functions' title="Crear i utilitzar funcions">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='04-03-debugging-techniques' title="Tècniques de depuració">Següent &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
