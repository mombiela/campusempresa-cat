<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow, noarchive">
    <title>Comprovacions de salut</title>

    <link rel="alternate" href="https://campusempresa.com/mod/nginx/03-04-health-checks" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/nginx/03-04-health-checks" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/nginx/03-04-health-checks" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css?v=4" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script>var DEVELOP = window.location.href.indexOf("localhost")!=-1 && true;</script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>  	
	</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-0 text-end">
			<p class="mb-0 p-0">	<a href="https://enterprisecampus.net/mod/nginx/03-04-health-checks" class="px-2">EN</a></b>
	|
	<a href="https://campusempresa.com/mod/nginx/03-04-health-checks" class="px-2">ES</a></b>
	|
	<b class="px-2">CA</b>
</p>
			<p class="mb-4 mt-0 mx-2  d-none d-md-block"><cite>Tot el coneixement al teu abast</cite></p>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">El Projecte</a> | 
<a href="/about">Sobre nosaltres</a> | 
<a href="/contribute">Contribuir</a> | 
<a href="/donate">Donacions</a> | 
<a href="/licence">Llicència</a>
		</div>
	</div>
</div>
		<div class="top-bar container-fluid p-0">
	<div class="container-xxl p-0">
		<div class="row">
			<div class="col" id="left_menu">
					<a href="/"  class="nav-link px-3">
		<i class="bi bi-house-fill"></i>
		HOME
	</a>

	<a href="./"  class="nav-link px-3">
		<i class="bi bi-journal-bookmark"></i>
		Contingut del curs
	</a>

			</div>
		</div>
	</div>
</div>

<!--  
<div class="top-bar container-fluid">
	<div class="container-xxl">
		<nav class="navbar navbar-expand-md p-0">
			<div class="container-fluid">
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				
				<div class="collapse navbar-collapse" id="navbarNav">
					<div class="navbar-nav me-auto">
							<a href="/"  class="nav-link px-3">
		<i class="bi bi-house-fill"></i>
		HOME
	</a>

	<a href="./"  class="nav-link px-3">
		<i class="bi bi-journal-bookmark"></i>
		Contingut del curs
	</a>

					</div>
				</div>			
							</div>
		</nav>
	</div>
</div>
 -->				<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
				<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='03-03-load-balancing' title="Balanceig de càrrega">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<h2 style="text-decoration:underline">Comprovacions de salut</h2>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='04-01-basic-security-practices' title="Pràctiques bàsiques de seguretat">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>Les comprovacions de salut són una part essencial de la configuració d'un proxy invers amb NGINX, especialment quan es tracta de balanceig de càrrega. Aquestes comprovacions permeten assegurar-se que els servidors de backend estan funcionant correctament abans de redirigir-hi el trànsit. En aquesta secció, aprendrem com configurar i utilitzar les comprovacions de salut en NGINX.</p>
</div><h1>Conceptes clau</h1>
<div class='content'><ol>
<li><strong>Comprovació de salut activa</strong>: NGINX envia sol·licituds periòdiques als servidors de backend per verificar que estan operatius.</li>
<li><strong>Comprovació de salut passiva</strong>: NGINX monitoritza les respostes dels servidors de backend a les sol·licituds reals dels clients per detectar problemes.</li>
</ol>
</div><h1>Configuració de les comprovacions de salut</h1>
<div class='content'></div><h2>Comprovació de salut activa</h2>
<div class='content'><p>Per configurar comprovacions de salut activa, necessitem el mòdul <code>ngx_http_upstream_hc_module</code>, que està disponible en NGINX Plus. A continuació, es mostra un exemple de configuració:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aHR0cCB7CiAgICB1cHN0cmVhbSBiYWNrZW5kIHsKICAgICAgICBzZXJ2ZXIgYmFja2VuZDEuZXhhbXBsZS5jb207CiAgICAgICAgc2VydmVyIGJhY2tlbmQyLmV4YW1wbGUuY29tOwoKICAgICAgICAjIENvbmZpZ3VyYWNpw7MgZGUgbGEgY29tcHJvdmFjacOzIGRlIHNhbHV0IGFjdGl2YQogICAgICAgIGhlYWx0aF9jaGVjayBpbnRlcnZhbD01cyBmYWlscz0zIHBhc3Nlcz0yOwogICAgfQoKICAgIHNlcnZlciB7CiAgICAgICAgbG9jYXRpb24gLyB7CiAgICAgICAgICAgIHByb3h5X3Bhc3MgaHR0cDovL2JhY2tlbmQ7CiAgICAgICAgfQogICAgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>http {
    upstream backend {
        server backend1.example.com;
        server backend2.example.com;

        # Configuraci&oacute; de la comprovaci&oacute; de salut activa
        health_check interval=5s fails=3 passes=2;
    }

    server {
        location / {
            proxy_pass http://backend;
        }
    }
}</pre></div><div class='content'><p><strong>Explicació del codi:</strong></p>
<ul>
<li><code>interval=5s</code>: NGINX enviarà una sol·licitud de comprovació de salut cada 5 segons.</li>
<li><code>fails=3</code>: Si un servidor de backend falla 3 comprovacions consecutives, serà marcat com a inactiu.</li>
<li><code>passes=2</code>: Si un servidor de backend passa 2 comprovacions consecutives després d'haver estat marcat com a inactiu, serà marcat com a actiu de nou.</li>
</ul>
</div><h2>Comprovació de salut passiva</h2>
<div class='content'><p>Les comprovacions de salut passiva no requereixen configuració addicional, ja que NGINX les realitza automàticament monitoritzant les respostes dels servidors de backend. No obstant això, podem ajustar alguns paràmetres per millorar la seva eficàcia:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aHR0cCB7CiAgICB1cHN0cmVhbSBiYWNrZW5kIHsKICAgICAgICBzZXJ2ZXIgYmFja2VuZDEuZXhhbXBsZS5jb207CiAgICAgICAgc2VydmVyIGJhY2tlbmQyLmV4YW1wbGUuY29tOwoKICAgICAgICAjIENvbmZpZ3VyYWNpw7MgZGUgbGEgY29tcHJvdmFjacOzIGRlIHNhbHV0IHBhc3NpdmEKICAgICAgICBwcm94eV9uZXh0X3Vwc3RyZWFtIGVycm9yIHRpbWVvdXQgaHR0cF81MDAgaHR0cF81MDIgaHR0cF81MDMgaHR0cF81MDQ7CiAgICB9CgogICAgc2VydmVyIHsKICAgICAgICBsb2NhdGlvbiAvIHsKICAgICAgICAgICAgcHJveHlfcGFzcyBodHRwOi8vYmFja2VuZDsKICAgICAgICB9CiAgICB9Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>http {
    upstream backend {
        server backend1.example.com;
        server backend2.example.com;

        # Configuraci&oacute; de la comprovaci&oacute; de salut passiva
        proxy_next_upstream error timeout http_500 http_502 http_503 http_504;
    }

    server {
        location / {
            proxy_pass http://backend;
        }
    }
}</pre></div><div class='content'><p><strong>Explicació del codi:</strong></p>
<ul>
<li><code>proxy_next_upstream</code>: Defineix les condicions sota les quals NGINX redirigirà la sol·licitud a un altre servidor de backend. En aquest cas, si es produeix un error, un temps d'espera o un codi de resposta HTTP 5xx, NGINX redirigirà la sol·licitud a un altre servidor.</li>
</ul>
</div><h1>Exercici pràctic</h1>
<div class='content'></div><h2>Objectiu</h2>
<div class='content'><p>Configurar comprovacions de salut activa i passiva per a un grup de servidors de backend.</p>
</div><h2>Passos</h2>
<div class='content'><ol>
<li>
<p><strong>Crea un fitxer de configuració per a NGINX</strong>:</p>
<pre><code class="language-nginx">http {
    upstream backend {
        server backend1.example.com;
        server backend2.example.com;

        # Configuració de la comprovació de salut activa
        health_check interval=10s fails=2 passes=1;

        # Configuració de la comprovació de salut passiva
        proxy_next_upstream error timeout http_500 http_502 http_503 http_504;
    }

    server {
        listen 80;
        location / {
            proxy_pass http://backend;
        }
    }
}
</code></pre>
</li>
<li>
<p><strong>Guarda el fitxer i reinicia NGINX</strong>:</p>
<pre><code class="language-bash">sudo nginx -s reload
</code></pre>
</li>
<li>
<p><strong>Verifica que les comprovacions de salut estan funcionant</strong>:</p>
<ul>
<li>Accedeix al teu servidor NGINX i revisa els logs per assegurar-te que les comprovacions de salut s'estan realitzant correctament.</li>
<li>Simula una fallada en un dels servidors de backend i observa com NGINX redirigeix el trànsit a l'altre servidor.</li>
</ul>
</li>
</ol>
</div><h2>Solució</h2>
<div class='content'><p>El codi proporcionat anteriorment ja conté la solució per configurar les comprovacions de salut activa i passiva. Assegura't de substituir <code>backend1.example.com</code> i <code>backend2.example.com</code> amb els teus servidors de backend reals.</p>
</div><h1>Errors comuns i consells</h1>
<div class='content'><ul>
<li><strong>Error: &quot;unknown directive 'health_check'&quot;</strong>: Això indica que estàs utilitzant una versió de NGINX que no inclou el mòdul <code>ngx_http_upstream_hc_module</code>. Assegura't d'utilitzar NGINX Plus o compila NGINX amb el mòdul necessari.</li>
<li><strong>Consell</strong>: Ajusta els intervals i els paràmetres de les comprovacions de salut segons les necessitats del teu entorn per evitar falsos positius o negatius.</li>
</ul>
</div><h1>Conclusió</h1>
<div class='content'><p>Les comprovacions de salut són una eina poderosa per assegurar la disponibilitat i la fiabilitat dels teus servidors de backend. Amb NGINX, pots configurar tant comprovacions de salut activa com passiva per monitoritzar l'estat dels teus servidors i redirigir el trànsit de manera eficient en cas de fallades. En la següent secció, explorarem pràctiques bàsiques de seguretat per protegir el teu entorn NGINX.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='03-03-load-balancing' title="Balanceig de càrrega">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='04-01-basic-security-practices' title="Pràctiques bàsiques de seguretat">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
				<!-- 
	<h1>Publicitat</h1>
	<p>Aquest espai està destinat a publicitat.</p>
	<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
	<p>Gràcies per col·laborar!</p>
	 -->
			
	<div class="container mt-2 d-none d-md-block index">
		<h1>Curs de NGINX</h1>
<h2>Mòdul 1: Introducció a NGINX</h2>
<ul>
<li><a href="01-01-what-is-nginx">Què és NGINX?</a></li>
<li><a href="01-02-installing-nginx">Instal·lant NGINX</a></li>
<li><a href="01-03-basic-nginx-configuration">Configuració bàsica de NGINX</a></li>
<li><a href="01-04-starting-stopping-nginx">Iniciant i aturant NGINX</a></li>
</ul>
<h2>Mòdul 2: NGINX com a servidor web</h2>
<ul>
<li><a href="02-01-serving-static-content">Servint contingut estàtic</a></li>
<li><a href="02-02-directory-listings">Llistats de directoris</a></li>
<li><a href="02-03-custom-error-pages">Pàgines d'error personalitzades</a></li>
<li><a href="02-04-logging-log-formats">Registre i formats de registre</a></li>
</ul>
<h2>Mòdul 3: NGINX com a proxy invers</h2>
<ul>
<li><a href="03-01-introduction-reverse-proxy">Introducció al proxy invers</a></li>
<li><a href="03-02-configuring-reverse-proxy">Configurant un proxy invers</a></li>
<li><a href="03-03-load-balancing">Balanceig de càrrega</a></li>
<li><a href="03-04-health-checks">Comprovacions de salut</a></li>
</ul>
<h2>Mòdul 4: Seguretat i optimització</h2>
<ul>
<li><a href="04-01-basic-security-practices">Pràctiques bàsiques de seguretat</a></li>
<li><a href="04-02-rate-limiting">Limitació de velocitat</a></li>
<li><a href="04-03-ssl-tls-configuration">Configuració SSL/TLS</a></li>
<li><a href="04-04-caching">Caché</a></li>
</ul>
<h2>Mòdul 5: Funcions avançades de NGINX</h2>
<ul>
<li><a href="05-01-nginx-modules">Mòduls de NGINX</a></li>
<li><a href="05-02-using-nginx-docker">Utilitzant NGINX amb Docker</a></li>
<li><a href="05-03-nginx-http2">NGINX i HTTP/2</a></li>
<li><a href="05-04-nginx-grpc">NGINX i gRPC</a></li>
</ul>
<h2>Mòdul 6: Monitorització i resolució de problemes</h2>
<ul>
<li><a href="06-01-monitoring-nginx">Monitoritzant NGINX</a></li>
<li><a href="06-02-common-issues-solutions">Problemes comuns i solucions</a></li>
<li><a href="06-03-performance-tuning">Optimització del rendiment</a></li>
<li><a href="06-04-debugging-nginx">Depurant NGINX</a></li>
</ul>
<h2>Mòdul 7: NGINX Plus</h2>
<ul>
<li><a href="07-01-introduction-nginx-plus">Introducció a NGINX Plus</a></li>
<li><a href="07-02-advanced-load-balancing">Balanceig de càrrega avançat</a></li>
<li><a href="07-03-application-health-monitoring">Monitorització de la salut de l'aplicació</a></li>
<li><a href="07-04-dynamic-configuration">Configuració dinàmica</a></li>
</ul>

	</div>










		</div>
	</div>
</div>		
<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">El Projecte</a> | 
<a href="/about">Sobre nosaltres</a> | 
<a href="/contribute">Contribuir</a> | 
<a href="/donate">Donacions</a> | 
<a href="/licence">Llicència</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
