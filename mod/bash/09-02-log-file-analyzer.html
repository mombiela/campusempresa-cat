<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projecte 2: Analitzador de Fitxers de Registre</title>

    <link rel="alternate" href="https://campusempresa.com/mod/bash/09-02-log-file-analyzer" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/bash/09-02-log-file-analyzer" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/bash/09-02-log-file-analyzer" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/bash/09-02-log-file-analyzer" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/bash/09-02-log-file-analyzer" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<!-- <a href="/">Home</a>  -->
									<a href="./">Contingut del curs</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Competències tècniques</a>
				<a href="/all/conocimientos">Coneixements</a>
				<a href="/all/soft_skills">Competències socials</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='09-01-system-information-script' title="Projecte 1: Script d'Informació del Sistema">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Projecte 2: Analitzador de Fitxers de Registre</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='09-03-automated-backup-system' title="Projecte 3: Sistema de Còpia de Seguretat Automatitzat">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>En aquest projecte, crearem un script en Bash que analitzi fitxers de registre (logs) per extreure informació útil. Els fitxers de registre són essencials per monitoritzar el comportament del sistema, detectar errors i analitzar l'ús de recursos. Aquest projecte ens permetrà aplicar molts dels conceptes apresos en els mòduls anteriors.</p>
</div><h1><p>Objectius del Projecte</p>
</h1>
<div class='content'><ol>
<li><strong>Llegir i processar fitxers de registre.</strong></li>
<li><strong>Filtrar i cercar informació específica.</strong></li>
<li><strong>Generar informes resum.</strong></li>
<li><strong>Automatitzar l'anàlisi de registres.</strong></li>
</ol>
</div><h1><p>Requisits Previs</p>
</h1>
<div class='content'><p>Abans de començar, assegura't de tenir coneixements bàsics sobre:</p>
<ul>
<li>Comandes bàsiques de Bash.</li>
<li>Manipulació de cadenes.</li>
<li>Redirecció i piping.</li>
<li>Expressions regulars.</li>
</ul>
</div><h1><p>Estructura del Projecte</p>
</h1>
<div class='content'><ol>
<li><strong>Lectura del Fitxer de Registre</strong></li>
<li><strong>Filtratge de Dades</strong></li>
<li><strong>Generació d'Informes</strong></li>
<li><strong>Automatització</strong></li>
</ol>
</div><h1><ol>
<li>Lectura del Fitxer de Registre</li>
</ol>
</h1>
<div class='content'></div><h2><p>Exemple de Fitxer de Registre</p>
</h2>
<div class='content'><p>Suposem que tenim un fitxer de registre anomenat <code>system.log</code> amb el següent contingut:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("SmFuIDEwIDEwOjAwOjAxIHNlcnZlcjEgQ1JPTlsxMjM0NV06IChyb290KSBDTUQgKHJ1bi1wYXJ0cyAvZXRjL2Nyb24uZGFpbHkpCkphbiAxMCAxMDowNTo0MyBzZXJ2ZXIxIHNzaGRbMTIzNDZdOiBGYWlsZWQgcGFzc3dvcmQgZm9yIGludmFsaWQgdXNlciBhZG1pbiBmcm9tIDE5Mi4xNjguMS4xMDAgcG9ydCAyMiBzc2gyCkphbiAxMCAxMDoxMDoyMiBzZXJ2ZXIxIHNzaGRbMTIzNDddOiBBY2NlcHRlZCBwYXNzd29yZCBmb3IgdXNlcjEgZnJvbSAxOTIuMTY4LjEuMTAxIHBvcnQgMjIgc3NoMgpKYW4gMTAgMTA6MTU6MDEgc2VydmVyMSBDUk9OWzEyMzQ4XTogKHJvb3QpIENNRCAocnVuLXBhcnRzIC9ldGMvY3Jvbi5ob3VybHkp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Jan 10 10:00:01 server1 CRON[12345]: (root) CMD (run-parts /etc/cron.daily)
Jan 10 10:05:43 server1 sshd[12346]: Failed password for invalid user admin from 192.168.1.100 port 22 ssh2
Jan 10 10:10:22 server1 sshd[12347]: Accepted password for user1 from 192.168.1.101 port 22 ssh2
Jan 10 10:15:01 server1 CRON[12348]: (root) CMD (run-parts /etc/cron.hourly)</pre></div><div class='content'></div><h2><p>Script per Llegir el Fitxer</p>
</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyEvYmluL2Jhc2gKCiMgQ29tcHJvdmEgc2kgZWwgZml0eGVyIGRlIHJlZ2lzdHJlIGV4aXN0ZWl4CkxPR19GSUxFPSJzeXN0ZW0ubG9nIgppZiBbWyAhIC1mICIkTE9HX0ZJTEUiIF1dOyB0aGVuCiAgICBlY2hvICJFbCBmaXR4ZXIgZGUgcmVnaXN0cmUgJExPR19GSUxFIG5vIGV4aXN0ZWl4LiIKICAgIGV4aXQgMQpmaQoKIyBMbGVnZWl4IGVsIGZpdHhlciBkZSByZWdpc3RyZQp3aGlsZSBJRlM9IHJlYWQgLXIgbGluZTsgZG8KICAgIGVjaG8gIiRsaW5lIgpkb25lIDwgIiRMT0dfRklMRSI="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#!/bin/bash

# Comprova si el fitxer de registre existeix
LOG_FILE=&quot;system.log&quot;
if [[ ! -f &quot;$LOG_FILE&quot; ]]; then
    echo &quot;El fitxer de registre $LOG_FILE no existeix.&quot;
    exit 1
fi

# Llegeix el fitxer de registre
while IFS= read -r line; do
    echo &quot;$line&quot;
done &lt; &quot;$LOG_FILE&quot;</pre></div><div class='content'></div><h2><p>Explicació del Codi</p>
</h2>
<div class='content'><ul>
<li><code>LOG_FILE=&quot;system.log&quot;</code>: Defineix el nom del fitxer de registre.</li>
<li><code>if [[ ! -f &quot;$LOG_FILE&quot; ]]; then ... fi</code>: Comprova si el fitxer de registre existeix.</li>
<li><code>while IFS= read -r line; do ... done &lt; &quot;$LOG_FILE&quot;</code>: Llegeix cada línia del fitxer de registre i la mostra per pantalla.</li>
</ul>
</div><h1><ol start="2">
<li>Filtratge de Dades</li>
</ol>
</h1>
<div class='content'></div><h2><p>Filtrar per Paraula Clau</p>
</h2>
<div class='content'><p>Suposem que volem filtrar les línies que contenen la paraula &quot;sshd&quot;.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyEvYmluL2Jhc2gKCkxPR19GSUxFPSJzeXN0ZW0ubG9nIgppZiBbWyAhIC1mICIkTE9HX0ZJTEUiIF1dOyB0aGVuCiAgICBlY2hvICJFbCBmaXR4ZXIgZGUgcmVnaXN0cmUgJExPR19GSUxFIG5vIGV4aXN0ZWl4LiIKICAgIGV4aXQgMQpmaQoKIyBGaWx0cmEgbGVzIGzDrW5pZXMgcXVlIGNvbnRlbmVuICJzc2hkIgpncmVwICJzc2hkIiAiJExPR19GSUxFIg=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#!/bin/bash

LOG_FILE=&quot;system.log&quot;
if [[ ! -f &quot;$LOG_FILE&quot; ]]; then
    echo &quot;El fitxer de registre $LOG_FILE no existeix.&quot;
    exit 1
fi

# Filtra les l&iacute;nies que contenen &quot;sshd&quot;
grep &quot;sshd&quot; &quot;$LOG_FILE&quot;</pre></div><div class='content'></div><h2><p>Explicació del Codi</p>
</h2>
<div class='content'><ul>
<li><code>grep &quot;sshd&quot; &quot;$LOG_FILE&quot;</code>: Utilitza <code>grep</code> per cercar i mostrar les línies que contenen la paraula &quot;sshd&quot;.</li>
</ul>
</div><h1><ol start="3">
<li>Generació d'Informes</li>
</ol>
</h1>
<div class='content'></div><h2><p>Comptar Incidències de SSH</p>
</h2>
<div class='content'><p>Podem comptar quantes vegades s'ha intentat accedir al sistema via SSH.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyEvYmluL2Jhc2gKCkxPR19GSUxFPSJzeXN0ZW0ubG9nIgppZiBbWyAhIC1mICIkTE9HX0ZJTEUiIF1dOyB0aGVuCiAgICBlY2hvICJFbCBmaXR4ZXIgZGUgcmVnaXN0cmUgJExPR19GSUxFIG5vIGV4aXN0ZWl4LiIKICAgIGV4aXQgMQpmaQoKIyBDb21wdGFyIGluY2lkw6huY2llcyBkZSBTU0gKc3NoX2F0dGVtcHRzPSQoZ3JlcCAtYyAic3NoZCIgIiRMT0dfRklMRSIpCmVjaG8gIk5vbWJyZSBkJ2ludGVudHMgZCdhY2PDqXMgdmlhIFNTSDogJHNzaF9hdHRlbXB0cyI="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#!/bin/bash

LOG_FILE=&quot;system.log&quot;
if [[ ! -f &quot;$LOG_FILE&quot; ]]; then
    echo &quot;El fitxer de registre $LOG_FILE no existeix.&quot;
    exit 1
fi

# Comptar incid&egrave;ncies de SSH
ssh_attempts=$(grep -c &quot;sshd&quot; &quot;$LOG_FILE&quot;)
echo &quot;Nombre d'intents d'acc&eacute;s via SSH: $ssh_attempts&quot;</pre></div><div class='content'></div><h2><p>Explicació del Codi</p>
</h2>
<div class='content'><ul>
<li><code>ssh_attempts=$(grep -c &quot;sshd&quot; &quot;$LOG_FILE&quot;)</code>: Utilitza <code>grep -c</code> per comptar les línies que contenen &quot;sshd&quot; i emmagatzema el resultat a la variable <code>ssh_attempts</code>.</li>
<li><code>echo &quot;Nombre d'intents d'accés via SSH: $ssh_attempts&quot;</code>: Mostra el nombre d'intents d'accés via SSH.</li>
</ul>
</div><h1><ol start="4">
<li>Automatització</li>
</ol>
</h1>
<div class='content'></div><h2><p>Executar l'Anàlisi Automàticament</p>
</h2>
<div class='content'><p>Podem programar l'execució de l'script per analitzar els registres de manera automàtica utilitzant <code>cron</code>.</p>
</div><h2><p>Exemple de Crontab</p>
</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBFZGl0YSBlbCBjcm9udGFiIGFtYiBsYSBjb21hbmRhIGBjcm9udGFiIC1lYCBpIGFmZWdlaXggbGEgc2Vnw7xlbnQgbMOtbmlhOgowICogKiAqICogL3BhdGgvdG8veW91ci9zY3JpcHQuc2ggPj4gL3BhdGgvdG8veW91ci9sb2dfYW5hbHlzaXNfb3V0cHV0LmxvZyAyPiYx"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Edita el crontab amb la comanda `crontab -e` i afegeix la seg&uuml;ent l&iacute;nia:
0 * * * * /path/to/your/script.sh &gt;&gt; /path/to/your/log_analysis_output.log 2&gt;&amp;1</pre></div><div class='content'></div><h2><p>Explicació del Crontab</p>
</h2>
<div class='content'><ul>
<li><code>0 * * * *</code>: Executa l'script cada hora.</li>
<li><code>/path/to/your/script.sh</code>: Ruta completa a l'script.</li>
<li><code>&gt;&gt; /path/to/your/log_analysis_output.log 2&gt;&amp;1</code>: Redirigeix la sortida de l'script a un fitxer de registre.</li>
</ul>
</div><h1><p>Exercici Pràctic</p>
</h1>
<div class='content'></div><h2><p>Descripció</p>
</h2>
<div class='content'><p>Crea un script que:</p>
<ol>
<li>Llegeixi un fitxer de registre.</li>
<li>Filtri les línies que contenen errors (paraula clau &quot;error&quot;).</li>
<li>Compti el nombre d'errors.</li>
<li>Generi un informe amb el nombre d'errors i les línies que contenen errors.</li>
</ol>
</div><h2><p>Solució</p>
</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyEvYmluL2Jhc2gKCkxPR19GSUxFPSJzeXN0ZW0ubG9nIgppZiBbWyAhIC1mICIkTE9HX0ZJTEUiIF1dOyB0aGVuCiAgICBlY2hvICJFbCBmaXR4ZXIgZGUgcmVnaXN0cmUgJExPR19GSUxFIG5vIGV4aXN0ZWl4LiIKICAgIGV4aXQgMQpmaQoKIyBGaWx0cmEgbGVzIGzDrW5pZXMgcXVlIGNvbnRlbmVuICJlcnJvciIKZXJyb3JfbGluZXM9JChncmVwIC1pICJlcnJvciIgIiRMT0dfRklMRSIpCgojIENvbXB0YXIgZWwgbm9tYnJlIGQnZXJyb3JzCmVycm9yX2NvdW50PSQoZWNobyAiJGVycm9yX2xpbmVzIiB8IHdjIC1sKQoKIyBHZW5lcmFyIGwnaW5mb3JtZQplY2hvICJOb21icmUgZCdlcnJvcnM6ICRlcnJvcl9jb3VudCIKZWNobyAiTMOtbmllcyBhbWIgZXJyb3JzOiIKZWNobyAiJGVycm9yX2xpbmVzIg=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#!/bin/bash

LOG_FILE=&quot;system.log&quot;
if [[ ! -f &quot;$LOG_FILE&quot; ]]; then
    echo &quot;El fitxer de registre $LOG_FILE no existeix.&quot;
    exit 1
fi

# Filtra les l&iacute;nies que contenen &quot;error&quot;
error_lines=$(grep -i &quot;error&quot; &quot;$LOG_FILE&quot;)

# Comptar el nombre d'errors
error_count=$(echo &quot;$error_lines&quot; | wc -l)

# Generar l'informe
echo &quot;Nombre d'errors: $error_count&quot;
echo &quot;L&iacute;nies amb errors:&quot;
echo &quot;$error_lines&quot;</pre></div><div class='content'></div><h2><p>Explicació del Codi</p>
</h2>
<div class='content'><ul>
<li><code>error_lines=$(grep -i &quot;error&quot; &quot;$LOG_FILE&quot;)</code>: Filtra les línies que contenen &quot;error&quot; (ignorant majúscules/minúscules) i les emmagatzema a la variable <code>error_lines</code>.</li>
<li><code>error_count=$(echo &quot;$error_lines&quot; | wc -l)</code>: Compta el nombre de línies que contenen errors.</li>
<li><code>echo &quot;Nombre d'errors: $error_count&quot;</code>: Mostra el nombre d'errors.</li>
<li><code>echo &quot;Línies amb errors:&quot;</code>: Mostra un missatge indicant que es llistaran les línies amb errors.</li>
<li><code>echo &quot;$error_lines&quot;</code>: Mostra les línies que contenen errors.</li>
</ul>
</div><h1><p>Conclusió</p>
</h1>
<div class='content'><p>En aquest projecte, hem creat un analitzador de fitxers de registre en Bash que ens permet llegir, filtrar i generar informes sobre els registres del sistema. Hem après a utilitzar comandes bàsiques de Bash, expressions regulars i tècniques d'automatització per analitzar fitxers de registre de manera eficient. Aquest projecte ens prepara per a tasques més avançades d'automatització i monitorització del sistema.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='09-01-system-information-script' title="Projecte 1: Script d'Informació del Sistema">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='09-03-automated-backup-system' title="Projecte 3: Sistema de Còpia de Seguretat Automatitzat">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
