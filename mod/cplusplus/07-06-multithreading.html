<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multifil</title>

    <link rel="alternate" href="https://campusempresa.com/mod/cplusplus/07-06-multithreading" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/cplusplus/07-06-multithreading" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/cplusplus/07-06-multithreading" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 px-0 py-2 py-md-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 px-0 py-2 py-md-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/cplusplus/07-06-multithreading" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/cplusplus/07-06-multithreading" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Projecte</a>
				<a href="/about">Sobre nosaltres</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donacions</a>
				<a href="/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='07-05-lambda-expressions' title="Expressions Lambda">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Multifil</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='08-01-code-optimization-techniques' title="Tècniques d'Optimització de Codi">Següent &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introducció al Multifil</h1>
<div class='content'><p>El multifil (multithreading) és una tècnica de programació que permet executar múltiples fils (threads) de manera concurrent dins d'un mateix procés. Això pot millorar significativament el rendiment d'una aplicació, especialment en sistemes amb múltiples nuclis de CPU.</p>
</div><h2>Conceptes Clau</h2>
<div class='content'><ul>
<li><strong>Fil (Thread)</strong>: Un fil és la unitat més petita d'execució que pot ser gestionada pel sistema operatiu.</li>
<li><strong>Procés</strong>: Un procés és un programa en execució que pot contenir múltiples fils.</li>
<li><strong>Concurrència</strong>: La capacitat d'executar múltiples tasques al mateix temps.</li>
<li><strong>Paral·lelisme</strong>: L'execució simultània de múltiples tasques en diferents nuclis de CPU.</li>
</ul>
</div><h1>Creació de Fils en C++</h1>
<div class='content'><p>En C++, la biblioteca <code>&lt;thread&gt;</code> proporciona les eines necessàries per treballar amb fils. A continuació es mostra un exemple bàsic de com crear i gestionar fils.</p>
</div><h2>Exemple Bàsic</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("I2luY2x1ZGUgPGlvc3RyZWFtPgojaW5jbHVkZSA8dGhyZWFkPgoKLy8gRnVuY2nDsyBxdWUgc2Vyw6AgZXhlY3V0YWRhIGVuIHVuIGZpbCBzZXBhcmF0CnZvaWQgZnVuY2lvRmlsKCkgewogICAgc3RkOjpjb3V0IDw8ICJIb2xhIGRlcyBkZWwgZmlsISIgPDwgc3RkOjplbmRsOwp9CgppbnQgbWFpbigpIHsKICAgIC8vIENyZWFyIHVuIGZpbCBxdWUgZXhlY3V0YSBsYSBmdW5jacOzICdmdW5jaW9GaWwnCiAgICBzdGQ6OnRocmVhZCBmaWwoZnVuY2lvRmlsKTsKCiAgICAvLyBFc3BlcmFyIHF1ZSBlbCBmaWwgYWNhYmkKICAgIGZpbC5qb2luKCk7CgogICAgc3RkOjpjb3V0IDw8ICJIb2xhIGRlcyBkZWwgZmlsIHByaW5jaXBhbCEiIDw8IHN0ZDo6ZW5kbDsKCiAgICByZXR1cm4gMDsKfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#include &lt;iostream&gt;
#include &lt;thread&gt;

// Funci&oacute; que ser&agrave; executada en un fil separat
void funcioFil() {
    std::cout &lt;&lt; &quot;Hola des del fil!&quot; &lt;&lt; std::endl;
}

int main() {
    // Crear un fil que executa la funci&oacute; 'funcioFil'
    std::thread fil(funcioFil);

    // Esperar que el fil acabi
    fil.join();

    std::cout &lt;&lt; &quot;Hola des del fil principal!&quot; &lt;&lt; std::endl;

    return 0;
}</pre></div><div class='content'></div><h2>Explicació del Codi</h2>
<div class='content'><ol>
<li><strong>Incloure la Biblioteca <code>&lt;thread&gt;</code></strong>: Necessària per treballar amb fils.</li>
<li><strong>Funció <code>funcioFil</code></strong>: Aquesta funció serà executada en un fil separat.</li>
<li><strong>Crear un Fil</strong>: Utilitzem el constructor de <code>std::thread</code> per crear un nou fil que executa <code>funcioFil</code>.</li>
<li><strong>Esperar que el Fil Acabi</strong>: Utilitzem <code>join()</code> per esperar que el fil acabi abans de continuar amb el fil principal.</li>
</ol>
</div><h1>Sincronització de Fils</h1>
<div class='content'><p>Quan múltiples fils accedeixen a recursos compartits, és crucial sincronitzar-los per evitar condicions de carrera (race conditions). La biblioteca <code>&lt;mutex&gt;</code> proporciona mecanismes per a la sincronització.</p>
</div><h2>Exemple amb `std::mutex`</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("I2luY2x1ZGUgPGlvc3RyZWFtPgojaW5jbHVkZSA8dGhyZWFkPgojaW5jbHVkZSA8bXV0ZXg+CgpzdGQ6Om11dGV4IG10eDsKCnZvaWQgZnVuY2lvRmlsKGludCBpZCkgewogICAgLy8gQmxvcXVlamFyIGVsIG11dGV4CiAgICBtdHgubG9jaygpOwogICAgc3RkOjpjb3V0IDw8ICJGaWwgIiA8PCBpZCA8PCAiIGVzdMOgIGV4ZWN1dGFudCIgPDwgc3RkOjplbmRsOwogICAgLy8gRGVzYmxvcXVlamFyIGVsIG11dGV4CiAgICBtdHgudW5sb2NrKCk7Cn0KCmludCBtYWluKCkgewogICAgc3RkOjp0aHJlYWQgZmlsc1s1XTsKCiAgICAvLyBDcmVhciA1IGZpbHMKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgNTsgKytpKSB7CiAgICAgICAgZmlsc1tpXSA9IHN0ZDo6dGhyZWFkKGZ1bmNpb0ZpbCwgaSk7CiAgICB9CgogICAgLy8gRXNwZXJhciBxdWUgdG90cyBlbHMgZmlscyBhY2FiaW4KICAgIGZvciAoaW50IGkgPSAwOyBpIDwgNTsgKytpKSB7CiAgICAgICAgZmlsc1tpXS5qb2luKCk7CiAgICB9CgogICAgcmV0dXJuIDA7Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#include &lt;iostream&gt;
#include &lt;thread&gt;
#include &lt;mutex&gt;

std::mutex mtx;

void funcioFil(int id) {
    // Bloquejar el mutex
    mtx.lock();
    std::cout &lt;&lt; &quot;Fil &quot; &lt;&lt; id &lt;&lt; &quot; est&agrave; executant&quot; &lt;&lt; std::endl;
    // Desbloquejar el mutex
    mtx.unlock();
}

int main() {
    std::thread fils[5];

    // Crear 5 fils
    for (int i = 0; i &lt; 5; ++i) {
        fils[i] = std::thread(funcioFil, i);
    }

    // Esperar que tots els fils acabin
    for (int i = 0; i &lt; 5; ++i) {
        fils[i].join();
    }

    return 0;
}</pre></div><div class='content'></div><h2>Explicació del Codi</h2>
<div class='content'><ol>
<li><strong>Incloure la Biblioteca <code>&lt;mutex&gt;</code></strong>: Necessària per treballar amb mutex.</li>
<li><strong>Crear un <code>std::mutex</code></strong>: Un objecte mutex per a la sincronització.</li>
<li><strong>Bloquejar i Desbloquejar el Mutex</strong>: Utilitzem <code>mtx.lock()</code> i <code>mtx.unlock()</code> per assegurar que només un fil accedeixi a la secció crítica al mateix temps.</li>
</ol>
</div><h1>Exercicis Pràctics</h1>
<div class='content'></div><h2>Exercici 1: Crear i Gestionar Fils</h2>
<div class='content'><p><strong>Descripció</strong>: Escriu un programa que creï tres fils, cadascun dels quals imprimeixi un missatge diferent.</p>
<p><strong>Solució</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("I2luY2x1ZGUgPGlvc3RyZWFtPgojaW5jbHVkZSA8dGhyZWFkPgoKdm9pZCBmdW5jaW9GaWwxKCkgewogICAgc3RkOjpjb3V0IDw8ICJGaWwgMSBlc3TDoCBleGVjdXRhbnQiIDw8IHN0ZDo6ZW5kbDsKfQoKdm9pZCBmdW5jaW9GaWwyKCkgewogICAgc3RkOjpjb3V0IDw8ICJGaWwgMiBlc3TDoCBleGVjdXRhbnQiIDw8IHN0ZDo6ZW5kbDsKfQoKdm9pZCBmdW5jaW9GaWwzKCkgewogICAgc3RkOjpjb3V0IDw8ICJGaWwgMyBlc3TDoCBleGVjdXRhbnQiIDw8IHN0ZDo6ZW5kbDsKfQoKaW50IG1haW4oKSB7CiAgICBzdGQ6OnRocmVhZCBmaWwxKGZ1bmNpb0ZpbDEpOwogICAgc3RkOjp0aHJlYWQgZmlsMihmdW5jaW9GaWwyKTsKICAgIHN0ZDo6dGhyZWFkIGZpbDMoZnVuY2lvRmlsMyk7CgogICAgZmlsMS5qb2luKCk7CiAgICBmaWwyLmpvaW4oKTsKICAgIGZpbDMuam9pbigpOwoKICAgIHJldHVybiAwOwp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#include &lt;iostream&gt;
#include &lt;thread&gt;

void funcioFil1() {
    std::cout &lt;&lt; &quot;Fil 1 est&agrave; executant&quot; &lt;&lt; std::endl;
}

void funcioFil2() {
    std::cout &lt;&lt; &quot;Fil 2 est&agrave; executant&quot; &lt;&lt; std::endl;
}

void funcioFil3() {
    std::cout &lt;&lt; &quot;Fil 3 est&agrave; executant&quot; &lt;&lt; std::endl;
}

int main() {
    std::thread fil1(funcioFil1);
    std::thread fil2(funcioFil2);
    std::thread fil3(funcioFil3);

    fil1.join();
    fil2.join();
    fil3.join();

    return 0;
}</pre></div><div class='content'></div><h2>Exercici 2: Sincronització amb `std::mutex`</h2>
<div class='content'><p><strong>Descripció</strong>: Modifica l'exemple anterior per utilitzar un <code>std::mutex</code> per sincronitzar l'accés a la consola.</p>
<p><strong>Solució</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("I2luY2x1ZGUgPGlvc3RyZWFtPgojaW5jbHVkZSA8dGhyZWFkPgojaW5jbHVkZSA8bXV0ZXg+CgpzdGQ6Om11dGV4IG10eDsKCnZvaWQgZnVuY2lvRmlsKGludCBpZCkgewogICAgbXR4LmxvY2soKTsKICAgIHN0ZDo6Y291dCA8PCAiRmlsICIgPDwgaWQgPDwgIiBlc3TDoCBleGVjdXRhbnQiIDw8IHN0ZDo6ZW5kbDsKICAgIG10eC51bmxvY2soKTsKfQoKaW50IG1haW4oKSB7CiAgICBzdGQ6OnRocmVhZCBmaWxzWzNdOwoKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMzsgKytpKSB7CiAgICAgICAgZmlsc1tpXSA9IHN0ZDo6dGhyZWFkKGZ1bmNpb0ZpbCwgaSArIDEpOwogICAgfQoKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMzsgKytpKSB7CiAgICAgICAgZmlsc1tpXS5qb2luKCk7CiAgICB9CgogICAgcmV0dXJuIDA7Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#include &lt;iostream&gt;
#include &lt;thread&gt;
#include &lt;mutex&gt;

std::mutex mtx;

void funcioFil(int id) {
    mtx.lock();
    std::cout &lt;&lt; &quot;Fil &quot; &lt;&lt; id &lt;&lt; &quot; est&agrave; executant&quot; &lt;&lt; std::endl;
    mtx.unlock();
}

int main() {
    std::thread fils[3];

    for (int i = 0; i &lt; 3; ++i) {
        fils[i] = std::thread(funcioFil, i + 1);
    }

    for (int i = 0; i &lt; 3; ++i) {
        fils[i].join();
    }

    return 0;
}</pre></div><div class='content'></div><h1>Errors Comuns i Consells</h1>
<div class='content'><ul>
<li><strong>Oblidar <code>join()</code></strong>: Si no esperes que els fils acabin amb <code>join()</code>, el programa pot acabar abans que els fils hagin completat la seva execució.</li>
<li><strong>Condicions de Carrera</strong>: Sempre utilitza mecanismes de sincronització com <code>std::mutex</code> quan múltiples fils accedeixen a recursos compartits.</li>
<li><strong>Bloqueig de Mutex</strong>: Assegura't de desbloquejar el mutex després d'usar-lo per evitar bloquejos (deadlocks).</li>
</ul>
</div><h1>Conclusió</h1>
<div class='content'><p>El multifil és una tècnica poderosa per millorar el rendiment de les aplicacions, però requereix una gestió acurada per evitar problemes de concurrència. Amb els conceptes i exemples proporcionats, hauríeu de tenir una bona base per començar a treballar amb fils en C++.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='07-05-lambda-expressions' title="Expressions Lambda">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='08-01-code-optimization-techniques' title="Tècniques d'Optimització de Codi">Següent &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
