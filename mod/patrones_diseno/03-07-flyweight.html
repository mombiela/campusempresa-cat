<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flyweight</title>

    <link rel="alternate" href="https://campusempresa.com/mod/patrones_diseno/03-07-flyweight" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/patrones_diseno/03-07-flyweight" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/patrones_diseno/03-07-flyweight" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
							<a href="https://enterprisecampus.net/mod/patrones_diseno/03-07-flyweight" class="px-2">EN</a></b>
				|
				<a href="https://campusempresa.com/mod/patrones_diseno/03-07-flyweight" class="px-2">ES</a></b>
				|
				<b class="px-2">CA</b>
											</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<!-- <a href="/">Home</a>  -->
									<a href="./">Contingut del curs</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Competències tècniques</a>
				<a href="/all/conocimientos">Coneixements</a>
				<a href="/all/soft_skills">Competències socials</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='03-06-facade' title="Facade">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Flyweight</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='03-08-proxy' title="Proxy">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'></div><h1><p>Introducció al Patró Flyweight</p>
</h1>
<div class='content'><p>El patró Flyweight és un patró estructural que té com a objectiu reduir la quantitat de memòria utilitzada per un programa quan es treballa amb un gran nombre d'objectes similars. Aquest patró aconsegueix això compartint parts comunes dels objectes en lloc de mantenir còpies separades per a cada objecte.</p>
</div><h2><p>Conceptes Clau</p>
</h2>
<div class='content'><ul>
<li><strong>Compartició</strong>: El Flyweight permet compartir objectes per reduir l'ús de memòria.</li>
<li><strong>Estat Intrínsec</strong>: Part de l'estat que és compartida entre tots els objectes Flyweight.</li>
<li><strong>Estat Extrínsec</strong>: Part de l'estat que és específica per a cada objecte i no es comparteix.</li>
</ul>
</div><h1><p>Estructura del Patró Flyweight</p>
</h1>
<div class='content'><p>El patró Flyweight es compon de les següents parts:</p>
<ol>
<li><strong>Flyweight</strong>: Interfície que defineix les operacions que poden ser realitzades per l'objecte Flyweight.</li>
<li><strong>ConcreteFlyweight</strong>: Implementació concreta de l'objecte Flyweight que comparteix l'estat intrínsec.</li>
<li><strong>FlyweightFactory</strong>: Crea i gestiona objectes Flyweight. Assegura que els objectes Flyweight es comparteixin correctament.</li>
<li><strong>Client</strong>: Utilitza els objectes Flyweight i gestiona l'estat extrínsec.</li>
</ol>
</div><h2><p>Diagrama UML</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ky0tLS0tLS0tLS0tLS0tLS0tLS0rICAgICAgICAgICstLS0tLS0tLS0tLS0tLS0tLS0tKwp8ICAgRmx5d2VpZ2h0ICAgICAgIHw8LS0tLS0tLS0tfCAgIEZseXdlaWdodEZhY3Rvcnl8CistLS0tLS0tLS0tLS0tLS0tLS0tKyAgICAgICAgICArLS0tLS0tLS0tLS0tLS0tLS0tLSsKfCArb3BlcmF0aW9uKCkgICAgICB8ICAgICAgICAgIHwgK2dldEZseXdlaWdodCgpICAgfAorLS0tLS0tLS0tLS0tLS0tLS0tLSsgICAgICAgICAgKy0tLS0tLS0tLS0tLS0tLS0tLS0rCiAgICAgICAgICAgXgogICAgICAgICAgIHwKICAgICAgICAgICB8CistLS0tLS0tLS0tLS0tLS0tLS0tKwp8Q29uY3JldGVGbHl3ZWlnaHQgIHwKKy0tLS0tLS0tLS0tLS0tLS0tLS0rCnwgK29wZXJhdGlvbigpICAgICAgfAorLS0tLS0tLS0tLS0tLS0tLS0tLSs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>+-------------------+          +-------------------+
|   Flyweight       |&lt;---------|   FlyweightFactory|
+-------------------+          +-------------------+
| +operation()      |          | +getFlyweight()   |
+-------------------+          +-------------------+
           ^
           |
           |
+-------------------+
|ConcreteFlyweight  |
+-------------------+
| +operation()      |
+-------------------+</pre></div><div class='content'></div><h1><p>Implementació en Codi</p>
</h1>
<div class='content'></div><h2><p>Exemple en Java</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gRmx5d2VpZ2h0IEludGVyZmFjZQppbnRlcmZhY2UgRmx5d2VpZ2h0IHsKICAgIHZvaWQgb3BlcmF0aW9uKFN0cmluZyBleHRyaW5zaWNTdGF0ZSk7Cn0KCi8vIENvbmNyZXRlRmx5d2VpZ2h0CmNsYXNzIENvbmNyZXRlRmx5d2VpZ2h0IGltcGxlbWVudHMgRmx5d2VpZ2h0IHsKICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIGludHJpbnNpY1N0YXRlOwoKICAgIHB1YmxpYyBDb25jcmV0ZUZseXdlaWdodChTdHJpbmcgaW50cmluc2ljU3RhdGUpIHsKICAgICAgICB0aGlzLmludHJpbnNpY1N0YXRlID0gaW50cmluc2ljU3RhdGU7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb24oU3RyaW5nIGV4dHJpbnNpY1N0YXRlKSB7CiAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJJbnRyaW5zaWMgU3RhdGU6ICIgKyBpbnRyaW5zaWNTdGF0ZSArICIsIEV4dHJpbnNpYyBTdGF0ZTogIiArIGV4dHJpbnNpY1N0YXRlKTsKICAgIH0KfQoKLy8gRmx5d2VpZ2h0RmFjdG9yeQpjbGFzcyBGbHl3ZWlnaHRGYWN0b3J5IHsKICAgIHByaXZhdGUgZmluYWwgTWFwPFN0cmluZywgRmx5d2VpZ2h0PiBmbHl3ZWlnaHRzID0gbmV3IEhhc2hNYXA8PigpOwoKICAgIHB1YmxpYyBGbHl3ZWlnaHQgZ2V0Rmx5d2VpZ2h0KFN0cmluZyBrZXkpIHsKICAgICAgICBpZiAoIWZseXdlaWdodHMuY29udGFpbnNLZXkoa2V5KSkgewogICAgICAgICAgICBmbHl3ZWlnaHRzLnB1dChrZXksIG5ldyBDb25jcmV0ZUZseXdlaWdodChrZXkpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZseXdlaWdodHMuZ2V0KGtleSk7CiAgICB9Cn0KCi8vIENsaWVudApwdWJsaWMgY2xhc3MgRmx5d2VpZ2h0UGF0dGVybkRlbW8gewogICAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgewogICAgICAgIEZseXdlaWdodEZhY3RvcnkgZmFjdG9yeSA9IG5ldyBGbHl3ZWlnaHRGYWN0b3J5KCk7CgogICAgICAgIEZseXdlaWdodCBmbHl3ZWlnaHQxID0gZmFjdG9yeS5nZXRGbHl3ZWlnaHQoIkEiKTsKICAgICAgICBmbHl3ZWlnaHQxLm9wZXJhdGlvbigiRmlyc3QgQ2FsbCIpOwoKICAgICAgICBGbHl3ZWlnaHQgZmx5d2VpZ2h0MiA9IGZhY3RvcnkuZ2V0Rmx5d2VpZ2h0KCJCIik7CiAgICAgICAgZmx5d2VpZ2h0Mi5vcGVyYXRpb24oIlNlY29uZCBDYWxsIik7CgogICAgICAgIEZseXdlaWdodCBmbHl3ZWlnaHQzID0gZmFjdG9yeS5nZXRGbHl3ZWlnaHQoIkEiKTsKICAgICAgICBmbHl3ZWlnaHQzLm9wZXJhdGlvbigiVGhpcmQgQ2FsbCIpOwogICAgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Flyweight Interface
interface Flyweight {
    void operation(String extrinsicState);
}

// ConcreteFlyweight
class ConcreteFlyweight implements Flyweight {
    private final String intrinsicState;

    public ConcreteFlyweight(String intrinsicState) {
        this.intrinsicState = intrinsicState;
    }

    @Override
    public void operation(String extrinsicState) {
        System.out.println(&quot;Intrinsic State: &quot; + intrinsicState + &quot;, Extrinsic State: &quot; + extrinsicState);
    }
}

// FlyweightFactory
class FlyweightFactory {
    private final Map&lt;String, Flyweight&gt; flyweights = new HashMap&lt;&gt;();

    public Flyweight getFlyweight(String key) {
        if (!flyweights.containsKey(key)) {
            flyweights.put(key, new ConcreteFlyweight(key));
        }
        return flyweights.get(key);
    }
}

// Client
public class FlyweightPatternDemo {
    public static void main(String[] args) {
        FlyweightFactory factory = new FlyweightFactory();

        Flyweight flyweight1 = factory.getFlyweight(&quot;A&quot;);
        flyweight1.operation(&quot;First Call&quot;);

        Flyweight flyweight2 = factory.getFlyweight(&quot;B&quot;);
        flyweight2.operation(&quot;Second Call&quot;);

        Flyweight flyweight3 = factory.getFlyweight(&quot;A&quot;);
        flyweight3.operation(&quot;Third Call&quot;);
    }
}</pre></div><div class='content'></div><h2><p>Explicació del Codi</p>
</h2>
<div class='content'><ol>
<li><strong>Flyweight Interface</strong>: Defineix l'operació <code>operation</code> que accepta l'estat extrínsec com a paràmetre.</li>
<li><strong>ConcreteFlyweight</strong>: Implementa la interfície Flyweight i manté l'estat intrínsec.</li>
<li><strong>FlyweightFactory</strong>: Gestiona la creació i compartició dels objectes Flyweight. Utilitza un <code>Map</code> per emmagatzemar i recuperar els objectes Flyweight.</li>
<li><strong>Client</strong>: Utilitza la fàbrica per obtenir objectes Flyweight i invoca les operacions amb l'estat extrínsec.</li>
</ol>
</div><h1><p>Exercici Pràctic</p>
</h1>
<div class='content'></div><h2><p>Enunciat</p>
</h2>
<div class='content'><p>Implementa el patró Flyweight per gestionar un sistema de caràcters en un editor de text. Cada caràcter ha de ser un objecte Flyweight que comparteix l'estat intrínsec (el caràcter en si) i té un estat extrínsec (la posició en el text).</p>
</div><h2><p>Solució</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gRmx5d2VpZ2h0IEludGVyZmFjZQppbnRlcmZhY2UgQ2hhcmFjdGVyRmx5d2VpZ2h0IHsKICAgIHZvaWQgZGlzcGxheShpbnQgcG9zaXRpb24pOwp9CgovLyBDb25jcmV0ZUZseXdlaWdodApjbGFzcyBDb25jcmV0ZUNoYXJhY3RlckZseXdlaWdodCBpbXBsZW1lbnRzIENoYXJhY3RlckZseXdlaWdodCB7CiAgICBwcml2YXRlIGZpbmFsIGNoYXIgaW50cmluc2ljU3RhdGU7CgogICAgcHVibGljIENvbmNyZXRlQ2hhcmFjdGVyRmx5d2VpZ2h0KGNoYXIgaW50cmluc2ljU3RhdGUpIHsKICAgICAgICB0aGlzLmludHJpbnNpY1N0YXRlID0gaW50cmluc2ljU3RhdGU7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBkaXNwbGF5KGludCBwb3NpdGlvbikgewogICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiQ2hhcmFjdGVyOiAiICsgaW50cmluc2ljU3RhdGUgKyAiLCBQb3NpdGlvbjogIiArIHBvc2l0aW9uKTsKICAgIH0KfQoKLy8gRmx5d2VpZ2h0RmFjdG9yeQpjbGFzcyBDaGFyYWN0ZXJGbHl3ZWlnaHRGYWN0b3J5IHsKICAgIHByaXZhdGUgZmluYWwgTWFwPENoYXJhY3RlciwgQ2hhcmFjdGVyRmx5d2VpZ2h0PiBmbHl3ZWlnaHRzID0gbmV3IEhhc2hNYXA8PigpOwoKICAgIHB1YmxpYyBDaGFyYWN0ZXJGbHl3ZWlnaHQgZ2V0Rmx5d2VpZ2h0KGNoYXIga2V5KSB7CiAgICAgICAgaWYgKCFmbHl3ZWlnaHRzLmNvbnRhaW5zS2V5KGtleSkpIHsKICAgICAgICAgICAgZmx5d2VpZ2h0cy5wdXQoa2V5LCBuZXcgQ29uY3JldGVDaGFyYWN0ZXJGbHl3ZWlnaHQoa2V5KSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmbHl3ZWlnaHRzLmdldChrZXkpOwogICAgfQp9CgovLyBDbGllbnQKcHVibGljIGNsYXNzIEZseXdlaWdodFBhdHRlcm5UZXh0RWRpdG9yIHsKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHsKICAgICAgICBDaGFyYWN0ZXJGbHl3ZWlnaHRGYWN0b3J5IGZhY3RvcnkgPSBuZXcgQ2hhcmFjdGVyRmx5d2VpZ2h0RmFjdG9yeSgpOwoKICAgICAgICBTdHJpbmcgdGV4dCA9ICJIRUxMTyBGTFlXRUlHSFQiOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdGV4dC5sZW5ndGgoKTsgaSsrKSB7CiAgICAgICAgICAgIENoYXJhY3RlckZseXdlaWdodCBmbHl3ZWlnaHQgPSBmYWN0b3J5LmdldEZseXdlaWdodCh0ZXh0LmNoYXJBdChpKSk7CiAgICAgICAgICAgIGZseXdlaWdodC5kaXNwbGF5KGkpOwogICAgICAgIH0KICAgIH0KfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Flyweight Interface
interface CharacterFlyweight {
    void display(int position);
}

// ConcreteFlyweight
class ConcreteCharacterFlyweight implements CharacterFlyweight {
    private final char intrinsicState;

    public ConcreteCharacterFlyweight(char intrinsicState) {
        this.intrinsicState = intrinsicState;
    }

    @Override
    public void display(int position) {
        System.out.println(&quot;Character: &quot; + intrinsicState + &quot;, Position: &quot; + position);
    }
}

// FlyweightFactory
class CharacterFlyweightFactory {
    private final Map&lt;Character, CharacterFlyweight&gt; flyweights = new HashMap&lt;&gt;();

    public CharacterFlyweight getFlyweight(char key) {
        if (!flyweights.containsKey(key)) {
            flyweights.put(key, new ConcreteCharacterFlyweight(key));
        }
        return flyweights.get(key);
    }
}

// Client
public class FlyweightPatternTextEditor {
    public static void main(String[] args) {
        CharacterFlyweightFactory factory = new CharacterFlyweightFactory();

        String text = &quot;HELLO FLYWEIGHT&quot;;
        for (int i = 0; i &lt; text.length(); i++) {
            CharacterFlyweight flyweight = factory.getFlyweight(text.charAt(i));
            flyweight.display(i);
        }
    }
}</pre></div><div class='content'></div><h2><p>Explicació de la Solució</p>
</h2>
<div class='content'><ol>
<li><strong>CharacterFlyweight Interface</strong>: Defineix l'operació <code>display</code> que accepta la posició com a paràmetre.</li>
<li><strong>ConcreteCharacterFlyweight</strong>: Implementa la interfície CharacterFlyweight i manté l'estat intrínsec (el caràcter).</li>
<li><strong>CharacterFlyweightFactory</strong>: Gestiona la creació i compartició dels objectes CharacterFlyweight. Utilitza un <code>Map</code> per emmagatzemar i recuperar els objectes CharacterFlyweight.</li>
<li><strong>Client</strong>: Utilitza la fàbrica per obtenir objectes CharacterFlyweight i invoca les operacions amb la posició del caràcter en el text.</li>
</ol>
</div><h1><p>Resum</p>
</h1>
<div class='content'><p>El patró Flyweight és útil per optimitzar l'ús de memòria en aplicacions que treballen amb un gran nombre d'objectes similars. Compartint l'estat intrínsec i gestionant l'estat extrínsec, aquest patró permet reduir significativament la quantitat de memòria necessària. Hem vist la seva implementació en Java i hem practicat amb un exemple d'un editor de text.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='03-06-facade' title="Facade">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='03-08-proxy' title="Proxy">
				<span class="d-none d-md-inline">Següent &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
