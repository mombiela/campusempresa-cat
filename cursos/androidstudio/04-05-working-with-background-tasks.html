<!DOCTYPE html>
<html lang="ca">
<head>
    <title> Treballar amb Tasques en Segon Pla </title>
        
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow, noarchive">
    
    <link rel="alternate" href="https://campusempresa.com/cursos/androidstudio/04-05-working-with-background-tasks" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/cursos/androidstudio/04-05-working-with-background-tasks" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/courses/androidstudio/04-05-working-with-background-tasks" hreflang="en" />
    
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.1ab297bfa4.css" rel="stylesheet">
	 
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script>
  		var LANG = "ca";
  		var CATEGORY = "frameworks";
  		var MOD_NAME = "androidstudio";
  		var TEMA_NAME = "4-5";
  		var TYPE = "mod";
  		var PATH = "mod/androidstudio/04-05-working-with-background-tasks";
  		var IS_INDEX = false;
  	</script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="module" src="/js/app.902a5a267d.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>
	  	
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-VVPMPJSR3P"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());	
	  gtag('config', 'G-VVPMPJSR3P');
	</script>
</head>

<body class="d-none">
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-0">
			<a href="/"><img src="/img/logo_header.png" alt="Logo Campus Empresa"></a>
		</div>
		<div class="col-12 col-md-6 p-0 text-end">
			<p class="mb-0 p-0">	<a href="https://enterprisecampus.net/courses/androidstudio/04-05-working-with-background-tasks" class="px-2">EN</a></b>
	|
	<a href="https://campusempresa.com/cursos/androidstudio/04-05-working-with-background-tasks" class="px-2">ES</a></b>
	|
	<b class="px-2">CA</b>
</p>
			<p class="mb-4 mt-0 mx-2  d-none d-md-block"><cite>Tot el coneixement al teu abast</cite></p>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objectiu" rel="nofollow">El Projecte</a> | 
<a href="/sobre-nosaltres" rel="nofollow">Sobre nosaltres</a> | 
<a href="/contribuir" rel="nofollow">Contribuir</a> | 
<a href="/donar" rel="nofollow">Donacions</a> | 
<a href="/llicencia" rel="nofollow">Llicència</a>
		</div>
	</div>
</div>
		<div class="top-bar container-fluid p-0">
	<div class="container-xxl p-0">
		<div class="row">
			<div class="col">
				<div class="d-flex justify-content-between">
					<div class="left">
						<a href="/" class="nav-link px-3" id="btnHome">
	<i class="bi bi-house-fill"></i>
	HOME
</a>

<a href="/els-meus-cursos" class="nav-link px-3 d-none" id="btnMyCourses">
	<i class="bi bi-rocket-takeoff-fill"></i>
	<i><b>Els meus cursos</b></i>
</a>
<a href="/cursos-finalitzats" class="nav-link px-3 d-none" id="trophy_button">
	<i class="bi bi-trophy-fill"></i>
	Finalitzats             
</a>

					</div>
                    <div class="ms-auto right">
                        <a id="user_button" href="#" class="nav-link px-3" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i id="user_icon" class="bi"></i>                            
                        </a>
                    </div>					
				</div>
			</div>
		</div>
	</div>
</div>

		<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
										<div class="row py-1 m-0" id="buttonsModSection">
	<div class="col-6 p-0" data-mod="androidstudio">
		<a  href="#" class="text-secondary d-none" data-read-mod="androidstudio" data-read-unit="4-5" style="text-decoration:none;">
			<i class="bi bi-check-circle-fill"></i> 
			Marcar com a llegit
		</a>
		<a href="#" class="text-secondary d-none" data-unread-mod="androidstudio" data-unread-unit="4-5" style="text-decoration:none;">
			<i class="bi bi-x-circle-fill"></i>
			Marcar com a no llegit
		</a>
	</div>
	<div class="col-6 text-end p-0">
					<a href="./"  class="nav-link">
				<i class="bi bi-journal-text"></i>
				Contingut del curs
			</a>
			</div>
</div>						<div id="inner_content">
				<div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='04-04-custom-views-and-canvas' title="Vistes Personalitzades i Canvas" class="py-2 px-3 btn btn-primary">
				&#x25C4; Anterior 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='04-04-custom-views-and-canvas' title="Vistes Personalitzades i Canvas" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
					<h1 style="text-decoration:underline">Treballar amb Tasques en Segon Pla</h1>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='05-01-implementing-mvvm-architecture' title="Implementació de l'Arquitectura MVVM" class="py-2 px-3 btn btn-primary"
				data-read-mod="androidstudio" data-read-unit="4-5">
				Següent &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='05-01-implementing-mvvm-architecture' title="Implementació de l'Arquitectura MVVM" class="py-2 px-3 btn btn-primary" 
				data-read-mod="androidstudio" data-read-unit="4-5">
				 &#x25BA;
			</a>
			</div>
</div>
<div class='content'><p>En aquest tema, aprendrem com gestionar tasques en segon pla en una aplicació Android. Les tasques en segon pla són operacions que es realitzen fora del fil principal de la interfície d'usuari (UI), permetent que l'aplicació continuï sent responsiva mentre es duen a terme operacions que poden trigar temps, com ara descàrregues de xarxa, operacions de base de dades, o processament de dades.</p>
</div><h2>Conceptes Clau</h2>
<div class='content'><ol>
<li><strong>Fil Principal (Main Thread)</strong>: És el fil on s'executa la interfície d'usuari de l'aplicació. Qualsevol operació que trigui massa temps en aquest fil pot fer que l'aplicació sembli bloquejada.</li>
<li><strong>Tasques en Segon Pla</strong>: Operacions que es realitzen fora del fil principal per evitar bloquejar la UI.</li>
<li><strong>AsyncTask</strong>: Una classe antiga per gestionar tasques en segon pla, però que ja no es recomana per a noves aplicacions.</li>
<li><strong>Executors</strong>: Una API més moderna per gestionar fils en segon pla.</li>
<li><strong>WorkManager</strong>: Una API per gestionar tasques en segon pla que necessiten ser persistents i poden ser programades per a un moment específic.</li>
</ol>
</div><h2>Executors</h2>
<div class='content'></div><h3>Introducció</h3>
<div class='content'><p>Els Executors proporcionen una manera fàcil de gestionar fils en segon pla. Utilitzen un grup de fils (thread pool) per executar tasques de manera eficient.</p>
</div><h3>Exemple Pràctic</h3>
<div class='content'></div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkV4ZWN1dG9yU2VydmljZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkV4ZWN1dG9yczsKCnB1YmxpYyBjbGFzcyBCYWNrZ3JvdW5kVGFza0V4YW1wbGUgewoKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHsKICAgICAgICAvLyBDcmVhciB1biBleGVjdXRvciBhbWIgdW4gc29sIGZpbAogICAgICAgIEV4ZWN1dG9yU2VydmljZSBleGVjdXRvciA9IEV4ZWN1dG9ycy5uZXdTaW5nbGVUaHJlYWRFeGVjdXRvcigpOwoKICAgICAgICAvLyBEZWZpbmlyIHVuYSB0YXNjYSBlbiBzZWdvbiBwbGEKICAgICAgICBSdW5uYWJsZSBiYWNrZ3JvdW5kVGFzayA9IG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgIC8vIENvZGkgZGUgbGEgdGFzY2EgZW4gc2Vnb24gcGxhCiAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlRhc3F1ZXMgZW4gc2Vnb24gcGxhIGV4ZWN1dGFudC1zZSIpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoMjAwMCk7IC8vIFNpbXVsYXIgdW5hIHRhc2NhIHF1ZSB0cmlnYSAyIHNlZ29ucwogICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlRhc3F1ZXMgZW4gc2Vnb24gcGxhIGZpbmFsaXR6YWRlcyIpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLy8gRXhlY3V0YXIgbGEgdGFzY2EgZW4gc2Vnb24gcGxhCiAgICAgICAgZXhlY3V0b3IuZXhlY3V0ZShiYWNrZ3JvdW5kVGFzayk7CgogICAgICAgIC8vIFRhbmNhciBsJ2V4ZWN1dG9yCiAgICAgICAgZXhlY3V0b3Iuc2h1dGRvd24oKTsKICAgIH0KfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public class BackgroundTaskExample {

    public static void main(String[] args) {
        // Crear un executor amb un sol fil
        ExecutorService executor = Executors.newSingleThreadExecutor();

        // Definir una tasca en segon pla
        Runnable backgroundTask = new Runnable() {
            @Override
            public void run() {
                // Codi de la tasca en segon pla
                System.out.println(&quot;Tasques en segon pla executant-se&quot;);
                try {
                    Thread.sleep(2000); // Simular una tasca que triga 2 segons
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                System.out.println(&quot;Tasques en segon pla finalitzades&quot;);
            }
        };

        // Executar la tasca en segon pla
        executor.execute(backgroundTask);

        // Tancar l'executor
        executor.shutdown();
    }
}</pre></div><div class='content'></div><h3>Explicació</h3>
<div class='content'><ol>
<li><strong>ExecutorService</strong>: Creem un executor amb un sol fil.</li>
<li><strong>Runnable</strong>: Definim una tasca en segon pla que imprimeix missatges abans i després de dormir durant 2 segons.</li>
<li><strong>execute()</strong>: Executem la tasca en segon pla.</li>
<li><strong>shutdown()</strong>: Tanquem l'executor després de completar la tasca.</li>
</ol>
</div><h2>WorkManager</h2>
<div class='content'></div><h3>Introducció</h3>
<div class='content'><p>WorkManager és una API robusta per gestionar tasques en segon pla que necessiten ser persistents i poden ser programades per a un moment específic. És ideal per a tasques que han de continuar fins i tot si l'aplicació es tanca o el dispositiu es reinicia.</p>
</div><h3>Exemple Pràctic</h3>
<div class='content'><h4>Pas 1: Afegir la Dependència</h4>
<p>Afegiu la següent dependència al vostre <code>build.gradle</code>:</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGVwZW5kZW5jaWVzIHsKICAgIGltcGxlbWVudGF0aW9uICJhbmRyb2lkeC53b3JrOndvcmstcnVudGltZToyLjcuMCIKfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>dependencies {
    implementation &quot;androidx.work:work-runtime:2.7.0&quot;
}</pre></div><div class='content'><h4>Pas 2: Crear una Classe Worker</h4>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGFuZHJvaWQuY29udGVudC5Db250ZXh0OwppbXBvcnQgYW5kcm9pZHguYW5ub3RhdGlvbi5Ob25OdWxsOwppbXBvcnQgYW5kcm9pZHgud29yay5Xb3JrZXI7CmltcG9ydCBhbmRyb2lkeC53b3JrLldvcmtlclBhcmFtZXRlcnM7CgpwdWJsaWMgY2xhc3MgTXlXb3JrZXIgZXh0ZW5kcyBXb3JrZXIgewoKICAgIHB1YmxpYyBNeVdvcmtlcihATm9uTnVsbCBDb250ZXh0IGNvbnRleHQsIEBOb25OdWxsIFdvcmtlclBhcmFtZXRlcnMgcGFyYW1zKSB7CiAgICAgICAgc3VwZXIoY29udGV4dCwgcGFyYW1zKTsKICAgIH0KCiAgICBATm9uTnVsbAogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgUmVzdWx0IGRvV29yaygpIHsKICAgICAgICAvLyBDb2RpIGRlIGxhIHRhc2NhIGVuIHNlZ29uIHBsYQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFRocmVhZC5zbGVlcCgzMDAwKTsgLy8gU2ltdWxhciB1bmEgdGFzY2EgcXVlIHRyaWdhIDMgc2Vnb25zCiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBlLnByaW50U3RhY2tUcmFjZSgpOwogICAgICAgICAgICByZXR1cm4gUmVzdWx0LmZhaWx1cmUoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFJlc3VsdC5zdWNjZXNzKCk7CiAgICB9Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import android.content.Context;
import androidx.annotation.NonNull;
import androidx.work.Worker;
import androidx.work.WorkerParameters;

public class MyWorker extends Worker {

    public MyWorker(@NonNull Context context, @NonNull WorkerParameters params) {
        super(context, params);
    }

    @NonNull
    @Override
    public Result doWork() {
        // Codi de la tasca en segon pla
        try {
            Thread.sleep(3000); // Simular una tasca que triga 3 segons
        } catch (InterruptedException e) {
            e.printStackTrace();
            return Result.failure();
        }
        return Result.success();
    }
}</pre></div><div class='content'><h4>Pas 3: Programar la Tasca</h4>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGFuZHJvaWR4LmFwcGNvbXBhdC5hcHAuQXBwQ29tcGF0QWN0aXZpdHk7CmltcG9ydCBhbmRyb2lkLm9zLkJ1bmRsZTsKaW1wb3J0IGFuZHJvaWR4LndvcmsuT25lVGltZVdvcmtSZXF1ZXN0OwppbXBvcnQgYW5kcm9pZHgud29yay5Xb3JrTWFuYWdlcjsKCnB1YmxpYyBjbGFzcyBNYWluQWN0aXZpdHkgZXh0ZW5kcyBBcHBDb21wYXRBY3Rpdml0eSB7CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBvbkNyZWF0ZShCdW5kbGUgc2F2ZWRJbnN0YW5jZVN0YXRlKSB7CiAgICAgICAgc3VwZXIub25DcmVhdGUoc2F2ZWRJbnN0YW5jZVN0YXRlKTsKICAgICAgICBzZXRDb250ZW50VmlldyhSLmxheW91dC5hY3Rpdml0eV9tYWluKTsKCiAgICAgICAgLy8gQ3JlYXIgdW5hIHNvbMK3bGljaXR1ZCBkZSB0cmViYWxsCiAgICAgICAgT25lVGltZVdvcmtSZXF1ZXN0IHdvcmtSZXF1ZXN0ID0gbmV3IE9uZVRpbWVXb3JrUmVxdWVzdC5CdWlsZGVyKE15V29ya2VyLmNsYXNzKS5idWlsZCgpOwoKICAgICAgICAvLyBQcm9ncmFtYXIgbGEgdGFzY2EKICAgICAgICBXb3JrTWFuYWdlci5nZXRJbnN0YW5jZSh0aGlzKS5lbnF1ZXVlKHdvcmtSZXF1ZXN0KTsKICAgIH0KfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import androidx.work.OneTimeWorkRequest;
import androidx.work.WorkManager;

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        // Crear una sol&middot;licitud de treball
        OneTimeWorkRequest workRequest = new OneTimeWorkRequest.Builder(MyWorker.class).build();

        // Programar la tasca
        WorkManager.getInstance(this).enqueue(workRequest);
    }
}</pre></div><div class='content'></div><h3>Explicació</h3>
<div class='content'><ol>
<li><strong>Dependència</strong>: Afegim la dependència de WorkManager al nostre projecte.</li>
<li><strong>MyWorker</strong>: Creem una classe que extén <code>Worker</code> i implementa el mètode <code>doWork()</code>, on definim la tasca en segon pla.</li>
<li><strong>OneTimeWorkRequest</strong>: Creem una sol·licitud de treball per executar la tasca una vegada.</li>
<li><strong>WorkManager</strong>: Programem la tasca utilitzant <code>WorkManager</code>.</li>
</ol>
</div><h2>Exercici Pràctic</h2>
<div class='content'></div><h3>Enunciat</h3>
<div class='content'><p>Creeu una aplicació Android que descarregui una imatge d'una URL en segon pla i la mostri en una <code>ImageView</code> quan la descàrrega hagi finalitzat.</p>
</div><h3>Solució</h3>
<div class='content'><h4>Pas 1: Afegir Permisos</h4>
<p>Afegiu el permís d'internet al vostre <code>AndroidManifest.xml</code>:</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PHVzZXMtcGVybWlzc2lvbiBhbmRyb2lkOm5hbWU9ImFuZHJvaWQucGVybWlzc2lvbi5JTlRFUk5FVCIvPg=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;</pre></div><div class='content'><h4>Pas 2: Crear la Classe Worker</h4>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGFuZHJvaWQuY29udGVudC5Db250ZXh0OwppbXBvcnQgYW5kcm9pZC5ncmFwaGljcy5CaXRtYXA7CmltcG9ydCBhbmRyb2lkLmdyYXBoaWNzLkJpdG1hcEZhY3Rvcnk7CmltcG9ydCBhbmRyb2lkLndpZGdldC5JbWFnZVZpZXc7CmltcG9ydCBhbmRyb2lkeC5hbm5vdGF0aW9uLk5vbk51bGw7CmltcG9ydCBhbmRyb2lkeC53b3JrLldvcmtlcjsKaW1wb3J0IGFuZHJvaWR4LndvcmsuV29ya2VyUGFyYW1ldGVyczsKaW1wb3J0IGphdmEuaW8uSW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLm5ldC5IdHRwVVJMQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEubmV0LlVSTDsKCnB1YmxpYyBjbGFzcyBEb3dubG9hZEltYWdlV29ya2VyIGV4dGVuZHMgV29ya2VyIHsKCiAgICBwdWJsaWMgRG93bmxvYWRJbWFnZVdvcmtlcihATm9uTnVsbCBDb250ZXh0IGNvbnRleHQsIEBOb25OdWxsIFdvcmtlclBhcmFtZXRlcnMgcGFyYW1zKSB7CiAgICAgICAgc3VwZXIoY29udGV4dCwgcGFyYW1zKTsKICAgIH0KCiAgICBATm9uTnVsbAogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgUmVzdWx0IGRvV29yaygpIHsKICAgICAgICBTdHJpbmcgaW1hZ2VVcmwgPSBnZXRJbnB1dERhdGEoKS5nZXRTdHJpbmcoImltYWdlX3VybCIpOwogICAgICAgIEJpdG1hcCBiaXRtYXAgPSBkb3dubG9hZEltYWdlKGltYWdlVXJsKTsKICAgICAgICBpZiAoYml0bWFwICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gR3VhcmRhciBsYSBpbWF0Z2UgZW4gdW4gbGxvYyBhY2Nlc3NpYmxlIHBlciBhIGwnVUkKICAgICAgICAgICAgSW1hZ2VTdG9yYWdlLnNhdmVJbWFnZShnZXRBcHBsaWNhdGlvbkNvbnRleHQoKSwgYml0bWFwKTsKICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5zdWNjZXNzKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsdXJlKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgQml0bWFwIGRvd25sb2FkSW1hZ2UoU3RyaW5nIGltYWdlVXJsKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgVVJMIHVybCA9IG5ldyBVUkwoaW1hZ2VVcmwpOwogICAgICAgICAgICBIdHRwVVJMQ29ubmVjdGlvbiBjb25uZWN0aW9uID0gKEh0dHBVUkxDb25uZWN0aW9uKSB1cmwub3BlbkNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgY29ubmVjdGlvbi5jb25uZWN0KCk7CiAgICAgICAgICAgIElucHV0U3RyZWFtIGlucHV0ID0gY29ubmVjdGlvbi5nZXRJbnB1dFN0cmVhbSgpOwogICAgICAgICAgICByZXR1cm4gQml0bWFwRmFjdG9yeS5kZWNvZGVTdHJlYW0oaW5wdXQpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import android.content.Context;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.widget.ImageView;
import androidx.annotation.NonNull;
import androidx.work.Worker;
import androidx.work.WorkerParameters;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.net.URL;

public class DownloadImageWorker extends Worker {

    public DownloadImageWorker(@NonNull Context context, @NonNull WorkerParameters params) {
        super(context, params);
    }

    @NonNull
    @Override
    public Result doWork() {
        String imageUrl = getInputData().getString(&quot;image_url&quot;);
        Bitmap bitmap = downloadImage(imageUrl);
        if (bitmap != null) {
            // Guardar la imatge en un lloc accessible per a l'UI
            ImageStorage.saveImage(getApplicationContext(), bitmap);
            return Result.success();
        } else {
            return Result.failure();
        }
    }

    private Bitmap downloadImage(String imageUrl) {
        try {
            URL url = new URL(imageUrl);
            HttpURLConnection connection = (HttpURLConnection) url.openConnection();
            connection.connect();
            InputStream input = connection.getInputStream();
            return BitmapFactory.decodeStream(input);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }
}</pre></div><div class='content'><h4>Pas 3: Crear una Classe per Guardar la Imatge</h4>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGFuZHJvaWQuY29udGVudC5Db250ZXh0OwppbXBvcnQgYW5kcm9pZC5ncmFwaGljcy5CaXRtYXA7CmltcG9ydCBqYXZhLmlvLkZpbGVPdXRwdXRTdHJlYW07CgpwdWJsaWMgY2xhc3MgSW1hZ2VTdG9yYWdlIHsKCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgc2F2ZUltYWdlKENvbnRleHQgY29udGV4dCwgQml0bWFwIGJpdG1hcCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEZpbGVPdXRwdXRTdHJlYW0gZm9zID0gY29udGV4dC5vcGVuRmlsZU91dHB1dCgiZG93bmxvYWRlZF9pbWFnZS5wbmciLCBDb250ZXh0Lk1PREVfUFJJVkFURSk7CiAgICAgICAgICAgIGJpdG1hcC5jb21wcmVzcyhCaXRtYXAuQ29tcHJlc3NGb3JtYXQuUE5HLCAxMDAsIGZvcyk7CiAgICAgICAgICAgIGZvcy5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgQml0bWFwIGxvYWRJbWFnZShDb250ZXh0IGNvbnRleHQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gQml0bWFwRmFjdG9yeS5kZWNvZGVTdHJlYW0oY29udGV4dC5vcGVuRmlsZUlucHV0KCJkb3dubG9hZGVkX2ltYWdlLnBuZyIpKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBlLnByaW50U3RhY2tUcmFjZSgpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICB9Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import android.content.Context;
import android.graphics.Bitmap;
import java.io.FileOutputStream;

public class ImageStorage {

    public static void saveImage(Context context, Bitmap bitmap) {
        try {
            FileOutputStream fos = context.openFileOutput(&quot;downloaded_image.png&quot;, Context.MODE_PRIVATE);
            bitmap.compress(Bitmap.CompressFormat.PNG, 100, fos);
            fos.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public static Bitmap loadImage(Context context) {
        try {
            return BitmapFactory.decodeStream(context.openFileInput(&quot;downloaded_image.png&quot;));
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }
}</pre></div><div class='content'><h4>Pas 4: Programar la Tasca i Mostrar la Imatge</h4>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGFuZHJvaWR4LmFwcGNvbXBhdC5hcHAuQXBwQ29tcGF0QWN0aXZpdHk7CmltcG9ydCBhbmRyb2lkLmdyYXBoaWNzLkJpdG1hcDsKaW1wb3J0IGFuZHJvaWQub3MuQnVuZGxlOwppbXBvcnQgYW5kcm9pZC53aWRnZXQuSW1hZ2VWaWV3OwppbXBvcnQgYW5kcm9pZHgud29yay5EYXRhOwppbXBvcnQgYW5kcm9pZHgud29yay5PbmVUaW1lV29ya1JlcXVlc3Q7CmltcG9ydCBhbmRyb2lkeC53b3JrLldvcmtNYW5hZ2VyOwppbXBvcnQgYW5kcm9pZHgud29yay5Xb3JrZXI7CmltcG9ydCBhbmRyb2lkeC53b3JrLldvcmtlclBhcmFtZXRlcnM7CgpwdWJsaWMgY2xhc3MgTWFpbkFjdGl2aXR5IGV4dGVuZHMgQXBwQ29tcGF0QWN0aXZpdHkgewoKICAgIHByaXZhdGUgSW1hZ2VWaWV3IGltYWdlVmlldzsKCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIG9uQ3JlYXRlKEJ1bmRsZSBzYXZlZEluc3RhbmNlU3RhdGUpIHsKICAgICAgICBzdXBlci5vbkNyZWF0ZShzYXZlZEluc3RhbmNlU3RhdGUpOwogICAgICAgIHNldENvbnRlbnRWaWV3KFIubGF5b3V0LmFjdGl2aXR5X21haW4pOwoKICAgICAgICBpbWFnZVZpZXcgPSBmaW5kVmlld0J5SWQoUi5pZC5pbWFnZVZpZXcpOwoKICAgICAgICAvLyBDcmVhciB1bmEgc29swrdsaWNpdHVkIGRlIHRyZWJhbGwgYW1iIGRhZGVzIGQnZW50cmFkYQogICAgICAgIERhdGEgaW5wdXREYXRhID0gbmV3IERhdGEuQnVpbGRlcigpCiAgICAgICAgICAgICAgICAucHV0U3RyaW5nKCJpbWFnZV91cmwiLCAiaHR0cHM6Ly9leGFtcGxlLmNvbS9pbWFnZS5wbmciKQogICAgICAgICAgICAgICAgLmJ1aWxkKCk7CgogICAgICAgIE9uZVRpbWVXb3JrUmVxdWVzdCB3b3JrUmVxdWVzdCA9IG5ldyBPbmVUaW1lV29ya1JlcXVlc3QuQnVpbGRlcihEb3dubG9hZEltYWdlV29ya2VyLmNsYXNzKQogICAgICAgICAgICAgICAgLnNldElucHV0RGF0YShpbnB1dERhdGEpCiAgICAgICAgICAgICAgICAuYnVpbGQoKTsKCiAgICAgICAgLy8gUHJvZ3JhbWFyIGxhIHRhc2NhCiAgICAgICAgV29ya01hbmFnZXIuZ2V0SW5zdGFuY2UodGhpcykuZW5xdWV1ZSh3b3JrUmVxdWVzdCk7CgogICAgICAgIC8vIE9ic2VydmFyIGVscyByZXN1bHRhdHMgZGUgbGEgdGFzY2EKICAgICAgICBXb3JrTWFuYWdlci5nZXRJbnN0YW5jZSh0aGlzKS5nZXRXb3JrSW5mb0J5SWRMaXZlRGF0YSh3b3JrUmVxdWVzdC5nZXRJZCgpKQogICAgICAgICAgICAgICAgLm9ic2VydmUodGhpcywgd29ya0luZm8gLT4gewogICAgICAgICAgICAgICAgICAgIGlmICh3b3JrSW5mbyAhPSBudWxsICYmIHdvcmtJbmZvLmdldFN0YXRlKCkuaXNGaW5pc2hlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENhcnJlZ2FyIGxhIGltYXRnZSBndWFyZGFkYSBpIG1vc3RyYXItbGEKICAgICAgICAgICAgICAgICAgICAgICAgQml0bWFwIGJpdG1hcCA9IEltYWdlU3RvcmFnZS5sb2FkSW1hZ2UodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiaXRtYXAgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2VWaWV3LnNldEltYWdlQml0bWFwKGJpdG1hcCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgIH0KfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import androidx.appcompat.app.AppCompatActivity;
import android.graphics.Bitmap;
import android.os.Bundle;
import android.widget.ImageView;
import androidx.work.Data;
import androidx.work.OneTimeWorkRequest;
import androidx.work.WorkManager;
import androidx.work.Worker;
import androidx.work.WorkerParameters;

public class MainActivity extends AppCompatActivity {

    private ImageView imageView;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        imageView = findViewById(R.id.imageView);

        // Crear una sol&middot;licitud de treball amb dades d'entrada
        Data inputData = new Data.Builder()
                .putString(&quot;image_url&quot;, &quot;https://example.com/image.png&quot;)
                .build();

        OneTimeWorkRequest workRequest = new OneTimeWorkRequest.Builder(DownloadImageWorker.class)
                .setInputData(inputData)
                .build();

        // Programar la tasca
        WorkManager.getInstance(this).enqueue(workRequest);

        // Observar els resultats de la tasca
        WorkManager.getInstance(this).getWorkInfoByIdLiveData(workRequest.getId())
                .observe(this, workInfo -&gt; {
                    if (workInfo != null &amp;&amp; workInfo.getState().isFinished()) {
                        // Carregar la imatge guardada i mostrar-la
                        Bitmap bitmap = ImageStorage.loadImage(this);
                        if (bitmap != null) {
                            imageView.setImageBitmap(bitmap);
                        }
                    }
                });
    }
}</pre></div><div class='content'></div><h3>Explicació</h3>
<div class='content'><ol>
<li><strong>Permís d'Internet</strong>: Afegim el permís d'internet al manifest.</li>
<li><strong>DownloadImageWorker</strong>: Creem una classe <code>Worker</code> per descarregar la imatge en segon pla.</li>
<li><strong>ImageStorage</strong>: Creem una classe per guardar i carregar la imatge descarregada.</li>
<li><strong>MainActivity</strong>: Programem la tasca de descàrrega i observem els resultats per mostrar la imatge quan la descàrrega hagi finalitzat.</li>
</ol>
</div><h2>Conclusió</h2>
<div class='content'><p>En aquest tema, hem après com gestionar tasques en segon pla utilitzant Executors i WorkManager. Hem vist exemples pràctics de com implementar aquestes tècniques i hem creat una aplicació que descarrega una imatge en segon pla i la mostra a la interfície d'usuari. Les tasques en segon pla són essencials per mantenir la responsivitat de les aplicacions Android i proporcionar una millor experiència d'usuari.</p>
</div><div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='04-04-custom-views-and-canvas' title="Vistes Personalitzades i Canvas" class="py-2 px-3 btn btn-primary">
				&#x25C4; Anterior 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='04-04-custom-views-and-canvas' title="Vistes Personalitzades i Canvas" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='05-01-implementing-mvvm-architecture' title="Implementació de l'Arquitectura MVVM" class="py-2 px-3 btn btn-primary"
				data-read-mod="androidstudio" data-read-unit="4-5">
				Següent &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='05-01-implementing-mvvm-architecture' title="Implementació de l'Arquitectura MVVM" class="py-2 px-3 btn btn-primary" 
				data-read-mod="androidstudio" data-read-unit="4-5">
				 &#x25BA;
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
						
	<div class="container mt-2 d-none d-md-block index">
		<h1>Curs d'Android Studio</h1>
<h2>Mòdul 1: Introducció a Android Studio</h2>
<ul>
<li><a href="01-01-introduction-to-android-studio">Introducció a Android Studio</a></li>
<li><a href="01-02-setting-up-android-studio">Configuració d'Android Studio</a></li>
<li><a href="01-03-understanding-the-android-studio-interface">Comprensió de la Interfície d'Android Studio</a></li>
<li><a href="01-04-creating-your-first-android-project">Creació del teu Primer Projecte Android</a></li>
</ul>
<h2>Mòdul 2: Desenvolupament Bàsic d'Android</h2>
<ul>
<li><a href="02-01-understanding-android-project-structure">Comprensió de l'Estructura del Projecte Android</a></li>
<li><a href="02-02-introduction-to-xml-layouts">Introducció als Dissenys XML</a></li>
<li><a href="02-03-basic-ui-components">Components Bàsics de la Interfície d'Usuari</a></li>
<li><a href="02-04-introduction-to-activities">Introducció a les Activitats</a></li>
<li><a href="02-05-running-your-app-on-an-emulator">Executar la teva Aplicació en un Emulador</a></li>
</ul>
<h2>Mòdul 3: Desenvolupament Intermedi d'Android</h2>
<ul>
<li><a href="03-01-introduction-to-intents">Introducció als Intents</a></li>
<li><a href="03-02-working-with-fragments">Treballar amb Fragments</a></li>
<li><a href="03-03-handling-user-input">Gestió de l'Entrada de l'Usuari</a></li>
<li><a href="03-04-using-recyclerview">Ús de RecyclerView</a></li>
<li><a href="03-05-networking-in-android">Xarxes en Android</a></li>
</ul>
<h2>Mòdul 4: Desenvolupament Avançat d'Android</h2>
<ul>
<li><a href="04-01-data-persistence-with-sqlite">Persistència de Dades amb SQLite</a></li>
<li><a href="04-02-using-room-for-database-management">Ús de Room per a la Gestió de Bases de Dades</a></li>
<li><a href="04-03-advanced-ui-components">Components Avançats de la Interfície d'Usuari</a></li>
<li><a href="04-04-custom-views-and-canvas">Vistes Personalitzades i Canvas</a></li>
<li><a href="04-05-working-with-background-tasks">Treballar amb Tasques en Segon Pla</a></li>
</ul>
<h2>Mòdul 5: Desenvolupament Professional d'Android</h2>
<ul>
<li><a href="05-01-implementing-mvvm-architecture">Implementació de l'Arquitectura MVVM</a></li>
<li><a href="05-02-dependency-injection-with-dagger">Injecció de Dependències amb Dagger</a></li>
<li><a href="05-03-unit-testing-and-ui-testing">Proves Unitàries i Proves de la Interfície d'Usuari</a></li>
<li><a href="05-04-publishing-your-app-on-google-play">Publicació de la teva Aplicació a Google Play</a></li>
<li><a href="05-05-performance-optimization">Optimització del Rendiment</a></li>
</ul>
<h2>Mòdul 6: Temes Especials</h2>
<ul>
<li><a href="06-01-using-firebase-in-android">Ús de Firebase en Android</a></li>
<li><a href="06-02-integrating-google-maps">Integració de Google Maps</a></li>
<li><a href="06-03-implementing-in-app-purchases">Implementació de Compres Integrades a l'Aplicació</a></li>
<li><a href="06-04-using-machine-learning-in-android">Ús de l'Aprenentatge Automàtic en Android</a></li>
<li><a href="06-05-augmented-reality-with-arcore">Realitat Augmentada amb ARCore</a></li>
</ul>

	</div>










		</div>
	</div>
</div>		
<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objectiu" rel="nofollow">El Projecte</a> | 
<a href="/sobre-nosaltres" rel="nofollow">Sobre nosaltres</a> | 
<a href="/contribuir" rel="nofollow">Contribuir</a> | 
<a href="/donar" rel="nofollow">Donacions</a> | 
<a href="/llicencia" rel="nofollow">Llicència</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

		<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">Usuari no autentificat</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            	<div id="modal-body-main"></div>
            </div>
        </div>
    </div>
</div>	</div>    
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
