<!DOCTYPE html>
<html lang="ca">
<head>
    <title> FFI (Interfície de Funció Estrangera) </title>
        
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow, noarchive">
    
    <link rel="alternate" href="https://campusempresa.com/cursos/rust/09-03-ffi" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/cursos/rust/09-03-ffi" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/courses/rust/09-03-ffi" hreflang="en" />
    
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.1ab297bfa4.css" rel="stylesheet">
	 
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script>
  		var LANG = "ca";
  		var CATEGORY = "languages";
  		var MOD_NAME = "rust";
  		var TEMA_NAME = "9-3";
  		var TYPE = "mod";
  		var PATH = "mod/rust/09-03-ffi";
  		var IS_INDEX = false;
  	</script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="module" src="/js/app.e0e4cfcd99.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>
	  	
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-VVPMPJSR3P"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());	
	  gtag('config', 'G-VVPMPJSR3P');
	</script>
</head>

<body class="d-none">
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-0">
			<a href="/"><img src="/img/logo_header.png" alt="Logo Campus Empresa"></a>
		</div>
		<div class="col-12 col-md-6 p-0 text-end">
			<p class="mb-0 p-0">	<a href="https://enterprisecampus.net/courses/rust/09-03-ffi" class="px-2">EN</a></b>
	|
	<a href="https://campusempresa.com/cursos/rust/09-03-ffi" class="px-2">ES</a></b>
	|
	<b class="px-2">CA</b>
</p>
			<p class="mb-4 mt-0 mx-2  d-none d-md-block"><cite>Tot el coneixement al teu abast</cite></p>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objectiu" rel="nofollow">El Projecte</a> | 
<a href="/sobre-nosaltres" rel="nofollow">Sobre nosaltres</a> | 
<a href="/contribuir" rel="nofollow">Contribuir</a> | 
<a href="/donar" rel="nofollow">Donacions</a> | 
<a href="/llicencia" rel="nofollow">Llicència</a>
		</div>
	</div>
</div>
		<div class="top-bar container-fluid p-0">
	<div class="container-xxl p-0">
		<div class="row">
			<div class="col">
				<div class="d-flex justify-content-between">
					<div class="left">
						<a href="/" class="nav-link px-3" id="btnHome">
	<i class="bi bi-house-fill"></i>
	HOME
</a>

<a href="/els-meus-cursos" class="nav-link px-3 d-none" id="btnMyCourses">
	<i class="bi bi-rocket-takeoff-fill"></i>
	<i><b>Els meus cursos</b></i>
</a>
<a href="/cursos-finalitzats" class="nav-link px-3 d-none" id="trophy_button">
	<i class="bi bi-trophy-fill"></i>
	Finalitzats             
</a>

					</div>
                    <div class="ms-auto right">
                        <a id="user_button" href="#" class="nav-link px-3" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i id="user_icon" class="bi"></i>                            
                        </a>
                    </div>					
				</div>
			</div>
		</div>
	</div>
</div>

		<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
										<div class="row py-1 m-0" id="buttonsModSection">
	<div class="col-6 p-0" data-mod="rust">
		<a  href="#" class="text-secondary d-none" data-read-mod="rust" data-read-unit="9-3" style="text-decoration:none;">
			<i class="bi bi-check-circle-fill"></i> 
			Marcar com a llegit
		</a>
		<a href="#" class="text-secondary d-none" data-unread-mod="rust" data-unread-unit="9-3" style="text-decoration:none;">
			<i class="bi bi-x-circle-fill"></i>
			Marcar com a no llegit
		</a>
	</div>
	<div class="col-6 text-end p-0">
					<a href="./"  class="nav-link">
				<i class="bi bi-journal-text"></i>
				Contingut del curs
			</a>
			</div>
</div>						<div id="inner_content">
				<div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='09-02-unsafe-rust' title="Rust Insegur" class="py-2 px-3 btn btn-primary">
				&#x25C4; Anterior 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='09-02-unsafe-rust' title="Rust Insegur" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
					<h1 style="text-decoration:underline">FFI (Interfície de Funció Estrangera)</h1>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='10-01-building-project' title="Construcció d'un Projecte" class="py-2 px-3 btn btn-primary"
				data-read-mod="rust" data-read-unit="9-3">
				Següent &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='10-01-building-project' title="Construcció d'un Projecte" class="py-2 px-3 btn btn-primary" 
				data-read-mod="rust" data-read-unit="9-3">
				 &#x25BA;
			</a>
			</div>
</div>
<div class='content'></div><h2>Introducció</h2>
<div class='content'><p>La Interfície de Funció Estrangera (FFI) permet que el codi escrit en Rust interactuï amb codi escrit en altres llenguatges de programació, com C o C++. Això és especialment útil quan es vol reutilitzar biblioteques existents o integrar Rust en projectes més grans que ja utilitzen altres llenguatges.</p>
</div><h2>Conceptes Clau</h2>
<div class='content'><ol>
<li><strong>Exposició de Funcions Rust a C</strong>: Permet que el codi C cridi funcions definides en Rust.</li>
<li><strong>Crida de Funcions C des de Rust</strong>: Permet que el codi Rust cridi funcions definides en C.</li>
<li><strong>Tipus de Dades Compatibles</strong>: Assegura que els tipus de dades utilitzats en les interfícies siguin compatibles entre Rust i el llenguatge estranger.</li>
<li><strong>Seguretat</strong>: L'ús de FFI pot introduir riscos de seguretat, per la qual cosa és important seguir bones pràctiques.</li>
</ol>
</div><h2>Exposició de Funcions Rust a C</h2>
<div class='content'><p>Per exposar funcions Rust a C, utilitzem l'atribut <code>#[no_mangle]</code> i la paraula clau <code>extern &quot;C&quot;</code>.</p>
</div><h3>Exemple</h3>
<div class='content'></div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("I1tub19tYW5nbGVdCnB1YiBleHRlcm4gIkMiIGZuIGFkZChhOiBpMzIsIGI6IGkzMikgLT4gaTMyIHsKICAgIGEgKyBiCn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#[no_mangle]
pub extern &quot;C&quot; fn add(a: i32, b: i32) -&gt; i32 {
    a + b
}</pre></div><div class='content'></div><h3>Explicació</h3>
<div class='content'><ul>
<li><code>#[no_mangle]</code>: Evita que el compilador canviï el nom de la funció, permetent que sigui accessible des de C.</li>
<li><code>extern &quot;C&quot;</code>: Indica que la funció utilitza la convenció de crida de C.</li>
</ul>
</div><h2>Crida de Funcions C des de Rust</h2>
<div class='content'><p>Per cridar funcions C des de Rust, utilitzem la paraula clau <code>extern</code> i definim les funcions externes.</p>
</div><h3>Exemple</h3>
<div class='content'></div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZXh0ZXJuICJDIiB7CiAgICBmbiBwcmludGYoZm9ybWF0OiAqY29uc3QgaTgsIC4uLikgLT4gaTMyOwp9CgpmbiBtYWluKCkgewogICAgbGV0IG1lc3NhZ2UgPSBiIkhlbGxvIGZyb20gUnVzdCFcMCIgYXMgKmNvbnN0IHU4IGFzICpjb25zdCBpODsKICAgIHVuc2FmZSB7CiAgICAgICAgcHJpbnRmKG1lc3NhZ2UpOwogICAgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>extern &quot;C&quot; {
    fn printf(format: *const i8, ...) -&gt; i32;
}

fn main() {
    let message = b&quot;Hello from Rust!\0&quot; as *const u8 as *const i8;
    unsafe {
        printf(message);
    }
}</pre></div><div class='content'></div><h3>Explicació</h3>
<div class='content'><ul>
<li><code>extern &quot;C&quot;</code>: Indica que les funcions declarades utilitzen la convenció de crida de C.</li>
<li><code>unsafe</code>: Les crides a funcions externes són insegures perquè el compilador no pot verificar la seva seguretat.</li>
</ul>
</div><h2>Tipus de Dades Compatibles</h2>
<div class='content'><p>Quan es treballa amb FFI, és important assegurar-se que els tipus de dades utilitzats són compatibles entre Rust i el llenguatge estranger. Alguns tipus comuns són:</p>
<table>
<thead>
<tr>
<th>Rust</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>i32</code></td>
<td><code>int</code></td>
</tr>
<tr>
<td><code>u32</code></td>
<td><code>unsigned int</code></td>
</tr>
<tr>
<td><code>f32</code></td>
<td><code>float</code></td>
</tr>
<tr>
<td><code>f64</code></td>
<td><code>double</code></td>
</tr>
<tr>
<td><code>*const T</code></td>
<td><code>const T*</code></td>
</tr>
<tr>
<td><code>*mut T</code></td>
<td><code>T*</code></td>
</tr>
</tbody>
</table>
</div><h2>Exercici Pràctic</h2>
<div class='content'></div><h3>Exercici</h3>
<div class='content'><ol>
<li>Escriu una funció en C que sumi dos enters.</li>
<li>Escriu un programa en Rust que cridi aquesta funció C i imprimeixi el resultat.</li>
</ol>
</div><h3>Solució</h3>
<div class='content'><h4>Codi C</h4>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gc3VtLmMKaW50IHN1bShpbnQgYSwgaW50IGIpIHsKICAgIHJldHVybiBhICsgYjsKfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// sum.c
int sum(int a, int b) {
    return a + b;
}</pre></div><div class='content'><h4>Codi Rust</h4>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZXh0ZXJuICJDIiB7CiAgICBmbiBzdW0oYTogaTMyLCBiOiBpMzIpIC0+IGkzMjsKfQoKZm4gbWFpbigpIHsKICAgIGxldCByZXN1bHQgPSB1bnNhZmUgeyBzdW0oNSwgMykgfTsKICAgIHByaW50bG4hKCJUaGUgc3VtIGlzOiB7fSIsIHJlc3VsdCk7Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>extern &quot;C&quot; {
    fn sum(a: i32, b: i32) -&gt; i32;
}

fn main() {
    let result = unsafe { sum(5, 3) };
    println!(&quot;The sum is: {}&quot;, result);
}</pre></div><div class='content'></div><h3>Compilació i Execució</h3>
<div class='content'><ol>
<li>Compila el codi C:
<pre><code class="language-sh">gcc -c sum.c -o sum.o
</code></pre>
</li>
<li>Compila el codi Rust i enllaça amb l'objecte C:
<pre><code class="language-sh">rustc main.rs sum.o -o main
</code></pre>
</li>
<li>Executa el programa:
<pre><code class="language-sh">./main
</code></pre>
</li>
</ol>
</div><h2>Resum</h2>
<div class='content'><p>En aquesta secció, hem après com utilitzar la Interfície de Funció Estrangera (FFI) per permetre que el codi Rust interactuï amb codi escrit en altres llenguatges, com C. Hem vist com exposar funcions Rust a C, com cridar funcions C des de Rust, i la importància d'utilitzar tipus de dades compatibles. També hem realitzat un exercici pràctic per reforçar aquests conceptes.</p>
</div><div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='09-02-unsafe-rust' title="Rust Insegur" class="py-2 px-3 btn btn-primary">
				&#x25C4; Anterior 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='09-02-unsafe-rust' title="Rust Insegur" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='10-01-building-project' title="Construcció d'un Projecte" class="py-2 px-3 btn btn-primary"
				data-read-mod="rust" data-read-unit="9-3">
				Següent &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='10-01-building-project' title="Construcció d'un Projecte" class="py-2 px-3 btn btn-primary" 
				data-read-mod="rust" data-read-unit="9-3">
				 &#x25BA;
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
						
	<div class="container mt-2 d-none d-md-block index">
		<h1>Curs de Programació en Rust</h1>
<h2>Mòdul 1: Introducció a Rust</h2>
<ul>
<li><a href="01-01-what-is-rust">Què és Rust?</a></li>
<li><a href="01-02-setting-up-rust">Configuració de l'Entorn de Rust</a></li>
<li><a href="01-03-hello-world">Programa Hola, Món!</a></li>
<li><a href="01-04-basic-syntax">Sintaxi i Estructura Bàsica</a></li>
</ul>
<h2>Mòdul 2: Conceptes Bàsics</h2>
<ul>
<li><a href="02-01-variables-mutability">Variables i Mutabilitat</a></li>
<li><a href="02-02-data-types">Tipus de Dades</a></li>
<li><a href="02-03-functions">Funcions</a></li>
<li><a href="02-04-control-flow">Flux de Control</a></li>
</ul>
<h2>Mòdul 3: Propietat i Préstec</h2>
<ul>
<li><a href="03-01-understanding-ownership">Comprendre la Propietat</a></li>
<li><a href="03-02-references-borrowing">Referències i Préstec</a></li>
<li><a href="03-03-slices">Slices</a></li>
</ul>
<h2>Mòdul 4: Structs i Enums</h2>
<ul>
<li><a href="04-01-defining-structs">Definició de Structs</a></li>
<li><a href="04-02-using-structs">Ús de Structs</a></li>
<li><a href="04-03-enums-pattern-matching">Enums i Coincidència de Patrons</a></li>
</ul>
<h2>Mòdul 5: Col·leccions</h2>
<ul>
<li><a href="05-01-vectors">Vectors</a></li>
<li><a href="05-02-strings">Strings</a></li>
<li><a href="05-03-hashmaps">HashMaps</a></li>
</ul>
<h2>Mòdul 6: Gestió d'Errors</h2>
<ul>
<li><a href="06-01-error-handling-result">Gestió d'Errors amb Result</a></li>
<li><a href="06-02-error-handling-option">Gestió d'Errors amb Option</a></li>
<li><a href="06-03-panic-unwinding">Pànic i Desenrotllament</a></li>
</ul>
<h2>Mòdul 7: Conceptes Avançats</h2>
<ul>
<li><a href="07-01-lifetimes">Durades de Vida</a></li>
<li><a href="07-02-traits">Traits</a></li>
<li><a href="07-03-generics">Genèrics</a></li>
</ul>
<h2>Mòdul 8: Concurrència</h2>
<ul>
<li><a href="08-01-threads">Fils</a></li>
<li><a href="08-02-message-passing">Passatge de Missatges</a></li>
<li><a href="08-03-shared-state">Estat Compartit</a></li>
</ul>
<h2>Mòdul 9: Característiques Avançades</h2>
<ul>
<li><a href="09-01-macros">Macros</a></li>
<li><a href="09-02-unsafe-rust">Rust Insegur</a></li>
<li><a href="09-03-ffi">FFI (Interfície de Funció Estrangera)</a></li>
</ul>
<h2>Mòdul 10: Projecte i Millors Pràctiques</h2>
<ul>
<li><a href="10-01-building-project">Construcció d'un Projecte</a></li>
<li><a href="10-02-testing">Proves</a></li>
<li><a href="10-03-documentation">Documentació</a></li>
<li><a href="10-04-best-practices">Millors Pràctiques</a></li>
</ul>

	</div>










		</div>
	</div>
</div>		
<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objectiu" rel="nofollow">El Projecte</a> | 
<a href="/sobre-nosaltres" rel="nofollow">Sobre nosaltres</a> | 
<a href="/contribuir" rel="nofollow">Contribuir</a> | 
<a href="/donar" rel="nofollow">Donacions</a> | 
<a href="/llicencia" rel="nofollow">Llicència</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

		<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">Usuari no autentificat</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            	<div id="modal-body-main"></div>
            </div>
        </div>
    </div>
</div>	</div>    
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
