<!DOCTYPE html>
<html lang="ca">
<head>
    <title> Estat Compartit </title>
        
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow, noarchive">
    
    <link rel="alternate" href="https://campusempresa.com/cursos/rust/08-03-shared-state" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/cursos/rust/08-03-shared-state" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/courses/rust/08-03-shared-state" hreflang="en" />
    
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.1ab297bfa4.css" rel="stylesheet">
	 
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script>
  		var LANG = "ca";
  		var CATEGORY = "languages";
  		var MOD_NAME = "rust";
  		var TEMA_NAME = "8-3";
  		var TYPE = "mod";
  		var PATH = "mod/rust/08-03-shared-state";
  		var IS_INDEX = false;
  	</script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="module" src="/js/app.8d8afe898f.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>
	  	
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-VVPMPJSR3P"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());	
	  gtag('config', 'G-VVPMPJSR3P');
	</script>
</head>

<body class="d-none">
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-0">
			<a href="/"><img src="/img/logo_header.png" alt="Logo Campus Empresa"></a>
		</div>
		<div class="col-12 col-md-6 p-0 text-end">
			<p class="mb-0 p-0">	<a href="https://enterprisecampus.net/courses/rust/08-03-shared-state" class="px-2">EN</a></b>
	|
	<a href="https://campusempresa.com/cursos/rust/08-03-shared-state" class="px-2">ES</a></b>
	|
	<b class="px-2">CA</b>
</p>
			<p class="mb-4 mt-0 mx-2  d-none d-md-block"><cite>Tot el coneixement al teu abast</cite></p>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objectiu" rel="nofollow">El Projecte</a> | 
<a href="/sobre-nosaltres" rel="nofollow">Sobre nosaltres</a> | 
<a href="/contribuir" rel="nofollow">Contribuir</a> | 
<a href="/donar" rel="nofollow">Donacions</a> | 
<a href="/llicencia" rel="nofollow">Llicència</a>
		</div>
	</div>
</div>
		<div class="top-bar container-fluid p-0">
	<div class="container-xxl p-0">
		<div class="row">
			<div class="col">
				<div class="d-flex justify-content-between">
					<div class="left">
						<a href="/" class="nav-link px-3" id="btnHome">
	<i class="bi bi-house-fill"></i>
	HOME
</a>

<a href="/els-meus-cursos" class="nav-link px-3 d-none" id="btnMyCourses">
	<i class="bi bi-rocket-takeoff-fill"></i>
	<i><b>Els meus cursos</b></i>
</a>
<a href="/cursos-finalitzats" class="nav-link px-3 d-none" id="trophy_button">
	<i class="bi bi-trophy-fill"></i>
	Finalitzats             
</a>

					</div>
                    <div class="ms-auto right">
                        <a id="user_button" href="#" class="nav-link px-3" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i id="user_icon" class="bi"></i>                            
                        </a>
                    </div>					
				</div>
			</div>
		</div>
	</div>
</div>

		<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
										<div class="row py-1 m-0" id="buttonsModSection">
	<div class="col-6 p-0" data-mod="rust">
		<a  href="#" class="text-secondary d-none" data-read-mod="rust" data-read-unit="8-3" style="text-decoration:none;">
			<i class="bi bi-check-circle-fill"></i> 
			Marcar com a llegit
		</a>
		<a href="#" class="text-secondary d-none" data-unread-mod="rust" data-unread-unit="8-3" style="text-decoration:none;">
			<i class="bi bi-x-circle-fill"></i>
			Marcar com a no llegit
		</a>
	</div>
	<div class="col-6 text-end p-0">
					<a href="./"  class="nav-link">
				<i class="bi bi-journal-text"></i>
				Contingut del curs
			</a>
			</div>
</div>						<div id="inner_content">
				<div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='08-02-message-passing' title="Passatge de Missatges" class="py-2 px-3 btn btn-primary">
				&#x25C4; Anterior 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='08-02-message-passing' title="Passatge de Missatges" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
					<h1 style="text-decoration:underline">Estat Compartit</h1>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='09-01-macros' title="Macros" class="py-2 px-3 btn btn-primary"
				data-read-mod="rust" data-read-unit="8-3">
				Següent &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='09-01-macros' title="Macros" class="py-2 px-3 btn btn-primary" 
				data-read-mod="rust" data-read-unit="8-3">
				 &#x25BA;
			</a>
			</div>
</div>
<div class='content'><p>En aquest tema, explorarem com gestionar l'estat compartit en programes concurrents en Rust. La concurrència és una característica poderosa que permet que múltiples parts d'un programa s'executin simultàniament, però també introdueix complexitat, especialment quan es tracta de compartir dades entre fils.</p>
</div><h2>Objectius d'Aprenentatge</h2>
<div class='content'><p>Al final d'aquest tema, hauràs après:</p>
<ul>
<li>Com utilitzar <code>Mutex</code> per protegir l'accés a dades compartides.</li>
<li>Com utilitzar <code>Arc</code> per compartir dades entre fils de manera segura.</li>
<li>Com evitar condicions de carrera i bloquejos.</li>
</ul>
</div><h2><ol>
<li>Introducció a <code>Mutex</code></li>
</ol></h2>
<div class='content'><p>Un <code>Mutex</code> (abreviatura de &quot;mutual exclusion&quot;) és una estructura que garanteix que només un fil pugui accedir a una dada compartida en un moment donat. Això ajuda a evitar condicions de carrera, on múltiples fils accedeixen i modifiquen dades simultàniament de manera no segura.</p>
</div><h3>Exemple Bàsic de <code>Mutex</code></h3>
<div class='content'></div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNlIHN0ZDo6c3luYzo6TXV0ZXg7CgpmbiBtYWluKCkgewogICAgbGV0IG0gPSBNdXRleDo6bmV3KDUpOwoKICAgIHsKICAgICAgICBsZXQgbXV0IG51bSA9IG0ubG9jaygpLnVud3JhcCgpOwogICAgICAgICpudW0gPSA2OwogICAgfQoKICAgIHByaW50bG4hKCJtID0gezo/fSIsIG0pOwp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>use std::sync::Mutex;

fn main() {
    let m = Mutex::new(5);

    {
        let mut num = m.lock().unwrap();
        *num = 6;
    }

    println!(&quot;m = {:?}&quot;, m);
}</pre></div><div class='content'><p><strong>Explicació:</strong></p>
<ul>
<li><code>Mutex::new(5)</code> crea un nou <code>Mutex</code> que conté el valor 5.</li>
<li><code>m.lock().unwrap()</code> bloqueja el <code>Mutex</code> per obtenir accés exclusiu a les dades. Si un altre fil ja ha bloquejat el <code>Mutex</code>, aquest fil esperarà fins que el <code>Mutex</code> estigui disponible.</li>
<li><code>*num = 6</code> modifica el valor protegit pel <code>Mutex</code>.</li>
<li>Quan <code>num</code> surt de l'àmbit, el <code>Mutex</code> es desbloqueja automàticament.</li>
</ul>
</div><h2><ol start="2">
<li>Compartir Dades entre Fils amb <code>Arc</code></li>
</ol></h2>
<div class='content'><p><code>Arc</code> (abreviatura de &quot;atomic reference counting&quot;) és una estructura que permet compartir dades entre múltiples fils de manera segura. <code>Arc</code> és similar a <code>Rc</code>, però és segur per a l'ús concurrent.</p>
</div><h3>Exemple de <code>Arc</code> amb <code>Mutex</code></h3>
<div class='content'></div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNlIHN0ZDo6c3luYzo6e0FyYywgTXV0ZXh9Owp1c2Ugc3RkOjp0aHJlYWQ7CgpmbiBtYWluKCkgewogICAgbGV0IGNvdW50ZXIgPSBBcmM6Om5ldyhNdXRleDo6bmV3KDApKTsKICAgIGxldCBtdXQgaGFuZGxlcyA9IHZlYyFbXTsKCiAgICBmb3IgXyBpbiAwLi4xMCB7CiAgICAgICAgbGV0IGNvdW50ZXIgPSBBcmM6OmNsb25lKCZjb3VudGVyKTsKICAgICAgICBsZXQgaGFuZGxlID0gdGhyZWFkOjpzcGF3bihtb3ZlIHx8IHsKICAgICAgICAgICAgbGV0IG11dCBudW0gPSBjb3VudGVyLmxvY2soKS51bndyYXAoKTsKICAgICAgICAgICAgKm51bSArPSAxOwogICAgICAgIH0pOwogICAgICAgIGhhbmRsZXMucHVzaChoYW5kbGUpOwogICAgfQoKICAgIGZvciBoYW5kbGUgaW4gaGFuZGxlcyB7CiAgICAgICAgaGFuZGxlLmpvaW4oKS51bndyYXAoKTsKICAgIH0KCiAgICBwcmludGxuISgiUmVzdWx0OiB7fSIsICpjb3VudGVyLmxvY2soKS51bndyYXAoKSk7Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>use std::sync::{Arc, Mutex};
use std::thread;

fn main() {
    let counter = Arc::new(Mutex::new(0));
    let mut handles = vec![];

    for _ in 0..10 {
        let counter = Arc::clone(&amp;counter);
        let handle = thread::spawn(move || {
            let mut num = counter.lock().unwrap();
            *num += 1;
        });
        handles.push(handle);
    }

    for handle in handles {
        handle.join().unwrap();
    }

    println!(&quot;Result: {}&quot;, *counter.lock().unwrap());
}</pre></div><div class='content'><p><strong>Explicació:</strong></p>
<ul>
<li><code>Arc::new(Mutex::new(0))</code> crea un <code>Arc</code> que conté un <code>Mutex</code> inicialitzat a 0.</li>
<li><code>Arc::clone(&amp;counter)</code> crea una nova referència al <code>Arc</code> original, permetent que múltiples fils comparteixin el mateix <code>Mutex</code>.</li>
<li><code>thread::spawn(move || { ... })</code> crea un nou fil que incrementa el valor protegit pel <code>Mutex</code>.</li>
<li><code>handle.join().unwrap()</code> espera que cada fil acabi la seva execució.</li>
<li>Finalment, es mostra el valor del <code>counter</code>, que ha estat incrementat per cada fil.</li>
</ul>
</div><h2><ol start="3">
<li>Evitar Condicions de Carrera i Bloquejos</li>
</ol></h2>
<div class='content'></div><h3>Condicions de Carrera</h3>
<div class='content'><p>Una condició de carrera ocorre quan múltiples fils accedeixen i modifiquen dades compartides simultàniament de manera no segura. L'ús de <code>Mutex</code> ajuda a evitar aquestes condicions, però és important assegurar-se que tots els accessos a les dades compartides estiguin protegits per un <code>Mutex</code>.</p>
</div><h3>Bloquejos</h3>
<div class='content'><p>Un bloqueig ocorre quan dos o més fils esperen indefinidament per recursos que estan bloquejats per altres fils. Per evitar bloquejos:</p>
<ul>
<li>Mantingues el codi dins d'una secció crítica (el codi que està protegit per un <code>Mutex</code>) tan curt com sigui possible.</li>
<li>Evita bloquejar múltiples <code>Mutex</code> al mateix temps.</li>
</ul>
</div><h2>Exercici Pràctic</h2>
<div class='content'></div><h3>Exercici</h3>
<div class='content'><p>Crea un programa que utilitzi <code>Arc</code> i <code>Mutex</code> per compartir un vector entre múltiples fils. Cada fil ha d'afegir un número al vector.</p>
</div><h3>Solució</h3>
<div class='content'></div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNlIHN0ZDo6c3luYzo6e0FyYywgTXV0ZXh9Owp1c2Ugc3RkOjp0aHJlYWQ7CgpmbiBtYWluKCkgewogICAgbGV0IGRhdGEgPSBBcmM6Om5ldyhNdXRleDo6bmV3KHZlYyFbXSkpOwogICAgbGV0IG11dCBoYW5kbGVzID0gdmVjIVtdOwoKICAgIGZvciBpIGluIDAuLjEwIHsKICAgICAgICBsZXQgZGF0YSA9IEFyYzo6Y2xvbmUoJmRhdGEpOwogICAgICAgIGxldCBoYW5kbGUgPSB0aHJlYWQ6OnNwYXduKG1vdmUgfHwgewogICAgICAgICAgICBsZXQgbXV0IHZlYyA9IGRhdGEubG9jaygpLnVud3JhcCgpOwogICAgICAgICAgICB2ZWMucHVzaChpKTsKICAgICAgICB9KTsKICAgICAgICBoYW5kbGVzLnB1c2goaGFuZGxlKTsKICAgIH0KCiAgICBmb3IgaGFuZGxlIGluIGhhbmRsZXMgewogICAgICAgIGhhbmRsZS5qb2luKCkudW53cmFwKCk7CiAgICB9CgogICAgcHJpbnRsbiEoIlJlc3VsdDogezo/fSIsICpkYXRhLmxvY2soKS51bndyYXAoKSk7Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>use std::sync::{Arc, Mutex};
use std::thread;

fn main() {
    let data = Arc::new(Mutex::new(vec![]));
    let mut handles = vec![];

    for i in 0..10 {
        let data = Arc::clone(&amp;data);
        let handle = thread::spawn(move || {
            let mut vec = data.lock().unwrap();
            vec.push(i);
        });
        handles.push(handle);
    }

    for handle in handles {
        handle.join().unwrap();
    }

    println!(&quot;Result: {:?}&quot;, *data.lock().unwrap());
}</pre></div><div class='content'><p><strong>Explicació:</strong></p>
<ul>
<li><code>Arc::new(Mutex::new(vec![]))</code> crea un <code>Arc</code> que conté un <code>Mutex</code> inicialitzat amb un vector buit.</li>
<li>Cada fil afegeix un número al vector protegit pel <code>Mutex</code>.</li>
<li>Finalment, es mostra el contingut del vector.</li>
</ul>
</div><h2>Resum</h2>
<div class='content'><p>En aquest tema, hem après com utilitzar <code>Mutex</code> per protegir l'accés a dades compartides i <code>Arc</code> per compartir dades entre fils de manera segura. També hem discutit com evitar condicions de carrera i bloquejos. Aquests conceptes són fonamentals per escriure programes concurrents segurs i eficients en Rust.</p>
</div><div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='08-02-message-passing' title="Passatge de Missatges" class="py-2 px-3 btn btn-primary">
				&#x25C4; Anterior 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='08-02-message-passing' title="Passatge de Missatges" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='09-01-macros' title="Macros" class="py-2 px-3 btn btn-primary"
				data-read-mod="rust" data-read-unit="8-3">
				Següent &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='09-01-macros' title="Macros" class="py-2 px-3 btn btn-primary" 
				data-read-mod="rust" data-read-unit="8-3">
				 &#x25BA;
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
						
	<div class="container mt-2 d-none d-md-block index">
		<h1>Curs de Programació en Rust</h1>
<h2>Mòdul 1: Introducció a Rust</h2>
<ul>
<li><a href="01-01-what-is-rust">Què és Rust?</a></li>
<li><a href="01-02-setting-up-rust">Configuració de l'Entorn de Rust</a></li>
<li><a href="01-03-hello-world">Programa Hola, Món!</a></li>
<li><a href="01-04-basic-syntax">Sintaxi i Estructura Bàsica</a></li>
</ul>
<h2>Mòdul 2: Conceptes Bàsics</h2>
<ul>
<li><a href="02-01-variables-mutability">Variables i Mutabilitat</a></li>
<li><a href="02-02-data-types">Tipus de Dades</a></li>
<li><a href="02-03-functions">Funcions</a></li>
<li><a href="02-04-control-flow">Flux de Control</a></li>
</ul>
<h2>Mòdul 3: Propietat i Préstec</h2>
<ul>
<li><a href="03-01-understanding-ownership">Comprendre la Propietat</a></li>
<li><a href="03-02-references-borrowing">Referències i Préstec</a></li>
<li><a href="03-03-slices">Slices</a></li>
</ul>
<h2>Mòdul 4: Structs i Enums</h2>
<ul>
<li><a href="04-01-defining-structs">Definició de Structs</a></li>
<li><a href="04-02-using-structs">Ús de Structs</a></li>
<li><a href="04-03-enums-pattern-matching">Enums i Coincidència de Patrons</a></li>
</ul>
<h2>Mòdul 5: Col·leccions</h2>
<ul>
<li><a href="05-01-vectors">Vectors</a></li>
<li><a href="05-02-strings">Strings</a></li>
<li><a href="05-03-hashmaps">HashMaps</a></li>
</ul>
<h2>Mòdul 6: Gestió d'Errors</h2>
<ul>
<li><a href="06-01-error-handling-result">Gestió d'Errors amb Result</a></li>
<li><a href="06-02-error-handling-option">Gestió d'Errors amb Option</a></li>
<li><a href="06-03-panic-unwinding">Pànic i Desenrotllament</a></li>
</ul>
<h2>Mòdul 7: Conceptes Avançats</h2>
<ul>
<li><a href="07-01-lifetimes">Durades de Vida</a></li>
<li><a href="07-02-traits">Traits</a></li>
<li><a href="07-03-generics">Genèrics</a></li>
</ul>
<h2>Mòdul 8: Concurrència</h2>
<ul>
<li><a href="08-01-threads">Fils</a></li>
<li><a href="08-02-message-passing">Passatge de Missatges</a></li>
<li><a href="08-03-shared-state">Estat Compartit</a></li>
</ul>
<h2>Mòdul 9: Característiques Avançades</h2>
<ul>
<li><a href="09-01-macros">Macros</a></li>
<li><a href="09-02-unsafe-rust">Rust Insegur</a></li>
<li><a href="09-03-ffi">FFI (Interfície de Funció Estrangera)</a></li>
</ul>
<h2>Mòdul 10: Projecte i Millors Pràctiques</h2>
<ul>
<li><a href="10-01-building-project">Construcció d'un Projecte</a></li>
<li><a href="10-02-testing">Proves</a></li>
<li><a href="10-03-documentation">Documentació</a></li>
<li><a href="10-04-best-practices">Millors Pràctiques</a></li>
</ul>

	</div>










		</div>
	</div>
</div>		
<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objectiu" rel="nofollow">El Projecte</a> | 
<a href="/sobre-nosaltres" rel="nofollow">Sobre nosaltres</a> | 
<a href="/contribuir" rel="nofollow">Contribuir</a> | 
<a href="/donar" rel="nofollow">Donacions</a> | 
<a href="/llicencia" rel="nofollow">Llicència</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

		<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">Usuari no autentificat</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            	<div id="modal-body-main"></div>
            </div>
        </div>
    </div>
</div>	</div>    
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
