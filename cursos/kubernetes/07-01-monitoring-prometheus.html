<!DOCTYPE html>
<html lang="ca">
<head>
    <title> Monitorització amb Prometheus </title>
        
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow, noarchive">
    
    <link rel="alternate" href="https://campusempresa.com/cursos/kubernetes/07-01-monitoring-prometheus" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/cursos/kubernetes/07-01-monitoring-prometheus" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/courses/kubernetes/07-01-monitoring-prometheus" hreflang="en" />
    
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.1ab297bfa4.css" rel="stylesheet">
	 
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script>
  		var LANG = "ca";
  		var CATEGORY = "frameworks";
  		var MOD_NAME = "kubernetes";
  		var TEMA_NAME = "7-1";
  		var TYPE = "mod";
  		var PATH = "mod/kubernetes/07-01-monitoring-prometheus";
  		var IS_INDEX = false;
  	</script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="module" src="/js/app.ae32789132.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>
	  	
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-VVPMPJSR3P"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());	
	  gtag('config', 'G-VVPMPJSR3P');
	</script>
</head>

<body class="d-none">
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-0">
			<a href="/"><img src="/img/logo_header.png" alt="Logo Campus Empresa"></a>
		</div>
		<div class="col-12 col-md-6 p-0 text-end">
			<p class="mb-0 p-0">	<a href="https://enterprisecampus.net/courses/kubernetes/07-01-monitoring-prometheus" class="px-2">EN</a></b>
	|
	<a href="https://campusempresa.com/cursos/kubernetes/07-01-monitoring-prometheus" class="px-2">ES</a></b>
	|
	<b class="px-2">CA</b>
</p>
			<p class="mb-4 mt-0 mx-2  d-none d-md-block"><cite>Tot el coneixement al teu abast</cite></p>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objectiu" rel="nofollow">El Projecte</a> | 
<a href="/sobre-nosaltres" rel="nofollow">Sobre nosaltres</a> | 
<a href="/contribuir" rel="nofollow">Contribuir</a> | 
<a href="/donar" rel="nofollow">Donacions</a> | 
<a href="/llicencia" rel="nofollow">Llicència</a>
		</div>
	</div>
</div>
		<div class="top-bar container-fluid p-0">
	<div class="container-xxl p-0">
		<div class="row">
			<div class="col">
				<div class="d-flex justify-content-between">
					<div class="left">
						<a href="/" class="nav-link px-3" id="btnHome">
	<i class="bi bi-house-fill"></i>
	HOME
</a>

<a href="/els-meus-cursos" class="nav-link px-3 d-none" id="btnMyCourses">
	<i class="bi bi-rocket-takeoff-fill"></i>
	<i><b>Els meus cursos</b></i>
</a>
<a href="/cursos-finalitzats" class="nav-link px-3 d-none" id="trophy_button">
	<i class="bi bi-trophy-fill"></i>
	Finalitzats             
</a>

					</div>
                    <div class="ms-auto right">
                        <a id="user_button" href="#" class="nav-link px-3" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i id="user_icon" class="bi"></i>                            
                        </a>
                    </div>					
				</div>
			</div>
		</div>
	</div>
</div>

		<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
										<div class="row py-1 m-0" id="buttonsModSection">
	<div class="col-6 p-0" data-mod="kubernetes">
		<a  href="#" class="text-secondary d-none" data-read-mod="kubernetes" data-read-unit="7-1" style="text-decoration:none;">
			<i class="bi bi-check-circle-fill"></i> 
			Marcar com a llegit
		</a>
		<a href="#" class="text-secondary d-none" data-unread-mod="kubernetes" data-unread-unit="7-1" style="text-decoration:none;">
			<i class="bi bi-x-circle-fill"></i>
			Marcar com a no llegit
		</a>
	</div>
	<div class="col-6 text-end p-0">
					<a href="./"  class="nav-link">
				<i class="bi bi-journal-text"></i>
				Contingut del curs
			</a>
			</div>
</div>						<div id="inner_content">
				<div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='06-04-crds' title="Definicions de Recursos Personalitzats (CRDs)" class="py-2 px-3 btn btn-primary">
				&#x25C4; Anterior 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='06-04-crds' title="Definicions de Recursos Personalitzats (CRDs)" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
					<h1 style="text-decoration:underline">Monitorització amb Prometheus</h1>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='07-02-logging-efk' title="Registre amb Elasticsearch, Fluentd i Kibana (EFK)" class="py-2 px-3 btn btn-primary"
				data-read-mod="kubernetes" data-read-unit="7-1">
				Següent &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='07-02-logging-efk' title="Registre amb Elasticsearch, Fluentd i Kibana (EFK)" class="py-2 px-3 btn btn-primary" 
				data-read-mod="kubernetes" data-read-unit="7-1">
				 &#x25BA;
			</a>
			</div>
</div>
<div class='content'></div><h2>Introducció</h2>
<div class='content'><p>Prometheus és una eina de monitorització i alerta de codi obert dissenyada per recollir i processar dades de mètriques en temps real. És àmpliament utilitzada en entorns de Kubernetes per la seva capacitat de gestionar grans volums de dades i la seva integració amb altres eines com Grafana per a la visualització de dades.</p>
</div><h2>Objectius d'Aprenentatge</h2>
<div class='content'><p>En aquesta secció, aprendràs:</p>
<ul>
<li>Què és Prometheus i com funciona.</li>
<li>Com desplegar Prometheus en un clúster de Kubernetes.</li>
<li>Com configurar Prometheus per recollir mètriques de les aplicacions.</li>
<li>Com utilitzar Grafana per visualitzar les mètriques recollides per Prometheus.</li>
</ul>
</div><h2>Què és Prometheus?</h2>
<div class='content'><p>Prometheus és un sistema de monitorització i alerta que recull mètriques de diverses fonts, les emmagatzema en una base de dades de sèries temporals i permet realitzar consultes sobre aquestes dades utilitzant el seu llenguatge de consulta, PromQL.</p>
</div><h3>Característiques Clau de Prometheus</h3>
<div class='content'><ul>
<li><strong>Model de dades de sèries temporals</strong>: Emmagatzema les dades com a sèries temporals, que són seqüències de dades amb marques de temps.</li>
<li><strong>PromQL</strong>: Un llenguatge de consulta potent per extreure i analitzar dades.</li>
<li><strong>Alertes</strong>: Permet definir regles d'alerta que poden enviar notificacions quan es compleixen determinades condicions.</li>
<li><strong>Exportadors</strong>: Components que recullen mètriques de diverses fonts i les exposen a Prometheus.</li>
</ul>
</div><h2>Desplegament de Prometheus en Kubernetes</h2>
<div class='content'></div><h3>Pas 1: Instal·lació de Prometheus</h3>
<div class='content'><p>Per instal·lar Prometheus en un clúster de Kubernetes, podem utilitzar Helm, una eina de gestió de paquets per Kubernetes.</p>
<ol>
<li>
<p><strong>Instal·la Helm</strong> (si no ho tens instal·lat):</p>
<pre><code class="language-bash">curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash
</code></pre>
</li>
<li>
<p><strong>Afegeix el repositori de Helm per Prometheus</strong>:</p>
<pre><code class="language-bash">helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update
</code></pre>
</li>
<li>
<p><strong>Instal·la Prometheus utilitzant Helm</strong>:</p>
<pre><code class="language-bash">helm install prometheus prometheus-community/prometheus
</code></pre>
</li>
</ol>
</div><h3>Pas 2: Configuració de Prometheus</h3>
<div class='content'><p>Després d'instal·lar Prometheus, necessitem configurar-lo per recollir mètriques de les nostres aplicacions.</p>
<ol>
<li>
<p><strong>Crea un fitxer de configuració per Prometheus</strong> (<code>prometheus-config.yaml</code>):</p>
<pre><code class="language-yaml">global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'kubernetes-apiservers'
    kubernetes_sd_configs:
      - role: endpoints
    relabel_configs:
      - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
        action: keep
        regex: default;kubernetes;https

  - job_name: 'kubernetes-nodes'
    kubernetes_sd_configs:
      - role: node
    relabel_configs:
      - action: labelmap
        regex: __meta_kubernetes_node_label_(.+)
      - target_label: __address__
        replacement: kubernetes.default.svc:443
      - source_labels: [__meta_kubernetes_node_name]
        regex: (.+)
        target_label: __metrics_path__
        replacement: /api/v1/nodes/${1}/proxy/metrics
</code></pre>
</li>
<li>
<p><strong>Aplica la configuració a Prometheus</strong>:</p>
<pre><code class="language-bash">kubectl apply -f prometheus-config.yaml
</code></pre>
</li>
</ol>
</div><h2>Visualització de Mètriques amb Grafana</h2>
<div class='content'><p>Grafana és una eina de visualització de dades que es pot integrar amb Prometheus per crear panells de control interactius.</p>
</div><h3>Pas 1: Instal·lació de Grafana</h3>
<div class='content'><ol>
<li>
<p><strong>Instal·la Grafana utilitzant Helm</strong>:</p>
<pre><code class="language-bash">helm install grafana grafana/grafana
</code></pre>
</li>
<li>
<p><strong>Obté la contrasenya per defecte de Grafana</strong>:</p>
<pre><code class="language-bash">kubectl get secret --namespace default grafana -o jsonpath=&quot;{.data.admin-password}&quot; | base64 --decode ; echo
</code></pre>
</li>
<li>
<p><strong>Accedeix a la interfície web de Grafana</strong>:</p>
<ul>
<li>Obre un navegador web i ves a <code>http://&lt;grafana-ip&gt;:3000</code>.</li>
<li>Inicia sessió amb el nom d'usuari <code>admin</code> i la contrasenya obtinguda en el pas anterior.</li>
</ul>
</li>
</ol>
</div><h3>Pas 2: Configuració de Grafana per utilitzar Prometheus</h3>
<div class='content'><ol>
<li>
<p><strong>Afegeix Prometheus com a font de dades</strong>:</p>
<ul>
<li>Ves a <code>Configuration</code> &gt; <code>Data Sources</code> &gt; <code>Add data source</code>.</li>
<li>Selecciona <code>Prometheus</code>.</li>
<li>Introdueix l'URL de Prometheus (<code>http://prometheus-server.default.svc.cluster.local:9090</code>).</li>
<li>Fes clic a <code>Save &amp; Test</code>.</li>
</ul>
</li>
<li>
<p><strong>Crea un panell de control</strong>:</p>
<ul>
<li>Ves a <code>Create</code> &gt; <code>Dashboard</code>.</li>
<li>Afegeix un nou panell (<code>Add new panel</code>).</li>
<li>Selecciona la font de dades <code>Prometheus</code>.</li>
<li>Escriu una consulta PromQL per obtenir les mètriques que vols visualitzar, per exemple:
<pre><code class="language-promql">sum(rate(http_requests_total[5m])) by (job)
</code></pre>
</li>
<li>Guarda el panell (<code>Save</code>).</li>
</ul>
</li>
</ol>
</div><h2>Exercici Pràctic</h2>
<div class='content'></div><h3>Objectiu</h3>
<div class='content'><p>Desplegar Prometheus i Grafana en un clúster de Kubernetes i configurar-los per recollir i visualitzar mètriques d'una aplicació simple.</p>
</div><h3>Passos</h3>
<div class='content'><ol>
<li>
<p><strong>Desplega una aplicació simple en Kubernetes</strong> (per exemple, una aplicació Nginx):</p>
<pre><code class="language-bash">kubectl create deployment nginx --image=nginx
kubectl expose deployment nginx --port=80 --type=NodePort
</code></pre>
</li>
<li>
<p><strong>Instal·la Prometheus i Grafana seguint els passos anteriors</strong>.</p>
</li>
<li>
<p><strong>Configura Prometheus per recollir mètriques de l'aplicació Nginx</strong>.</p>
</li>
<li>
<p><strong>Crea un panell de control en Grafana per visualitzar les mètriques de Nginx</strong>.</p>
</li>
</ol>
</div><h3>Solució</h3>
<div class='content'><ol>
<li>
<p><strong>Desplegament de Nginx</strong>:</p>
<pre><code class="language-bash">kubectl create deployment nginx --image=nginx
kubectl expose deployment nginx --port=80 --type=NodePort
</code></pre>
</li>
<li>
<p><strong>Instal·lació de Prometheus i Grafana</strong>:</p>
<ul>
<li>Segueix els passos descrits en les seccions anteriors.</li>
</ul>
</li>
<li>
<p><strong>Configuració de Prometheus</strong>:</p>
<ul>
<li>Afegeix una nova configuració de <code>scrape_config</code> per Nginx en el fitxer <code>prometheus-config.yaml</code>:
<pre><code class="language-yaml">- job_name: 'nginx'
  kubernetes_sd_configs:
    - role: endpoints
  relabel_configs:
    - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
      action: keep
      regex: default;nginx;http
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>Creació del panell de control en Grafana</strong>:</p>
<ul>
<li>Afegeix una nova consulta PromQL per obtenir les mètriques de Nginx, per exemple:
<pre><code class="language-promql">sum(rate(nginx_http_requests_total[5m])) by (job)
</code></pre>
</li>
</ul>
</li>
</ol>
</div><h2>Conclusió</h2>
<div class='content'><p>En aquesta secció, hem après a desplegar i configurar Prometheus en un clúster de Kubernetes per recollir mètriques de les nostres aplicacions. També hem vist com utilitzar Grafana per visualitzar aquestes mètriques de manera efectiva. Aquestes eines són essencials per mantenir la salut i el rendiment de les aplicacions en un entorn de Kubernetes.</p>
</div><div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='06-04-crds' title="Definicions de Recursos Personalitzats (CRDs)" class="py-2 px-3 btn btn-primary">
				&#x25C4; Anterior 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='06-04-crds' title="Definicions de Recursos Personalitzats (CRDs)" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='07-02-logging-efk' title="Registre amb Elasticsearch, Fluentd i Kibana (EFK)" class="py-2 px-3 btn btn-primary"
				data-read-mod="kubernetes" data-read-unit="7-1">
				Següent &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='07-02-logging-efk' title="Registre amb Elasticsearch, Fluentd i Kibana (EFK)" class="py-2 px-3 btn btn-primary" 
				data-read-mod="kubernetes" data-read-unit="7-1">
				 &#x25BA;
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
						
	<div class="container mt-2 d-none d-md-block index">
		<h1>Curs de Kubernetes</h1>
<h2>Mòdul 1: Introducció a Kubernetes</h2>
<ul>
<li><a href="01-01-what-is-kubernetes">Què és Kubernetes?</a></li>
<li><a href="01-02-kubernetes-architecture">Arquitectura de Kubernetes</a></li>
<li><a href="01-03-key-concepts-terminology">Conceptes i Terminologia Clau</a></li>
<li><a href="01-04-setting-up-cluster">Configuració d'un Clúster de Kubernetes</a></li>
<li><a href="01-05-kubernetes-cli">CLI de Kubernetes (kubectl)</a></li>
</ul>
<h2>Mòdul 2: Components Bàsics de Kubernetes</h2>
<ul>
<li><a href="02-01-pods">Pods</a></li>
<li><a href="02-02-replicasets">ReplicaSets</a></li>
<li><a href="02-03-deployments">Deployments</a></li>
<li><a href="02-04-services">Serveis</a></li>
<li><a href="02-05-namespaces">Namespaces</a></li>
</ul>
<h2>Mòdul 3: Gestió de Configuració i Secrets</h2>
<ul>
<li><a href="03-01-configmaps">ConfigMaps</a></li>
<li><a href="03-02-secrets">Secrets</a></li>
<li><a href="03-03-environment-variables">Variables d'Entorn</a></li>
<li><a href="03-04-resource-quotas-limits">Quotes i Límits de Recursos</a></li>
</ul>
<h2>Mòdul 4: Xarxes en Kubernetes</h2>
<ul>
<li><a href="04-01-cluster-networking">Xarxes de Clúster</a></li>
<li><a href="04-02-service-types">Tipus de Serveis</a></li>
<li><a href="04-03-ingress-controllers">Ingress Controllers</a></li>
<li><a href="04-04-network-policies">Polítiques de Xarxa</a></li>
</ul>
<h2>Mòdul 5: Emmagatzematge en Kubernetes</h2>
<ul>
<li><a href="05-01-volumes">Volums</a></li>
<li><a href="05-02-persistent-volumes">Volums Persistents</a></li>
<li><a href="05-03-persistent-volume-claims">Reclamacions de Volums Persistents</a></li>
<li><a href="05-04-storage-classes">Classes d'Emmagatzematge</a></li>
</ul>
<h2>Mòdul 6: Conceptes Avançats de Kubernetes</h2>
<ul>
<li><a href="06-01-statefulsets">StatefulSets</a></li>
<li><a href="06-02-daemonsets">DaemonSets</a></li>
<li><a href="06-03-jobs-cronjobs">Feines i Feines Programades</a></li>
<li><a href="06-04-crds">Definicions de Recursos Personalitzats (CRDs)</a></li>
</ul>
<h2>Mòdul 7: Monitorització i Registre</h2>
<ul>
<li><a href="07-01-monitoring-prometheus">Monitorització amb Prometheus</a></li>
<li><a href="07-02-logging-efk">Registre amb Elasticsearch, Fluentd i Kibana (EFK)</a></li>
<li><a href="07-03-health-checks-probes">Controls de Salut i Probes</a></li>
<li><a href="07-04-metrics-server">Servidor de Mètriques</a></li>
</ul>
<h2>Mòdul 8: Seguretat en Kubernetes</h2>
<ul>
<li><a href="08-01-rbac">Control d'Accés Basat en Rols (RBAC)</a></li>
<li><a href="08-02-pod-security-policies">Polítiques de Seguretat de Pods</a></li>
<li><a href="08-03-network-security">Seguretat de Xarxa</a></li>
<li><a href="08-04-image-security">Seguretat d'Imatges</a></li>
</ul>
<h2>Mòdul 9: Escalabilitat i Rendiment</h2>
<ul>
<li><a href="09-01-horizontal-pod-autoscaling">Autoscalat Horitzontal de Pods</a></li>
<li><a href="09-02-vertical-pod-autoscaling">Autoscalat Vertical de Pods</a></li>
<li><a href="09-03-cluster-autoscaling">Autoscalat de Clúster</a></li>
<li><a href="09-04-performance-tuning">Optimització del Rendiment</a></li>
</ul>
<h2>Mòdul 10: Ecosistema i Eines de Kubernetes</h2>
<ul>
<li><a href="10-01-helm">Helm</a></li>
<li><a href="10-02-kustomize">Kustomize</a></li>
<li><a href="10-03-kubeadm">Kubeadm</a></li>
<li><a href="10-04-minikube">Minikube</a></li>
</ul>
<h2>Mòdul 11: Estudis de Cas i Aplicacions del Món Real</h2>
<ul>
<li><a href="11-01-deploying-web-application">Desplegament d'una Aplicació Web</a></li>
<li><a href="11-02-cicd-kubernetes">CI/CD amb Kubernetes</a></li>
<li><a href="11-03-running-stateful-applications">Execució d'Aplicacions Stateful</a></li>
<li><a href="11-04-multi-cluster-management">Gestió Multi-Clúster</a></li>
</ul>
<h2>Mòdul 12: Preparació per a la Certificació de Kubernetes</h2>
<ul>
<li><a href="12-01-cka">Administrador Certificat de Kubernetes (CKA)</a></li>
<li><a href="12-02-ckad">Desenvolupador d'Aplicacions Certificat de Kubernetes (CKAD)</a></li>
<li><a href="12-03-cks">Especialista en Seguretat Certificat de Kubernetes (CKS)</a></li>
<li><a href="12-04-exam-preparation-tips">Consells per a la Preparació de l'Examen</a></li>
</ul>

	</div>










		</div>
	</div>
</div>		
<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objectiu" rel="nofollow">El Projecte</a> | 
<a href="/sobre-nosaltres" rel="nofollow">Sobre nosaltres</a> | 
<a href="/contribuir" rel="nofollow">Contribuir</a> | 
<a href="/donar" rel="nofollow">Donacions</a> | 
<a href="/llicencia" rel="nofollow">Llicència</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

		<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">Usuari no autentificat</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            	<div id="modal-body-main"></div>
            </div>
        </div>
    </div>
</div>	</div>    
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
