<!DOCTYPE html>
<html lang="ca">
<head>
    <title> Bloqueig de l'estat </title>
        
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, nofollow, noarchive">
    
    <link rel="alternate" href="https://campusempresa.com/cursos/terraform/03-04-state-locking" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/cursos/terraform/03-04-state-locking" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/courses/terraform/03-04-state-locking" hreflang="en" />
    
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.ea63f62b9e.css" rel="stylesheet">
	 
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script>
  		var LANG = "ca";
  		var CATEGORY = "frameworks";
  		var MOD_NAME = "terraform";
  		var TEMA_NAME = "3-4";
  		var TYPE = "mod";
  		var PATH = "mod/terraform/03-04-state-locking";
  		var IS_INDEX = false;
  	</script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="module" src="/js/app.902a5a267d.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>
	  	
</head>

<body class="d-none">
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-0 text-end">
			<p class="mb-0 p-0">	<a href="https://enterprisecampus.net/courses/terraform/03-04-state-locking" class="px-2">EN</a></b>
	|
	<a href="https://campusempresa.com/cursos/terraform/03-04-state-locking" class="px-2">ES</a></b>
	|
	<b class="px-2">CA</b>
</p>
			<p class="mb-4 mt-0 mx-2  d-none d-md-block"><cite>Tot el coneixement al teu abast</cite></p>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objectiu" rel="nofollow">El Projecte</a> | 
<a href="/sobre-nosaltres" rel="nofollow">Sobre nosaltres</a> | 
<a href="/contribuir" rel="nofollow">Contribuir</a> | 
<a href="/donar" rel="nofollow">Donacions</a> | 
<a href="/llicencia" rel="nofollow">Llicència</a>
		</div>
	</div>
</div>
		<div class="top-bar container-fluid p-0">
	<div class="container-xxl p-0">
		<div class="row">
			<div class="col">
				<div class="d-flex justify-content-between">
					<div class="left">
						<a href="/" class="nav-link px-3" id="btnHome">
	<i class="bi bi-house-fill"></i>
	HOME
</a>

<a href="/els-meus-cursos" class="nav-link px-3 d-none" id="btnMyCourses">
	<i class="bi bi-rocket-takeoff-fill"></i>
	<i><b>Els meus cursos</b></i>
</a>
<a href="/cursos-finalitzats" class="nav-link px-3 d-none" id="trophy_button">
	<i class="bi bi-trophy-fill"></i>
	Finalitzats             
</a>

					</div>
                    <div class="ms-auto right">
                        <a id="user_button" href="#" class="nav-link px-3" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i id="user_icon" class="bi"></i>                            
                        </a>
                    </div>					
				</div>
			</div>
		</div>
	</div>
</div>

		<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
										<div class="row py-1 m-0" id="buttonsModSection">
	<div class="col-6 p-0" data-mod="terraform">
		<a  href="#" class="text-secondary d-none" data-read-mod="terraform" data-read-unit="3-4" style="text-decoration:none;">
			<i class="bi bi-check-circle-fill"></i> 
			Marcar com a llegit
		</a>
		<a href="#" class="text-secondary d-none" data-unread-mod="terraform" data-unread-unit="3-4" style="text-decoration:none;">
			<i class="bi bi-x-circle-fill"></i>
			Marcar com a no llegit
		</a>
	</div>
	<div class="col-6 text-end p-0">
					<a href="./"  class="nav-link">
				<i class="bi bi-journal-text"></i>
				Contingut del curs
			</a>
			</div>
</div>						<div id="inner_content">
				<div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='03-03-remote-state' title="Estat remot" class="py-2 px-3 btn btn-primary">
				&#x25C4; Anterior 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='03-03-remote-state' title="Estat remot" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
					<h2 style="text-decoration:underline">Bloqueig de l'estat</h2>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='04-01-introduction-to-modules' title="Introducció als mòduls" class="py-2 px-3 btn btn-primary"
				data-read-mod="terraform" data-read-unit="3-4">
				Següent &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='04-01-introduction-to-modules' title="Introducció als mòduls" class="py-2 px-3 btn btn-primary" 
				data-read-mod="terraform" data-read-unit="3-4">
				 &#x25BA;
			</a>
			</div>
</div>
<div class='content'><p>El bloqueig de l'estat és una funcionalitat crucial en Terraform que ajuda a evitar conflictes quan múltiples usuaris o processos intenten modificar l'estat simultàniament. Sense un mecanisme de bloqueig, es podrien produir inconsistències i corrupcions en l'estat, cosa que podria portar a errors greus en la infraestructura.</p>
</div><h1>Conceptes clau</h1>
<div class='content'><ul>
<li><strong>Bloqueig d'estat</strong>: Mecanisme per assegurar que només un procés pugui modificar l'estat a la vegada.</li>
<li><strong>Backend</strong>: Emmagatzematge on es guarda l'estat de Terraform. Alguns backends suporten el bloqueig automàtic.</li>
<li><strong>DynamoDB</strong>: Un servei de base de dades NoSQL d'Amazon que es pot utilitzar per implementar el bloqueig d'estat en AWS.</li>
</ul>
</div><h1>Com funciona el bloqueig d'estat</h1>
<div class='content'><p>Quan Terraform inicia una operació que modifica l'estat (com <code>terraform apply</code> o <code>terraform plan</code>), intenta adquirir un bloqueig. Si el bloqueig ja està adquirit per un altre procés, Terraform esperarà fins que el bloqueig estigui disponible. Això assegura que només un procés pugui modificar l'estat a la vegada.</p>
</div><h1>Configuració del bloqueig d'estat amb DynamoDB</h1>
<div class='content'></div><h2>Requisits previs</h2>
<div class='content'><ul>
<li>Un compte d'AWS amb permisos per crear taules DynamoDB.</li>
<li>Terraform instal·lat i configurat.</li>
</ul>
</div><h2>Passos per configurar el bloqueig d'estat</h2>
<div class='content'><ol>
<li>
<p><strong>Crear una taula DynamoDB per al bloqueig d'estat</strong>:</p>
<pre><code class="language-bash">aws dynamodb create-table <br>       --table-name terraform-lock-table <br>       --attribute-definitions AttributeName=LockID,AttributeType=S <br>       --key-schema AttributeName=LockID,KeyType=HASH <br>       --provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5
</code></pre>
</li>
<li>
<p><strong>Configurar el backend de Terraform per utilitzar DynamoDB per al bloqueig</strong>:</p>
<p>Afegeix la configuració següent al fitxer <code>main.tf</code>:</p>
<pre><code class="language-hcl">terraform {
  backend &quot;s3&quot; {
    bucket         = &quot;my-terraform-state-bucket&quot;
    key            = &quot;path/to/my/key&quot;
    region         = &quot;us-west-2&quot;
    dynamodb_table = &quot;terraform-lock-table&quot;
  }
}
</code></pre>
</li>
</ol>
</div><h2>Exemple complet</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHJvdmlkZXIgImF3cyIgewogIHJlZ2lvbiA9ICJ1cy13ZXN0LTIiCn0KCnRlcnJhZm9ybSB7CiAgYmFja2VuZCAiczMiIHsKICAgIGJ1Y2tldCAgICAgICAgID0gIm15LXRlcnJhZm9ybS1zdGF0ZS1idWNrZXQiCiAgICBrZXkgICAgICAgICAgICA9ICJwYXRoL3RvL215L2tleSIKICAgIHJlZ2lvbiAgICAgICAgID0gInVzLXdlc3QtMiIKICAgIGR5bmFtb2RiX3RhYmxlID0gInRlcnJhZm9ybS1sb2NrLXRhYmxlIgogIH0KfQoKcmVzb3VyY2UgImF3c19zM19idWNrZXQiICJleGFtcGxlIiB7CiAgYnVja2V0ID0gIm15LWV4YW1wbGUtYnVja2V0IgogIGFjbCAgICA9ICJwcml2YXRlIgp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>provider &quot;aws&quot; {
  region = &quot;us-west-2&quot;
}

terraform {
  backend &quot;s3&quot; {
    bucket         = &quot;my-terraform-state-bucket&quot;
    key            = &quot;path/to/my/key&quot;
    region         = &quot;us-west-2&quot;
    dynamodb_table = &quot;terraform-lock-table&quot;
  }
}

resource &quot;aws_s3_bucket&quot; &quot;example&quot; {
  bucket = &quot;my-example-bucket&quot;
  acl    = &quot;private&quot;
}</pre></div><div class='content'></div><h2>Explicació del codi</h2>
<div class='content'><ul>
<li><strong>provider &quot;aws&quot;</strong>: Configura el proveïdor AWS.</li>
<li><strong>terraform { backend &quot;s3&quot; { ... } }</strong>: Configura el backend S3 per emmagatzemar l'estat i utilitza DynamoDB per al bloqueig.</li>
<li><strong>resource &quot;aws_s3_bucket&quot; &quot;example&quot; { ... }</strong>: Defineix un recurs S3 com a exemple.</li>
</ul>
</div><h1>Errors comuns i solucions</h1>
<div class='content'><ul>
<li>
<p><strong>Error: &quot;Error acquiring the state lock&quot;</strong>:</p>
<ul>
<li><strong>Causa</strong>: Un altre procés ja ha adquirit el bloqueig.</li>
<li><strong>Solució</strong>: Espera que l'altre procés alliberi el bloqueig o investiga si hi ha un bloqueig orfe.</li>
</ul>
</li>
<li>
<p><strong>Error: &quot;DynamoDB table not found&quot;</strong>:</p>
<ul>
<li><strong>Causa</strong>: La taula DynamoDB especificada no existeix.</li>
<li><strong>Solució</strong>: Assegura't que la taula DynamoDB està creada i que el nom és correcte.</li>
</ul>
</li>
</ul>
</div><h1>Exercici pràctic</h1>
<div class='content'></div><h2>Objectiu</h2>
<div class='content'><p>Configurar el bloqueig d'estat utilitzant DynamoDB per a una infraestructura simple en AWS.</p>
</div><h2>Passos</h2>
<div class='content'><ol>
<li>Crea una taula DynamoDB per al bloqueig d'estat.</li>
<li>Configura el backend de Terraform per utilitzar S3 i DynamoDB.</li>
<li>Defineix un recurs simple, com un bucket S3.</li>
<li>Executa <code>terraform init</code> i <code>terraform apply</code> per veure el bloqueig en acció.</li>
</ol>
</div><h2>Solució</h2>
<div class='content'><ol>
<li>
<p><strong>Crear la taula DynamoDB</strong>:</p>
<pre><code class="language-bash">aws dynamodb create-table <br>       --table-name terraform-lock-table <br>       --attribute-definitions AttributeName=LockID,AttributeType=S <br>       --key-schema AttributeName=LockID,KeyType=HASH <br>       --provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5
</code></pre>
</li>
<li>
<p><strong>Configurar el backend de Terraform</strong>:</p>
<pre><code class="language-hcl">terraform {
  backend &quot;s3&quot; {
    bucket         = &quot;my-terraform-state-bucket&quot;
    key            = &quot;path/to/my/key&quot;
    region         = &quot;us-west-2&quot;
    dynamodb_table = &quot;terraform-lock-table&quot;
  }
}
</code></pre>
</li>
<li>
<p><strong>Definir un recurs simple</strong>:</p>
<pre><code class="language-hcl">provider &quot;aws&quot; {
  region = &quot;us-west-2&quot;
}

resource &quot;aws_s3_bucket&quot; &quot;example&quot; {
  bucket = &quot;my-example-bucket&quot;
  acl    = &quot;private&quot;
}
</code></pre>
</li>
<li>
<p><strong>Executar Terraform</strong>:</p>
<pre><code class="language-bash">terraform init
terraform apply
</code></pre>
</li>
</ol>
</div><h1>Conclusió</h1>
<div class='content'><p>El bloqueig d'estat és una funcionalitat essencial per garantir la consistència i la integritat de l'estat en Terraform, especialment quan múltiples usuaris o processos treballen en la mateixa infraestructura. Utilitzar serveis com DynamoDB per implementar el bloqueig d'estat és una pràctica recomanada per evitar conflictes i errors.</p>
</div><div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='03-03-remote-state' title="Estat remot" class="py-2 px-3 btn btn-primary">
				&#x25C4; Anterior 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='03-03-remote-state' title="Estat remot" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='04-01-introduction-to-modules' title="Introducció als mòduls" class="py-2 px-3 btn btn-primary"
				data-read-mod="terraform" data-read-unit="3-4">
				Següent &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='04-01-introduction-to-modules' title="Introducció als mòduls" class="py-2 px-3 btn btn-primary" 
				data-read-mod="terraform" data-read-unit="3-4">
				 &#x25BA;
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
						
	<div class="container mt-2 d-none d-md-block index">
		<h1>Curs de Terraform</h1>
<h2>Mòdul 1: Introducció a Terraform</h2>
<ul>
<li><a href="01-01-what-is-terraform">Què és Terraform?</a></li>
<li><a href="01-02-installing-terraform">Instal·lant Terraform</a></li>
<li><a href="01-03-terraform-basics">Conceptes bàsics de Terraform</a></li>
<li><a href="01-04-first-terraform-configuration">Primera configuració de Terraform</a></li>
</ul>
<h2>Mòdul 2: Llenguatge de configuració de Terraform</h2>
<ul>
<li><a href="02-01-hcl-syntax">Sintaxi HCL</a></li>
<li><a href="02-02-variables-and-outputs">Variables i sortides</a></li>
<li><a href="02-03-resource-and-data-blocks">Blocs de recursos i dades</a></li>
<li><a href="02-04-providers">Proveïdors</a></li>
</ul>
<h2>Mòdul 3: Gestió de l'estat</h2>
<ul>
<li><a href="03-01-understanding-state">Comprendre l'estat</a></li>
<li><a href="03-02-state-files">Fitxers d'estat</a></li>
<li><a href="03-03-remote-state">Estat remot</a></li>
<li><a href="03-04-state-locking">Bloqueig de l'estat</a></li>
</ul>
<h2>Mòdul 4: Mòduls de Terraform</h2>
<ul>
<li><a href="04-01-introduction-to-modules">Introducció als mòduls</a></li>
<li><a href="04-02-creating-modules">Creació de mòduls</a></li>
<li><a href="04-03-using-modules">Ús de mòduls</a></li>
<li><a href="04-04-module-registry">Registre de mòduls</a></li>
</ul>
<h2>Mòdul 5: Proveïment de recursos</h2>
<ul>
<li><a href="05-01-provisioning-basics">Conceptes bàsics de proveïment</a></li>
<li><a href="05-02-provisioning-aws-resources">Proveïment de recursos AWS</a></li>
<li><a href="05-03-provisioning-azure-resources">Proveïment de recursos Azure</a></li>
<li><a href="05-04-provisioning-gcp-resources">Proveïment de recursos GCP</a></li>
</ul>
<h2>Mòdul 6: Funcionalitats avançades de Terraform</h2>
<ul>
<li><a href="06-01-terraform-workspaces">Espais de treball de Terraform</a></li>
<li><a href="06-02-terraform-functions">Funcions de Terraform</a></li>
<li><a href="06-03-dynamic-blocks">Blocs dinàmics</a></li>
<li><a href="06-04-terraform-import">Importació de Terraform</a></li>
</ul>
<h2>Mòdul 7: Millors pràctiques de Terraform</h2>
<ul>
<li><a href="07-01-code-organization">Organització del codi</a></li>
<li><a href="07-02-version-control">Control de versions</a></li>
<li><a href="07-03-testing-terraform-code">Proves del codi de Terraform</a></li>
<li><a href="07-04-security-best-practices">Millors pràctiques de seguretat</a></li>
</ul>
<h2>Mòdul 8: Terraform en CI/CD</h2>
<ul>
<li><a href="08-01-integrating-terraform-with-cicd">Integració de Terraform amb CI/CD</a></li>
<li><a href="08-02-automating-terraform-with-jenkins">Automatització de Terraform amb Jenkins</a></li>
<li><a href="08-03-using-terraform-with-github-actions">Ús de Terraform amb GitHub Actions</a></li>
<li><a href="08-04-terraform-cloud-and-enterprise">Terraform Cloud i Enterprise</a></li>
</ul>
<h2>Mòdul 9: Resolució de problemes i depuració</h2>
<ul>
<li><a href="09-01-common-errors">Errors comuns</a></li>
<li><a href="09-02-debugging-terraform">Depuració de Terraform</a></li>
<li><a href="09-03-state-management-issues">Problemes de gestió de l'estat</a></li>
<li><a href="09-04-community-and-support">Comunitat i suport</a></li>
</ul>
<h2>Mòdul 10: Projectes del món real</h2>
<ul>
<li><a href="10-01-project-aws-infrastructure">Projecte 1: Infraestructura AWS</a></li>
<li><a href="10-02-project-multi-cloud-deployment">Projecte 2: Desplegament multi-núvol</a></li>
<li><a href="10-03-project-kubernetes-with-terraform">Projecte 3: Kubernetes amb Terraform</a></li>
<li><a href="10-04-project-serverless-applications">Projecte 4: Aplicacions sense servidor</a></li>
</ul>

	</div>










		</div>
	</div>
</div>		
<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objectiu" rel="nofollow">El Projecte</a> | 
<a href="/sobre-nosaltres" rel="nofollow">Sobre nosaltres</a> | 
<a href="/contribuir" rel="nofollow">Contribuir</a> | 
<a href="/donar" rel="nofollow">Donacions</a> | 
<a href="/llicencia" rel="nofollow">Llicència</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir cookies per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Acceptar</a>
    <a href="/cookies">Més informació</a>
</div>	

		<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">Usuari no autentificat</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            	<div id="modal-body-main"></div>
            </div>
        </div>
    </div>
</div>	</div>    
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
